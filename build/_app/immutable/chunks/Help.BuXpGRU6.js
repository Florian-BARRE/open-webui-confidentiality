import{s as Qe,y as Ye,e as M,k as $,c as P,o as ee,f as g,S as lt,i as U,u as Ie,A as et,d as p,j as de,p as on,C as rt,a as I,r as gn,v as mn,w as pn,x as _n,l as je,Q as so,g as k,D as be,t as Se,E as ye,b as Ae,h as Ne,n as Re,N as wt,H as kn,F as Pn,q as Jn,V as qo,P as pr,T as Vg,U as Fg,M as Qo,z as Jr,B as io,ao as ft,W as an,X as Dt,Y as vo,_ as Vn,J as vn,a1 as pe,a3 as fi,ap as ns,aj as xd,a0 as os,aq as St,a4 as Kr,al as Kg,ar as Gg,am as Wg,I as ql,an as jl,R as Ql,O as Li,m as Yg}from"./scheduler.COi8bgmk.js";import{S as Ve,i as Fe,f as tt,b as te,d as re,m as ne,t as T,a as D,e as oe,g as Le,c as Ue,j as Ui}from"./index.Bs8QJi7D.js";import{g as Wa}from"./globals.D0QH3NT1.js";import{e as Pt,u as Is,o as Ts}from"./each.BJyh__76.js";import{t as at}from"./Toaster.svelte_svelte_type_style_lang.DWJS6NQk.js";import{C as qg,D as jg,F as Qg,a as Zd,b as Xg,P as Jg}from"./FilesOverlay.igb7FqLr.js";import{g as $s}from"./entry.CJoDrhoB.js";import{p as xg}from"./stores.C4AUZRdz.js";import{t as yr,u as Xo,c as Ci,p as $d,n as ef,m as Tr,l as Ss,e as hi,a as zo,i as As,L as _r,T as pa,d as Zg,V as Xl,X as jn,K as nn,Y as Fo,J as Mo,W as tf,h as gr,s as _a,E as $g,f as Jl,y as em,z as fr,r as tm,N as Bi,H as nm,B as hr,q as om}from"./index.CEg_AGoW.js";import{v as Uo,a as rm,B as im,C as sm,D as am,E as lm,F as cm,G as $i,H as xl,f as rs,t as um,b as qn,I as dm,m as Ya,n as fm,J as hm,K as gm,L as mm,d as pm,w as ea}from"./index.CAqpCFNN.js";import{f as ba,i as Rr,C as _m,u as ta,d as bm,a as ym}from"./index.B4m0Tvqa.js";import{d as vm}from"./index.Cg0OPtX4.js";import{p as wm,h as km}from"./index.CPLvMS4H.js";import{M as Cm,a as Em,b as Im,T as Tm,S as Sm,P as Am,q as Rm}from"./index.i9qadfDx.js";import{h as Mm,i as Zl,j as $l}from"./index.Bw9bk_sn.js";import{q as Pm,r as Om,s as Nm,t as Dm,v as Hm,w as Lm}from"./index.wYMsEk5_.js";import{g as qa,j as Um,k as Bm,l as zm}from"./index.C4m6ypjA.js";import{W as Vm,B as ja}from"./WrenchSolid.CXjLHWml.js";import{u as Fm,b as Km}from"./index.DFddHU6T.js";import"./updater.Bk3MSEsf.js";import{D as Rs,M as Ln}from"./Dropdown.BuR5DAeA.js";import{b as Ms}from"./menu-trigger.C9rldVBO.js";import{f as Ei}from"./index.BFuekP1B.js";import{T as Gt}from"./Tooltip.B-3Et9rk.js";import{S as Gm}from"./Switch.CLaBGINu.js";import{V as Wm,R as Ym}from"./RichTextInput.74Ru7sRv.js";import{g as qm}from"./index.CyuTU49n.js";import{g as jm}from"./index.BzBr5V23.js";import{F as nf}from"./fuse.CU2r43ac.js";import{d as Qm,r as Xm}from"./relativeTime.BDz4fsXT.js";import{S as Ps}from"./Spinner.CDQGqs0P.js";import{F as of}from"./FileItem.BJjA9Yfq.js";import{h as mo,ba as rf,bb as Qa,bc as na,bd as oa,be as Jm,ah as xm,bf as Zm,bg as $m,af as sf,bh as ep}from"./Markdown.DB9plO3Y.js";import{X as Os}from"./XMark.DYluEBXi.js";import{G as tp}from"./GlobeAlt.DjmUVOmA.js";import{S as np,E as op,K as rp,M as ip}from"./Messages.DXKfQvit.js";import{m as is}from"./marked.esm._0_gBwjO.js";import{S as sp}from"./Selector.DQe_xl0i.js";import{f as ap}from"./FileSaver.min.CimDdHIv.js";import{a as lp}from"./index.D7AM03-4.js";import{U as cp}from"./UserMenu.C-ed6zv_.js";import{M as up}from"./MenuLines.MTFiQ6hC.js";import{M as dp}from"./Modal.DiiA2I-w.js";import{A as fp}from"./AdvancedParams.D4oxGnBx.js";import{g as hp,j as gp,k as mp,l as pp}from"./index.DBGWvNys.js";import{V as _p,H as bp}from"./Heart.BR_J3iN0.js";import{C as es}from"./Collapsible.CgOPK37m.js";import{s as yp,t as vp}from"./index.WVUePvoN.js";import{D as wp}from"./Drawer.DR5TGN0u.js";import{w as ot,a as ho,d as Ur}from"./index.CQwy_pUe.js";import{g as rr,a as gi}from"./spread.CgU5AtxT.js";import{E as kp}from"./EllipsisVertical.DL5paeJE.js";import{C as Cp}from"./ConfirmDialog.CkQZuRwU.js";import{f as zi}from"./index.DcmDifxE.js";function Ep(o){let e;for(;e=o.sourceEvent;)o=e;return o}function To(o,e){if(o=Ep(o),e===void 0&&(e=o.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var n=t.createSVGPoint();return n.x=o.clientX,n.y=o.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[o.clientX-r.left-e.clientLeft,o.clientY-r.top-e.clientTop]}}return[o.pageX,o.pageY]}const Ip={passive:!1},mi={capture:!0,passive:!1};function ra(o){o.stopImmediatePropagation()}function Br(o){o.preventDefault(),o.stopImmediatePropagation()}function af(o){var e=o.document.documentElement,t=mo(o).on("dragstart.drag",Br,mi);"onselectstart"in e?t.on("selectstart.drag",Br,mi):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function lf(o,e){var t=o.document.documentElement,n=mo(o).on("dragstart.drag",null);e&&(n.on("click.drag",Br,mi),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in t?n.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const Vi=o=>()=>o;function ya(o,{sourceEvent:e,subject:t,target:n,identifier:r,active:i,x:a,y:s,dx:l,dy:c,dispatch:u}){Object.defineProperties(this,{type:{value:o,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:u}})}ya.prototype.on=function(){var o=this._.on.apply(this._,arguments);return o===this._?this:o};function Tp(o){return!o.ctrlKey&&!o.button}function Sp(){return this.parentNode}function Ap(o,e){return e??{x:o.x,y:o.y}}function Rp(){return navigator.maxTouchPoints||"ontouchstart"in this}function Mp(){var o=Tp,e=Sp,t=Ap,n=Rp,r={},i=rf("start","drag","end"),a=0,s,l,c,u,d=0;function f(C){C.on("mousedown.drag",h).filter(n).on("touchstart.drag",v).on("touchmove.drag",m,Ip).on("touchend.drag touchcancel.drag",b).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(C,O){if(!(u||!o.call(this,C,O))){var S=w(this,e.call(this,C,O),C,O,"mouse");S&&(mo(C.view).on("mousemove.drag",_,mi).on("mouseup.drag",y,mi),af(C.view),ra(C),c=!1,s=C.clientX,l=C.clientY,S("start",C))}}function _(C){if(Br(C),!c){var O=C.clientX-s,S=C.clientY-l;c=O*O+S*S>d}r.mouse("drag",C)}function y(C){mo(C.view).on("mousemove.drag mouseup.drag",null),lf(C.view,c),Br(C),r.mouse("end",C)}function v(C,O){if(o.call(this,C,O)){var S=C.changedTouches,E=e.call(this,C,O),H=S.length,R,L;for(R=0;R<H;++R)(L=w(this,E,C,O,S[R].identifier,S[R]))&&(ra(C),L("start",C,S[R]))}}function m(C){var O=C.changedTouches,S=O.length,E,H;for(E=0;E<S;++E)(H=r[O[E].identifier])&&(Br(C),H("drag",C,O[E]))}function b(C){var O=C.changedTouches,S=O.length,E,H;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),E=0;E<S;++E)(H=r[O[E].identifier])&&(ra(C),H("end",C,O[E]))}function w(C,O,S,E,H,R){var L=i.copy(),F=To(R||S,O),q,W,A;if((A=t.call(C,new ya("beforestart",{sourceEvent:S,target:f,identifier:H,active:a,x:F[0],y:F[1],dx:0,dy:0,dispatch:L}),E))!=null)return q=A.x-F[0]||0,W=A.y-F[1]||0,function V(N,G,X){var Q=F,j;switch(N){case"start":r[H]=V,j=a++;break;case"end":delete r[H],--a;case"drag":F=To(X||G,O),j=a;break}L.call(N,C,new ya(N,{sourceEvent:G,subject:A,target:f,identifier:H,active:j,x:F[0]+q,y:F[1]+W,dx:F[0]-Q[0],dy:F[1]-Q[1],dispatch:L}),E)}}return f.filter=function(C){return arguments.length?(o=typeof C=="function"?C:Vi(!!C),f):o},f.container=function(C){return arguments.length?(e=typeof C=="function"?C:Vi(C),f):e},f.subject=function(C){return arguments.length?(t=typeof C=="function"?C:Vi(C),f):t},f.touchable=function(C){return arguments.length?(n=typeof C=="function"?C:Vi(!!C),f):n},f.on=function(){var C=i.on.apply(i,arguments);return C===i?f:C},f.clickDistance=function(C){return arguments.length?(d=(C=+C)*C,f):Math.sqrt(d)},f}var Pp=1e-12;function ec(o){return((o=Math.exp(o))+1/o)/2}function Op(o){return((o=Math.exp(o))-1/o)/2}function Np(o){return((o=Math.exp(2*o))-1)/(o+1)}const Dp=function o(e,t,n){function r(i,a){var s=i[0],l=i[1],c=i[2],u=a[0],d=a[1],f=a[2],h=u-s,_=d-l,y=h*h+_*_,v,m;if(y<Pp)m=Math.log(f/c)/e,v=function(E){return[s+E*h,l+E*_,c*Math.exp(e*E*m)]};else{var b=Math.sqrt(y),w=(f*f-c*c+n*y)/(2*c*t*b),C=(f*f-c*c-n*y)/(2*f*t*b),O=Math.log(Math.sqrt(w*w+1)-w),S=Math.log(Math.sqrt(C*C+1)-C);m=(S-O)/e,v=function(E){var H=E*m,R=ec(O),L=c/(t*b)*(R*Np(e*H+O)-Op(O));return[s+L*h,l+L*_,c*R/ec(e*H+O)]}}return v.duration=m*1e3*e/Math.SQRT2,v}return r.rho=function(i){var a=Math.max(.001,+i),s=a*a,l=s*s;return o(a,s,l)},r}(Math.SQRT2,2,4),Fi=o=>()=>o;function Hp(o,{sourceEvent:e,target:t,transform:n,dispatch:r}){Object.defineProperties(this,{type:{value:o,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:r}})}function ia(o){o.stopImmediatePropagation()}function ii(o){o.preventDefault(),o.stopImmediatePropagation()}function Lp(o){return(!o.ctrlKey||o.type==="wheel")&&!o.button}function Up(){var o=this;return o instanceof SVGElement?(o=o.ownerSVGElement||o,o.hasAttribute("viewBox")?(o=o.viewBox.baseVal,[[o.x,o.y],[o.x+o.width,o.y+o.height]]):[[0,0],[o.width.baseVal.value,o.height.baseVal.value]]):[[0,0],[o.clientWidth,o.clientHeight]]}function tc(){return this.__zoom||Qa}function Bp(o){return-o.deltaY*(o.deltaMode===1?.05:o.deltaMode?1:.002)*(o.ctrlKey?10:1)}function zp(){return navigator.maxTouchPoints||"ontouchstart"in this}function Vp(o,e,t){var n=o.invertX(e[0][0])-t[0][0],r=o.invertX(e[1][0])-t[1][0],i=o.invertY(e[0][1])-t[0][1],a=o.invertY(e[1][1])-t[1][1];return o.translate(r>n?(n+r)/2:Math.min(0,n)||Math.max(0,r),a>i?(i+a)/2:Math.min(0,i)||Math.max(0,a))}function Fp(){var o=Lp,e=Up,t=Vp,n=Bp,r=zp,i=[0,1/0],a=[[-1/0,-1/0],[1/0,1/0]],s=250,l=Dp,c=rf("start","zoom","end"),u,d,f,h=500,_=150,y=0,v=10;function m(A){A.property("__zoom",tc).on("wheel.zoom",H,{passive:!1}).on("mousedown.zoom",R).on("dblclick.zoom",L).filter(r).on("touchstart.zoom",F).on("touchmove.zoom",q).on("touchend.zoom touchcancel.zoom",W).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.transform=function(A,V,N,G){var X=A.selection?A.selection():A;X.property("__zoom",tc),A!==X?O(A,V,N,G):X.interrupt().each(function(){S(this,arguments).event(G).start().zoom(null,typeof V=="function"?V.apply(this,arguments):V).end()})},m.scaleBy=function(A,V,N,G){m.scaleTo(A,function(){var X=this.__zoom.k,Q=typeof V=="function"?V.apply(this,arguments):V;return X*Q},N,G)},m.scaleTo=function(A,V,N,G){m.transform(A,function(){var X=e.apply(this,arguments),Q=this.__zoom,j=N==null?C(X):typeof N=="function"?N.apply(this,arguments):N,ue=Q.invert(j),B=typeof V=="function"?V.apply(this,arguments):V;return t(w(b(Q,B),j,ue),X,a)},N,G)},m.translateBy=function(A,V,N,G){m.transform(A,function(){return t(this.__zoom.translate(typeof V=="function"?V.apply(this,arguments):V,typeof N=="function"?N.apply(this,arguments):N),e.apply(this,arguments),a)},null,G)},m.translateTo=function(A,V,N,G,X){m.transform(A,function(){var Q=e.apply(this,arguments),j=this.__zoom,ue=G==null?C(Q):typeof G=="function"?G.apply(this,arguments):G;return t(Qa.translate(ue[0],ue[1]).scale(j.k).translate(typeof V=="function"?-V.apply(this,arguments):-V,typeof N=="function"?-N.apply(this,arguments):-N),Q,a)},G,X)};function b(A,V){return V=Math.max(i[0],Math.min(i[1],V)),V===A.k?A:new na(V,A.x,A.y)}function w(A,V,N){var G=V[0]-N[0]*A.k,X=V[1]-N[1]*A.k;return G===A.x&&X===A.y?A:new na(A.k,G,X)}function C(A){return[(+A[0][0]+ +A[1][0])/2,(+A[0][1]+ +A[1][1])/2]}function O(A,V,N,G){A.on("start.zoom",function(){S(this,arguments).event(G).start()}).on("interrupt.zoom end.zoom",function(){S(this,arguments).event(G).end()}).tween("zoom",function(){var X=this,Q=arguments,j=S(X,Q).event(G),ue=e.apply(X,Q),B=N==null?C(ue):typeof N=="function"?N.apply(X,Q):N,x=Math.max(ue[1][0]-ue[0][0],ue[1][1]-ue[0][1]),J=X.__zoom,ce=typeof V=="function"?V.apply(X,Q):V,me=l(J.invert(B).concat(x/J.k),ce.invert(B).concat(x/ce.k));return function(se){if(se===1)se=ce;else{var Be=me(se),He=x/Be[2];se=new na(He,B[0]-Be[0]*He,B[1]-Be[1]*He)}j.zoom(null,se)}})}function S(A,V,N){return!N&&A.__zooming||new E(A,V)}function E(A,V){this.that=A,this.args=V,this.active=0,this.sourceEvent=null,this.extent=e.apply(A,V),this.taps=0}E.prototype={event:function(A){return A&&(this.sourceEvent=A),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(A,V){return this.mouse&&A!=="mouse"&&(this.mouse[1]=V.invert(this.mouse[0])),this.touch0&&A!=="touch"&&(this.touch0[1]=V.invert(this.touch0[0])),this.touch1&&A!=="touch"&&(this.touch1[1]=V.invert(this.touch1[0])),this.that.__zoom=V,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(A){var V=mo(this.that).datum();c.call(A,this.that,new Hp(A,{sourceEvent:this.sourceEvent,target:m,type:A,transform:this.that.__zoom,dispatch:c}),V)}};function H(A,...V){if(!o.apply(this,arguments))return;var N=S(this,V).event(A),G=this.__zoom,X=Math.max(i[0],Math.min(i[1],G.k*Math.pow(2,n.apply(this,arguments)))),Q=To(A);if(N.wheel)(N.mouse[0][0]!==Q[0]||N.mouse[0][1]!==Q[1])&&(N.mouse[1]=G.invert(N.mouse[0]=Q)),clearTimeout(N.wheel);else{if(G.k===X)return;N.mouse=[Q,G.invert(Q)],oa(this),N.start()}ii(A),N.wheel=setTimeout(j,_),N.zoom("mouse",t(w(b(G,X),N.mouse[0],N.mouse[1]),N.extent,a));function j(){N.wheel=null,N.end()}}function R(A,...V){if(f||!o.apply(this,arguments))return;var N=A.currentTarget,G=S(this,V,!0).event(A),X=mo(A.view).on("mousemove.zoom",B,!0).on("mouseup.zoom",x,!0),Q=To(A,N),j=A.clientX,ue=A.clientY;af(A.view),ia(A),G.mouse=[Q,this.__zoom.invert(Q)],oa(this),G.start();function B(J){if(ii(J),!G.moved){var ce=J.clientX-j,me=J.clientY-ue;G.moved=ce*ce+me*me>y}G.event(J).zoom("mouse",t(w(G.that.__zoom,G.mouse[0]=To(J,N),G.mouse[1]),G.extent,a))}function x(J){X.on("mousemove.zoom mouseup.zoom",null),lf(J.view,G.moved),ii(J),G.event(J).end()}}function L(A,...V){if(o.apply(this,arguments)){var N=this.__zoom,G=To(A.changedTouches?A.changedTouches[0]:A,this),X=N.invert(G),Q=N.k*(A.shiftKey?.5:2),j=t(w(b(N,Q),G,X),e.apply(this,V),a);ii(A),s>0?mo(this).transition().duration(s).call(O,j,G,A):mo(this).call(m.transform,j,G,A)}}function F(A,...V){if(o.apply(this,arguments)){var N=A.touches,G=N.length,X=S(this,V,A.changedTouches.length===G).event(A),Q,j,ue,B;for(ia(A),j=0;j<G;++j)ue=N[j],B=To(ue,this),B=[B,this.__zoom.invert(B),ue.identifier],X.touch0?!X.touch1&&X.touch0[2]!==B[2]&&(X.touch1=B,X.taps=0):(X.touch0=B,Q=!0,X.taps=1+!!u);u&&(u=clearTimeout(u)),Q&&(X.taps<2&&(d=B[0],u=setTimeout(function(){u=null},h)),oa(this),X.start())}}function q(A,...V){if(this.__zooming){var N=S(this,V).event(A),G=A.changedTouches,X=G.length,Q,j,ue,B;for(ii(A),Q=0;Q<X;++Q)j=G[Q],ue=To(j,this),N.touch0&&N.touch0[2]===j.identifier?N.touch0[0]=ue:N.touch1&&N.touch1[2]===j.identifier&&(N.touch1[0]=ue);if(j=N.that.__zoom,N.touch1){var x=N.touch0[0],J=N.touch0[1],ce=N.touch1[0],me=N.touch1[1],se=(se=ce[0]-x[0])*se+(se=ce[1]-x[1])*se,Be=(Be=me[0]-J[0])*Be+(Be=me[1]-J[1])*Be;j=b(j,Math.sqrt(se/Be)),ue=[(x[0]+ce[0])/2,(x[1]+ce[1])/2],B=[(J[0]+me[0])/2,(J[1]+me[1])/2]}else if(N.touch0)ue=N.touch0[0],B=N.touch0[1];else return;N.zoom("touch",t(w(j,ue,B),N.extent,a))}}function W(A,...V){if(this.__zooming){var N=S(this,V).event(A),G=A.changedTouches,X=G.length,Q,j;for(ia(A),f&&clearTimeout(f),f=setTimeout(function(){f=null},h),Q=0;Q<X;++Q)j=G[Q],N.touch0&&N.touch0[2]===j.identifier?delete N.touch0:N.touch1&&N.touch1[2]===j.identifier&&delete N.touch1;if(N.touch1&&!N.touch0&&(N.touch0=N.touch1,delete N.touch1),N.touch0)N.touch0[1]=this.__zoom.invert(N.touch0[0]);else if(N.end(),N.taps===2&&(j=To(j,this),Math.hypot(d[0]-j[0],d[1]-j[1])<v)){var ue=mo(this).on("dblclick.zoom");ue&&ue.apply(this,arguments)}}}return m.wheelDelta=function(A){return arguments.length?(n=typeof A=="function"?A:Fi(+A),m):n},m.filter=function(A){return arguments.length?(o=typeof A=="function"?A:Fi(!!A),m):o},m.touchable=function(A){return arguments.length?(r=typeof A=="function"?A:Fi(!!A),m):r},m.extent=function(A){return arguments.length?(e=typeof A=="function"?A:Fi([[+A[0][0],+A[0][1]],[+A[1][0],+A[1][1]]]),m):e},m.scaleExtent=function(A){return arguments.length?(i[0]=+A[0],i[1]=+A[1],m):[i[0],i[1]]},m.translateExtent=function(A){return arguments.length?(a[0][0]=+A[0][0],a[1][0]=+A[1][0],a[0][1]=+A[0][1],a[1][1]=+A[1][1],m):[[a[0][0],a[0][1]],[a[1][0],a[1][1]]]},m.constrain=function(A){return arguments.length?(t=A,m):t},m.duration=function(A){return arguments.length?(s=+A,m):s},m.interpolate=function(A){return arguments.length?(l=A,m):l},m.on=function(){var A=c.on.apply(c,arguments);return A===c?m:A},m.clickDistance=function(A){return arguments.length?(y=(A=+A)*A,m):Math.sqrt(y)},m.tapDistance=function(A){return arguments.length?(v=+A,m):v},m}function Kp(o){let e,t,n,r,i,a,s;return l(),{feed:c,reset:l};function l(){e=!0,t="",n=0,r=-1,i=void 0,a=void 0,s=""}function c(d){t=t?t+d:d,e&&Gp(t)&&(t=t.slice(cf.length)),e=!1;const f=t.length;let h=0,_=!1;for(;h<f;){_&&(t[h]===`
`&&++h,_=!1);let y=-1,v=r,m;for(let b=n;y<0&&b<f;++b)m=t[b],m===":"&&v<0?v=b-h:m==="\r"?(_=!0,y=b-h):m===`
`&&(y=b-h);if(y<0){n=f-h,r=v;break}else n=0,r=-1;u(t,h,v,y),h+=y+1}h===f?t="":h>0&&(t=t.slice(h))}function u(d,f,h,_){if(_===0){s.length>0&&(o({type:"event",id:i,event:a||void 0,data:s.slice(0,-1)}),s="",i=void 0),a=void 0;return}const y=h<0,v=d.slice(f,f+(y?_:h));let m=0;y?m=_:d[f+h+1]===" "?m=h+2:m=h+1;const b=f+m,w=_-m,C=d.slice(b,b+w).toString();if(v==="data")s+=C?"".concat(C,`
`):`
`;else if(v==="event")a=C;else if(v==="id"&&!C.includes("\0"))i=C;else if(v==="retry"){const O=parseInt(C,10);Number.isNaN(O)||o({type:"reconnect-interval",value:O})}}}const cf=[239,187,191];function Gp(o){return cf.every((e,t)=>o.charCodeAt(t)===e)}class Wp extends TransformStream{constructor(){let e;super({start(t){e=Kp(n=>{n.type==="event"&&t.enqueue(n)})},transform(t){e.feed(t)}})}}async function Yp(o,e){const t=o.pipeThrough(new TextDecoderStream).pipeThrough(new Wp).getReader();let n=qp(t);return e&&(n=jp(n)),n}async function*qp(o){var e,t,n;for(;;){const{value:r,done:i}=await o.read();if(i){yield{done:!0,value:""};break}if(!r)continue;const a=r.data;if(a.startsWith("[DONE]")){yield{done:!0,value:""};break}try{const s=JSON.parse(a);if(console.log(s),s.error){yield{done:!0,value:"",error:s.error};break}if(s.sources){yield{done:!1,value:"",sources:s.sources};continue}if(s.selected_model_id){yield{done:!1,value:"",selectedModelId:s.selected_model_id};continue}if(s.usage){yield{done:!1,value:"",usage:s.usage};continue}yield{done:!1,value:((n=(t=(e=s.choices)==null?void 0:e[0])==null?void 0:t.delta)==null?void 0:n.content)??""}}catch(s){console.error("Error extracting delta from SSE event:",s)}}}async function*jp(o){for await(const e of o){if(e.done){yield e;return}if(e.error){yield e;continue}if(e.sources){yield e;continue}if(e.selectedModelId){yield e;continue}if(e.usage){yield e;continue}let t=e.value;if(t.length<5){yield{done:!1,value:t};continue}for(;t!="";){const n=Math.min(Math.floor(Math.random()*3)+1,t.length);yield{done:!1,value:t.slice(0,n)},(document==null?void 0:document.visibilityState)!=="hidden"&&await Qp(5),t=t.slice(n)}}}const Qp=o=>new Promise(e=>setTimeout(e,o));let pi="",_i="";async function Xp(){var t,n;const o=await fetch("/api/config");if(!o.ok)throw new Error("Failed to fetch Google Drive credentials");const e=await o.json();if(pi=(t=e.google_drive)==null?void 0:t.api_key,_i=(n=e.google_drive)==null?void 0:n.client_id,!pi||!_i)throw new Error("Google Drive API credentials not configured")}const Jp=["https://www.googleapis.com/auth/drive.readonly","https://www.googleapis.com/auth/drive.file"],xp=()=>{if(!pi||!_i)throw new Error("Google Drive API credentials not configured");if(pi===""||_i==="")throw new Error("Please configure valid Google Drive API credentials")};let Ki=null,nc=!1;const Zp=()=>new Promise((o,e)=>{if(typeof gapi>"u"){const t=document.createElement("script");t.src="https://apis.google.com/js/api.js",t.onload=()=>{gapi.load("picker",()=>{o(!0)})},t.onerror=e,document.body.appendChild(t)}else gapi.load("picker",()=>{o(!0)})}),$p=()=>new Promise((o,e)=>{if(typeof google>"u"){const t=document.createElement("script");t.src="https://accounts.google.com/gsi/client",t.onload=o,t.onerror=e,document.body.appendChild(t)}else o(!0)}),e1=async()=>Ki||new Promise((o,e)=>{google.accounts.oauth2.initTokenClient({client_id:_i,scope:Jp.join(" "),callback:n=>{n.access_token?(Ki=n.access_token,o(Ki)):e(new Error("Failed to get access token"))},error_callback:n=>{e(new Error(n.message||"OAuth error occurred"))}}).requestAccessToken()}),t1=async()=>{nc||(await Xp(),xp(),await Promise.all([Zp(),$p()]),nc=!0)},n1=()=>new Promise(async(o,e)=>{try{console.log("Initializing Google Drive Picker..."),await t1(),console.log("Getting auth token...");const t=await e1();if(!t)throw console.error("Failed to get OAuth token"),new Error("Unable to get OAuth token");console.log("Auth token obtained successfully"),new google.picker.PickerBuilder().enableFeature(google.picker.Feature.NAV_HIDDEN).enableFeature(google.picker.Feature.MULTISELECT_ENABLED).addView(new google.picker.DocsView().setIncludeFolders(!1).setSelectFolderEnabled(!1).setMimeTypes("application/pdf,text/plain,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.google-apps.document,application/vnd.google-apps.spreadsheet,application/vnd.google-apps.presentation")).setOAuthToken(t).setDeveloperKey(pi).setCallback(async r=>{if(r[google.picker.Response.ACTION]===google.picker.Action.PICKED)try{const i=r[google.picker.Response.DOCUMENTS][0],a=i[google.picker.Document.ID],s=i[google.picker.Document.NAME],l=i[google.picker.Document.URL];if(!a||!s)throw new Error("Required file details missing");const c=i[google.picker.Document.MIME_TYPE];let u,d;c.includes("google-apps")?(c.includes("document")?d="text/plain":c.includes("spreadsheet")?d="text/csv":c.includes("presentation")?d="text/plain":d="application/pdf",u=`https://www.googleapis.com/drive/v3/files/${a}/export?mimeType=${encodeURIComponent(d)}`):u=`https://www.googleapis.com/drive/v3/files/${a}?alt=media`;const f=await fetch(u,{headers:{Authorization:`Bearer ${t}`,Accept:"*/*"}});if(!f.ok){const y=await f.text();throw console.error("Download failed:",{status:f.status,statusText:f.statusText,error:y}),new Error(`Failed to download file (${f.status}): ${y}`)}const h=await f.blob(),_={id:a,name:s,url:u,blob:h,headers:{Authorization:`Bearer ${t}`,Accept:"*/*"}};o(_)}catch(i){e(i)}else r[google.picker.Response.ACTION]===google.picker.Action.CANCEL&&o(null)}).build().setVisible(!0)}catch(t){console.error("Google Drive Picker error:",t),e(t)}});/*! @azure/msal-common v15.2.0 2025-02-18 */const ge={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},Gi={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR:400,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599,MULTI_SIDED_ERROR:600},Ii=[ge.OPENID_SCOPE,ge.PROFILE_SCOPE,ge.OFFLINE_ACCESS_SCOPE],oc=[...Ii,ge.EMAIL_SCOPE],Hn={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},rc={ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},nr={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},Wi={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},wn={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},ic={PLAIN:"plain",S256:"S256"},Ti={QUERY:"query",FRAGMENT:"fragment"},o1={...Ti,FORM_POST:"form_post"},uf={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},Yi={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},Mn={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},_t={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},Xa="appmetadata",r1="client_info",ai="1",ss={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},Wn={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},Tn={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},Ut={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},li={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},sc={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},ac={username:"username",password:"password"},qi={httpSuccess:200,httpBadRequest:400},Mr={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},sa={CONFIGURED_MATCHES_DETECTED:"1",CONFIGURED_NO_AUTO_DETECTION:"2",CONFIGURED_NOT_DETECTED:"3",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},mr={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},i1={Jwt:"JWT",Jwk:"JWK",Pop:"pop"},s1=300;/*! @azure/msal-common v15.2.0 2025-02-18 */const Ja="unexpected_error",a1="post_request_failed";/*! @azure/msal-common v15.2.0 2025-02-18 */const lc={[Ja]:"Unexpected error in authentication.",[a1]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class en extends Error{constructor(e,t,n){const r=t?`${e}: ${t}`:e;super(r),Object.setPrototypeOf(this,en.prototype),this.errorCode=e||ge.EMPTY_STRING,this.errorMessage=t||ge.EMPTY_STRING,this.subError=n||ge.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function df(o,e){return new en(o,e?`${lc[o]} ${e}`:lc[o])}/*! @azure/msal-common v15.2.0 2025-02-18 */const xa="client_info_decoding_error",ff="client_info_empty_error",Za="token_parsing_error",hf="null_or_empty_token",Bo="endpoints_resolution_error",gf="network_error",mf="openid_config_error",pf="hash_not_deserialized",Gr="invalid_state",_f="state_mismatch",as="state_not_found",bf="nonce_mismatch",$a="auth_time_not_found",yf="max_age_transpired",l1="multiple_matching_tokens",c1="multiple_matching_accounts",vf="multiple_matching_appMetadata",wf="request_cannot_be_made",kf="cannot_remove_empty_scope",Cf="cannot_append_scopeset",va="empty_input_scopeset",u1="device_code_polling_cancelled",d1="device_code_expired",f1="device_code_unknown_error",el="no_account_in_silent_request",Ef="invalid_cache_record",tl="invalid_cache_environment",wa="no_account_found",ka="no_crypto_object",Ca="unexpected_credential_type",h1="invalid_assertion",g1="invalid_client_credential",or="token_refresh_required",m1="user_timeout_reached",If="token_claims_cnf_required_for_signedjwt",Tf="authorization_code_missing_from_server_response",Sf="binding_key_not_removed",Af="end_session_endpoint_not_supported",nl="key_id_missing",p1="no_network_connectivity",_1="user_canceled",b1="missing_tenant_id_error",yt="method_not_implemented",y1="nested_app_auth_bridge_disabled";/*! @azure/msal-common v15.2.0 2025-02-18 */const cc={[xa]:"The client info could not be parsed/decoded correctly",[ff]:"The client info was empty",[Za]:"Token cannot be parsed",[hf]:"The token is null or empty",[Bo]:"Endpoints cannot be resolved",[gf]:"Network request failed",[mf]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[pf]:"The hash parameters could not be deserialized",[Gr]:"State was not the expected format",[_f]:"State mismatch error",[as]:"State not found",[bf]:"Nonce mismatch error",[$a]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[yf]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[l1]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[c1]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[vf]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[wf]:"Token request cannot be made without authorization code or refresh token.",[kf]:"Cannot remove null or empty scope from ScopeSet",[Cf]:"Cannot append ScopeSet",[va]:"Empty input ScopeSet cannot be processed",[u1]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[d1]:"Device code is expired.",[f1]:"Device code stopped polling for unknown reasons.",[el]:"Please pass an account object, silent flow is not supported without account information",[Ef]:"Cache record object was null or undefined.",[tl]:"Invalid environment when attempting to create cache entry",[wa]:"No account found in cache for given key.",[ka]:"No crypto object detected.",[Ca]:"Unexpected credential type.",[h1]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[g1]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[or]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[m1]:"User defined timeout for device code polling reached",[If]:"Cannot generate a POP jwt if the token_claims are not populated",[Tf]:"Server response does not contain an authorization code to proceed",[Sf]:"Could not remove the credential's binding key from storage.",[Af]:"The provided authority does not support logout",[nl]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[p1]:"No network connectivity. Check your internet connection.",[_1]:"User cancelled the flow.",[b1]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[yt]:"This method has not been implemented",[y1]:"The nested app auth bridge is disabled"};class ol extends en{constructor(e,t){super(e,t?`${cc[e]}: ${t}`:cc[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,ol.prototype)}}function ke(o,e){return new ol(o,e)}/*! @azure/msal-common v15.2.0 2025-02-18 */const ls={createNewGuid:()=>{throw ke(yt)},base64Decode:()=>{throw ke(yt)},base64Encode:()=>{throw ke(yt)},base64UrlEncode:()=>{throw ke(yt)},encodeKid:()=>{throw ke(yt)},async getPublicKeyThumbprint(){throw ke(yt)},async removeTokenBindingKey(){throw ke(yt)},async clearKeystore(){throw ke(yt)},async signJwt(){throw ke(yt)},async hashString(){throw ke(yt)}};/*! @azure/msal-common v15.2.0 2025-02-18 */var $t;(function(o){o[o.Error=0]="Error",o[o.Warning=1]="Warning",o[o.Info=2]="Info",o[o.Verbose=3]="Verbose",o[o.Trace=4]="Trace"})($t||($t={}));class ir{constructor(e,t,n){this.level=$t.Info;const r=()=>{},i=e||ir.createDefaultLoggerOptions();this.localCallback=i.loggerCallback||r,this.piiLoggingEnabled=i.piiLoggingEnabled||!1,this.level=typeof i.logLevel=="number"?i.logLevel:$t.Info,this.correlationId=i.correlationId||ge.EMPTY_STRING,this.packageName=t||ge.EMPTY_STRING,this.packageVersion=n||ge.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:$t.Info}}clone(e,t,n){return new ir({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:n||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const i=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${$t[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,i,t.containsPii||!1)}executeCallback(e,t,n){this.localCallback&&this.localCallback(e,t,n)}error(e,t){this.logMessage(e,{logLevel:$t.Error,containsPii:!1,correlationId:t||ge.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:$t.Error,containsPii:!0,correlationId:t||ge.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:$t.Warning,containsPii:!1,correlationId:t||ge.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:$t.Warning,containsPii:!0,correlationId:t||ge.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:$t.Info,containsPii:!1,correlationId:t||ge.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:$t.Info,containsPii:!0,correlationId:t||ge.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:$t.Verbose,containsPii:!1,correlationId:t||ge.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:$t.Verbose,containsPii:!0,correlationId:t||ge.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:$t.Trace,containsPii:!1,correlationId:t||ge.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:$t.Trace,containsPii:!0,correlationId:t||ge.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}/*! @azure/msal-common v15.2.0 2025-02-18 */const Rf="@azure/msal-common",rl="15.2.0";/*! @azure/msal-common v15.2.0 2025-02-18 */const il={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"};/*! @azure/msal-common v15.2.0 2025-02-18 */function xr(o,e){const t=v1(o);try{const n=e(t);return JSON.parse(n)}catch{throw ke(Za)}}function v1(o){if(!o)throw ke(hf);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(o);if(!t||t.length<4)throw ke(Za);return t[2]}function Mf(o,e){if(e===0||Date.now()-3e5>o+e)throw ke(yf)}/*! @azure/msal-common v15.2.0 2025-02-18 */function No(){return Math.round(new Date().getTime()/1e3)}function Ea(o,e){const t=Number(o)||0;return No()+e>t}function w1(o){return Number(o)>No()}/*! @azure/msal-common v15.2.0 2025-02-18 */function ci(o){return[I1(o),T1(o),S1(o),A1(o),R1(o)].join(Mn.CACHE_KEY_SEPARATOR).toLowerCase()}function Ns(o,e,t,n,r){return{credentialType:_t.ID_TOKEN,homeAccountId:o,environment:e,clientId:n,secret:t,realm:r}}function Ds(o,e,t,n,r,i,a,s,l,c,u,d,f,h,_){var v,m;const y={homeAccountId:o,credentialType:_t.ACCESS_TOKEN,secret:t,cachedAt:No().toString(),expiresOn:a.toString(),extendedExpiresOn:s.toString(),environment:e,clientId:n,realm:r,target:i,tokenType:u||Ut.BEARER};if(d&&(y.userAssertionHash=d),c&&(y.refreshOn=c.toString()),h&&(y.requestedClaims=h,y.requestedClaimsHash=_),((v=y.tokenType)==null?void 0:v.toLowerCase())!==Ut.BEARER.toLowerCase())switch(y.credentialType=_t.ACCESS_TOKEN_WITH_AUTH_SCHEME,y.tokenType){case Ut.POP:const b=xr(t,l);if(!((m=b==null?void 0:b.cnf)!=null&&m.kid))throw ke(If);y.keyId=b.cnf.kid;break;case Ut.SSH:y.keyId=f}return y}function Pf(o,e,t,n,r,i,a){const s={credentialType:_t.REFRESH_TOKEN,homeAccountId:o,environment:e,clientId:n,secret:t};return i&&(s.userAssertionHash=i),r&&(s.familyId=r),a&&(s.expiresOn=a.toString()),s}function sl(o){return o.hasOwnProperty("homeAccountId")&&o.hasOwnProperty("environment")&&o.hasOwnProperty("credentialType")&&o.hasOwnProperty("clientId")&&o.hasOwnProperty("secret")}function k1(o){return o?sl(o)&&o.hasOwnProperty("realm")&&o.hasOwnProperty("target")&&(o.credentialType===_t.ACCESS_TOKEN||o.credentialType===_t.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function C1(o){return o?sl(o)&&o.hasOwnProperty("realm")&&o.credentialType===_t.ID_TOKEN:!1}function E1(o){return o?sl(o)&&o.credentialType===_t.REFRESH_TOKEN:!1}function I1(o){return[o.homeAccountId,o.environment].join(Mn.CACHE_KEY_SEPARATOR).toLowerCase()}function T1(o){const e=o.credentialType===_t.REFRESH_TOKEN&&o.familyId||o.clientId;return[o.credentialType,e,o.realm||""].join(Mn.CACHE_KEY_SEPARATOR).toLowerCase()}function S1(o){return(o.target||"").toLowerCase()}function A1(o){return(o.requestedClaimsHash||"").toLowerCase()}function R1(o){return o.tokenType&&o.tokenType.toLowerCase()!==Ut.BEARER.toLowerCase()?o.tokenType.toLowerCase():""}function M1(o,e){const t=o.indexOf(Tn.CACHE_KEY)===0;let n=!0;return e&&(n=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&n}function P1(o,e){let t=!1;o&&(t=o.indexOf(li.THROTTLING_PREFIX)===0);let n=!0;return e&&(n=e.hasOwnProperty("throttleTime")),t&&n}function O1({environment:o,clientId:e}){return[Xa,o,e].join(Mn.CACHE_KEY_SEPARATOR).toLowerCase()}function N1(o,e){return e?o.indexOf(Xa)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function D1(o,e){return e?o.indexOf(ss.CACHE_KEY)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function uc(){return No()+ss.REFRESH_TIME_SECONDS}function ji(o,e,t){o.authorization_endpoint=e.authorization_endpoint,o.token_endpoint=e.token_endpoint,o.end_session_endpoint=e.end_session_endpoint,o.issuer=e.issuer,o.endpointsFromNetwork=t,o.jwks_uri=e.jwks_uri}function aa(o,e,t){o.aliases=e.aliases,o.preferred_cache=e.preferred_cache,o.preferred_network=e.preferred_network,o.aliasesFromNetwork=t}function dc(o){return o.expiresAt<=No()}/*! @azure/msal-common v15.2.0 2025-02-18 */const Of="redirect_uri_empty",H1="claims_request_parsing_error",Nf="authority_uri_insecure",si="url_parse_error",Df="empty_url_error",Hf="empty_input_scopes_error",Lf="invalid_prompt_value",al="invalid_claims",Uf="token_request_empty",Bf="logout_request_empty",zf="invalid_code_challenge_method",ll="pkce_params_missing",cl="invalid_cloud_discovery_metadata",Vf="invalid_authority_metadata",Ff="untrusted_authority",Hs="missing_ssh_jwk",Kf="missing_ssh_kid",L1="missing_nonce_authentication_header",U1="invalid_authentication_header",Gf="cannot_set_OIDCOptions",Wf="cannot_allow_platform_broker",Yf="authority_mismatch";/*! @azure/msal-common v15.2.0 2025-02-18 */const B1={[Of]:"A redirect URI is required for all calls, and none has been set.",[H1]:"Could not parse the given claims request object.",[Nf]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[si]:"URL could not be parsed into appropriate segments.",[Df]:"URL was empty or null.",[Hf]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[Lf]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[al]:"Given claims parameter must be a stringified JSON object.",[Uf]:"Token request was empty and not found in cache.",[Bf]:"The logout request was null or undefined.",[zf]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[ll]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[cl]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[Vf]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[Ff]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[Hs]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[Kf]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[L1]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[U1]:"Invalid authentication header provided",[Gf]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[Wf]:"Cannot set allowPlatformBroker parameter to true when not in AAD protocol mode.",[Yf]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};class ul extends en{constructor(e){super(e,B1[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,ul.prototype)}}function Vt(o){return new ul(o)}/*! @azure/msal-common v15.2.0 2025-02-18 */class Po{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},n=e.split("&"),r=i=>decodeURIComponent(i.replace(/\+/g," "));return n.forEach(i=>{if(i.trim()){const[a,s]=i.split(/=(.+)/g,2);a&&s&&(t[r(a)]=r(s))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class un{constructor(e){const t=e?Po.trimArrayEntries([...e]):[],n=t?Po.removeEmptyStringsFromArray(t):[];if(!n||!n.length)throw Vt(Hf);this.scopes=new Set,n.forEach(r=>this.scopes.add(r))}static fromString(e){const n=(e||ge.EMPTY_STRING).split(" ");return new un(n)}static createSearchScopes(e){const t=new un(e);return t.containsOnlyOIDCScopes()?t.removeScope(ge.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}containsScope(e){const t=this.printScopesLowerCase().split(" "),n=new un(t);return e?n.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return oc.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw ke(Cf)}}removeScope(e){if(!e)throw ke(kf);this.scopes.delete(e.trim())}removeOIDCScopes(){oc.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw ke(va);const t=new Set;return e.scopes.forEach(n=>t.add(n.toLowerCase())),this.scopes.forEach(n=>t.add(n.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw ke(va);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),n=e.getScopeCount(),r=this.getScopeCount();return t.size<r+n}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):ge.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}/*! @azure/msal-common v15.2.0 2025-02-18 */function cs(o,e){if(!o)throw ke(ff);try{const t=e(o);return JSON.parse(t)}catch{throw ke(xa)}}function Dr(o){if(!o)throw ke(xa);const e=o.split(Mn.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?ge.EMPTY_STRING:e[1]}}/*! @azure/msal-common v15.2.0 2025-02-18 */function fc(o,e){return!!o&&!!e&&o===e.split(".")[1]}function dl(o,e,t,n){if(n){const{oid:r,sub:i,tid:a,name:s,tfp:l,acr:c}=n,u=a||l||c||"";return{tenantId:u,localAccountId:r||i||"",name:s,isHomeTenant:fc(u,o)}}else return{tenantId:t,localAccountId:e,isHomeTenant:fc(t,o)}}function fl(o,e,t,n){let r=o;if(e){const{isHomeTenant:i,...a}=e;r={...o,...a}}if(t){const{isHomeTenant:i,...a}=dl(o.homeAccountId,o.localAccountId,o.tenantId,t);return r={...r,...a,idTokenClaims:t,idToken:n},r}return r}/*! @azure/msal-common v15.2.0 2025-02-18 */const go={Default:0,Adfs:1,Dsts:2,Ciam:3};/*! @azure/msal-common v15.2.0 2025-02-18 */function qf(o){return o&&(o.tid||o.tfp||o.acr)||null}/*! @azure/msal-common v15.2.0 2025-02-18 */const Ko={AAD:"AAD",OIDC:"OIDC"};/*! @azure/msal-common v15.2.0 2025-02-18 */class Un{generateAccountId(){return[this.homeAccountId,this.environment].join(Mn.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return Un.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){const t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(Mn.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,n){var c,u,d,f,h,_;const r=new Un;t.authorityType===go.Adfs?r.authorityType=Yi.ADFS_ACCOUNT_TYPE:t.protocolMode===Ko.AAD?r.authorityType=Yi.MSSTS_ACCOUNT_TYPE:r.authorityType=Yi.GENERIC_ACCOUNT_TYPE;let i;e.clientInfo&&n&&(i=cs(e.clientInfo,n)),r.clientInfo=e.clientInfo,r.homeAccountId=e.homeAccountId,r.nativeAccountId=e.nativeAccountId;const a=e.environment||t&&t.getPreferredCache();if(!a)throw ke(tl);r.environment=a,r.realm=(i==null?void 0:i.utid)||qf(e.idTokenClaims)||"",r.localAccountId=(i==null?void 0:i.uid)||((c=e.idTokenClaims)==null?void 0:c.oid)||((u=e.idTokenClaims)==null?void 0:u.sub)||"";const s=((d=e.idTokenClaims)==null?void 0:d.preferred_username)||((f=e.idTokenClaims)==null?void 0:f.upn),l=(h=e.idTokenClaims)!=null&&h.emails?e.idTokenClaims.emails[0]:null;if(r.username=s||l||"",r.name=((_=e.idTokenClaims)==null?void 0:_.name)||"",r.cloudGraphHostName=e.cloudGraphHostName,r.msGraphHost=e.msGraphHost,e.tenantProfiles)r.tenantProfiles=e.tenantProfiles;else{const y=dl(e.homeAccountId,r.localAccountId,r.realm,e.idTokenClaims);r.tenantProfiles=[y]}return r}static createFromAccountInfo(e,t,n){var i;const r=new Un;return r.authorityType=e.authorityType||Yi.GENERIC_ACCOUNT_TYPE,r.homeAccountId=e.homeAccountId,r.localAccountId=e.localAccountId,r.nativeAccountId=e.nativeAccountId,r.realm=e.tenantId,r.environment=e.environment,r.username=e.username,r.name=e.name,r.cloudGraphHostName=t,r.msGraphHost=n,r.tenantProfiles=Array.from(((i=e.tenantProfiles)==null?void 0:i.values())||[]),r}static generateHomeAccountId(e,t,n,r,i){if(!(t===go.Adfs||t===go.Dsts)){if(e)try{const a=cs(e,r.base64Decode);if(a.uid&&a.utid)return`${a.uid}.${a.utid}`}catch{}n.warning("No client info in response")}return(i==null?void 0:i.sub)||""}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,n){if(!e||!t)return!1;let r=!0;if(n){const i=e.idTokenClaims||{},a=t.idTokenClaims||{};r=i.iat===a.iat&&i.nonce===a.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&r}}/*! @azure/msal-common v15.2.0 2025-02-18 */function jf(o){return o.startsWith("#/")?o.substring(2):o.startsWith("#")||o.startsWith("?")?o.substring(1):o}function us(o){if(!o||o.indexOf("=")<0)return null;try{const e=jf(o),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.error||t.error_description||t.state)return t}catch{throw ke(pf)}return null}/*! @azure/msal-common v15.2.0 2025-02-18 */class At{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw Vt(Df);e.includes("#")||(this._urlString=At.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return Po.endsWith(t,"?")?t=t.slice(0,-1):Po.endsWith(t,"?/")&&(t=t.slice(0,-2)),Po.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw Vt(si)}if(!e.HostNameAndPort||!e.PathSegments)throw Vt(si);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw Vt(Nf)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return At.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),n=t.PathSegments;return e&&n.length!==0&&(n[0]===nr.COMMON||n[0]===nr.ORGANIZATIONS)&&(n[0]=e),At.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw Vt(si);const n={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let r=n.AbsolutePath.split("/");return r=r.filter(i=>i&&i.length>0),n.PathSegments=r,n.QueryString&&n.QueryString.endsWith("/")&&(n.QueryString=n.QueryString.substring(0,n.QueryString.length-1)),n}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),n=e.match(t);if(!n)throw Vt(si);return n[2]}static getAbsoluteUrl(e,t){if(e[0]===ge.FORWARD_SLASH){const r=new At(t).getUrlComponents();return r.Protocol+"//"+r.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new At(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!us(e)}}/*! @azure/msal-common v15.2.0 2025-02-18 */const Qf={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},hc=Qf.endpointMetadata,hl=Qf.instanceDiscoveryMetadata,Xf=new Set;hl.metadata.forEach(o=>{o.aliases.forEach(e=>{Xf.add(e)})});function z1(o,e){var r;let t;const n=o.canonicalAuthority;if(n){const i=new At(n).getUrlComponents().HostNameAndPort;t=gc(i,(r=o.cloudDiscoveryMetadata)==null?void 0:r.metadata,Wn.CONFIG,e)||gc(i,hl.metadata,Wn.HARDCODED_VALUES,e)||o.knownAuthorities}return t||[]}function gc(o,e,t,n){if(n==null||n.trace(`getAliasesFromMetadata called with source: ${t}`),o&&e){const r=ds(e,o);if(r)return n==null||n.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),r.aliases;n==null||n.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function V1(o){return ds(hl.metadata,o)}function ds(o,e){for(let t=0;t<o.length;t++){const n=o[t];if(n.aliases.includes(e))return n}return null}/*! @azure/msal-common v15.2.0 2025-02-18 */const Jf="cache_quota_exceeded",gl="cache_error_unknown";/*! @azure/msal-common v15.2.0 2025-02-18 */const la={[Jf]:"Exceeded cache storage capacity.",[gl]:"Unexpected error occurred when using cache storage."};class zr extends Error{constructor(e,t){const n=t||(la[e]?la[e]:la[gl]);super(`${e}: ${n}`),Object.setPrototypeOf(this,zr.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=n}}/*! @azure/msal-common v15.2.0 2025-02-18 */class Ia{constructor(e,t,n,r){this.clientId=e,this.cryptoImpl=t,this.commonLogger=n.clone(Rf,rl),this.staticAuthorityOptions=r}getAllAccounts(e){return this.buildTenantProfiles(this.getAccountsFilteredBy(e||{}),e)}getAccountInfoFilteredBy(e){const t=this.getAllAccounts(e);return t.length>1?t.sort(r=>r.idTokenClaims?-1:1)[0]:t.length===1?t[0]:null}getBaseAccountInfo(e){const t=this.getAccountsFilteredBy(e);return t.length>0?t[0].getAccountInfo():null}buildTenantProfiles(e,t){return e.flatMap(n=>this.getTenantProfilesFromAccountEntity(n,t==null?void 0:t.tenantId,t))}getTenantedAccountInfoByFilter(e,t,n,r){let i=null,a;if(r&&!this.tenantProfileMatchesFilter(n,r))return null;const s=this.getIdToken(e,t,n.tenantId);return s&&(a=xr(s.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(a,r))?null:(i=fl(e,n,a,s==null?void 0:s.secret),i)}getTenantProfilesFromAccountEntity(e,t,n){const r=e.getAccountInfo();let i=r.tenantProfiles||new Map;const a=this.getTokenKeys();if(t){const l=i.get(t);if(l)i=new Map([[t,l]]);else return[]}const s=[];return i.forEach(l=>{const c=this.getTenantedAccountInfoByFilter(r,a,l,n);c&&s.push(c)}),s}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}async saveCacheRecord(e,t,n){var r,i,a,s;if(!e)throw ke(Ef);try{e.account&&await this.setAccount(e.account,t),e.idToken&&(n==null?void 0:n.idToken)!==!1&&await this.setIdTokenCredential(e.idToken,t),e.accessToken&&(n==null?void 0:n.accessToken)!==!1&&await this.saveAccessToken(e.accessToken,t),e.refreshToken&&(n==null?void 0:n.refreshToken)!==!1&&await this.setRefreshTokenCredential(e.refreshToken,t),e.appMetadata&&this.setAppMetadata(e.appMetadata)}catch(l){throw(r=this.commonLogger)==null||r.error("CacheManager.saveCacheRecord: failed"),l instanceof Error?((i=this.commonLogger)==null||i.errorPii(`CacheManager.saveCacheRecord: ${l.message}`,t),l.name==="QuotaExceededError"||l.name==="NS_ERROR_DOM_QUOTA_REACHED"||l.message.includes("exceeded the quota")?((a=this.commonLogger)==null||a.error("CacheManager.saveCacheRecord: exceeded storage quota",t),new zr(Jf)):new zr(l.name,l.message)):((s=this.commonLogger)==null||s.errorPii(`CacheManager.saveCacheRecord: ${l}`,t),new zr(gl))}}async saveAccessToken(e,t){const n={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},r=this.getTokenKeys(),i=un.fromString(e.target),a=[];r.accessToken.forEach(s=>{if(!this.accessTokenKeyMatchesFilter(s,n,!1))return;const l=this.getAccessTokenCredential(s);l&&this.credentialMatchesFilter(l,n)&&un.fromString(l.target).intersectingScopeSets(i)&&a.push(this.removeAccessToken(s))}),await Promise.all(a),await this.setAccessTokenCredential(e,t)}getAccountsFilteredBy(e){const t=this.getAccountKeys(),n=[];return t.forEach(r=>{var l;if(!this.isAccountKey(r,e.homeAccountId))return;const i=this.getAccount(r,this.commonLogger);if(!i||e.homeAccountId&&!this.matchHomeAccountId(i,e.homeAccountId)||e.username&&!this.matchUsername(i.username,e.username)||e.environment&&!this.matchEnvironment(i,e.environment)||e.realm&&!this.matchRealm(i,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(i,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(i,e.authorityType))return;const a={localAccountId:e==null?void 0:e.localAccountId,name:e==null?void 0:e.name},s=(l=i.tenantProfiles)==null?void 0:l.filter(c=>this.tenantProfileMatchesFilter(c,a));s&&s.length===0||n.push(i)}),n}isAccountKey(e,t,n){return!(e.split(Mn.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||n&&!e.toLowerCase().includes(n.toLowerCase()))}isCredentialKey(e){if(e.split(Mn.CACHE_KEY_SEPARATOR).length<6)return!1;const t=e.toLowerCase();if(t.indexOf(_t.ID_TOKEN.toLowerCase())===-1&&t.indexOf(_t.ACCESS_TOKEN.toLowerCase())===-1&&t.indexOf(_t.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())===-1&&t.indexOf(_t.REFRESH_TOKEN.toLowerCase())===-1)return!1;if(t.indexOf(_t.REFRESH_TOKEN.toLowerCase())>-1){const n=`${_t.REFRESH_TOKEN}${Mn.CACHE_KEY_SEPARATOR}${this.clientId}${Mn.CACHE_KEY_SEPARATOR}`,r=`${_t.REFRESH_TOKEN}${Mn.CACHE_KEY_SEPARATOR}${ai}${Mn.CACHE_KEY_SEPARATOR}`;if(t.indexOf(n.toLowerCase())===-1&&t.indexOf(r.toLowerCase())===-1)return!1}else if(t.indexOf(this.clientId.toLowerCase())===-1)return!1;return!0}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===_t.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===Ut.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){const t=this.getKeys(),n={};return t.forEach(r=>{if(!this.isAppMetadata(r))return;const i=this.getAppMetadata(r);i&&(e.environment&&!this.matchEnvironment(i,e.environment)||e.clientId&&!this.matchClientId(i,e.clientId)||(n[r]=i))}),n}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let n=null;return t.forEach(r=>{if(!this.isAuthorityMetadata(r)||r.indexOf(this.clientId)===-1)return;const i=this.getAuthorityMetadata(r);i&&i.aliases.indexOf(e)!==-1&&(n=i)}),n}async removeAllAccounts(){const e=this.getAccountKeys(),t=[];e.forEach(n=>{t.push(this.removeAccount(n))}),await Promise.all(t)}async removeAccount(e){const t=this.getAccount(e,this.commonLogger);t&&(await this.removeAccountContext(t),this.removeItem(e))}async removeAccountContext(e){const t=this.getTokenKeys(),n=e.generateAccountId(),r=[];t.idToken.forEach(i=>{i.indexOf(n)===0&&this.removeIdToken(i)}),t.accessToken.forEach(i=>{i.indexOf(n)===0&&r.push(this.removeAccessToken(i))}),t.refreshToken.forEach(i=>{i.indexOf(n)===0&&this.removeRefreshToken(i)}),await Promise.all(r)}async removeAccessToken(e){const t=this.getAccessTokenCredential(e);if(t){if(t.credentialType.toLowerCase()===_t.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&t.tokenType===Ut.POP){const r=t.keyId;if(r)try{await this.cryptoImpl.removeTokenBindingKey(r)}catch{throw ke(Sf)}}return this.removeItem(e)}}removeAppMetadata(){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t)}),!0}readAccountFromCache(e){const t=Un.generateAccountCacheKey(e);return this.getAccount(t,this.commonLogger)}getIdToken(e,t,n,r,i){this.commonLogger.trace("CacheManager - getIdToken called");const a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:_t.ID_TOKEN,clientId:this.clientId,realm:n},s=this.getIdTokensByFilter(a,t),l=s.size;if(l<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(l>1){let c=s;if(!n){const u=new Map;s.forEach((f,h)=>{f.realm===e.tenantId&&u.set(h,f)});const d=u.size;if(d<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),s.values().next().value;if(d===1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),u.values().next().value;c=u}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),c.forEach((u,d)=>{this.removeIdToken(d)}),r&&i&&r.addFields({multiMatchedID:s.size},i),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),s.values().next().value}getIdTokensByFilter(e,t){const n=t&&t.idToken||this.getTokenKeys().idToken,r=new Map;return n.forEach(i=>{if(!this.idTokenKeyMatchesFilter(i,{clientId:this.clientId,...e}))return;const a=this.getIdTokenCredential(i);a&&this.credentialMatchesFilter(a,e)&&r.set(i,a)}),r}idTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.clientId&&n.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&n.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e){this.removeItem(e)}removeRefreshToken(e){this.removeItem(e)}getAccessToken(e,t,n,r,i,a){this.commonLogger.trace("CacheManager - getAccessToken called");const s=un.createSearchScopes(t.scopes),l=t.authenticationScheme||Ut.BEARER,c=l&&l.toLowerCase()!==Ut.BEARER.toLowerCase()?_t.ACCESS_TOKEN_WITH_AUTH_SCHEME:_t.ACCESS_TOKEN,u={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:c,clientId:this.clientId,realm:r||e.tenantId,target:s,tokenType:l,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},d=n&&n.accessToken||this.getTokenKeys().accessToken,f=[];d.forEach(_=>{if(this.accessTokenKeyMatchesFilter(_,u,!0)){const y=this.getAccessTokenCredential(_);y&&this.credentialMatchesFilter(y,u)&&f.push(y)}});const h=f.length;return h<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):h>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),f.forEach(_=>{this.removeAccessToken(ci(_))}),i&&a&&i.addFields({multiMatchedAT:f.length},a),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),f[0])}accessTokenKeyMatchesFilter(e,t,n){const r=e.toLowerCase();if(t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&r.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&r.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){const i=t.target.asArray();for(let a=0;a<i.length;a++){if(n&&!r.includes(i[a].toLowerCase()))return!1;if(!n&&r.includes(i[a].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e){const t=this.getTokenKeys(),n=[];return t.accessToken.forEach(r=>{if(!this.accessTokenKeyMatchesFilter(r,e,!0))return;const i=this.getAccessTokenCredential(r);i&&this.credentialMatchesFilter(i,e)&&n.push(i)}),n}getRefreshToken(e,t,n,r,i){this.commonLogger.trace("CacheManager - getRefreshToken called");const a=t?ai:void 0,s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:_t.REFRESH_TOKEN,clientId:this.clientId,familyId:a},l=n&&n.refreshToken||this.getTokenKeys().refreshToken,c=[];l.forEach(d=>{if(this.refreshTokenKeyMatchesFilter(d,s)){const f=this.getRefreshTokenCredential(d);f&&this.credentialMatchesFilter(f,s)&&c.push(f)}});const u=c.length;return u<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(u>1&&r&&i&&r.addFields({multiMatchedRT:u},i),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),c[0])}refreshTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.familyId&&n.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&n.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&n.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},n=this.getAppMetadataFilteredBy(t),r=Object.keys(n).map(a=>n[a]),i=r.length;if(i<1)return null;if(i>1)throw ke(vf);return r[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===ai)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){const n=e.oid||e.sub;return t===n}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){var n;return t.toLowerCase()===((n=e.name)==null?void 0:n.toLowerCase())}matchUsername(e,t){return!!(e&&typeof e=="string"&&(t==null?void 0:t.toLowerCase())===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const r=z1(this.staticAuthorityOptions,this.commonLogger);if(r.includes(t)&&r.includes(e.environment))return!0}const n=this.getAuthorityMetadataByAlias(t);return!!(n&&n.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){var n;return((n=e.realm)==null?void 0:n.toLowerCase())===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==_t.ACCESS_TOKEN&&e.credentialType!==_t.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:un.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(Xa)!==-1}isAuthorityMetadata(e){return e.indexOf(ss.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${ss.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(const n in t)e[n]=t[n];return e}}class F1 extends Ia{async setAccount(){throw ke(yt)}getAccount(){throw ke(yt)}async setIdTokenCredential(){throw ke(yt)}getIdTokenCredential(){throw ke(yt)}async setAccessTokenCredential(){throw ke(yt)}getAccessTokenCredential(){throw ke(yt)}async setRefreshTokenCredential(){throw ke(yt)}getRefreshTokenCredential(){throw ke(yt)}setAppMetadata(){throw ke(yt)}getAppMetadata(){throw ke(yt)}setServerTelemetry(){throw ke(yt)}getServerTelemetry(){throw ke(yt)}setAuthorityMetadata(){throw ke(yt)}getAuthorityMetadata(){throw ke(yt)}getAuthorityMetadataKeys(){throw ke(yt)}setThrottlingCache(){throw ke(yt)}getThrottlingCache(){throw ke(yt)}removeItem(){throw ke(yt)}getKeys(){throw ke(yt)}getAccountKeys(){throw ke(yt)}getTokenKeys(){throw ke(yt)}}/*! @azure/msal-common v15.2.0 2025-02-18 */const xf={tokenRenewalOffsetSeconds:s1,preventCorsPreflight:!1},K1={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:$t.Info,correlationId:ge.EMPTY_STRING},G1={claimsBasedCachingEnabled:!1},W1={async sendGetRequestAsync(){throw ke(yt)},async sendPostRequestAsync(){throw ke(yt)}},Y1={sku:ge.SKU,version:rl,cpu:ge.EMPTY_STRING,os:ge.EMPTY_STRING},q1={clientSecret:ge.EMPTY_STRING,clientAssertion:void 0},j1={azureCloudInstance:il.None,tenant:`${ge.DEFAULT_COMMON_TENANT}`},Q1={application:{appName:"",appVersion:""}};function X1({authOptions:o,systemOptions:e,loggerOptions:t,cacheOptions:n,storageInterface:r,networkInterface:i,cryptoInterface:a,clientCredentials:s,libraryInfo:l,telemetry:c,serverTelemetryManager:u,persistencePlugin:d,serializableCache:f}){const h={...K1,...t};return{authOptions:J1(o),systemOptions:{...xf,...e},loggerOptions:h,cacheOptions:{...G1,...n},storageInterface:r||new F1(o.clientId,ls,new ir(h)),networkInterface:i||W1,cryptoInterface:a||ls,clientCredentials:s||q1,libraryInfo:{...Y1,...l},telemetry:{...Q1,...c},serverTelemetryManager:u||null,persistencePlugin:d||null,serializableCache:f||null}}function J1(o){return{clientCapabilities:[],azureCloudOptions:j1,skipAuthorityMetadataCache:!1,instanceAware:!1,...o}}function Ta(o){return o.authOptions.authority.options.protocolMode===Ko.OIDC}/*! @azure/msal-common v15.2.0 2025-02-18 */const Xn={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};/*! @azure/msal-common v15.2.0 2025-02-18 */const vr="client_id",Zf="redirect_uri",mc="response_type",x1="response_mode",Z1="grant_type",$1="claims",e_="scope",t_="refresh_token",n_="state",o_="nonce",r_="prompt",i_="code",s_="code_challenge",a_="code_challenge_method",l_="code_verifier",c_="client-request-id",u_="x-client-SKU",d_="x-client-VER",f_="x-client-OS",h_="x-client-CPU",g_="x-client-current-telemetry",m_="x-client-last-telemetry",p_="x-ms-lib-capability",__="x-app-name",b_="x-app-ver",y_="post_logout_redirect_uri",v_="id_token_hint",w_="device_code",k_="client_secret",C_="client_assertion",E_="client_assertion_type",pc="token_type",_c="req_cnf",I_="assertion",T_="requested_token_use",bc="return_spa_code",S_="nativebroker",A_="logout_hint",R_="sid",M_="login_hint",P_="domain_hint",O_="x-client-xtra-sku",ml="brk_client_id",Sa="brk_redirect_uri";/*! @azure/msal-common v15.2.0 2025-02-18 */class Pr{static validateRedirectUri(e){if(!e)throw Vt(Of)}static validatePrompt(e){const t=[];for(const n in wn)t.push(wn[n]);if(t.indexOf(e)<0)throw Vt(Lf)}static validateClaims(e){try{JSON.parse(e)}catch{throw Vt(al)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw Vt(ll);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([ic.PLAIN,ic.S256].indexOf(e)<0)throw Vt(zf)}}/*! @azure/msal-common v15.2.0 2025-02-18 */function N_(o,e,t){if(!e)return;const n=o.get(vr);n&&o.has(ml)&&(t==null||t.addFields({embeddedClientId:n,embeddedRedirectUri:o.get(Zf)},e))}class ui{constructor(e,t){this.parameters=new Map,this.performanceClient=t,this.correlationId=e}addResponseTypeCode(){this.parameters.set(mc,encodeURIComponent(ge.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(mc,encodeURIComponent(`${ge.TOKEN_RESPONSE_TYPE} ${ge.ID_TOKEN_RESPONSE_TYPE}`))}addResponseMode(e){this.parameters.set(x1,encodeURIComponent(e||o1.QUERY))}addNativeBroker(){this.parameters.set(S_,encodeURIComponent("1"))}addScopes(e,t=!0,n=Ii){t&&!n.includes("openid")&&!e.includes("openid")&&n.push("openid");const r=t?[...e||[],...n]:e||[],i=new un(r);this.parameters.set(e_,encodeURIComponent(i.printScopes()))}addClientId(e){this.parameters.set(vr,encodeURIComponent(e))}addRedirectUri(e){Pr.validateRedirectUri(e),this.parameters.set(Zf,encodeURIComponent(e))}addPostLogoutRedirectUri(e){Pr.validateRedirectUri(e),this.parameters.set(y_,encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set(v_,encodeURIComponent(e))}addDomainHint(e){this.parameters.set(P_,encodeURIComponent(e))}addLoginHint(e){this.parameters.set(M_,encodeURIComponent(e))}addCcsUpn(e){this.parameters.set(Hn.CCS_HEADER,encodeURIComponent(`UPN:${e}`))}addCcsOid(e){this.parameters.set(Hn.CCS_HEADER,encodeURIComponent(`Oid:${e.uid}@${e.utid}`))}addSid(e){this.parameters.set(R_,encodeURIComponent(e))}addClaims(e,t){const n=this.addClientCapabilitiesToClaims(e,t);Pr.validateClaims(n),this.parameters.set($1,encodeURIComponent(n))}addCorrelationId(e){this.parameters.set(c_,encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set(u_,e.sku),this.parameters.set(d_,e.version),e.os&&this.parameters.set(f_,e.os),e.cpu&&this.parameters.set(h_,e.cpu)}addApplicationTelemetry(e){e!=null&&e.appName&&this.parameters.set(__,e.appName),e!=null&&e.appVersion&&this.parameters.set(b_,e.appVersion)}addPrompt(e){Pr.validatePrompt(e),this.parameters.set(`${r_}`,encodeURIComponent(e))}addState(e){e&&this.parameters.set(n_,encodeURIComponent(e))}addNonce(e){this.parameters.set(o_,encodeURIComponent(e))}addCodeChallengeParams(e,t){if(Pr.validateCodeChallengeParams(e,t),e&&t)this.parameters.set(s_,encodeURIComponent(e)),this.parameters.set(a_,encodeURIComponent(t));else throw Vt(ll)}addAuthorizationCode(e){this.parameters.set(i_,encodeURIComponent(e))}addDeviceCode(e){this.parameters.set(w_,encodeURIComponent(e))}addRefreshToken(e){this.parameters.set(t_,encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set(l_,encodeURIComponent(e))}addClientSecret(e){this.parameters.set(k_,encodeURIComponent(e))}addClientAssertion(e){e&&this.parameters.set(C_,encodeURIComponent(e))}addClientAssertionType(e){e&&this.parameters.set(E_,encodeURIComponent(e))}addOboAssertion(e){this.parameters.set(I_,encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set(T_,encodeURIComponent(e))}addGrantType(e){this.parameters.set(Z1,encodeURIComponent(e))}addClientInfo(){this.parameters.set(r1,"1")}addExtraQueryParameters(e){Object.entries(e).forEach(([t,n])=>{!this.parameters.has(t)&&n&&this.parameters.set(t,n)})}addClientCapabilitiesToClaims(e,t){let n;if(!e)n={};else try{n=JSON.parse(e)}catch{throw Vt(al)}return t&&t.length>0&&(n.hasOwnProperty(Wi.ACCESS_TOKEN)||(n[Wi.ACCESS_TOKEN]={}),n[Wi.ACCESS_TOKEN][Wi.XMS_CC]={values:t}),JSON.stringify(n)}addUsername(e){this.parameters.set(ac.username,encodeURIComponent(e))}addPassword(e){this.parameters.set(ac.password,encodeURIComponent(e))}addPopToken(e){e&&(this.parameters.set(pc,Ut.POP),this.parameters.set(_c,encodeURIComponent(e)))}addSshJwk(e){e&&(this.parameters.set(pc,Ut.SSH),this.parameters.set(_c,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set(g_,e.generateCurrentRequestHeaderValue()),this.parameters.set(m_,e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set(p_,li.X_MS_LIB_CAPABILITY_VALUE)}addLogoutHint(e){this.parameters.set(A_,encodeURIComponent(e))}addBrokerParameters(e){const t={};t[ml]=e.brokerClientId,t[Sa]=e.brokerRedirectUri,this.addExtraQueryParameters(t)}createQueryString(){const e=new Array;return this.parameters.forEach((t,n)=>{e.push(`${n}=${t}`)}),N_(this.parameters,this.correlationId,this.performanceClient),e.join("&")}}/*! @azure/msal-common v15.2.0 2025-02-18 */function D_(o){return o.hasOwnProperty("authorization_endpoint")&&o.hasOwnProperty("token_endpoint")&&o.hasOwnProperty("issuer")&&o.hasOwnProperty("jwks_uri")}/*! @azure/msal-common v15.2.0 2025-02-18 */function H_(o){return o.hasOwnProperty("tenant_discovery_endpoint")&&o.hasOwnProperty("metadata")}/*! @azure/msal-common v15.2.0 2025-02-18 */function L_(o){return o.hasOwnProperty("error")&&o.hasOwnProperty("error_description")}/*! @azure/msal-common v15.2.0 2025-02-18 */const ae={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",InitializeCache:"initializeCache",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",StandardInteractionClientInitializeAuthorizationCodeRequest:"standardInteractionClientInitializeAuthorizationCodeRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",AuthClientCreateQueryString:"authClientCreateQueryString",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",ImportExistingCache:"importExistingCache",SetUserData:"setUserData",LocalStorageUpdated:"localStorageUpdated",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues",GenerateHKDF:"generateHKDF",GenerateBaseKey:"generateBaseKey",Base64Decode:"base64Decode",UrlEncodeArr:"urlEncodeArr",Encrypt:"encrypt",Decrypt:"decrypt"},U_={NotStarted:0,InProgress:1,Completed:2};/*! @azure/msal-common v15.2.0 2025-02-18 */const jo=(o,e,t,n,r)=>(...i)=>{t.trace(`Executing function ${e}`);const a=n==null?void 0:n.startMeasurement(e,r);if(r){const s=e+"CallCount";n==null||n.incrementFields({[s]:1},r)}try{const s=o(...i);return a==null||a.end({success:!0}),t.trace(`Returning result from ${e}`),s}catch(s){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(s))}catch{t.trace("Unable to print error message.")}throw a==null||a.end({success:!1},s),s}},Ce=(o,e,t,n,r)=>(...i)=>{t.trace(`Executing function ${e}`);const a=n==null?void 0:n.startMeasurement(e,r);if(r){const s=e+"CallCount";n==null||n.incrementFields({[s]:1},r)}return n==null||n.setPreQueueTime(e,r),o(...i).then(s=>(t.trace(`Returning result from ${e}`),a==null||a.end({success:!0}),s)).catch(s=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(s))}catch{t.trace("Unable to print error message.")}throw a==null||a.end({success:!1},s),s})};/*! @azure/msal-common v15.2.0 2025-02-18 */class Ls{constructor(e,t,n,r){this.networkInterface=e,this.logger=t,this.performanceClient=n,this.correlationId=r}async detectRegion(e,t){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.RegionDiscoveryDetectRegion,this.correlationId);let n=e;if(n)t.region_source=Mr.ENVIRONMENT_VARIABLE;else{const i=Ls.IMDS_OPTIONS;try{const a=await Ce(this.getRegionFromIMDS.bind(this),ae.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(ge.IMDS_VERSION,i);if(a.status===qi.httpSuccess&&(n=a.body,t.region_source=Mr.IMDS),a.status===qi.httpBadRequest){const s=await Ce(this.getCurrentVersion.bind(this),ae.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(i);if(!s)return t.region_source=Mr.FAILED_AUTO_DETECTION,null;const l=await Ce(this.getRegionFromIMDS.bind(this),ae.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(s,i);l.status===qi.httpSuccess&&(n=l.body,t.region_source=Mr.IMDS)}}catch{return t.region_source=Mr.FAILED_AUTO_DETECTION,null}}return n||(t.region_source=Mr.FAILED_AUTO_DETECTION),n||null}async getRegionFromIMDS(e,t){var n;return(n=this.performanceClient)==null||n.addQueueMeasurement(ae.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${ge.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,ge.IMDS_TIMEOUT)}async getCurrentVersion(e){var t;(t=this.performanceClient)==null||t.addQueueMeasurement(ae.RegionDiscoveryGetCurrentVersion,this.correlationId);try{const n=await this.networkInterface.sendGetRequestAsync(`${ge.IMDS_ENDPOINT}?format=json`,e);return n.status===qi.httpBadRequest&&n.body&&n.body["newest-versions"]&&n.body["newest-versions"].length>0?n.body["newest-versions"][0]:null}catch{return null}}}Ls.IMDS_OPTIONS={headers:{Metadata:"true"}};/*! @azure/msal-common v15.2.0 2025-02-18 */class Rn{constructor(e,t,n,r,i,a,s,l){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=r,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=i,this.performanceClient=s,this.correlationId=a,this.managedIdentity=l||!1,this.regionDiscovery=new Ls(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(ge.CIAM_AUTH_URL))return go.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case ge.ADFS:return go.Adfs;case ge.DSTS:return go.Dsts}return go.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new At(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw ke(Bo)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw ke(Bo)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw ke(Bo)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw ke(Af);return this.replacePath(this.metadata.end_session_endpoint)}else throw ke(Bo)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw ke(Bo)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw ke(Bo)}canReplaceTenant(e){return e.PathSegments.length===1&&!Rn.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===go.Default&&this.protocolMode===Ko.AAD}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const r=new At(this.metadata.canonical_authority).getUrlComponents(),i=r.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((s,l)=>{let c=i[l];if(l===0&&this.canReplaceTenant(r)){const u=new At(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];c!==u&&(this.logger.verbose(`Replacing tenant domain name ${c} with id ${u}`),c=u)}s!==c&&(t=t.replace(`/${c}/`,`/${s}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===go.Adfs||this.protocolMode!==Ko.AAD&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){var r,i;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.AuthorityResolveEndpointsAsync,this.correlationId);const e=this.getCurrentMetadataEntity(),t=await Ce(this.updateCloudDiscoveryMetadata.bind(this),ae.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const n=await Ce(this.updateEndpointMetadata.bind(this),ae.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:n}),(i=this.performanceClient)==null||i.addFields({cloudDiscoverySource:t,authorityEndpointSource:n},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:uc(),jwks_uri:""}),e}updateCachedMetadata(e,t,n){t!==Wn.CACHE&&(n==null?void 0:n.source)!==Wn.CACHE&&(e.expiresAt=uc(),e.canonical_authority=this.canonicalAuthority);const r=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(r,e),this.metadata=e}async updateEndpointMetadata(e){var r,i,a;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.AuthorityUpdateEndpointMetadata,this.correlationId);const t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===Wn.HARDCODED_VALUES&&(i=this.authorityOptions.azureRegionConfiguration)!=null&&i.azureRegion&&t.metadata){const s=await Ce(this.updateMetadataWithRegionalInformation.bind(this),ae.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);ji(e,s,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let n=await Ce(this.getEndpointMetadataFromNetwork.bind(this),ae.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return(a=this.authorityOptions.azureRegionConfiguration)!=null&&a.azureRegion&&(n=await Ce(this.updateMetadataWithRegionalInformation.bind(this),ae.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(n)),ji(e,n,!0),Wn.NETWORK;throw ke(mf,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),ji(e,t,!1),{source:Wn.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const r=this.getEndpointMetadataFromHardcodedValues();if(r)return ji(e,r,!1),{source:Wn.HARDCODED_VALUES,metadata:r};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const n=dc(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("Found endpoint metadata in the cache."),{source:Wn.CACHE}):(n&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new At(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw Vt(Vf)}return null}async getEndpointMetadataFromNetwork(){var n;(n=this.performanceClient)==null||n.addQueueMeasurement(ae.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{const r=await this.networkInterface.sendGetRequestAsync(t,e);return D_(r.body)?r.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(r){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${r}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in hc?hc[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){var n,r,i;(n=this.performanceClient)==null||n.addQueueMeasurement(ae.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);const t=(r=this.authorityOptions.azureRegionConfiguration)==null?void 0:r.azureRegion;if(t){if(t!==ge.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=sa.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,Rn.replaceWithRegionalInformation(e,t);const a=await Ce(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),ae.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)((i=this.authorityOptions.azureRegionConfiguration)==null?void 0:i.environmentRegion,this.regionDiscoveryMetadata);if(a)return this.regionDiscoveryMetadata.region_outcome=sa.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=a,Rn.replaceWithRegionalInformation(e,a);this.regionDiscoveryMetadata.region_outcome=sa.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const n=await Ce(this.getCloudDiscoveryMetadataFromNetwork.bind(this),ae.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return aa(e,n,!0),Wn.NETWORK;throw Vt(Ff)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||ge.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||ge.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||ge.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),aa(e,t,!1),Wn.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const r=V1(this.hostnameAndPort);if(r)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),aa(e,r,!1),Wn.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const n=dc(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!n?(this.logger.verbose("Found cloud discovery metadata in the cache."),Wn.CACHE):(n&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===go.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),Rn.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=ds(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),Vt(cl)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),Rn.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);const e=`${ge.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let n=null;try{const i=await this.networkInterface.sendGetRequestAsync(e,t);let a,s;if(H_(i.body))a=i.body,s=a.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${a.tenant_discovery_endpoint}`);else if(L_(i.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${i.status}`),a=i.body,a.error===ge.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${a.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${a.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),s=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),n=ds(s,this.hostnameAndPort)}catch(i){if(i instanceof en)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${i.errorCode}
Error Description: ${i.errorMessage}`);else{const a=i;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${a.name}
Error Description: ${a.message}`)}return null}return n||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),n=Rn.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),n}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&At.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let n;if(t&&t.azureCloudInstance!==il.None){const r=t.tenant?t.tenant:ge.DEFAULT_COMMON_TENANT;n=`${t.azureCloudInstance}/${r}/`}return n||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return ge.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw ke(Bo)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return Xf.has(e)}static isPublicCloudAuthority(e){return ge.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,n){const r=new At(e);r.validateAsUri();const i=r.getUrlComponents();let a=`${t}.${i.HostNameAndPort}`;this.isPublicCloudAuthority(i.HostNameAndPort)&&(a=`${t}.${ge.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const s=At.constructAuthorityUriFromObject({...r.getUrlComponents(),HostNameAndPort:a}).urlString;return n?`${s}?${n}`:s}static replaceWithRegionalInformation(e,t){const n={...e};return n.authorization_endpoint=Rn.buildRegionalAuthorityString(n.authorization_endpoint,t),n.token_endpoint=Rn.buildRegionalAuthorityString(n.token_endpoint,t),n.end_session_endpoint&&(n.end_session_endpoint=Rn.buildRegionalAuthorityString(n.end_session_endpoint,t)),n}static transformCIAMAuthority(e){let t=e;const r=new At(e).getUrlComponents();if(r.PathSegments.length===0&&r.HostNameAndPort.endsWith(ge.CIAM_AUTH_URL)){const i=r.HostNameAndPort.split(".")[0];t=`${t}${i}${ge.AAD_TENANT_DOMAIN_SUFFIX}`}return t}}Rn.reservedTenantDomains=new Set(["{tenant}","{tenantid}",nr.COMMON,nr.CONSUMERS,nr.ORGANIZATIONS]);function B_(o){var r;const n=(r=new At(o).getUrlComponents().PathSegments.slice(-1)[0])==null?void 0:r.toLowerCase();switch(n){case nr.COMMON:case nr.ORGANIZATIONS:case nr.CONSUMERS:return;default:return n}}function $f(o){return o.endsWith(ge.FORWARD_SLASH)?o:`${o}${ge.FORWARD_SLASH}`}function z_(o){const e=o.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw Vt(cl)}return{canonicalAuthority:o.authority?$f(o.authority):void 0,knownAuthorities:o.knownAuthorities,cloudDiscoveryMetadata:t}}/*! @azure/msal-common v15.2.0 2025-02-18 */async function eh(o,e,t,n,r,i,a){a==null||a.addQueueMeasurement(ae.AuthorityFactoryCreateDiscoveredInstance,i);const s=Rn.transformCIAMAuthority($f(o)),l=new Rn(s,e,t,n,r,i,a);try{return await Ce(l.resolveEndpointsAsync.bind(l),ae.AuthorityResolveEndpointsAsync,r,a,i)(),l}catch{throw ke(Bo)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class sr extends en{constructor(e,t,n,r,i){super(e,t,n),this.name="ServerError",this.errorNo=r,this.status=i,Object.setPrototypeOf(this,sr.prototype)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class So{static generateThrottlingStorageKey(e){return`${li.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t){var i;const n=So.generateThrottlingStorageKey(t),r=e.getThrottlingCache(n);if(r){if(r.throttleTime<Date.now()){e.removeItem(n);return}throw new sr(((i=r.errorCodes)==null?void 0:i.join(" "))||ge.EMPTY_STRING,r.errorMessage,r.subError)}}static postProcess(e,t,n){if(So.checkResponseStatus(n)||So.checkResponseForRetryAfter(n)){const r={throttleTime:So.calculateThrottleTime(parseInt(n.headers[Hn.RETRY_AFTER])),error:n.body.error,errorCodes:n.body.error_codes,errorMessage:n.body.error_description,subError:n.body.suberror};e.setThrottlingCache(So.generateThrottlingStorageKey(t),r)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(Hn.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){const t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(Math.min(n+(t||li.DEFAULT_THROTTLE_TIME_SECONDS),n+li.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,n,r){const i={clientId:t,authority:n.authority,scopes:n.scopes,homeAccountIdentifier:r,claims:n.claims,authenticationScheme:n.authenticationScheme,resourceRequestMethod:n.resourceRequestMethod,resourceRequestUri:n.resourceRequestUri,shrClaims:n.shrClaims,sshKid:n.sshKid},a=this.generateThrottlingStorageKey(i);e.removeItem(a)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class Us extends en{constructor(e,t,n){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,Us.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=n}}function yc(o,e,t){return new Us(o,e,t)}/*! @azure/msal-common v15.2.0 2025-02-18 */class pl{constructor(e,t){this.config=X1(e),this.logger=new ir(this.config.loggerOptions,Rf,rl),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[Hn.CONTENT_TYPE]=ge.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case Xn.HOME_ACCOUNT_ID:try{const n=Dr(e.credential);t[Hn.CCS_HEADER]=`Oid:${n.uid}@${n.utid}`}catch(n){this.logger.verbose("Could not parse home account ID for CCS Header: "+n)}break;case Xn.UPN:t[Hn.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}async executePostToTokenEndpoint(e,t,n,r,i,a){var l;a&&((l=this.performanceClient)==null||l.addQueueMeasurement(a,i));const s=await this.sendPostRequest(r,e,{body:t,headers:n},i);return this.config.serverTelemetryManager&&s.status<500&&s.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),s}async sendPostRequest(e,t,n,r){var a,s,l;So.preProcess(this.cacheManager,e);let i;try{i=await Ce(this.networkClient.sendPostRequestAsync.bind(this.networkClient),ae.NetworkClientSendPostRequestAsync,this.logger,this.performanceClient,r)(t,n);const c=i.headers||{};(s=this.performanceClient)==null||s.addFields({refreshTokenSize:((a=i.body.refresh_token)==null?void 0:a.length)||0,httpVerToken:c[Hn.X_MS_HTTP_VERSION]||"",requestId:c[Hn.X_MS_REQUEST_ID]||""},r)}catch(c){if(c instanceof Us){const u=c.responseHeaders;throw u&&((l=this.performanceClient)==null||l.addFields({httpVerToken:u[Hn.X_MS_HTTP_VERSION]||"",requestId:u[Hn.X_MS_REQUEST_ID]||"",contentTypeHeader:u[Hn.CONTENT_TYPE]||void 0,contentLengthHeader:u[Hn.CONTENT_LENGTH]||void 0,httpStatus:c.httpStatus},r)),c.error}throw c instanceof en?c:ke(gf)}return So.postProcess(this.cacheManager,e,i),i}async updateAuthority(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(ae.UpdateTokenEndpointAuthority,t);const n=`https://${e}/${this.authority.tenant}/`,r=await eh(n,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=r}createTokenQueryParameters(e){const t=new ui(e.correlationId,this.performanceClient);return e.embeddedClientId&&t.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.addCorrelationId(e.correlationId),t.createQueryString()}}/*! @azure/msal-common v15.2.0 2025-02-18 */const fs="no_tokens_found",th="native_account_unavailable",_l="refresh_token_expired",V_="interaction_required",F_="consent_required",K_="login_required",Bs="bad_token";/*! @azure/msal-common v15.2.0 2025-02-18 */const vc=[V_,F_,K_,Bs],G_=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],W_={[fs]:"No refresh token found in the cache. Please sign-in.",[th]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[_l]:"Refresh token has expired.",[Bs]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};class bo extends en{constructor(e,t,n,r,i,a,s,l){super(e,t,n),Object.setPrototypeOf(this,bo.prototype),this.timestamp=r||ge.EMPTY_STRING,this.traceId=i||ge.EMPTY_STRING,this.correlationId=a||ge.EMPTY_STRING,this.claims=s||ge.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=l}}function wc(o,e,t){const n=!!o&&vc.indexOf(o)>-1,r=!!t&&G_.indexOf(t)>-1,i=!!e&&vc.some(a=>e.indexOf(a)>-1);return n||i||r}function Aa(o){return new bo(o,W_[o])}/*! @azure/msal-common v15.2.0 2025-02-18 */class _o{static setRequestState(e,t,n){const r=_o.generateLibraryState(e,n);return t?`${r}${ge.RESOURCE_DELIM}${t}`:r}static generateLibraryState(e,t){if(!e)throw ke(ka);const n={id:e.createNewGuid()};t&&(n.meta=t);const r=JSON.stringify(n);return e.base64Encode(r)}static parseRequestState(e,t){if(!e)throw ke(ka);if(!t)throw ke(Gr);try{const n=t.split(ge.RESOURCE_DELIM),r=n[0],i=n.length>1?n.slice(1).join(ge.RESOURCE_DELIM):ge.EMPTY_STRING,a=e.base64Decode(r),s=JSON.parse(a);return{userRequestState:i||ge.EMPTY_STRING,libraryState:s}}catch{throw ke(Gr)}}}/*! @azure/msal-common v15.2.0 2025-02-18 */const Y_={SW:"sw",UHW:"uhw"};class Wr{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){var i;(i=this.performanceClient)==null||i.addQueueMeasurement(ae.PopTokenGenerateCnf,e.correlationId);const n=await Ce(this.generateKid.bind(this),ae.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),r=this.cryptoUtils.base64UrlEncode(JSON.stringify(n));return{kid:n.kid,reqCnfString:r}}async generateKid(e){var n;return(n=this.performanceClient)==null||n.addQueueMeasurement(ae.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:Y_.SW}}async signPopToken(e,t,n){return this.signPayload(e,t,n)}async signPayload(e,t,n,r){const{resourceRequestMethod:i,resourceRequestUri:a,shrClaims:s,shrNonce:l,shrOptions:c}=n,u=a?new At(a):void 0,d=u==null?void 0:u.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:No(),m:i==null?void 0:i.toUpperCase(),u:d==null?void 0:d.HostNameAndPort,nonce:l||this.cryptoUtils.createNewGuid(),p:d==null?void 0:d.AbsolutePath,q:d!=null&&d.QueryString?[[],d.QueryString]:void 0,client_claims:s||void 0,...r},t,c,n.correlationId)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class q_{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}/*! @azure/msal-common v15.2.0 2025-02-18 */function j_(o){var n,r;const e="code=",t=(n=o.error_uri)==null?void 0:n.lastIndexOf(e);return t&&t>=0?(r=o.error_uri)==null?void 0:r.substring(t+e.length):void 0}class wr{constructor(e,t,n,r,i,a,s){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=r,this.serializableCache=i,this.persistencePlugin=a,this.performanceClient=s}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw e.state?ke(as,"Cached State"):ke(as,"Server State");let n,r;try{n=decodeURIComponent(e.state)}catch{throw ke(Gr,e.state)}try{r=decodeURIComponent(t)}catch{throw ke(Gr,e.state)}if(n!==r)throw ke(_f);if(e.error||e.error_description||e.suberror){const i=j_(e);throw wc(e.error,e.error_description,e.suberror)?new bo(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",i):new sr(e.error||"",e.error_description,e.suberror,i)}}validateTokenResponse(e,t){var n;if(e.error||e.error_description||e.suberror){const r=`Error(s): ${e.error_codes||ge.NOT_AVAILABLE} - Timestamp: ${e.timestamp||ge.NOT_AVAILABLE} - Description: ${e.error_description||ge.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||ge.NOT_AVAILABLE} - Trace ID: ${e.trace_id||ge.NOT_AVAILABLE}`,i=(n=e.error_codes)!=null&&n.length?e.error_codes[0]:void 0,a=new sr(e.error,r,e.suberror,i,e.status);if(t&&e.status&&e.status>=Gi.SERVER_ERROR_RANGE_START&&e.status<=Gi.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${a}`);return}else if(t&&e.status&&e.status>=Gi.CLIENT_ERROR_RANGE_START&&e.status<=Gi.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${a}`);return}throw wc(e.error,e.error_description,e.suberror)?new bo(e.error,e.error_description,e.suberror,e.timestamp||ge.EMPTY_STRING,e.trace_id||ge.EMPTY_STRING,e.correlation_id||ge.EMPTY_STRING,e.claims||ge.EMPTY_STRING,i):a}}async handleServerTokenResponse(e,t,n,r,i,a,s,l,c){var _;(_=this.performanceClient)==null||_.addQueueMeasurement(ae.HandleServerTokenResponse,e.correlation_id);let u;if(e.id_token){if(u=xr(e.id_token||ge.EMPTY_STRING,this.cryptoObj.base64Decode),i&&i.nonce&&u.nonce!==i.nonce)throw ke(bf);if(r.maxAge||r.maxAge===0){const y=u.auth_time;if(!y)throw ke($a);Mf(y,r.maxAge)}}this.homeAccountIdentifier=Un.generateHomeAccountId(e.client_info||ge.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,u);let d;i&&i.state&&(d=_o.parseRequestState(this.cryptoObj,i.state)),e.key_id=e.key_id||r.sshKid||void 0;const f=this.generateCacheRecord(e,t,n,r,u,a,i);let h;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),h=new q_(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(h)),s&&!l&&f.account){const y=f.account.generateAccountKey();if(!this.cacheStorage.getAccount(y))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await wr.generateAuthenticationResult(this.cryptoObj,t,f,!1,r,u,d,void 0,c)}await this.cacheStorage.saveCacheRecord(f,r.correlationId,r.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&h&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(h))}return wr.generateAuthenticationResult(this.cryptoObj,t,f,!1,r,u,d,e,c)}generateCacheRecord(e,t,n,r,i,a,s){const l=t.getPreferredCache();if(!l)throw ke(tl);const c=qf(i);let u,d;e.id_token&&i&&(u=Ns(this.homeAccountIdentifier,l,e.id_token,this.clientId,c||""),d=bl(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,i,e.client_info,l,c,s,void 0,this.logger));let f=null;if(e.access_token){const y=e.scope?un.fromString(e.scope):new un(r.scopes||[]),v=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,m=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,b=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,w=n+v,C=w+m,O=b&&b>0?n+b:void 0;f=Ds(this.homeAccountIdentifier,l,e.access_token,this.clientId,c||t.tenant||"",y.printScopes(),w,C,this.cryptoObj.base64Decode,O,e.token_type,a,e.key_id,r.claims,r.requestedClaimsHash)}let h=null;if(e.refresh_token){let y;if(e.refresh_token_expires_in){const v=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;y=n+v}h=Pf(this.homeAccountIdentifier,l,e.refresh_token,this.clientId,e.foci,a,y)}let _=null;return e.foci&&(_={clientId:this.clientId,environment:l,familyId:e.foci}),{account:d,idToken:u,accessToken:f,refreshToken:h,appMetadata:_}}static async generateAuthenticationResult(e,t,n,r,i,a,s,l,c){var w,C,O,S,E;let u=ge.EMPTY_STRING,d=[],f=null,h,_,y=ge.EMPTY_STRING;if(n.accessToken){if(n.accessToken.tokenType===Ut.POP&&!i.popKid){const H=new Wr(e),{secret:R,keyId:L}=n.accessToken;if(!L)throw ke(nl);u=await H.signPopToken(R,L,i)}else u=n.accessToken.secret;d=un.fromString(n.accessToken.target).asArray(),f=new Date(Number(n.accessToken.expiresOn)*1e3),h=new Date(Number(n.accessToken.extendedExpiresOn)*1e3),n.accessToken.refreshOn&&(_=new Date(Number(n.accessToken.refreshOn)*1e3))}n.appMetadata&&(y=n.appMetadata.familyId===ai?ai:"");const v=(a==null?void 0:a.oid)||(a==null?void 0:a.sub)||"",m=(a==null?void 0:a.tid)||"";l!=null&&l.spa_accountid&&n.account&&(n.account.nativeAccountId=l==null?void 0:l.spa_accountid);const b=n.account?fl(n.account.getAccountInfo(),void 0,a,(w=n.idToken)==null?void 0:w.secret):null;return{authority:t.canonicalAuthority,uniqueId:v,tenantId:m,scopes:d,account:b,idToken:((C=n==null?void 0:n.idToken)==null?void 0:C.secret)||"",idTokenClaims:a||{},accessToken:u,fromCache:r,expiresOn:f,extExpiresOn:h,refreshOn:_,correlationId:i.correlationId,requestId:c||ge.EMPTY_STRING,familyId:y,tokenType:((O=n.accessToken)==null?void 0:O.tokenType)||ge.EMPTY_STRING,state:s?s.userRequestState:ge.EMPTY_STRING,cloudGraphHostName:((S=n.account)==null?void 0:S.cloudGraphHostName)||ge.EMPTY_STRING,msGraphHost:((E=n.account)==null?void 0:E.msGraphHost)||ge.EMPTY_STRING,code:l==null?void 0:l.spa_code,fromNativeBroker:!1}}}function bl(o,e,t,n,r,i,a,s,l,c,u){u==null||u.verbose("setCachedAccount called");const f=o.getAccountKeys().find(m=>m.startsWith(t));let h=null;f&&(h=o.getAccount(f));const _=h||Un.createAccount({homeAccountId:t,idTokenClaims:r,clientInfo:i,environment:a,cloudGraphHostName:l==null?void 0:l.cloud_graph_host_name,msGraphHost:l==null?void 0:l.msgraph_host,nativeAccountId:c},e,n),y=_.tenantProfiles||[],v=s||_.realm;if(v&&!y.find(m=>m.tenantId===v)){const m=dl(t,_.localAccountId,v,r);y.push(m)}return _.tenantProfiles=y,_}/*! @azure/msal-common v15.2.0 2025-02-18 */async function nh(o,e,t){return typeof o=="string"?o:o({clientId:e,tokenEndpoint:t})}/*! @azure/msal-common v15.2.0 2025-02-18 */class oh extends pl{constructor(e,t){var n;super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=(n=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:n.defaultScopes}async getAuthCodeUrl(e){var n;(n=this.performanceClient)==null||n.addQueueMeasurement(ae.GetAuthCodeUrl,e.correlationId);const t=await Ce(this.createAuthCodeUrlQueryString.bind(this),ae.AuthClientCreateQueryString,this.logger,this.performanceClient,e.correlationId)(e);return At.appendQueryString(this.authority.authorizationEndpoint,t)}async acquireToken(e,t){var s,l;if((s=this.performanceClient)==null||s.addQueueMeasurement(ae.AuthClientAcquireToken,e.correlationId),!e.code)throw ke(wf);const n=No(),r=await Ce(this.executeTokenRequest.bind(this),ae.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),i=(l=r.headers)==null?void 0:l[Hn.X_MS_REQUEST_ID],a=new wr(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return a.validateTokenResponse(r.body),Ce(a.handleServerTokenResponse.bind(a),ae.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(r.body,this.authority,n,e,t,void 0,void 0,void 0,i)}handleFragmentResponse(e,t){if(new wr(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw ke(Tf);return e}getLogoutUri(e){if(!e)throw Vt(Bf);const t=this.createLogoutUrlQueryString(e);return At.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){var c,u;(c=this.performanceClient)==null||c.addQueueMeasurement(ae.AuthClientExecuteTokenRequest,t.correlationId);const n=this.createTokenQueryParameters(t),r=At.appendQueryString(e.tokenEndpoint,n),i=await Ce(this.createTokenRequestBody.bind(this),ae.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);let a;if(t.clientInfo)try{const d=cs(t.clientInfo,this.cryptoUtils.base64Decode);a={credential:`${d.uid}${Mn.CLIENT_INFO_SEPARATOR}${d.utid}`,type:Xn.HOME_ACCOUNT_ID}}catch(d){this.logger.verbose("Could not parse client info for CCS Header: "+d)}const s=this.createTokenRequestHeaders(a||t.ccsCredential),l={clientId:((u=t.tokenBodyParameters)==null?void 0:u.clientId)||this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return Ce(this.executePostToTokenEndpoint.bind(this),ae.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(r,i,s,l,t.correlationId,ae.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var r,i;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.AuthClientCreateTokenRequestBody,e.correlationId);const t=new ui(e.correlationId,this.performanceClient);if(t.addClientId(e.embeddedClientId||((i=e.tokenBodyParameters)==null?void 0:i[vr])||this.config.authOptions.clientId),this.includeRedirectUri?t.addRedirectUri(e.redirectUri):Pr.validateRedirectUri(e.redirectUri),t.addScopes(e.scopes,!0,this.oidcDefaultScopes),t.addAuthorizationCode(e.code),t.addLibraryInfo(this.config.libraryInfo),t.addApplicationTelemetry(this.config.telemetry.application),t.addThrottling(),this.serverTelemetryManager&&!Ta(this.config)&&t.addServerTelemetry(this.serverTelemetryManager),e.codeVerifier&&t.addCodeVerifier(e.codeVerifier),this.config.clientCredentials.clientSecret&&t.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const a=this.config.clientCredentials.clientAssertion;t.addClientAssertion(await nh(a.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),t.addClientAssertionType(a.assertionType)}if(t.addGrantType(uf.AUTHORIZATION_CODE_GRANT),t.addClientInfo(),e.authenticationScheme===Ut.POP){const a=new Wr(this.cryptoUtils,this.performanceClient);let s;e.popKid?s=this.cryptoUtils.encodeKid(e.popKid):s=(await Ce(a.generateCnf.bind(a),ae.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,t.addPopToken(s)}else if(e.authenticationScheme===Ut.SSH)if(e.sshJwk)t.addSshJwk(e.sshJwk);else throw Vt(Hs);(!Po.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&t.addClaims(e.claims,this.config.authOptions.clientCapabilities);let n;if(e.clientInfo)try{const a=cs(e.clientInfo,this.cryptoUtils.base64Decode);n={credential:`${a.uid}${Mn.CLIENT_INFO_SEPARATOR}${a.utid}`,type:Xn.HOME_ACCOUNT_ID}}catch(a){this.logger.verbose("Could not parse client info for CCS Header: "+a)}else n=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&n)switch(n.type){case Xn.HOME_ACCOUNT_ID:try{const a=Dr(n.credential);t.addCcsOid(a)}catch(a){this.logger.verbose("Could not parse home account ID for CCS Header: "+a)}break;case Xn.UPN:t.addCcsUpn(n.credential);break}return e.embeddedClientId&&t.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenBodyParameters&&t.addExtraQueryParameters(e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[bc])&&t.addExtraQueryParameters({[bc]:"1"}),t.createQueryString()}async createAuthCodeUrlQueryString(e){var i,a,s,l,c,u,d,f,h,_;const t=e.correlationId||this.config.cryptoInterface.createNewGuid();(i=this.performanceClient)==null||i.addQueueMeasurement(ae.AuthClientCreateQueryString,t);const n=new ui(t,this.performanceClient);n.addClientId(e.embeddedClientId||((a=e.extraQueryParameters)==null?void 0:a[vr])||this.config.authOptions.clientId);const r=[...e.scopes||[],...e.extraScopesToConsent||[]];if(n.addScopes(r,!0,this.oidcDefaultScopes),n.addRedirectUri(e.redirectUri),n.addCorrelationId(t),n.addResponseMode(e.responseMode),n.addResponseTypeCode(),n.addLibraryInfo(this.config.libraryInfo),Ta(this.config)||n.addApplicationTelemetry(this.config.telemetry.application),n.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&n.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&n.addPrompt(e.prompt),e.domainHint&&(n.addDomainHint(e.domainHint),(s=this.performanceClient)==null||s.addFields({domainHintFromRequest:!0},t)),(l=this.performanceClient)==null||l.addFields({prompt:e.prompt},t),e.prompt!==wn.SELECT_ACCOUNT)if(e.sid&&e.prompt===wn.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),n.addSid(e.sid),(c=this.performanceClient)==null||c.addFields({sidFromRequest:!0},t);else if(e.account){const y=this.extractAccountSid(e.account);let v=this.extractLoginHint(e.account);if(v&&e.domainHint&&(this.logger.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),v=null),v){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),n.addLoginHint(v),(u=this.performanceClient)==null||u.addFields({loginHintFromClaim:!0},t);try{const m=Dr(e.account.homeAccountId);n.addCcsOid(m)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(y&&e.prompt===wn.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),n.addSid(y),(d=this.performanceClient)==null||d.addFields({sidFromClaim:!0},t);try{const m=Dr(e.account.homeAccountId);n.addCcsOid(m)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),n.addLoginHint(e.loginHint),n.addCcsUpn(e.loginHint),(f=this.performanceClient)==null||f.addFields({loginHintFromRequest:!0},t);else if(e.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),n.addLoginHint(e.account.username),(h=this.performanceClient)==null||h.addFields({loginHintFromUpn:!0},t);try{const m=Dr(e.account.homeAccountId);n.addCcsOid(m)}catch{this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),n.addLoginHint(e.loginHint),n.addCcsUpn(e.loginHint),(_=this.performanceClient)==null||_.addFields({loginHintFromRequest:!0},t));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&n.addNonce(e.nonce),e.state&&n.addState(e.state),(e.claims||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,this.config.authOptions.clientCapabilities),e.embeddedClientId&&n.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),this.addExtraQueryParams(e,n),e.platformBroker&&(n.addNativeBroker(),e.authenticationScheme===Ut.POP)){const y=new Wr(this.cryptoUtils);let v;e.popKid?v=this.cryptoUtils.encodeKid(e.popKid):v=(await Ce(y.generateCnf.bind(y),ae.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,n.addPopToken(v)}return n.createQueryString()}createLogoutUrlQueryString(e){const t=new ui(e.correlationId,this.performanceClient);return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),this.addExtraQueryParams(e,t),t.createQueryString()}addExtraQueryParams(e,t){!(e.extraQueryParameters&&e.extraQueryParameters.hasOwnProperty("instance_aware"))&&this.config.authOptions.instanceAware&&(e.extraQueryParameters=e.extraQueryParameters||{},e.extraQueryParameters.instance_aware="true"),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters)}extractAccountSid(e){var t;return((t=e.idTokenClaims)==null?void 0:t.sid)||null}extractLoginHint(e){var t;return((t=e.idTokenClaims)==null?void 0:t.login_hint)||null}}/*! @azure/msal-common v15.2.0 2025-02-18 */const Q_=300;class X_ extends pl{constructor(e,t){super(e,t)}async acquireToken(e){var a,s;(a=this.performanceClient)==null||a.addQueueMeasurement(ae.RefreshTokenClientAcquireToken,e.correlationId);const t=No(),n=await Ce(this.executeTokenRequest.bind(this),ae.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),r=(s=n.headers)==null?void 0:s[Hn.X_MS_REQUEST_ID],i=new wr(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return i.validateTokenResponse(n.body),Ce(i.handleServerTokenResponse.bind(i),ae.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(n.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,r)}async acquireTokenByRefreshToken(e){var n;if(!e)throw Vt(Uf);if((n=this.performanceClient)==null||n.addQueueMeasurement(ae.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw ke(el);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await Ce(this.acquireTokenWithCachedRefreshToken.bind(this),ae.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(r){const i=r instanceof bo&&r.errorCode===fs,a=r instanceof sr&&r.errorCode===sc.INVALID_GRANT_ERROR&&r.subError===sc.CLIENT_MISMATCH_ERROR;if(i||a)return Ce(this.acquireTokenWithCachedRefreshToken.bind(this),ae.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw r}return Ce(this.acquireTokenWithCachedRefreshToken.bind(this),ae.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){var i,a,s;(i=this.performanceClient)==null||i.addQueueMeasurement(ae.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const n=jo(this.cacheManager.getRefreshToken.bind(this.cacheManager),ae.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,void 0,this.performanceClient,e.correlationId);if(!n)throw Aa(fs);if(n.expiresOn&&Ea(n.expiresOn,e.refreshTokenExpirationOffsetSeconds||Q_))throw(a=this.performanceClient)==null||a.addFields({rtExpiresOnMs:Number(n.expiresOn)},e.correlationId),Aa(_l);const r={...e,refreshToken:n.secret,authenticationScheme:e.authenticationScheme||Ut.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:Xn.HOME_ACCOUNT_ID}};try{return await Ce(this.acquireToken.bind(this),ae.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(r)}catch(l){if(l instanceof bo&&((s=this.performanceClient)==null||s.addFields({rtExpiresOnMs:Number(n.expiresOn)},e.correlationId),l.subError===Bs)){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const c=ci(n);this.cacheManager.removeRefreshToken(c)}throw l}}async executeTokenRequest(e,t){var l,c;(l=this.performanceClient)==null||l.addQueueMeasurement(ae.RefreshTokenClientExecuteTokenRequest,e.correlationId);const n=this.createTokenQueryParameters(e),r=At.appendQueryString(t.tokenEndpoint,n),i=await Ce(this.createTokenRequestBody.bind(this),ae.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),a=this.createTokenRequestHeaders(e.ccsCredential),s={clientId:((c=e.tokenBodyParameters)==null?void 0:c.clientId)||this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return Ce(this.executePostToTokenEndpoint.bind(this),ae.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(r,i,a,s,e.correlationId,ae.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){var r,i,a;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const t=e.correlationId,n=new ui(t,this.performanceClient);if(n.addClientId(e.embeddedClientId||((i=e.tokenBodyParameters)==null?void 0:i[vr])||this.config.authOptions.clientId),e.redirectUri&&n.addRedirectUri(e.redirectUri),n.addScopes(e.scopes,!0,(a=this.config.authOptions.authority.options.OIDCOptions)==null?void 0:a.defaultScopes),n.addGrantType(uf.REFRESH_TOKEN_GRANT),n.addClientInfo(),n.addLibraryInfo(this.config.libraryInfo),n.addApplicationTelemetry(this.config.telemetry.application),n.addThrottling(),this.serverTelemetryManager&&!Ta(this.config)&&n.addServerTelemetry(this.serverTelemetryManager),n.addRefreshToken(e.refreshToken),this.config.clientCredentials.clientSecret&&n.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const s=this.config.clientCredentials.clientAssertion;n.addClientAssertion(await nh(s.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),n.addClientAssertionType(s.assertionType)}if(e.authenticationScheme===Ut.POP){const s=new Wr(this.cryptoUtils,this.performanceClient);let l;e.popKid?l=this.cryptoUtils.encodeKid(e.popKid):l=(await Ce(s.generateCnf.bind(s),ae.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,n.addPopToken(l)}else if(e.authenticationScheme===Ut.SSH)if(e.sshJwk)n.addSshJwk(e.sshJwk);else throw Vt(Hs);if((!Po.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case Xn.HOME_ACCOUNT_ID:try{const s=Dr(e.ccsCredential.credential);n.addCcsOid(s)}catch(s){this.logger.verbose("Could not parse home account ID for CCS Header: "+s)}break;case Xn.UPN:n.addCcsUpn(e.ccsCredential.credential);break}return e.embeddedClientId&&n.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenBodyParameters&&n.addExtraQueryParameters(e.tokenBodyParameters),n.createQueryString()}}/*! @azure/msal-common v15.2.0 2025-02-18 */class J_ extends pl{constructor(e,t){super(e,t)}async acquireCachedToken(e){var l;(l=this.performanceClient)==null||l.addQueueMeasurement(ae.SilentFlowClientAcquireCachedToken,e.correlationId);let t=mr.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!Po.isEmptyObj(e.claims))throw this.setCacheOutcome(mr.FORCE_REFRESH_OR_CLAIMS,e.correlationId),ke(or);if(!e.account)throw ke(el);const n=e.account.tenantId||B_(e.authority),r=this.cacheManager.getTokenKeys(),i=this.cacheManager.getAccessToken(e.account,e,r,n,this.performanceClient,e.correlationId);if(i){if(w1(i.cachedAt)||Ea(i.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(mr.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),ke(or);i.refreshOn&&Ea(i.refreshOn,0)&&(t=mr.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(mr.NO_CACHED_ACCESS_TOKEN,e.correlationId),ke(or);const a=e.authority||this.authority.getPreferredCache(),s={account:this.cacheManager.readAccountFromCache(e.account),accessToken:i,idToken:this.cacheManager.getIdToken(e.account,r,n,this.performanceClient,e.correlationId),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(a)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await Ce(this.generateResultFromCacheRecord.bind(this),ae.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(s,e),t]}setCacheOutcome(e,t){var n,r;(n=this.serverTelemetryManager)==null||n.setCacheOutcome(e),(r=this.performanceClient)==null||r.addFields({cacheOutcome:e},t),e!==mr.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){var r;(r=this.performanceClient)==null||r.addQueueMeasurement(ae.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId);let n;if(e.idToken&&(n=xr(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){const i=n==null?void 0:n.auth_time;if(!i)throw ke($a);Mf(i,t.maxAge)}return wr.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,n)}}/*! @azure/msal-common v15.2.0 2025-02-18 */const x_={sendGetRequestAsync:()=>Promise.reject(ke(yt)),sendPostRequestAsync:()=>Promise.reject(ke(yt))};/*! @azure/msal-common v15.2.0 2025-02-18 */const kc=",",rh="|";function Z_(o){const{skus:e,libraryName:t,libraryVersion:n,extensionName:r,extensionVersion:i}=o,a=new Map([[0,[t,n]],[2,[r,i]]]);let s=[];if(e!=null&&e.length){if(s=e.split(kc),s.length<4)return e}else s=Array.from({length:4},()=>rh);return a.forEach((l,c)=>{var u,d;l.length===2&&((u=l[0])!=null&&u.length)&&((d=l[1])!=null&&d.length)&&$_({skuArr:s,index:c,skuName:l[0],skuVersion:l[1]})}),s.join(kc)}function $_(o){const{skuArr:e,index:t,skuName:n,skuVersion:r}=o;t>=e.length||(e[t]=[n,r].join(rh))}class bi{constructor(e,t){this.cacheOutcome=mr.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||ge.EMPTY_STRING,this.wrapperVer=e.wrapperVer||ge.EMPTY_STRING,this.telemetryCacheKey=Tn.CACHE_KEY+Mn.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${Tn.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],n=this.getNativeBrokerErrorCode();n!=null&&n.length&&t.push(`broker_error=${n}`);const r=t.join(Tn.VALUE_SEPARATOR),i=this.getRegionDiscoveryFields(),a=[e,i].join(Tn.VALUE_SEPARATOR);return[Tn.SCHEMA_VERSION,a,r].join(Tn.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=bi.maxErrorsToSend(e),n=e.failedRequests.slice(0,2*t).join(Tn.VALUE_SEPARATOR),r=e.errors.slice(0,t).join(Tn.VALUE_SEPARATOR),i=e.errors.length,a=t<i?Tn.OVERFLOW_TRUE:Tn.OVERFLOW_FALSE,s=[i,a].join(Tn.VALUE_SEPARATOR);return[Tn.SCHEMA_VERSION,e.cacheHits,n,r,s].join(Tn.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=Tn.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof en?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(Tn.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits}getLastRequests(){const e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){const e=this.getLastRequests(),t=bi.maxErrorsToSend(e),n=e.errors.length;if(t===n)this.cacheManager.removeItem(this.telemetryCacheKey);else{const r={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,r)}}static maxErrorsToSend(e){let t,n=0,r=0;const i=e.errors.length;for(t=0;t<i;t++){const a=e.failedRequests[2*t]||ge.EMPTY_STRING,s=e.failedRequests[2*t+1]||ge.EMPTY_STRING,l=e.errors[t]||ge.EMPTY_STRING;if(r+=a.toString().length+s.toString().length+l.length+3,r<Tn.MAX_LAST_HEADER_BYTES)n+=1;else break}return n}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||ge.EMPTY_STRING),e.push(this.regionSource||ge.EMPTY_STRING),e.push(this.regionOutcome||ge.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e)}static makeExtraSkuString(e){return Z_(e)}}/*! @azure/msal-common v15.2.0 2025-02-18 */const ih="missing_kid_error",sh="missing_alg_error";/*! @azure/msal-common v15.2.0 2025-02-18 */const e0={[ih]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[sh]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class yl extends en{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,yl.prototype)}}function Cc(o){return new yl(o,e0[o])}/*! @azure/msal-common v15.2.0 2025-02-18 */class vl{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw Cc(ih);if(!e.alg)throw Cc(sh);const t=new vl({typ:e.typ||i1.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}/*! @azure/msal-common v15.2.0 2025-02-18 */class Ec{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class t0{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:U_.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new Ec}}startPerformanceMeasurement(){return new Ec}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const wl="pkce_not_created",Ra="crypto_nonexistent",zs="empty_navigate_uri",ah="hash_empty_error",kl="no_state_in_hash",lh="hash_does_not_contain_known_properties",ch="unable_to_parse_state",uh="state_interaction_type_mismatch",dh="interaction_in_progress",fh="popup_window_error",hh="empty_window_error",kr="user_cancelled",n0="monitor_popup_timeout",gh="monitor_window_timeout",mh="redirect_in_iframe",ph="block_iframe_reload",_h="block_nested_popups",o0="iframe_closed_prematurely",Vs="silent_logout_unsupported",bh="no_account_error",r0="silent_prompt_value_error",yh="no_token_request_cache_error",vh="unable_to_parse_token_request_cache_error",Cl="no_cached_authority_error",i0="auth_request_not_set_error",s0="invalid_cache_type",Fs="non_browser_environment",Or="database_not_open",hs="no_network_connectivity",wh="post_request_failed",kh="get_request_failed",Ma="failed_to_parse_response",Ch="unable_to_load_token",El="crypto_key_not_found",Eh="auth_code_required",Ih="auth_code_or_nativeAccountId_required",Th="spa_code_and_nativeAccountId_present",Il="database_unavailable",Sh="unable_to_acquire_token_from_native_platform",Ah="native_handshake_timeout",Rh="native_extension_not_installed",Si="native_connection_not_established",gs="uninitialized_public_client_application",Mh="native_prompt_not_supported",Ph="invalid_base64_string",Oh="invalid_pop_token_request",Nh="failed_to_build_headers",Dh="failed_to_parse_headers";/*! @azure/msal-browser v4.5.0 2025-02-26 */const Lo="For more visit: aka.ms/msaljs/browser-errors",a0={[wl]:"The PKCE code challenge and verifier could not be generated.",[Ra]:"The crypto object or function is not available.",[zs]:"Navigation URI is empty. Please check stack trace for more info.",[ah]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${Lo}`,[kl]:"Hash does not contain state. Please verify that the request originated from msal.",[lh]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${Lo}`,[ch]:"Unable to parse state. Please verify that the request originated from msal.",[uh]:"Hash contains state but the interaction type does not match the caller.",[dh]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${Lo}`,[fh]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[hh]:"window.open returned null or undefined window object.",[kr]:"User cancelled the flow.",[n0]:`Token acquisition in popup failed due to timeout.  ${Lo}`,[gh]:`Token acquisition in iframe failed due to timeout.  ${Lo}`,[mh]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[ph]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${Lo}`,[_h]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[o0]:"The iframe being monitored was closed prematurely.",[Vs]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[bh]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[r0]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[yh]:"No token request found in cache.",[vh]:"The cached token request could not be parsed.",[Cl]:"No cached authority found.",[i0]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[s0]:"Invalid cache type",[Fs]:"Login and token requests are not supported in non-browser environments.",[Or]:"Database is not open!",[hs]:"No network connectivity. Check your internet connection.",[wh]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[kh]:"Network request failed. Please check the network trace to determine root cause.",[Ma]:"Failed to parse network response. Check network trace.",[Ch]:"Error loading token to cache.",[El]:"Cryptographic Key or Keypair not found in browser storage.",[Eh]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[Ih]:"An authorization code or nativeAccountId must be provided to this flow.",[Th]:"Request cannot contain both spa code and native account id.",[Il]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[Sh]:`Unable to acquire token from native platform.  ${Lo}`,[Ah]:"Timed out while attempting to establish connection to browser extension",[Rh]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[Si]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${Lo}`,[gs]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${Lo}`,[Mh]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[Ph]:"Invalid base64 encoded string.",[Oh]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[Nh]:"Failed to build request headers object.",[Dh]:"Failed to parse response headers"};class Ai extends en{constructor(e,t){super(e,a0[e],t),Object.setPrototypeOf(this,Ai.prototype),this.name="BrowserAuthError"}}function Je(o,e){return new Ai(o,e)}/*! @azure/msal-browser v4.5.0 2025-02-26 */const Qn={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},Hr={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},br={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},Sn={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},Ic={GET:"GET",POST:"POST"},Lt={AUTHORITY:"authority",ACQUIRE_TOKEN_ACCOUNT:"acquireToken.account",SESSION_STATE:"session.state",REQUEST_STATE:"request.state",NONCE_IDTOKEN:"nonce.id_token",ORIGIN_URI:"request.origin",RENEW_STATUS:"token.renew.status",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",SCOPES:"scopes",INTERACTION_STATUS_KEY:"interaction.status",CCS_CREDENTIAL:"ccs.credential",CORRELATION_ID:"request.correlationId",NATIVE_REQUEST:"request.native",REDIRECT_CONTEXT:"request.redirect.context"},tr={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys"},Qi={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},jt={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var st;(function(o){o.Redirect="redirect",o.Popup="popup",o.Silent="silent",o.None="none"})(st||(st={}));const Tc={scopes:Ii},Hh="jwk",Pa="msal.db",l0=1,c0=`${Pa}.keys`,Yn={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},u0=[Yn.Default,Yn.Skip,Yn.RefreshTokenAndNetwork],d0="msal.browser.log.level",f0="msal.browser.log.pii";/*! @azure/msal-browser v4.5.0 2025-02-26 */function Xi(o){return encodeURIComponent(Tl(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function Cr(o){return Lh(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Tl(o){return Lh(new TextEncoder().encode(o))}function Lh(o){const e=Array.from(o,t=>String.fromCodePoint(t)).join("");return btoa(e)}/*! @azure/msal-browser v4.5.0 2025-02-26 */function Go(o){return new TextDecoder().decode(ms(o))}function ms(o){let e=o.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw Je(Ph)}const t=atob(e);return Uint8Array.from(t,n=>n.codePointAt(0)||0)}/*! @azure/msal-browser v4.5.0 2025-02-26 */const h0="RSASSA-PKCS1-v1_5",Ks="AES-GCM",Uh="HKDF",Sl="SHA-256",g0=2048,m0=new Uint8Array([1,0,1]),Sc="0123456789abcdef",Ac=new Uint32Array(1),Bh="raw",zh="encrypt",Vh="decrypt",p0="deriveKey",_0="crypto_subtle_undefined",Al={name:h0,hash:Sl,modulusLength:g0,publicExponent:m0};function b0(o){if(!window)throw Je(Fs);if(!window.crypto)throw Je(Ra);if(!o&&!window.crypto.subtle)throw Je(Ra,_0)}async function Fh(o,e,t){e==null||e.addQueueMeasurement(ae.Sha256Digest,t);const r=new TextEncoder().encode(o);return window.crypto.subtle.digest(Sl,r)}function y0(o){return window.crypto.getRandomValues(o)}function ca(){return window.crypto.getRandomValues(Ac),Ac[0]}function yo(){const o=Date.now(),e=ca()*1024+(ca()&1023),t=new Uint8Array(16),n=Math.trunc(e/2**30),r=e&2**30-1,i=ca();t[0]=o/2**40,t[1]=o/2**32,t[2]=o/2**24,t[3]=o/2**16,t[4]=o/2**8,t[5]=o,t[6]=112|n>>>8,t[7]=n,t[8]=128|r>>>24,t[9]=r>>>16,t[10]=r>>>8,t[11]=r,t[12]=i>>>24,t[13]=i>>>16,t[14]=i>>>8,t[15]=i;let a="";for(let s=0;s<t.length;s++)a+=Sc.charAt(t[s]>>>4),a+=Sc.charAt(t[s]&15),(s===3||s===5||s===7||s===9)&&(a+="-");return a}async function v0(o,e){return window.crypto.subtle.generateKey(Al,o,e)}async function ua(o){return window.crypto.subtle.exportKey(Hh,o)}async function w0(o,e,t){return window.crypto.subtle.importKey(Hh,o,Al,e,t)}async function k0(o,e){return window.crypto.subtle.sign(Al,o,e)}async function C0(){const o=await window.crypto.subtle.generateKey({name:Ks,length:256},!0,[zh,Vh]);return window.crypto.subtle.exportKey(Bh,o)}async function Rc(o){return window.crypto.subtle.importKey(Bh,o,Uh,!1,[p0])}async function Kh(o,e,t){return window.crypto.subtle.deriveKey({name:Uh,salt:e,hash:Sl,info:new TextEncoder().encode(t)},o,{name:Ks,length:256},!1,[zh,Vh])}async function E0(o,e,t){const n=new TextEncoder().encode(e),r=window.crypto.getRandomValues(new Uint8Array(16)),i=await Kh(o,r,t),a=await window.crypto.subtle.encrypt({name:Ks,iv:new Uint8Array(12)},i,n);return{data:Cr(new Uint8Array(a)),nonce:Cr(r)}}async function I0(o,e,t,n){const r=ms(n),i=await Kh(o,ms(e),t),a=await window.crypto.subtle.decrypt({name:Ks,iv:new Uint8Array(12)},i,r);return new TextDecoder().decode(a)}async function Gh(o){const e=await Fh(o),t=new Uint8Array(e);return Cr(t)}/*! @azure/msal-browser v4.5.0 2025-02-26 */const yi="storage_not_supported",Oa="stubbed_public_client_application_called",ps="in_mem_redirect_unavailable";/*! @azure/msal-browser v4.5.0 2025-02-26 */const ts={[yi]:"Given storage configuration option was not supported.",[Oa]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[ps]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};ts[yi],ts[Oa],ts[ps];class Rl extends en{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,Rl.prototype)}}function Ml(o){return new Rl(o,ts[o])}/*! @azure/msal-browser v4.5.0 2025-02-26 */function T0(o){o.location.hash="",typeof o.history.replaceState=="function"&&o.history.replaceState(null,"",`${o.location.origin}${o.location.pathname}${o.location.search}`)}function S0(o){const e=o.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function Pl(){return window.parent!==window}function A0(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(`${Qn.POPUP_NAME_PREFIX}.`)===0}function Vo(){return typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function R0(){const e=new At(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function M0(){if(At.hashContainsKnownProperties(window.location.hash)&&Pl())throw Je(ph)}function P0(o){if(Pl()&&!o)throw Je(mh)}function O0(){if(A0())throw Je(_h)}function Wh(){if(typeof window>"u")throw Je(Fs)}function Yh(o){if(!o)throw Je(gs)}function Ol(o){Wh(),M0(),O0(),Yh(o)}function Mc(o,e){if(Ol(o),P0(e.system.allowRedirectInIframe),e.cache.cacheLocation===Sn.MemoryStorage&&!e.cache.storeAuthStateInCookie)throw Ml(ps)}function qh(o){const e=document.createElement("link");e.rel="preconnect",e.href=new URL(o).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}function N0(){return yo()}/*! @azure/msal-browser v4.5.0 2025-02-26 */class _s{navigateInternal(e,t){return _s.defaultNavigateWindow(e,t)}navigateExternal(e,t){return _s.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(n=>{setTimeout(()=>{n(!0)},t.timeout)})}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class D0{async sendGetRequestAsync(e,t){let n,r={},i=0;const a=Pc(t);try{n=await fetch(e,{method:Ic.GET,headers:a})}catch{throw Je(window.navigator.onLine?kh:hs)}r=Oc(n.headers);try{return i=n.status,{headers:r,body:await n.json(),status:i}}catch{throw yc(Je(Ma),i,r)}}async sendPostRequestAsync(e,t){const n=t&&t.body||"",r=Pc(t);let i,a=0,s={};try{i=await fetch(e,{method:Ic.POST,headers:r,body:n})}catch{throw Je(window.navigator.onLine?wh:hs)}s=Oc(i.headers);try{return a=i.status,{headers:s,body:await i.json(),status:a}}catch{throw yc(Je(Ma),a,s)}}}function Pc(o){try{const e=new Headers;if(!(o&&o.headers))return e;const t=o.headers;return Object.entries(t).forEach(([n,r])=>{e.append(n,r)}),e}catch{throw Je(Nh)}}function Oc(o){try{const e={};return o.forEach((t,n)=>{e[n]=t}),e}catch{throw Je(Dh)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const H0=6e4,Na=1e4,L0=3e4,U0=2e3;function B0({auth:o,cache:e,system:t,telemetry:n},r){const i={clientId:ge.EMPTY_STRING,authority:`${ge.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:ge.EMPTY_STRING,authorityMetadata:ge.EMPTY_STRING,redirectUri:typeof window<"u"?Vo():"",postLogoutRedirectUri:ge.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:Ko.AAD,OIDCOptions:{serverResponseType:Ti.FRAGMENT,defaultScopes:[ge.OPENID_SCOPE,ge.PROFILE_SCOPE,ge.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:il.None,tenant:ge.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1},a={cacheLocation:Sn.SessionStorage,temporaryCacheLocation:Sn.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!(e&&e.cacheLocation===Sn.LocalStorage),claimsBasedCachingEnabled:!1},s={loggerCallback:()=>{},logLevel:$t.Info,piiLoggingEnabled:!1},c={...{...xf,loggerOptions:s,networkClient:r?new D0:x_,navigationClient:new _s,loadFrameTimeout:0,windowHashTimeout:(t==null?void 0:t.loadFrameTimeout)||H0,iframeHashTimeout:(t==null?void 0:t.loadFrameTimeout)||Na,navigateFrameWait:0,redirectNavigationTimeout:L0,asyncPopups:!1,allowRedirectInIframe:!1,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:(t==null?void 0:t.nativeBrokerHandshakeTimeout)||U0,pollIntervalMilliseconds:Qn.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:(t==null?void 0:t.loggerOptions)||s},u={application:{appName:ge.EMPTY_STRING,appVersion:ge.EMPTY_STRING},client:new t0};if((o==null?void 0:o.protocolMode)!==Ko.OIDC&&(o!=null&&o.OIDCOptions)&&new ir(c.loggerOptions).warning(JSON.stringify(Vt(Gf))),o!=null&&o.protocolMode&&o.protocolMode!==Ko.AAD&&(c!=null&&c.allowPlatformBroker))throw Vt(Wf);return{auth:{...i,...o,OIDCOptions:{...i.OIDCOptions,...o==null?void 0:o.OIDCOptions}},cache:{...a,...e},system:c,telemetry:{...u,...n}}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const z0="@azure/msal-browser",Gs="4.5.0";/*! @azure/msal-browser v4.5.0 2025-02-26 */class Nl{static loggerCallback(e,t){switch(e){case $t.Error:console.error(t);return;case $t.Info:console.info(t);return;case $t.Verbose:console.debug(t);return;case $t.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){var l;this.browserEnvironment=typeof window<"u",this.config=B0(e,this.browserEnvironment);let t;try{t=window[Sn.SessionStorage]}catch{}const n=t==null?void 0:t.getItem(d0),r=(l=t==null?void 0:t.getItem(f0))==null?void 0:l.toLowerCase(),i=r==="true"?!0:r==="false"?!1:void 0,a={...this.config.system.loggerOptions},s=n&&Object.keys($t).includes(n)?$t[n]:void 0;s&&(a.loggerCallback=Nl.loggerCallback,a.logLevel=s),i!==void 0&&(a.piiLoggingEnabled=i),this.logger=new ir(a,z0,Gs),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Er extends Nl{getModuleName(){return Er.MODULE_NAME}getId(){return Er.ID}async initialize(){return this.available=typeof window<"u",this.available}}Er.MODULE_NAME="";Er.ID="StandardOperatingContext";/*! @azure/msal-browser v4.5.0 2025-02-26 */class V0{constructor(){this.dbName=Pa,this.version=l0,this.tableName=c0,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const n=window.indexedDB.open(this.dbName,this.version);n.addEventListener("upgradeneeded",r=>{r.target.result.createObjectStore(this.tableName)}),n.addEventListener("success",r=>{const i=r;this.db=i.target.result,this.dbOpen=!0,e()}),n.addEventListener("error",()=>t(Je(Il)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(Je(Or));const a=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);a.addEventListener("success",s=>{const l=s;this.closeConnection(),t(l.target.result)}),a.addEventListener("error",s=>{this.closeConnection(),n(s)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((n,r)=>{if(!this.db)return r(Je(Or));const s=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);s.addEventListener("success",()=>{this.closeConnection(),n()}),s.addEventListener("error",l=>{this.closeConnection(),r(l)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(Je(Or));const a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);a.addEventListener("success",()=>{this.closeConnection(),t()}),a.addEventListener("error",s=>{this.closeConnection(),n(s)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(Je(Or));const i=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();i.addEventListener("success",a=>{const s=a;this.closeConnection(),e(s.target.result)}),i.addEventListener("error",a=>{this.closeConnection(),t(a)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(Je(Or));const a=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);a.addEventListener("success",s=>{const l=s;this.closeConnection(),t(l.target.result===1)}),a.addEventListener("error",s=>{this.closeConnection(),n(s)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const n=window.indexedDB.deleteDatabase(Pa),r=setTimeout(()=>t(!1),200);n.addEventListener("success",()=>(clearTimeout(r),e(!0))),n.addEventListener("blocked",()=>(clearTimeout(r),e(!0))),n.addEventListener("error",()=>(clearTimeout(r),t(!1)))})}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Ws{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,n)=>{e.push(n)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class F0{constructor(e){this.inMemoryCache=new Ws,this.indexedDBCache=new V0,this.logger=e}handleDatabaseAccessError(e){if(e instanceof Ai&&e.errorCode===Il)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(n){this.handleDatabaseAccessError(n)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(n){this.handleDatabaseAccessError(n)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(n){this.handleDatabaseAccessError(n)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Yr{constructor(e,t,n){this.logger=e,b0(n??!1),this.cache=new F0(this.logger),this.performanceClient=t}createNewGuid(){return yo()}base64Encode(e){return Tl(e)}base64Decode(e){return Go(e)}base64UrlEncode(e){return Xi(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){var u;const t=(u=this.performanceClient)==null?void 0:u.startMeasurement(ae.CryptoOptsGetPublicKeyThumbprint,e.correlationId),n=await v0(Yr.EXTRACTABLE,Yr.POP_KEY_USAGES),r=await ua(n.publicKey),i={e:r.e,kty:r.kty,n:r.n},a=Nc(i),s=await this.hashString(a),l=await ua(n.privateKey),c=await w0(l,!1,["sign"]);return await this.cache.setItem(s,{privateKey:c,publicKey:n.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),s}async removeTokenBindingKey(e){return await this.cache.removeItem(e),!await this.cache.containsKey(e)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,n,r){var w;const i=(w=this.performanceClient)==null?void 0:w.startMeasurement(ae.CryptoOptsSignJwt,r),a=await this.cache.getItem(t);if(!a)throw Je(El);const s=await ua(a.publicKey),l=Nc(s),c=Xi(JSON.stringify({kid:t})),u=vl.getShrHeaderString({...n==null?void 0:n.header,alg:s.alg,kid:c}),d=Xi(u);e.cnf={jwk:JSON.parse(l)};const f=Xi(JSON.stringify(e)),h=`${d}.${f}`,y=new TextEncoder().encode(h),v=await k0(a.privateKey,y),m=Cr(new Uint8Array(v)),b=`${h}.${m}`;return i&&i.end({success:!0}),b}async hashString(e){return Gh(e)}}Yr.POP_KEY_USAGES=["sign","verify"];Yr.EXTRACTABLE=!0;function Nc(o){return JSON.stringify(o,Object.keys(o).sort())}/*! @azure/msal-browser v4.5.0 2025-02-26 */const K0=24*60*60*1e3,Da={Lax:"Lax",None:"None"};class jh{initialize(){return Promise.resolve()}getItem(e){const t=`${encodeURIComponent(e)}`,n=document.cookie.split(";");for(let r=0;r<n.length;r++){const i=n[r],[a,...s]=decodeURIComponent(i).trim().split("="),l=s.join("=");if(a===t)return l}return""}getUserData(){throw ke(yt)}setItem(e,t,n,r=!0,i=Da.Lax){let a=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${i};`;if(n){const s=G0(n);a+=`expires=${s};`}(r||i===Da.None)&&(a+="Secure;"),document.cookie=a}async setUserData(){return Promise.reject(ke(yt))}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach(n=>{const r=decodeURIComponent(n).trim().split("=");t.push(r[0])}),t}containsKey(e){return this.getKeys().includes(e)}}function G0(o){const e=new Date;return new Date(e.getTime()+o*K0).toUTCString()}/*! @azure/msal-browser v4.5.0 2025-02-26 */function Ha(o){const e=o.getItem(tr.ACCOUNT_KEYS);return e?JSON.parse(e):[]}function La(o,e){const t=e.getItem(`${tr.TOKEN_KEYS}.${o}`);if(t){const n=JSON.parse(t);if(n&&n.hasOwnProperty("idToken")&&n.hasOwnProperty("accessToken")&&n.hasOwnProperty("refreshToken"))return n}return{idToken:[],accessToken:[],refreshToken:[]}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const Dc="msal.cache.encryption",W0="msal.broadcast.cache";class Y0{constructor(e,t,n){if(!window.localStorage)throw Ml(yi);this.memoryStorage=new Ws,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=n,this.broadcast=new BroadcastChannel(W0)}async initialize(e){this.initialized=!0;const t=new jh,n=t.getItem(Dc);let r={key:"",id:""};if(n)try{r=JSON.parse(n)}catch{}if(r.key&&r.id){const i=jo(ms,ae.Base64Decode,this.logger,this.performanceClient,e)(r.key);this.encryptionCookie={id:r.id,key:await Ce(Rc,ae.GenerateHKDF,this.logger,this.performanceClient,e)(i)},await Ce(this.importExistingCache.bind(this),ae.ImportExistingCache,this.logger,this.performanceClient,e)(e)}else{this.clear();const i=yo(),a=await Ce(C0,ae.GenerateBaseKey,this.logger,this.performanceClient,e)(),s=jo(Cr,ae.UrlEncodeArr,this.logger,this.performanceClient,e)(new Uint8Array(a));this.encryptionCookie={id:i,key:await Ce(Rc,ae.GenerateHKDF,this.logger,this.performanceClient,e)(a)};const l={id:i,key:s};t.setItem(Dc,JSON.stringify(l),0,!0,Da.None)}this.broadcast.addEventListener("message",this.updateCache.bind(this))}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw Je(gs);return this.memoryStorage.getItem(e)}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,n){if(!this.initialized||!this.encryptionCookie)throw Je(gs);const{data:r,nonce:i}=await Ce(E0,ae.Encrypt,this.logger,this.performanceClient,n)(this.encryptionCookie.key,t,this.getContext(e)),a={id:this.encryptionCookie.id,nonce:i,data:r};this.memoryStorage.setItem(e,t),this.setItem(e,JSON.stringify(a)),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),Ha(this).forEach(n=>this.removeItem(n));const t=La(this.clientId,this);t.idToken.forEach(n=>this.removeItem(n)),t.accessToken.forEach(n=>this.removeItem(n)),t.refreshToken.forEach(n=>this.removeItem(n)),this.getKeys().forEach(n=>{(n.startsWith(ge.CACHE_PREFIX)||n.indexOf(this.clientId)!==-1)&&this.removeItem(n)})}async importExistingCache(e){if(!this.encryptionCookie)return;let t=Ha(this);t=await this.importArray(t,e),this.setItem(tr.ACCOUNT_KEYS,JSON.stringify(t));const n=La(this.clientId,this);n.idToken=await this.importArray(n.idToken,e),n.accessToken=await this.importArray(n.accessToken,e),n.refreshToken=await this.importArray(n.refreshToken,e),this.setItem(`${tr.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}async getItemFromEncryptedCache(e,t){if(!this.encryptionCookie)return null;const n=this.getItem(e);if(!n)return null;let r;try{r=JSON.parse(n)}catch{return null}return!r.id||!r.nonce||!r.data?(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),null):r.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):Ce(I0,ae.Decrypt,this.logger,this.performanceClient,t)(this.encryptionCookie.key,r.nonce,this.getContext(e),r.data)}async importArray(e,t){const n=[],r=[];return e.forEach(i=>{const a=this.getItemFromEncryptedCache(i,t).then(s=>{s?(this.memoryStorage.setItem(i,s),n.push(i)):this.removeItem(i)});r.push(a)}),await Promise.all(r),n}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e){this.logger.trace("Updating internal cache from broadcast event");const t=this.performanceClient.startMeasurement(ae.LocalStorageUpdated);t.add({isBackground:!0});const{key:n,value:r,context:i}=e.data;if(!n){this.logger.error("Broadcast event missing key"),t.end({success:!1,errorCode:"noKey"});return}if(i&&i!==this.clientId){this.logger.trace(`Ignoring broadcast event from clientId: ${i}`),t.end({success:!1,errorCode:"contextMismatch"});return}r?(this.memoryStorage.setItem(n,r),this.logger.verbose("Updated item in internal cache")):(this.memoryStorage.removeItem(n),this.logger.verbose("Removed item from internal cache")),t.end({success:!0})}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class q0{constructor(){if(!window.sessionStorage)throw Ml(yi)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */function Qh(o,e){if(!e)return null;try{return _o.parseRequestState(o,e).libraryState.meta}catch{throw ke(Gr)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const ct={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"};/*! @azure/msal-browser v4.5.0 2025-02-26 */class Ua extends Ia{constructor(e,t,n,r,i,a,s){super(e,n,r,s),this.cacheConfig=t,this.logger=r,this.internalStorage=new Ws,this.browserStorage=Hc(e,t.cacheLocation,r,i),this.temporaryCacheStorage=Hc(e,t.temporaryCacheLocation,r,i),this.cookieStorage=new jh,this.performanceClient=i,this.eventHandler=a}async initialize(e){await this.browserStorage.initialize(e)}validateAndParseJson(e){try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}getAccount(e){this.logger.trace("BrowserCacheManager.getAccount called");const t=this.browserStorage.getUserData(e);if(!t)return this.removeAccountKeyFromMap(e),null;const n=this.validateAndParseJson(t);return!n||!Un.isAccountEntity(n)?(this.removeAccountKeyFromMap(e),null):Ia.toObject(new Un,n)}async setAccount(e,t){this.logger.trace("BrowserCacheManager.setAccount called");const n=e.generateAccountKey();await Ce(this.browserStorage.setUserData.bind(this.browserStorage),ae.SetUserData,this.logger,this.performanceClient)(n,JSON.stringify(e),t);const r=this.addAccountKeyToMap(n);this.cacheConfig.cacheLocation===Sn.LocalStorage&&r&&this.eventHandler.emitEvent(ct.ACCOUNT_ADDED,void 0,e.getAccountInfo())}getAccountKeys(){return Ha(this.browserStorage)}addAccountKeyToMap(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const t=this.getAccountKeys();return t.indexOf(e)===-1?(t.push(e),this.browserStorage.setItem(tr.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added"),!0):(this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map"),!1)}removeAccountKeyFromMap(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const t=this.getAccountKeys(),n=t.indexOf(e);n>-1?(t.splice(n,1),this.browserStorage.setItem(tr.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}async removeAccount(e){super.removeAccount(e),this.removeAccountKeyFromMap(e)}async removeAccountContext(e){await super.removeAccountContext(e),this.cacheConfig.cacheLocation===Sn.LocalStorage&&this.eventHandler.emitEvent(ct.ACCOUNT_REMOVED,void 0,e.getAccountInfo())}removeIdToken(e){super.removeIdToken(e),this.removeTokenKey(e,_t.ID_TOKEN)}async removeAccessToken(e){super.removeAccessToken(e),this.removeTokenKey(e,_t.ACCESS_TOKEN)}removeRefreshToken(e){super.removeRefreshToken(e),this.removeTokenKey(e,_t.REFRESH_TOKEN)}getTokenKeys(){return La(this.clientId,this.browserStorage)}addTokenKey(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");const n=this.getTokenKeys();switch(t){case _t.ID_TOKEN:n.idToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),n.idToken.push(e));break;case _t.ACCESS_TOKEN:n.accessToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),n.accessToken.push(e));break;case _t.REFRESH_TOKEN:n.refreshToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),n.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),ke(Ca)}this.browserStorage.setItem(`${tr.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}removeTokenKey(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");const n=this.getTokenKeys();switch(t){case _t.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);const r=n.idToken.indexOf(e);r>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),n.idToken.splice(r,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case _t.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);const i=n.accessToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),n.accessToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case _t.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);const a=n.refreshToken.indexOf(e);a>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),n.refreshToken.splice(a,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),ke(Ca)}this.browserStorage.setItem(`${tr.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(n))}getIdTokenCredential(e){const t=this.browserStorage.getUserData(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,_t.ID_TOKEN),null;const n=this.validateAndParseJson(t);return!n||!C1(n)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,_t.ID_TOKEN),null):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),n)}async setIdTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const n=ci(e);await Ce(this.browserStorage.setUserData.bind(this.browserStorage),ae.SetUserData,this.logger,this.performanceClient)(n,JSON.stringify(e),t),this.addTokenKey(n,_t.ID_TOKEN)}getAccessTokenCredential(e){const t=this.browserStorage.getUserData(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,_t.ACCESS_TOKEN),null;const n=this.validateAndParseJson(t);return!n||!k1(n)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,_t.ACCESS_TOKEN),null):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),n)}async setAccessTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const n=ci(e);await Ce(this.browserStorage.setUserData.bind(this.browserStorage),ae.SetUserData,this.logger,this.performanceClient)(n,JSON.stringify(e),t),this.addTokenKey(n,_t.ACCESS_TOKEN)}getRefreshTokenCredential(e){const t=this.browserStorage.getUserData(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,_t.REFRESH_TOKEN),null;const n=this.validateAndParseJson(t);return!n||!E1(n)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,_t.REFRESH_TOKEN),null):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),n)}async setRefreshTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const n=ci(e);await Ce(this.browserStorage.setUserData.bind(this.browserStorage),ae.SetUserData,this.logger,this.performanceClient)(n,JSON.stringify(e),t),this.addTokenKey(n,_t.REFRESH_TOKEN)}getAppMetadata(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!N1(e,n)?(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),n)}setAppMetadata(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");const t=O1(e);this.browserStorage.setItem(t,JSON.stringify(e))}getServerTelemetry(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!M1(e,n)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),n)}setServerTelemetry(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.browserStorage.setItem(e,JSON.stringify(t))}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&D1(e,n)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),n):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(Qi.WRAPPER_SKU,e),this.internalStorage.setItem(Qi.WRAPPER_VER,t)}getWrapperMetadata(){const e=this.internalStorage.getItem(Qi.WRAPPER_SKU)||ge.EMPTY_STRING,t=this.internalStorage.getItem(Qi.WRAPPER_VER)||ge.EMPTY_STRING;return[e,t]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(){const e=this.generateCacheKey(rc.ACTIVE_ACCOUNT_FILTERS),t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters found"),null;const n=this.validateAndParseJson(t);return n?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:n.homeAccountId,localAccountId:n.localAccountId,tenantId:n.tenantId})):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e){const t=this.generateCacheKey(rc.ACTIVE_ACCOUNT_FILTERS);if(e){this.logger.verbose("setActiveAccount: Active account set");const n={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.browserStorage.setItem(t,JSON.stringify(n))}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t);this.eventHandler.emitEvent(ct.ACTIVE_ACCOUNT_CHANGED)}getThrottlingCache(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const n=this.validateAndParseJson(t);return!n||!P1(e,n)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),n)}setThrottlingCache(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.browserStorage.setItem(e,JSON.stringify(t))}getTemporaryCache(e,t){const n=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const i=this.cookieStorage.getItem(n);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),i}const r=this.temporaryCacheStorage.getItem(n);if(!r){if(this.cacheConfig.cacheLocation===Sn.LocalStorage){const i=this.browserStorage.getItem(n);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),i}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),r}setTemporaryCache(e,t,n){const r=n?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(r,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(r,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}async clear(){await this.removeAllAccounts(),this.removeAppMetadata(),this.temporaryCacheStorage.getKeys().forEach(e=>{(e.indexOf(ge.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(e)}),this.browserStorage.getKeys().forEach(e=>{(e.indexOf(ge.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(e)}),this.internalStorage.clear()}async clearTokensAndKeysWithClaims(e,t){e.addQueueMeasurement(ae.ClearTokensAndKeysWithClaims,t);const n=this.getTokenKeys(),r=[];n.accessToken.forEach(i=>{const a=this.getAccessTokenCredential(i);a!=null&&a.requestedClaimsHash&&i.includes(a.requestedClaimsHash.toLowerCase())&&r.push(this.removeAccessToken(i))}),await Promise.all(r),r.length>0&&this.logger.warning(`${r.length} access tokens with claims in the cache keys have been removed from the cache.`)}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):Po.startsWith(e,ge.CACHE_PREFIX)?e:`${ge.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){const{libraryState:{id:t}}=_o.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${Lt.AUTHORITY}.${t}`)}generateNonceKey(e){const{libraryState:{id:t}}=_o.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${Lt.NONCE_IDTOKEN}.${t}`)}generateStateKey(e){const{libraryState:{id:t}}=_o.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${Lt.REQUEST_STATE}.${t}`)}getCachedAuthority(e){const t=this.generateStateKey(e),n=this.getTemporaryCache(t);if(!n)return null;const r=this.generateAuthorityKey(n);return this.getTemporaryCache(r)}updateCacheEntries(e,t,n,r,i){this.logger.trace("BrowserCacheManager.updateCacheEntries called");const a=this.generateStateKey(e);this.setTemporaryCache(a,e,!1);const s=this.generateNonceKey(e);this.setTemporaryCache(s,t,!1);const l=this.generateAuthorityKey(e);if(this.setTemporaryCache(l,n,!1),i){const c={credential:i.homeAccountId,type:Xn.HOME_ACCOUNT_ID};this.setTemporaryCache(Lt.CCS_CREDENTIAL,JSON.stringify(c),!0)}else if(r){const c={credential:r,type:Xn.UPN};this.setTemporaryCache(Lt.CCS_CREDENTIAL,JSON.stringify(c),!0)}}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach(t=>{t.indexOf(e)!==-1&&this.removeTemporaryItem(t)}),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey(Lt.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(Lt.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(Lt.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(Lt.CORRELATION_ID)),this.removeTemporaryItem(this.generateCacheKey(Lt.CCS_CREDENTIAL)),this.removeTemporaryItem(this.generateCacheKey(Lt.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){const t=this.generateStateKey(e),n=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${n}`),this.resetRequestCache(n||ge.EMPTY_STRING)}}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach(t=>{if(t.indexOf(Lt.REQUEST_STATE)===-1)return;const n=this.temporaryCacheStorage.getItem(t);if(!n)return;const r=Qh(this.cryptoImpl,n);r&&r.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${n}`),this.resetRequestCache(n))}),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");const t=Tl(JSON.stringify(e));this.setTemporaryCache(Lt.REQUEST_PARAMS,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");const t=this.getTemporaryCache(Lt.REQUEST_PARAMS,!0);if(!t)throw Je(yh);let n;try{n=JSON.parse(Go(t))}catch(r){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${r}`),Je(vh)}if(this.removeTemporaryItem(this.generateCacheKey(Lt.REQUEST_PARAMS)),!n.authority){const r=this.generateAuthorityKey(e),i=this.getTemporaryCache(r);if(!i)throw Je(Cl);n.authority=i}return n}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(Lt.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${ge.CACHE_PREFIX}.${Lt.INTERACTION_STATUS_KEY}`;return this.getTemporaryCache(e,!1)}setInteractionInProgress(e){const t=`${ge.CACHE_PREFIX}.${Lt.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw Je(dh);this.setTemporaryCache(t,this.clientId,!1)}else!e&&this.getInteractionInProgress()===this.clientId&&this.removeTemporaryItem(t)}async hydrateCache(e,t){var s,l,c;const n=Ns((s=e.account)==null?void 0:s.homeAccountId,(l=e.account)==null?void 0:l.environment,e.idToken,this.clientId,e.tenantId);let r;t.claims&&(r=await this.cryptoImpl.hashString(t.claims));const i=Ds((c=e.account)==null?void 0:c.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?e.expiresOn.getTime()/1e3:0,e.extExpiresOn?e.extExpiresOn.getTime()/1e3:0,Go,void 0,e.tokenType,void 0,t.sshKid,t.claims,r),a={idToken:n,accessToken:i};return this.saveCacheRecord(a,e.correlationId)}async saveCacheRecord(e,t,n){try{await super.saveCacheRecord(e,t,n)}catch(r){if(r instanceof zr&&this.performanceClient&&t)try{const i=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:i.refreshToken.length,cacheIdCount:i.idToken.length,cacheAtCount:i.accessToken.length},t)}catch{}throw r}}}function Hc(o,e,t,n){try{switch(e){case Sn.LocalStorage:return new Y0(o,t,n);case Sn.SessionStorage:return new q0;case Sn.MemoryStorage:default:break}}catch(r){t.error(r)}return new Ws}const j0=(o,e,t,n)=>{const r={cacheLocation:Sn.MemoryStorage,temporaryCacheLocation:Sn.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new Ua(o,r,ls,e,t,n)};/*! @azure/msal-browser v4.5.0 2025-02-26 */function Q0(o,e,t,n){return o.verbose("getAllAccounts called"),t?e.getAllAccounts(n):[]}function X0(o,e,t){if(e.trace("getAccount called"),Object.keys(o).length===0)return e.warning("getAccount: No accountFilter provided"),null;const n=t.getAccountInfoFilteredBy(o);return n?(e.verbose("getAccount: Account matching provided filter found, returning"),n):(e.verbose("getAccount: No matching account found, returning null"),null)}function J0(o,e,t){if(e.trace("getAccountByUsername called"),!o)return e.warning("getAccountByUsername: No username provided"),null;const n=t.getAccountInfoFilteredBy({username:o});return n?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${o}`),n):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}function x0(o,e,t){if(e.trace("getAccountByHomeId called"),!o)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;const n=t.getAccountInfoFilteredBy({homeAccountId:o});return n?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${o}`),n):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function Z0(o,e,t){if(e.trace("getAccountByLocalId called"),!o)return e.warning("getAccountByLocalId: No localAccountId provided"),null;const n=t.getAccountInfoFilteredBy({localAccountId:o});return n?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${o}`),n):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function $0(o,e){e.setActiveAccount(o)}function eb(o){return o.getActiveAccount()}/*! @azure/msal-browser v4.5.0 2025-02-26 */const tb="msal.broadcast.event";class nb{constructor(e){this.eventCallbacks=new Map,this.logger=e||new ir({}),this.broadcastChannel=new BroadcastChannel(tb),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,n){if(typeof window<"u"){const r=n||N0();return this.eventCallbacks.has(r)?(this.logger.error(`Event callback with id: ${r} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(r,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${r}`),r)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,n,r){const i={eventType:e,interactionType:t||null,payload:n||null,error:r||null,timestamp:Date.now()};switch(e){case ct.ACCOUNT_ADDED:case ct.ACCOUNT_REMOVED:case ct.ACTIVE_ACCOUNT_CHANGED:this.broadcastChannel.postMessage(i);break;default:this.invokeCallbacks(i);break}}invokeCallbacks(e){this.eventCallbacks.forEach(([t,n],r)=>{(n.length===0||n.includes(e.eventType))&&(this.logger.verbose(`Emitting event to callback ${r}: ${e.eventType}`),t.apply(null,[e]))})}invokeCrossTabCallbacks(e){const t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){this.broadcastChannel.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){this.broadcastChannel.removeEventListener("message",this.invokeCrossTabCallbacks)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Xh{constructor(e,t,n,r,i,a,s,l,c){this.config=e,this.browserStorage=t,this.browserCrypto=n,this.networkClient=this.config.system.networkClient,this.eventHandler=i,this.navigationClient=a,this.nativeMessageHandler=l,this.correlationId=c||yo(),this.logger=r.clone(Qn.MSAL_SKU,Gs,this.correlationId),this.performanceClient=s}async clearCacheOnLogout(e){if(e){Un.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null));try{await this.browserStorage.removeAccount(Un.generateAccountCacheKey(e)),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),await this.browserStorage.clear(),await this.browserCrypto.clearKeystore()}catch{this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri;return At.getAbsoluteUrl(t,Vo())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const n={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new bi(n,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,n=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(ae.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const r={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},i=e.requestAuthority||this.config.auth.authority,a=n!=null&&n.length?n==="true":this.config.auth.instanceAware,s=t&&a?this.config.auth.authority.replace(At.getDomainFromUrl(i),t.environment):i,l=Rn.generateAuthority(s,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),c=await Ce(eh,ae.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(l,this.config.system.networkClient,this.browserStorage,r,this.logger,this.correlationId,this.performanceClient);if(t&&!c.isAlias(t.environment))throw Vt(Yf);return c}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const ob=32;async function Jh(o,e,t){o.addQueueMeasurement(ae.GeneratePkceCodes,t);const n=jo(rb,ae.GenerateCodeVerifier,e,o,t)(o,e,t),r=await Ce(ib,ae.GenerateCodeChallengeFromVerifier,e,o,t)(n,o,e,t);return{verifier:n,challenge:r}}function rb(o,e,t){try{const n=new Uint8Array(ob);return jo(y0,ae.GetRandomValues,e,o,t)(n),Cr(n)}catch{throw Je(wl)}}async function ib(o,e,t,n){e.addQueueMeasurement(ae.GenerateCodeChallengeFromVerifier,n);try{const r=await Ce(Fh,ae.Sha256Digest,t,e,n)(o,e,n);return Cr(new Uint8Array(r))}catch{throw Je(wl)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */async function Dl(o,e,t,n){t.addQueueMeasurement(ae.InitializeBaseRequest,o.correlationId);const r=o.authority||e.auth.authority,i=[...o&&o.scopes||[]],a={...o,correlationId:o.correlationId,authority:r,scopes:i};if(!a.authenticationScheme)a.authenticationScheme=Ut.BEARER,n.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);else{if(a.authenticationScheme===Ut.SSH){if(!o.sshJwk)throw Vt(Hs);if(!o.sshKid)throw Vt(Kf)}n.verbose(`Authentication Scheme set to "${a.authenticationScheme}" as configured in Auth request`)}return e.cache.claimsBasedCachingEnabled&&o.claims&&!Po.isEmptyObj(o.claims)&&(a.requestedClaimsHash=await Gh(o.claims)),a}async function sb(o,e,t,n,r){n.addQueueMeasurement(ae.InitializeSilentRequest,o.correlationId);const i=await Ce(Dl,ae.InitializeBaseRequest,r,n,o.correlationId)(o,t,n,r);return{...o,...i,account:e,forceRefresh:o.forceRefresh||!1}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Zr extends Xh{async initializeAuthorizationCodeRequest(e,t){this.performanceClient.addQueueMeasurement(ae.StandardInteractionClientInitializeAuthorizationCodeRequest,this.correlationId);const n=t||await Ce(Jh,ae.GeneratePkceCodes,this.logger,this.performanceClient,this.correlationId)(this.performanceClient,this.logger,this.correlationId),r={...e,redirectUri:e.redirectUri,code:ge.EMPTY_STRING,codeVerifier:n.verifier};return e.codeChallenge=n.challenge,e.codeChallengeMethod=ge.S256_CODE_CHALLENGE_METHOD,r}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e==null?void 0:e.correlationId);const t={correlationId:this.correlationId||yo(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const n=this.getLogoutHintFromIdTokenClaims(e.account);n&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=n)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=At.getAbsoluteUrl(e.postLogoutRedirectUri,Vo())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=At.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,Vo())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=At.getAbsoluteUrl(Vo(),Vo())):this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(ae.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const t=await Ce(this.getClientConfiguration.bind(this),ae.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new oh(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:n,requestAzureCloudOptions:r,requestExtraQueryParameters:i,account:a}=e;this.performanceClient.addQueueMeasurement(ae.StandardInteractionClientGetClientConfiguration,this.correlationId);const s=await Ce(this.getDiscoveredAuthority.bind(this),ae.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:n,requestAzureCloudOptions:r,requestExtraQueryParameters:i,account:a}),l=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:s,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:l.loggerCallback,piiLoggingEnabled:l.piiLoggingEnabled,logLevel:l.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:Qn.MSAL_SKU,version:Gs,cpu:ge.EMPTY_STRING,os:ge.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(ae.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const n=this.getRedirectUri(e.redirectUri),r={interactionType:t},i=_o.setRequestState(this.browserCrypto,e&&e.state||ge.EMPTY_STRING,r),s={...await Ce(Dl,ae.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:n,state:i,nonce:e.nonce||yo(),responseMode:this.config.auth.OIDCOptions.serverResponseType};if(e.loginHint||e.sid)return s;const l=e.account||this.browserStorage.getActiveAccount();return l&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${l.homeAccountId}`,this.correlationId),s.account=l),s}}/*! @azure/msal-browser v4.5.0 2025-02-26 */const ab="ContentError",xh="user_switch";/*! @azure/msal-browser v4.5.0 2025-02-26 */const lb="USER_INTERACTION_REQUIRED",cb="USER_CANCEL",ub="NO_NETWORK",db="PERSISTENT_ERROR",fb="DISABLED",hb="ACCOUNT_UNAVAILABLE";/*! @azure/msal-browser v4.5.0 2025-02-26 */const gb=-2147186943,mb={[xh]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class Ao extends en{constructor(e,t,n){super(e,t),Object.setPrototypeOf(this,Ao.prototype),this.name="NativeAuthError",this.ext=n}}function Nr(o){if(o.ext&&o.ext.status&&(o.ext.status===db||o.ext.status===fb)||o.ext&&o.ext.error&&o.ext.error===gb)return!0;switch(o.errorCode){case ab:return!0;default:return!1}}function Ba(o,e,t){if(t&&t.status)switch(t.status){case hb:return Aa(th);case lb:return new bo(o,e);case cb:return Je(kr);case ub:return Je(hs)}return new Ao(o,mb[o]||e,t)}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Zh extends Zr{async acquireToken(e){this.performanceClient.addQueueMeasurement(ae.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(jt.acquireTokenSilent_silentFlow),n=await Ce(this.getClientConfiguration.bind(this),ae.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),r=new J_(n,this.performanceClient);this.logger.verbose("Silent auth client created");try{const a=(await Ce(r.acquireCachedToken.bind(r),ae.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),a}catch(i){throw i instanceof Ai&&i.errorCode===El&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),i}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t==null?void 0:t.account)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Vr extends Xh{constructor(e,t,n,r,i,a,s,l,c,u,d,f){var _;super(e,t,n,r,i,a,l,c,f),this.apiId=s,this.accountId=u,this.nativeMessageHandler=c,this.nativeStorageManager=d,this.silentCacheClient=new Zh(e,this.nativeStorageManager,n,r,i,a,l,c,f);const h=this.nativeMessageHandler.getExtensionId()===Hr.PREFERRED_EXTENSION_ID?"chrome":(_=this.nativeMessageHandler.getExtensionId())!=null&&_.length?"unknown":void 0;this.skus=bi.makeExtraSkuString({libraryName:Qn.MSAL_SKU,libraryVersion:Gs,extensionName:h,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[O_]:this.skus}}async acquireToken(e){this.performanceClient.addQueueMeasurement(ae.NativeInteractionClientAcquireToken,e.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const t=this.performanceClient.startMeasurement(ae.NativeInteractionClientAcquireToken,e.correlationId),n=No(),r=this.initializeServerTelemetryManager(this.apiId);try{const i=await this.initializeNativeRequest(e);try{const u=await this.acquireTokensFromCache(this.accountId,i);return t.end({success:!0,isNativeBroker:!1,fromCache:!0}),u}catch{this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const{...a}=i,s={method:br.GetToken,request:a},l=await this.nativeMessageHandler.sendMessage(s),c=this.validateNativeResponse(l);return await this.handleNativeResponse(c,i,n).then(u=>(t.end({success:!0,isNativeBroker:!0,requestId:u.requestId}),r.clearNativeBrokerErrorCode(),u)).catch(u=>{throw t.end({success:!1,errorCode:u.errorCode,subErrorCode:u.subError,isNativeBroker:!0}),u})}catch(i){throw i instanceof Ao&&r.setNativeBrokerErrorCode(i.errorCode),i}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:un.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),ke(wa);const n=this.browserStorage.getBaseAccountInfo({nativeAccountId:e});if(!n)throw ke(wa);try{const r=this.createSilentCacheRequest(t,n),i=await this.silentCacheClient.acquireToken(r),a={...n,idTokenClaims:i==null?void 0:i.idTokenClaims,idToken:i==null?void 0:i.idToken};return{...i,account:a}}catch(r){throw r}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...n}=e;delete n.onRedirectNavigate;const r=await this.initializeNativeRequest(n),i={method:br.GetToken,request:r};try{const l=await this.nativeMessageHandler.sendMessage(i);this.validateNativeResponse(l)}catch(l){if(l instanceof Ao&&(this.initializeServerTelemetryManager(this.apiId).setNativeBrokerErrorCode(l.errorCode),Nr(l)))throw l}this.browserStorage.setTemporaryCache(Lt.NATIVE_REQUEST,JSON.stringify(r),!0);const a={apiId:jt.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},s=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(s,a)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const n=this.browserStorage.getCachedNativeRequest();if(!n)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&(e==null||e.addFields({errorCode:"no_cached_request"},t)),null;const{prompt:r,...i}=n;r&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Lt.NATIVE_REQUEST));const a={method:br.GetToken,request:i},s=No();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const l=await this.nativeMessageHandler.sendMessage(a);this.validateNativeResponse(l);const c=this.handleNativeResponse(l,i,s);this.browserStorage.setInteractionInProgress(!1);const u=await c;return this.initializeServerTelemetryManager(this.apiId).clearNativeBrokerErrorCode(),u}catch(l){throw this.browserStorage.setInteractionInProgress(!1),l}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,n){var u;this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const r=xr(e.id_token,Go),i=this.createHomeAccountIdentifier(e,r),a=(u=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId}))==null?void 0:u.homeAccountId;if(i!==a&&e.account.id!==t.accountId)throw Ba(xh);const s=await this.getDiscoveredAuthority({requestAuthority:t.authority}),l=bl(this.browserStorage,s,i,Go,r,e.client_info,void 0,r.tid,void 0,e.account.id,this.logger),c=await this.generateAuthenticationResult(e,t,r,l,s.canonicalAuthority,n);return await this.cacheAccount(l),await this.cacheNativeTokens(e,t,i,r,e.access_token,c.tenantId,n),c}createHomeAccountIdentifier(e,t){return Un.generateHomeAccountId(e.client_info||ge.EMPTY_STRING,go.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return e.scope?un.fromString(e.scope):un.fromString(t.scope)}async generatePopAccessToken(e,t){if(t.tokenType===Ut.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const n=new Wr(this.browserCrypto),r={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw ke(nl);return n.signPopToken(e.access_token,t.keyId,r)}else return e.access_token}async generateAuthenticationResult(e,t,n,r,i,a){const s=this.addTelemetryFromNativeResponse(e),l=e.scope?un.fromString(e.scope):un.fromString(t.scope),c=e.account.properties||{},u=c.UID||n.oid||n.sub||ge.EMPTY_STRING,d=c.TenantId||n.tid||ge.EMPTY_STRING,f=fl(r.getAccountInfo(),void 0,n,e.id_token);f.nativeAccountId!==e.account.id&&(f.nativeAccountId=e.account.id);const h=await this.generatePopAccessToken(e,t),_=t.tokenType===Ut.POP?Ut.POP:Ut.BEARER;return{authority:i,uniqueId:u,tenantId:d,scopes:l.asArray(),account:f,idToken:e.id_token,idTokenClaims:n,accessToken:h,fromCache:s?this.isResponseFromCache(s):!1,expiresOn:new Date(Number(a+e.expires_in)*1e3),tokenType:_,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}async cacheAccount(e){await this.browserStorage.setAccount(e,this.correlationId),this.browserStorage.removeAccountContext(e).catch(t=>{this.logger.error(`Error occurred while removing account context from browser storage. ${t}`)})}cacheNativeTokens(e,t,n,r,i,a,s){const l=Ns(n,t.authority,e.id_token||"",t.clientId,r.tid||""),c=t.tokenType===Ut.POP?ge.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,u=s+c,d=this.generateScopes(e,t),f=Ds(n,t.authority,i,t.clientId,r.tid||a,d.printScopes(),u,0,Go,void 0,t.tokenType,void 0,t.keyId),h={idToken:l,accessToken:f};return this.nativeStorageManager.saveCacheRecord(h,this.correlationId,t.storeInCache)}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw df(Ja,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const n=new At(t);n.validateAsUri();const{scopes:r,...i}=e,a=new un(r||[]);a.appendScopes(Ii);const s=()=>{switch(this.apiId){case jt.ssoSilent:case jt.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),wn.NONE}if(!e.prompt){this.logger.trace("initializeNativeRequest: prompt was not provided");return}switch(e.prompt){case wn.NONE:case wn.CONSENT:case wn.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),Je(Mh)}},l={...i,accountId:this.accountId,clientId:this.config.auth.clientId,authority:n.urlString,scope:a.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:s(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(l.signPopToken&&e.popKid)throw Je(Oh);if(this.handleExtraBrokerParams(l),l.extraParameters=l.extraParameters||{},l.extraParameters.telemetry=Hr.MATS_TELEMETRY,e.authenticationScheme===Ut.POP){const c={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},u=new Wr(this.browserCrypto);let d;if(l.keyId)d=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:l.keyId})),l.signPopToken=!1;else{const f=await Ce(u.generateCnf.bind(u),ae.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(c,this.logger);d=f.reqCnfString,l.keyId=f.kid,l.signPopToken=!0}l.reqCnf=d}return this.addRequestSKUs(l),l}handleExtraBrokerParams(e){var i;const t=e.extraParameters&&e.extraParameters.hasOwnProperty(ml)&&e.extraParameters.hasOwnProperty(Sa)&&e.extraParameters.hasOwnProperty(vr);if(!e.embeddedClientId&&!t)return;let n="";const r=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,n=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[Sa],n=e.extraParameters[vr]),e.extraParameters={child_client_id:n,child_redirect_uri:r},(i=this.performanceClient)==null||i.addFields({embeddedClientId:n,embeddedRedirectUri:r},e.correlationId)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Ro{constructor(e,t,n,r){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=r,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=n,this.handshakeEvent=n.startMeasurement(ae.NativeMessageHandlerHandshake)}async sendMessage(e){this.logger.trace("NativeMessageHandler - sendMessage called.");const t={channel:Hr.CHANNEL_ID,extensionId:this.extensionId,responseId:yo(),body:e};return this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(t)}`),this.messageChannel.port1.postMessage(t),new Promise((n,r)=>{this.resolvers.set(t.responseId,{resolve:n,reject:r})})}static async createProvider(e,t,n){e.trace("NativeMessageHandler - createProvider called.");try{const r=new Ro(e,t,n,Hr.PREFERRED_EXTENSION_ID);return await r.sendHandshakeRequest(),r}catch{const i=new Ro(e,t,n);return await i.sendHandshakeRequest(),i}}async sendHandshakeRequest(){this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:Hr.CHANNEL_ID,extensionId:this.extensionId,responseId:yo(),body:{method:br.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=t=>{this.onChannelMessage(t)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,n)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:n}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),n(Je(Ah)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;const t=e.data;if(!(!t.channel||t.channel!==Hr.CHANNEL_ID)&&!(t.extensionId&&t.extensionId!==this.extensionId)&&t.body.method===br.HandshakeRequest){const n=this.handshakeResolvers.get(t.responseId);if(!n){this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);return}this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),n.reject(Je(Rh))}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");const t=e.data,n=this.resolvers.get(t.responseId),r=this.handshakeResolvers.get(t.responseId);try{const i=t.body.method;if(i===br.Response){if(!n)return;const a=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(a)}`),a.status!=="Success")n.reject(Ba(a.code,a.description,a.ext));else if(a.result)a.result.code&&a.result.description?n.reject(Ba(a.result.code,a.result.description,a.result.ext)):n.resolve(a.result);else throw df(Ja,"Event does not contain result.");this.resolvers.delete(t.responseId)}else if(i===br.HandshakeResponse){if(!r){this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),r.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(i){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${i}`),this.logger.errorPii(`Unable to parse ${e}`),n?n.reject(i):r&&r.reject(i)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isPlatformBrokerAvailable(e,t,n,r){if(t.trace("isPlatformBrokerAvailable called"),!e.system.allowPlatformBroker)return t.trace("isPlatformBrokerAvailable: allowPlatformBroker is not enabled, returning false"),!1;if(!n)return t.trace("isPlatformBrokerAvailable: Platform extension provider is not initialized, returning false"),!1;if(r)switch(r){case Ut.BEARER:case Ut.POP:return t.trace("isPlatformBrokerAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isPlatformBrokerAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Hl{constructor(e,t,n,r,i){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=r,this.performanceClient=i}async handleCodeResponse(e,t){this.performanceClient.addQueueMeasurement(ae.HandleCodeResponse,t.correlationId);let n;try{n=this.authModule.handleFragmentResponse(e,t.state)}catch(r){throw r instanceof sr&&r.subError===kr?Je(kr):r}return Ce(this.handleCodeResponseFromServer.bind(this),ae.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(n,t)}async handleCodeResponseFromServer(e,t,n=!0){if(this.performanceClient.addQueueMeasurement(ae.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await Ce(this.authModule.updateAuthority.bind(this.authModule),ae.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),n&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const i=this.createCcsCredentials(t);i&&(this.authCodeRequest.ccsCredential=i)}return await Ce(this.authModule.acquireToken.bind(this.authModule),ae.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:Xn.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:Xn.UPN}:null}}/*! @azure/msal-browser v4.5.0 2025-02-26 */function $h(o,e,t){const n=us(o);if(!n)throw jf(o)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${o}`),Je(lh)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),Je(ah));return n}function pb(o,e,t){if(!o.state)throw Je(kl);const n=Qh(e,o.state);if(!n)throw Je(ch);if(n.interactionType!==t)throw Je(uh)}/*! @azure/msal-browser v4.5.0 2025-02-26 */class _b extends Zr{constructor(e,t,n,r,i,a,s,l,c,u){super(e,t,n,r,i,a,s,c,u),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=l}acquireToken(e,t){try{const r={popupName:this.generatePopupName(e.scopes||Ii,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window};return this.performanceClient.addFields({isAsyncPopup:this.config.system.asyncPopups},this.correlationId),this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,r,t)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(e,r,t))}catch(n){return Promise.reject(n)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),n={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:(e==null?void 0:e.popupWindowAttributes)||{},popupWindowParent:(e==null?void 0:e.popupWindowParent)??window},r=e&&e.authority,i=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,n,r,i)):(this.logger.verbose("asyncPopup set to false, opening popup"),n.popup=this.openSizedPopup("about:blank",n),this.logoutPopupAsync(t,n,r,i))}catch(t){return Promise.reject(t)}}async acquireTokenPopupAsync(e,t,n){var a;this.logger.verbose("acquireTokenPopupAsync called");const r=this.initializeServerTelemetryManager(jt.acquireTokenPopup),i=await Ce(this.initializeAuthorizationRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,st.Popup);t.popup&&qh(i.authority);try{const s=await Ce(this.initializeAuthorizationCodeRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(i,n),l=await Ce(this.createAuthCodeClient.bind(this),ae.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:i.authority,requestAzureCloudOptions:i.azureCloudOptions,requestExtraQueryParameters:i.extraQueryParameters,account:i.account}),c=Ro.isPlatformBrokerAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme);let u;c&&(u=this.performanceClient.startMeasurement(ae.FetchAccountIdWithNativeBroker,e.correlationId));const d=await l.getAuthCodeUrl({...i,platformBroker:c}),f=new Hl(l,this.browserStorage,s,this.logger,this.performanceClient),h=this.initiateAuthRequest(d,t);this.eventHandler.emitEvent(ct.POPUP_OPENED,st.Popup,{popupWindow:h},null);const _=await this.monitorPopupForHash(h,t.popupWindowParent),y=jo($h,ae.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(_,this.config.auth.OIDCOptions.serverResponseType,this.logger);if(So.removeThrottle(this.browserStorage,this.config.auth.clientId,s),y.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),u&&u.end({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw Je(Si);const m=new Vr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,jt.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,y.accountId,this.nativeStorage,i.correlationId),{userRequestState:b}=_o.parseRequestState(this.browserCrypto,i.state);return await m.acquireToken({...i,state:b,prompt:void 0})}return await f.handleCodeResponse(y,i)}catch(s){throw(a=t.popup)==null||a.close(),s instanceof en&&(s.setCorrelationId(this.correlationId),r.cacheFailedRequest(s)),s}}async logoutPopupAsync(e,t,n,r){var a,s,l,c;this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(ct.LOGOUT_START,st.Popup,e);const i=this.initializeServerTelemetryManager(jt.logoutPopup);try{await this.clearCacheOnLogout(e.account);const u=await Ce(this.createAuthCodeClient.bind(this),ae.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:n,account:e.account||void 0});try{u.authority.endSessionEndpoint}catch{if((a=e.account)!=null&&a.homeAccountId&&e.postLogoutRedirectUri&&u.authority.protocolMode===Ko.OIDC){if(this.browserStorage.removeAccount((s=e.account)==null?void 0:s.homeAccountId),this.eventHandler.emitEvent(ct.LOGOUT_SUCCESS,st.Popup,e),r){const h={apiId:jt.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},_=At.getAbsoluteUrl(r,Vo());await this.navigationClient.navigateInternal(_,h)}(l=t.popup)==null||l.close();return}}const d=u.getLogoutUri(e);this.eventHandler.emitEvent(ct.LOGOUT_SUCCESS,st.Popup,e);const f=this.openPopup(d,t);if(this.eventHandler.emitEvent(ct.POPUP_OPENED,st.Popup,{popupWindow:f},null),await this.monitorPopupForHash(f,t.popupWindowParent).catch(()=>{}),r){const h={apiId:jt.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},_=At.getAbsoluteUrl(r,Vo());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${_}`),await this.navigationClient.navigateInternal(_,h)}else this.logger.verbose("No main window navigation requested")}catch(u){throw(c=t.popup)==null||c.close(),u instanceof en&&(u.setCorrelationId(this.correlationId),i.cacheFailedRequest(u)),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(ct.LOGOUT_FAILURE,st.Popup,null,u),this.eventHandler.emitEvent(ct.LOGOUT_END,st.Popup),u}this.eventHandler.emitEvent(ct.LOGOUT_END,st.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),Je(zs)}monitorPopupForHash(e,t){return new Promise((n,r)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const i=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(i),r(Je(kr));return}let a="";try{a=e.location.href}catch{}if(!a||a==="about:blank")return;clearInterval(i);let s="";const l=this.config.auth.OIDCOptions.serverResponseType;e&&(l===Ti.QUERY?s=e.location.search:s=e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),n(s)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let n;if(t.popup?(n=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),n.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),n=this.openSizedPopup(e,t)),!n)throw Je(hh);return n.focus&&n.focus(),this.currentWindow=n,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),n}catch(n){throw this.logger.error("error opening popup "+n.message),this.browserStorage.setInteractionInProgress(!1),Je(fh)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:n,popupWindowParent:r}){var h,_,y,v;const i=r.screenLeft?r.screenLeft:r.screenX,a=r.screenTop?r.screenTop:r.screenY,s=r.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,l=r.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let c=(h=n.popupSize)==null?void 0:h.width,u=(_=n.popupSize)==null?void 0:_.height,d=(y=n.popupPosition)==null?void 0:y.top,f=(v=n.popupPosition)==null?void 0:v.left;return(!c||c<0||c>s)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),c=Qn.POPUP_WIDTH),(!u||u<0||u>l)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),u=Qn.POPUP_HEIGHT),(!d||d<0||d>l)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),d=Math.max(0,l/2-Qn.POPUP_HEIGHT/2+a)),(!f||f<0||f>s)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),f=Math.max(0,s/2-Qn.POPUP_WIDTH/2+i)),r.open(e,t,`width=${c}, height=${u}, top=${d}, left=${f}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(st.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${Qn.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${Qn.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Lc{constructor(e,t,n,r,i){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=r,this.performanceClient=i}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(Lt.ORIGIN_URI,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(Lt.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest),this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const n={apiId:jt.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1};if(typeof t.onRedirectNavigate=="function")if(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),t.onRedirectNavigate(e)!==!1){this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),await t.navigationClient.navigateExternal(e,n);return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation");return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),await t.navigationClient.navigateExternal(e,n);return}}else throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),Je(zs)}async handleCodeResponse(e,t){this.logger.verbose("RedirectHandler.handleCodeResponse called"),this.browserStorage.setInteractionInProgress(!1);const n=this.browserStorage.generateStateKey(t),r=this.browserStorage.getTemporaryCache(n);if(!r)throw ke(as,"Cached State");let i;try{i=this.authModule.handleFragmentResponse(e,r)}catch(c){throw c instanceof sr&&c.subError===kr?Je(kr):c}const a=this.browserStorage.generateNonceKey(r),s=this.browserStorage.getTemporaryCache(a);if(this.authCodeRequest.code=i.code,i.cloud_instance_host_name&&await Ce(this.authModule.updateAuthority.bind(this.authModule),ae.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,this.authCodeRequest.correlationId)(i.cloud_instance_host_name,this.authCodeRequest.correlationId),i.nonce=s||void 0,i.state=r,i.client_info)this.authCodeRequest.clientInfo=i.client_info;else{const c=this.checkCcsCredentials();c&&(this.authCodeRequest.ccsCredential=c)}const l=await this.authModule.acquireToken(this.authCodeRequest,i);return this.browserStorage.cleanRequestByState(t),l}checkCcsCredentials(){const e=this.browserStorage.getTemporaryCache(Lt.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}/*! @azure/msal-browser v4.5.0 2025-02-26 */function bb(){if(typeof window>"u"||typeof window.performance>"u"||typeof window.performance.getEntriesByType!="function")return;const o=window.performance.getEntriesByType("navigation"),e=o.length?o[0]:void 0;return e==null?void 0:e.type}class yb extends Zr{constructor(e,t,n,r,i,a,s,l,c,u){super(e,t,n,r,i,a,s,c,u),this.nativeStorage=l}async acquireToken(e){const t=await Ce(this.initializeAuthorizationRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,st.Redirect);this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||"",t.account||null);const n=this.initializeServerTelemetryManager(jt.acquireTokenRedirect),r=i=>{i.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.cleanRequestByState(t.state),this.eventHandler.emitEvent(ct.RESTORE_FROM_BFCACHE,st.Redirect))};try{const i=await Ce(this.initializeAuthorizationCodeRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,this.correlationId)(t),a=await Ce(this.createAuthCodeClient.bind(this),ae.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),s=new Lc(a,this.browserStorage,i,this.logger,this.performanceClient),l=await a.getAuthCodeUrl({...t,platformBroker:Ro.isPlatformBrokerAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)}),c=this.getRedirectStartPage(e.redirectStartPage);return this.logger.verbosePii(`Redirect start page: ${c}`),window.addEventListener("pageshow",r),await s.initiateAuthRequest(l,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:c,onRedirectNavigate:e.onRedirectNavigate||this.config.auth.onRedirectNavigate})}catch(i){throw i instanceof en&&(i.setCorrelationId(this.correlationId),n.cacheFailedRequest(i)),window.removeEventListener("pageshow",r),this.browserStorage.cleanRequestByState(t.state),i}}async handleRedirectPromise(e="",t){const n=this.initializeServerTelemetryManager(jt.handleRedirectPromise);try{if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const[r,i]=this.getRedirectResponse(e||"");if(!r)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(st.Redirect),bb()!=="back_forward"?t.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const a=this.browserStorage.getTemporaryCache(Lt.ORIGIN_URI,!0)||ge.EMPTY_STRING,s=At.removeHashFromUrl(a),l=At.removeHashFromUrl(window.location.href);if(s===l&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),a.indexOf("#")>-1&&S0(a),await this.handleResponse(r,n);if(this.config.auth.navigateToLoginRequestUrl){if(!Pl()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(Lt.URL_HASH,i,!0);const c={apiId:jt.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let u=!0;if(!a||a==="null"){const d=R0();this.browserStorage.setTemporaryCache(Lt.ORIGIN_URI,d,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),u=await this.navigationClient.navigateInternal(d,c)}else this.logger.verbose(`Navigating to loginRequestUrl: ${a}`),u=await this.navigationClient.navigateInternal(a,c);if(!u)return await this.handleResponse(r,n)}}else return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(r,n);return null}catch(r){throw r instanceof en&&(r.setCorrelationId(this.correlationId),n.cacheFailedRequest(r)),this.browserStorage.cleanRequestByInteractionType(st.Redirect),r}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(this.config.auth.OIDCOptions.serverResponseType===Ti.QUERY?t=window.location.search:t=window.location.hash);let n=us(t);if(n){try{pb(n,this.browserCrypto,st.Redirect)}catch(i){return i instanceof en&&this.logger.error(`Interaction type validation failed due to ${i.errorCode}: ${i.errorMessage}`),[null,""]}return T0(window),this.logger.verbose("Hash contains known properties, returning response hash"),[n,t]}const r=this.browserStorage.getTemporaryCache(Lt.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Lt.URL_HASH)),r&&(n=us(r),n)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[n,r]):[null,""]}async handleResponse(e,t){const n=e.state;if(!n)throw Je(kl);const r=this.browserStorage.getCachedRequest(n);if(this.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw Je(Si);const l=new Vr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,jt.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,e.accountId,this.nativeStorage,r.correlationId),{userRequestState:c}=_o.parseRequestState(this.browserCrypto,n);return l.acquireToken({...r,state:c,prompt:void 0}).finally(()=>{this.browserStorage.cleanRequestByState(n)})}const i=this.browserStorage.getCachedAuthority(n);if(!i)throw Je(Cl);const a=await Ce(this.createAuthCodeClient.bind(this),ae.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:i});return So.removeThrottle(this.browserStorage,this.config.auth.clientId,r),new Lc(a,this.browserStorage,r,this.logger,this.performanceClient).handleCodeResponse(e,n)}async logout(e){var r,i;this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e),n=this.initializeServerTelemetryManager(jt.logout);try{this.eventHandler.emitEvent(ct.LOGOUT_START,st.Redirect,e),await this.clearCacheOnLogout(t.account);const a={apiId:jt.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},s=await Ce(this.createAuthCodeClient.bind(this),ae.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:e&&e.authority,requestExtraQueryParameters:e==null?void 0:e.extraQueryParameters,account:e&&e.account||void 0});if(s.authority.protocolMode===Ko.OIDC)try{s.authority.endSessionEndpoint}catch{if((r=t.account)!=null&&r.homeAccountId){this.browserStorage.removeAccount((i=t.account)==null?void 0:i.homeAccountId),this.eventHandler.emitEvent(ct.LOGOUT_SUCCESS,st.Redirect,t);return}}const l=s.getLogoutUri(t);if(this.eventHandler.emitEvent(ct.LOGOUT_SUCCESS,st.Redirect,t),e&&typeof e.onRedirectNavigate=="function")if(e.onRedirectNavigate(l)!==!1){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(l,a);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation");else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),await this.navigationClient.navigateExternal(l,a);return}}catch(a){throw a instanceof en&&(a.setCorrelationId(this.correlationId),n.cacheFailedRequest(a)),this.eventHandler.emitEvent(ct.LOGOUT_FAILURE,st.Redirect,null,a),this.eventHandler.emitEvent(ct.LOGOUT_END,st.Redirect),a}this.eventHandler.emitEvent(ct.LOGOUT_END,st.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return At.getAbsoluteUrl(t,Vo())}}/*! @azure/msal-browser v4.5.0 2025-02-26 */async function vb(o,e,t,n,r){if(e.addQueueMeasurement(ae.SilentHandlerInitiateAuthRequest,n),!o)throw t.info("Navigate url is empty"),Je(zs);return r?Ce(kb,ae.SilentHandlerLoadFrame,t,e,n)(o,r,e,n):jo(Cb,ae.SilentHandlerLoadFrameSync,t,e,n)(o)}async function wb(o,e,t,n,r,i,a){return n.addQueueMeasurement(ae.SilentHandlerMonitorIframeForHash,i),new Promise((s,l)=>{e<Na&&r.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${Na}ms). This may result in timeouts.`);const c=window.setTimeout(()=>{window.clearInterval(u),l(Je(gh))},e),u=window.setInterval(()=>{let d="";const f=o.contentWindow;try{d=f?f.location.href:""}catch{}if(!d||d==="about:blank")return;let h="";f&&(a===Ti.QUERY?h=f.location.search:h=f.location.hash),window.clearTimeout(c),window.clearInterval(u),s(h)},t)}).finally(()=>{jo(Eb,ae.RemoveHiddenIframe,r,n,i)(o)})}function kb(o,e,t,n){return t.addQueueMeasurement(ae.SilentHandlerLoadFrame,n),new Promise((r,i)=>{const a=eg();window.setTimeout(()=>{if(!a){i("Unable to load iframe");return}a.src=o,r(a)},e)})}function Cb(o){const e=eg();return e.src=o,e}function eg(){const o=document.createElement("iframe");return o.className="msalSilentIframe",o.style.visibility="hidden",o.style.position="absolute",o.style.width=o.style.height="0",o.style.border="0",o.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(o),o}function Eb(o){document.body===o.parentNode&&document.body.removeChild(o)}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Ib extends Zr{constructor(e,t,n,r,i,a,s,l,c,u,d){super(e,t,n,r,i,a,l,u,d),this.apiId=s,this.nativeStorage=c}async acquireToken(e){this.performanceClient.addQueueMeasurement(ae.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const t={...e};t.prompt?t.prompt!==wn.NONE&&t.prompt!==wn.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${wn.NONE}`),t.prompt=wn.NONE):t.prompt=wn.NONE;const n=await Ce(this.initializeAuthorizationRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,st.Silent);qh(n.authority);const r=this.initializeServerTelemetryManager(this.apiId);let i;try{return i=await Ce(this.createAuthCodeClient.bind(this),ae.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:n.authority,requestAzureCloudOptions:n.azureCloudOptions,requestExtraQueryParameters:n.extraQueryParameters,account:n.account}),await Ce(this.silentTokenHelper.bind(this),ae.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(i,n)}catch(a){if(a instanceof en&&(a.setCorrelationId(this.correlationId),r.cacheFailedRequest(a)),!i||!(a instanceof en)||a.errorCode!==Qn.INVALID_GRANT_ERROR)throw a;this.performanceClient.addFields({retryError:a.errorCode},this.correlationId);const s=await Ce(this.initializeAuthorizationRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,st.Silent);return await Ce(this.silentTokenHelper.bind(this),ae.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(i,s)}}logout(){return Promise.reject(Je(Vs))}async silentTokenHelper(e,t){const n=t.correlationId;this.performanceClient.addQueueMeasurement(ae.SilentIframeClientTokenHelper,n);const r=await Ce(this.initializeAuthorizationCodeRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationCodeRequest,this.logger,this.performanceClient,n)(t),i=await Ce(e.getAuthCodeUrl.bind(e),ae.GetAuthCodeUrl,this.logger,this.performanceClient,n)({...t,platformBroker:Ro.isPlatformBrokerAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}),a=new Hl(e,this.browserStorage,r,this.logger,this.performanceClient),s=await Ce(vb,ae.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,n)(i,this.performanceClient,this.logger,n,this.config.system.navigateFrameWait),l=this.config.auth.OIDCOptions.serverResponseType,c=await Ce(wb,ae.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,n)(s,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,n,l),u=jo($h,ae.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(c,l,this.logger);if(u.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw Je(Si);const d=new Vr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,u.accountId,this.browserStorage,n),{userRequestState:f}=_o.parseRequestState(this.browserCrypto,t.state);return Ce(d.acquireToken.bind(d),ae.NativeInteractionClientAcquireToken,this.logger,this.performanceClient,n)({...t,state:f,prompt:t.prompt||wn.NONE})}return Ce(a.handleCodeResponse.bind(a),ae.HandleCodeResponse,this.logger,this.performanceClient,n)(u,t)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Tb extends Zr{async acquireToken(e){this.performanceClient.addQueueMeasurement(ae.SilentRefreshClientAcquireToken,e.correlationId);const t=await Ce(Dl,ae.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),n={...e,...t};e.redirectUri&&(n.redirectUri=this.getRedirectUri(e.redirectUri));const r=this.initializeServerTelemetryManager(jt.acquireTokenSilent_silentFlow),i=await this.createRefreshTokenClient({serverTelemetryManager:r,authorityUrl:n.authority,azureCloudOptions:n.azureCloudOptions,account:n.account});return Ce(i.acquireTokenByRefreshToken.bind(i),ae.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(n).catch(a=>{throw a.setCorrelationId(this.correlationId),r.cacheFailedRequest(a),a})}logout(){return Promise.reject(Je(Vs))}async createRefreshTokenClient(e){const t=await Ce(this.getClientConfiguration.bind(this),ae.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new X_(t,this.performanceClient)}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Sb{constructor(e,t,n,r){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=n,this.cryptoObj=r}async loadExternalTokens(e,t,n){if(!this.isBrowserEnvironment)throw Je(Fs);const r=e.correlationId||yo(),i=t.id_token?xr(t.id_token,Go):void 0,a={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},s=e.authority?new Rn(Rn.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,a,this.logger,e.correlationId||yo()):void 0,l=await this.loadAccount(e,n.clientInfo||t.client_info||"",r,i,s),c=await this.loadIdToken(t,l.homeAccountId,l.environment,l.realm,r),u=await this.loadAccessToken(e,t,l.homeAccountId,l.environment,l.realm,n,r),d=await this.loadRefreshToken(t,l.homeAccountId,l.environment,r);return this.generateAuthenticationResult(e,{account:l,idToken:c,accessToken:u,refreshToken:d},i,s)}async loadAccount(e,t,n,r,i){if(this.logger.verbose("TokenCache - loading account"),e.account){const c=Un.createFromAccountInfo(e.account);return await this.storage.setAccount(c,n),c}else if(!i||!t&&!r)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),Je(Ch);const a=Un.generateHomeAccountId(t,i.authorityType,this.logger,this.cryptoObj,r),s=r==null?void 0:r.tid,l=bl(this.storage,i,a,Go,r,t,i.hostnameAndPort,s,void 0,void 0,this.logger);return await this.storage.setAccount(l,n),l}async loadIdToken(e,t,n,r,i){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const a=Ns(t,n,e.id_token,this.config.auth.clientId,r);return await this.storage.setIdTokenCredential(a,i),a}async loadAccessToken(e,t,n,r,i,a,s){if(t.access_token)if(t.expires_in){if(!t.scope&&(!e.scopes||!e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null}else return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;else return this.logger.verbose("TokenCache - no access token found in response"),null;this.logger.verbose("TokenCache - loading access token");const l=t.scope?un.fromString(t.scope):new un(e.scopes),c=a.expiresOn||t.expires_in+new Date().getTime()/1e3,u=a.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+new Date().getTime()/1e3,d=Ds(n,r,t.access_token,this.config.auth.clientId,i,l.printScopes(),c,u,Go);return await this.storage.setAccessTokenCredential(d,s),d}async loadRefreshToken(e,t,n,r){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const i=Pf(t,n,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return await this.storage.setRefreshTokenCredential(i,r),i}generateAuthenticationResult(e,t,n,r){var u,d,f;let i="",a=[],s=null,l;t!=null&&t.accessToken&&(i=t.accessToken.secret,a=un.fromString(t.accessToken.target).asArray(),s=new Date(Number(t.accessToken.expiresOn)*1e3),l=new Date(Number(t.accessToken.extendedExpiresOn)*1e3));const c=t.account;return{authority:r?r.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:a,account:c.getAccountInfo(),idToken:((u=t.idToken)==null?void 0:u.secret)||"",idTokenClaims:n||{},accessToken:i,fromCache:!0,expiresOn:s,correlationId:e.correlationId||"",requestId:"",extExpiresOn:l,familyId:((d=t.refreshToken)==null?void 0:d.familyId)||"",tokenType:((f=t==null?void 0:t.accessToken)==null?void 0:f.tokenType)||"",state:e.state||"",cloudGraphHostName:c.cloudGraphHostName||"",msGraphHost:c.msGraphHost||"",fromNativeBroker:!1}}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Ab extends oh{constructor(e){super(e),this.includeRedirectUri=!1}}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Rb extends Zr{constructor(e,t,n,r,i,a,s,l,c,u){super(e,t,n,r,i,a,l,c,u),this.apiId=s}async acquireToken(e){if(!e.code)throw Je(Eh);const t=await Ce(this.initializeAuthorizationRequest.bind(this),ae.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,st.Silent),n=this.initializeServerTelemetryManager(this.apiId);try{const r={...t,code:e.code},i=await Ce(this.getClientConfiguration.bind(this),ae.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:n,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),a=new Ab(i);this.logger.verbose("Auth code client created");const s=new Hl(a,this.browserStorage,r,this.logger,this.performanceClient);return await Ce(s.handleCodeResponseFromServer.bind(s),ae.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(r){throw r instanceof en&&(r.setCorrelationId(this.correlationId),n.cacheFailedRequest(r)),r}}logout(){return Promise.reject(Je(Vs))}}/*! @azure/msal-browser v4.5.0 2025-02-26 */function Eo(o){const e=o==null?void 0:o.idTokenClaims;if(e!=null&&e.tfp||e!=null&&e.acr)return"B2C";if(e!=null&&e.tid){if((e==null?void 0:e.tid)==="9188040d-6c67-4c5b-b112-36a304b66dad")return"MSA"}else return;return"AAD"}function Ji(o,e){try{Ol(o)}catch(t){throw e.end({success:!1},t),t}}class Ys{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new Yr(this.logger,this.performanceClient):ls,this.eventHandler=new nb(this.logger),this.browserStorage=this.isBrowserEnvironment?new Ua(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,z_(this.config.auth)):j0(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);const t={cacheLocation:Sn.MemoryStorage,temporaryCacheLocation:Sn.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new Ua(this.config.auth.clientId,t,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.tokenCache=new Sb(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const n=new Ys(e);return await n.initialize(t),n}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e){if(this.logger.trace("initialize called"),this.initialized){this.logger.info("initialize has already been called, exiting early.");return}if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,this.eventHandler.emitEvent(ct.INITIALIZE_END);return}const t=(e==null?void 0:e.correlationId)||this.getRequestCorrelationId(),n=this.config.system.allowPlatformBroker,r=this.performanceClient.startMeasurement(ae.InitializeClientApplication,t);if(this.eventHandler.emitEvent(ct.INITIALIZE_START),await Ce(this.browserStorage.initialize.bind(this.browserStorage),ae.InitializeCache,this.logger,this.performanceClient,t)(t),n)try{this.nativeExtensionProvider=await Ro.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)}catch(i){this.logger.verbose(i)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),await Ce(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),ae.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,t)(this.performanceClient,t)),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(t),this.initialized=!0,this.eventHandler.emitEvent(ct.INITIALIZE_END),r.end({allowPlatformBroker:n,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),Yh(this.initialized),this.isBrowserEnvironment){const t=e||"";let n=this.redirectResponse.get(t);return typeof n>"u"?(n=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,n),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),n}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){const t=this.getAllAccounts(),n=this.browserStorage.getCachedNativeRequest(),r=n&&Ro.isPlatformBrokerAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e,i=r?n==null?void 0:n.correlationId:this.browserStorage.getTemporaryCache(Lt.CORRELATION_ID,!0)||"",a=this.performanceClient.startMeasurement(ae.AcquireTokenRedirect,i);this.eventHandler.emitEvent(ct.HANDLE_REDIRECT_START,st.Redirect);let s;if(r&&this.nativeExtensionProvider){this.logger.trace("handleRedirectPromise - acquiring token from native platform");const l=new Vr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,jt.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,n.accountId,this.nativeInternalStorage,n.correlationId);s=Ce(l.handleRedirectPromise.bind(l),ae.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,a.event.correlationId)(this.performanceClient,a.event.correlationId)}else{this.logger.trace("handleRedirectPromise - acquiring token from web flow");const l=this.createRedirectClient(i);s=Ce(l.handleRedirectPromise.bind(l),ae.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,a.event.correlationId)(e,a)}return s.then(l=>(l?(t.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(ct.LOGIN_SUCCESS,st.Redirect,l),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_SUCCESS,st.Redirect,l),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),a.end({success:!0,accountType:Eo(l.account)})):a.event.errorCode?a.end({success:!1}):a.discard(),this.eventHandler.emitEvent(ct.HANDLE_REDIRECT_END,st.Redirect),l)).catch(l=>{const c=l;throw t.length>0?this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_FAILURE,st.Redirect,null,c):this.eventHandler.emitEvent(ct.LOGIN_FAILURE,st.Redirect,null,c),this.eventHandler.emitEvent(ct.HANDLE_REDIRECT_END,st.Redirect),a.end({success:!1},c),l})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);const n=this.performanceClient.startMeasurement(ae.AcquireTokenPreRedirect,t);n.add({accountType:Eo(e.account),scenarioId:e.scenarioId});const r=e.onRedirectNavigate;if(r)e.onRedirectNavigate=a=>{const s=typeof r=="function"?r(a):void 0;return s!==!1?n.end({success:!0}):n.discard(),s};else{const a=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=s=>{const l=typeof a=="function"?a(s):void 0;return l!==!1?n.end({success:!0}):n.discard(),l}}const i=this.getAllAccounts().length>0;try{Mc(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),i?this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_START,st.Redirect,e):this.eventHandler.emitEvent(ct.LOGIN_START,st.Redirect,e);let a;return this.nativeExtensionProvider&&this.canUsePlatformBroker(e)?a=new Vr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,jt.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,n).catch(l=>{if(l instanceof Ao&&Nr(l))return this.nativeExtensionProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(l instanceof bo)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),l}):a=this.createRedirectClient(t).acquireToken(e),await a}catch(a){throw n.end({success:!1},a),i?this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_FAILURE,st.Redirect,null,a):this.eventHandler.emitEvent(ct.LOGIN_FAILURE,st.Redirect,null,a),a}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(ae.AcquireTokenPopup,t);n.add({scenarioId:e.scenarioId,accountType:Eo(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),Ji(this.initialized,n),this.browserStorage.setInteractionInProgress(!0)}catch(s){return Promise.reject(s)}const r=this.getAllAccounts();r.length>0?this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_START,st.Popup,e):this.eventHandler.emitEvent(ct.LOGIN_START,st.Popup,e);let i;const a=this.getPreGeneratedPkceCodes(t);return this.canUsePlatformBroker(e)?i=this.acquireTokenNative({...e,correlationId:t},jt.acquireTokenPopup).then(s=>(this.browserStorage.setInteractionInProgress(!1),n.end({success:!0,isNativeBroker:!0,accountType:Eo(s.account)}),s)).catch(s=>{if(s instanceof Ao&&Nr(s))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e,a);if(s instanceof bo)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e,a);throw this.browserStorage.setInteractionInProgress(!1),s}):i=this.createPopupClient(t).acquireToken(e,a),i.then(s=>(r.length<this.getAllAccounts().length?this.eventHandler.emitEvent(ct.LOGIN_SUCCESS,st.Popup,s):this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_SUCCESS,st.Popup,s),n.end({success:!0,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length,accountType:Eo(s.account)}),s)).catch(s=>(r.length>0?this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_FAILURE,st.Popup,null,s):this.eventHandler.emitEvent(ct.LOGIN_FAILURE,st.Popup,null,s),n.end({success:!1},s),Promise.reject(s))).finally(()=>this.config.system.asyncPopups&&this.preGeneratePkceCodes(t))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){var i,a;const t=this.getRequestCorrelationId(e),n={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement(ae.SsoSilent,t),(i=this.ssoSilentMeasurement)==null||i.add({scenarioId:e.scenarioId,accountType:Eo(e.account)}),Ji(this.initialized,this.ssoSilentMeasurement),(a=this.ssoSilentMeasurement)==null||a.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(ct.SSO_SILENT_START,st.Silent,n);let r;return this.canUsePlatformBroker(n)?r=this.acquireTokenNative(n,jt.ssoSilent).catch(s=>{if(s instanceof Ao&&Nr(s))return this.nativeExtensionProvider=void 0,this.createSilentIframeClient(n.correlationId).acquireToken(n);throw s}):r=this.createSilentIframeClient(n.correlationId).acquireToken(n),r.then(s=>{var l;return this.eventHandler.emitEvent(ct.SSO_SILENT_SUCCESS,st.Silent,s),(l=this.ssoSilentMeasurement)==null||l.end({success:!0,isNativeBroker:s.fromNativeBroker,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length,accountType:Eo(s.account)}),s}).catch(s=>{var l;throw this.eventHandler.emitEvent(ct.SSO_SILENT_FAILURE,st.Silent,null,s),(l=this.ssoSilentMeasurement)==null||l.end({success:!1},s),s}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);const n=this.performanceClient.startMeasurement(ae.AcquireTokenByCode,t);Ji(this.initialized,n),this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_BY_CODE_START,st.Silent,e),n.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw Je(Th);if(e.code){const r=e.code;let i=this.hybridAuthCodeResponses.get(r);return i?(this.logger.verbose("Existing acquireTokenByCode request found",t),n.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),i=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(a=>(this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_BY_CODE_SUCCESS,st.Silent,a),this.hybridAuthCodeResponses.delete(r),n.end({success:!0,isNativeBroker:a.fromNativeBroker,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length,accountType:Eo(a.account)}),a)).catch(a=>{throw this.hybridAuthCodeResponses.delete(r),this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_BY_CODE_FAILURE,st.Silent,null,a),n.end({success:!1},a),a}),this.hybridAuthCodeResponses.set(r,i)),await i}else if(e.nativeAccountId)if(this.canUsePlatformBroker(e,e.nativeAccountId)){const r=await this.acquireTokenNative({...e,correlationId:t},jt.acquireTokenByCode,e.nativeAccountId).catch(i=>{throw i instanceof Ao&&Nr(i)&&(this.nativeExtensionProvider=void 0),i});return n.end({accountType:Eo(r.account),success:!0}),r}else throw Je(Sh);else throw Je(Ih)}catch(r){throw this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_BY_CODE_FAILURE,st.Silent,null,r),n.end({success:!1},r),r}}async acquireTokenByCodeAsync(e){var r;return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(ae.AcquireTokenByCodeAsync,e.correlationId),(r=this.acquireTokenByCodeAsyncMeasurement)==null||r.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),await this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(i=>{var a;return(a=this.acquireTokenByCodeAsyncMeasurement)==null||a.end({success:!0,fromCache:i.fromCache,isNativeBroker:i.fromNativeBroker}),i}).catch(i=>{var a;throw(a=this.acquireTokenByCodeAsyncMeasurement)==null||a.end({success:!1},i),i}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(ae.AcquireTokenFromCache,e.correlationId),t){case Yn.Default:case Yn.AccessToken:case Yn.AccessTokenAndRefreshToken:const n=this.createSilentCacheClient(e.correlationId);return Ce(n.acquireToken.bind(n),ae.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw ke(or)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(ae.AcquireTokenByRefreshToken,e.correlationId),t){case Yn.Default:case Yn.AccessTokenAndRefreshToken:case Yn.RefreshToken:case Yn.RefreshTokenAndNetwork:const n=this.createSilentRefreshClient(e.correlationId);return Ce(n.acquireToken.bind(n),ae.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw ke(or)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(ae.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return Ce(t.acquireToken.bind(t),ae.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return Mc(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return Ol(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(t){return Promise.reject(t)}}async clearCache(e){if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, returning early.");return}const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){return Q0(this.logger,this.browserStorage,this.isBrowserEnvironment,e)}getAccount(e){return X0(e,this.logger,this.browserStorage)}getAccountByUsername(e){return J0(e,this.logger,this.browserStorage)}getAccountByHomeId(e){return x0(e,this.logger,this.browserStorage)}getAccountByLocalId(e){return Z0(e,this.logger,this.browserStorage)}setActiveAccount(e){$0(e,this.browserStorage)}getActiveAccount(){return eb(this.browserStorage)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const n=Un.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(n,e.correlationId),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,n){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw Je(Si);return new Vr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,n||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)}canUsePlatformBroker(e,t){if(this.logger.trace("canUsePlatformBroker called"),!Ro.isPlatformBrokerAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUsePlatformBroker: isPlatformBrokerAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case wn.NONE:case wn.CONSENT:case wn.LOGIN:this.logger.trace("canUsePlatformBroker: prompt is compatible with platform broker flow");break;default:return this.logger.trace(`canUsePlatformBroker: prompt = ${e.prompt} is not compatible with platform broker flow, returning false`),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("canUsePlatformBroker: nativeAccountId is not available, returning false"),!1):!0}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new _b(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new yb(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new Ib(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,jt.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new Zh(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new Tb(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new Rb(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,jt.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return Wh(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){if(this.config.cache.cacheLocation!==Sn.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.subscribeCrossTab()}disableAccountStorageEvents(){if(this.config.cache.cacheLocation!==Sn.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.unsubscribeCrossTab()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e!=null&&e.correlationId?e.correlationId:this.isBrowserEnvironment?yo():ge.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||Tc})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||Tc})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(ae.AcquireTokenSilent,t);n.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),Ji(this.initialized,n),this.logger.verbose("acquireTokenSilent called",t);const r=e.account||this.getActiveAccount();if(!r)throw Je(bh);n.add({accountType:Eo(r)});const i={clientId:this.config.auth.clientId,authority:e.authority||ge.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:r.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions},a=JSON.stringify(i),s=this.activeSilentTokenRequests.get(a);if(typeof s>"u"){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t);const l=Ce(this.acquireTokenSilentAsync.bind(this),ae.AcquireTokenSilentAsync,this.logger,this.performanceClient,t)({...e,correlationId:t},r).then(c=>(this.activeSilentTokenRequests.delete(a),n.end({success:!0,fromCache:c.fromCache,isNativeBroker:c.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,accessTokenSize:c.accessToken.length,idTokenSize:c.idToken.length}),c)).catch(c=>{throw this.activeSilentTokenRequests.delete(a),n.end({success:!1},c),c});return this.activeSilentTokenRequests.set(a,l),{...await l,state:e.state}}else return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),n.discard(),{...await s,state:e.state}}async acquireTokenSilentAsync(e,t){const n=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(ae.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_START,st.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",n);const r=await Ce(sb,ae.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),i=e.cacheLookupPolicy||Yn.Default;return this.acquireTokenSilentNoIframe(r,i).catch(async s=>{if(Mb(s,i))if(this.activeIframeRequest)if(i!==Yn.Skip){const[c,u]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${u}`,r.correlationId);const d=this.performanceClient.startMeasurement(ae.AwaitConcurrentIframe,r.correlationId);d.add({awaitIframeCorrelationId:u});const f=await c;if(d.end({success:f}),f)return this.logger.verbose(`Parallel iframe request with correlationId: ${u} succeeded. Retrying cache and/or RT redemption`,r.correlationId),this.acquireTokenSilentNoIframe(r,i);throw this.logger.info(`Iframe request with correlationId: ${u} failed. Interaction is required.`),s}else return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",r.correlationId),Ce(this.acquireTokenBySilentIframe.bind(this),ae.AcquireTokenBySilentIframe,this.logger,this.performanceClient,r.correlationId)(r);else{let c;return this.activeIframeRequest=[new Promise(u=>{c=u}),r.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",r.correlationId),Ce(this.acquireTokenBySilentIframe.bind(this),ae.AcquireTokenBySilentIframe,this.logger,this.performanceClient,r.correlationId)(r).then(u=>(c(!0),u)).catch(u=>{throw c(!1),u}).finally(()=>{this.activeIframeRequest=void 0})}else throw s}).then(s=>(this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_SUCCESS,st.Silent,s),e.correlationId&&this.performanceClient.addFields({fromCache:s.fromCache,isNativeBroker:s.fromNativeBroker},e.correlationId),s)).catch(s=>{throw this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_FAILURE,st.Silent,null,s),s}).finally(()=>{document.removeEventListener("visibilitychange",n)})}async acquireTokenSilentNoIframe(e,t){return Ro.isPlatformBrokerAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.acquireTokenNative(e,jt.acquireTokenSilent_silentFlow).catch(async n=>{throw n instanceof Ao&&Nr(n)?(this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,ke(or)):n})):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),Ce(this.acquireTokenFromCache.bind(this),ae.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch(n=>{if(t===Yn.AccessToken)throw n;return this.eventHandler.emitEvent(ct.ACQUIRE_TOKEN_NETWORK_START,st.Silent,e),Ce(this.acquireTokenByRefreshToken.bind(this),ae.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)}))}async preGeneratePkceCodes(e){return this.logger.verbose("Generating new PKCE codes"),this.pkceCode=await Ce(Jh,ae.GeneratePkceCodes,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()}getPreGeneratedPkceCodes(e){this.logger.verbose("Attempting to pick up pre-generated PKCE codes");const t=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,this.logger.verbose(`${t?"Found":"Did not find"} pre-generated PKCE codes`),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}}function Mb(o,e){const t=!(o instanceof bo&&o.subError!==Bs),n=o.errorCode===Qn.INVALID_GRANT_ERROR||o.errorCode===or,r=t&&n||o.errorCode===fs||o.errorCode===_l,i=u0.includes(e);return r&&i}/*! @azure/msal-browser v4.5.0 2025-02-26 */async function Pb(o,e){const t=new Er(o);return await t.initialize(),Ys.createController(t,e)}/*! @azure/msal-browser v4.5.0 2025-02-26 */class Ll{static async createPublicClientApplication(e){const t=await Pb(e);return new Ll(e,t)}constructor(e,t){this.controller=t||new Ys(new Er(e))}async initialize(e){return this.controller.initialize(e)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}let di="";async function Ob(){var t;if(di)return;const o=await fetch("/api/config");if(!o.ok)throw new Error("Failed to fetch OneDrive credentials");if(di=(t=(await o.json()).onedrive)==null?void 0:t.client_id,!di)throw new Error("OneDrive client ID not configured")}let ro=null;async function Nb(){try{di||await Ob();const o={auth:{authority:"https://login.microsoftonline.com/consumers",clientId:di}};return ro||(ro=new Ll(o),ro.initialize&&await ro.initialize()),ro}catch(o){throw new Error("MSAL initialization failed: "+(o instanceof Error?o.message:String(o)))}}async function za(){const o={scopes:["OneDrive.ReadWrite"]};let e="";try{if(ro=await Nb(),!ro)throw new Error("MSAL not initialized");e=(await ro.acquireTokenSilent(o)).accessToken}catch{if(!ro)throw new Error("MSAL not initialized");try{const n=await ro.loginPopup(o);ro.setActiveAccount(n.account),n.idToken&&(e=(await ro.acquireTokenSilent(o)).accessToken)}catch(n){throw new Error("Failed to login: "+(n instanceof Error?n.message:String(n)))}}if(!e)throw new Error("Failed to acquire access token");return e}const Db="https://onedrive.live.com/picker";var Jd;const Uc={sdk:"8.0",entry:{oneDrive:{files:{}}},authentication:{},messaging:{origin:(Jd=window==null?void 0:window.location)==null?void 0:Jd.origin,channelId:Uo()},typesAndSources:{mode:"files",pivots:{oneDrive:!0,recent:!0}}};async function Hb(o){const e=await za();if(!e)throw new Error("Unable to retrieve OneDrive access token.");const t=`${o["@sharePoint.endpoint"]}/drives/${o.parentReference.driveId}/items/${o.id}`,n=await fetch(t,{headers:{Authorization:`Bearer ${e}`}});if(!n.ok)throw new Error("Failed to fetch file information.");const i=(await n.json())["@content.downloadUrl"],a=await fetch(i);if(!a.ok)throw new Error("Failed to download file.");return await a.blob()}async function Lb(){if(typeof window>"u")throw new Error("Not in browser environment");return new Promise((o,e)=>{let t=null,n=null;const r=l=>{var u;if(l.source!==t)return;const c=l.data;if((c==null?void 0:c.type)==="initialize"&&(c==null?void 0:c.channelId)===Uc.messaging.channelId){if(n=(u=l.ports)==null?void 0:u[0],!n)return;n.addEventListener("message",i),n.start(),n.postMessage({type:"activate"})}},i=async l=>{const c=l.data;switch(c.type){case"notification":break;case"command":{n==null||n.postMessage({type:"acknowledge",id:c.id});const u=c.data;switch(u.command){case"authenticate":{try{const d=await za();if(d)n==null||n.postMessage({type:"result",id:c.id,data:{result:"token",token:d}});else throw new Error("Could not retrieve auth token")}catch{n==null||n.postMessage({result:"error",error:{code:"tokenError",message:"Failed to get token"},isExpected:!0})}break}case"close":{a(),o(null);break}case"pick":{n==null||n.postMessage({type:"result",id:c.id,data:{result:"success"}}),a(),o(u);break}default:{n==null||n.postMessage({result:"error",error:{code:"unsupportedCommand",message:u.command},isExpected:!0});break}}break}}};function a(){window.removeEventListener("message",r),n&&n.removeEventListener("message",i),t&&(t.close(),t=null)}(async()=>{try{const l=await za();if(!l)return e(new Error("Failed to acquire access token"));if(t=window.open("","OneDrivePicker","width=800,height=600"),!t)return e(new Error("Failed to open OneDrive picker window"));const c=new URLSearchParams({filePicker:JSON.stringify(Uc)}),u=`${Db}?${c.toString()}`,d=t.document.createElement("form");d.setAttribute("action",u),d.setAttribute("method","POST");const f=t.document.createElement("input");f.setAttribute("type","hidden"),f.setAttribute("name","access_token"),f.setAttribute("value",l),d.appendChild(f),t.document.body.appendChild(d),d.submit(),window.addEventListener("message",r)}catch(l){t&&t.close(),e(l)}})()})}async function Ub(){const o=await Lb();if(!o||!o.items||o.items.length===0)return null;const e=o.items[0];return{blob:await Hb(e),name:e.name}}function Bc(o,e,t){const n=o.slice();return n[28]=e[t],n}function Bb(o){let e;const t=o[16].default,n=gn(t,o,o[25],null);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i&33554432)&&mn(n,t,r,r[25],e?_n(t,r[25],i,null):pn(r[25]),null)},i(r){e||(T(n,r),e=!0)},o(r){D(n,r),e=!1},d(r){n&&n.d(r)}}}function zb(o){let e,t;return e=new Gt({props:{content:o[9].t("More"),$$slots:{default:[Bb]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&512&&(i.content=n[9].t("More")),r&33554432&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function zc(o){let e,t,n,r,i=Pt(Object.keys(o[7])),a=[];for(let l=0;l<i.length;l+=1)a[l]=Vc(Bc(o,i,l));const s=l=>D(a[l],1,1,()=>{a[l]=null});return{c(){e=M("div");for(let l=0;l<a.length;l+=1)a[l].c();t=$(),n=M("hr"),this.h()},l(l){e=P(l,"DIV",{class:!0});var c=I(e);for(let u=0;u<a.length;u+=1)a[u].l(c);c.forEach(p),t=ee(l),n=P(l,"HR",{class:!0}),this.h()},h(){g(e,"class","max-h-28 overflow-y-auto scrollbar-hidden"),g(n,"class","border-black/5 dark:border-white/5 my-1")},m(l,c){U(l,e,c);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(e,null);U(l,t,c),U(l,n,c),r=!0},p(l,c){if(c&129){i=Pt(Object.keys(l[7]));let u;for(u=0;u<i.length;u+=1){const d=Bc(l,i,u);a[u]?(a[u].p(d,c),T(a[u],1)):(a[u]=Vc(d),a[u].c(),T(a[u],1),a[u].m(e,null))}for(Le(),u=i.length;u<a.length;u+=1)s(u);Ue()}},i(l){if(!r){for(let c=0;c<i.length;c+=1)T(a[c]);r=!0}},o(l){a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)D(a[c]);r=!1},d(l){l&&(p(e),p(t),p(n)),so(a,l)}}}function Vb(o){let e,t,n,r,i=o[7][o[28]].name+"",a,s;return t=new Vm({}),{c(){e=M("div"),te(t.$$.fragment),n=$(),r=M("div"),a=Se(i),this.h()},l(l){e=P(l,"DIV",{class:!0});var c=I(e);re(t.$$.fragment,c),c.forEach(p),n=ee(l),r=P(l,"DIV",{class:!0});var u=I(r);a=Ae(u,i),u.forEach(p),this.h()},h(){g(e,"class","shrink-0"),g(r,"class","truncate")},m(l,c){U(l,e,c),ne(t,e,null),U(l,n,c),U(l,r,c),k(r,a),s=!0},p(l,c){(!s||c&128)&&i!==(i=l[7][l[28]].name+"")&&Ne(a,i)},i(l){s||(T(t.$$.fragment,l),s=!0)},o(l){D(t.$$.fragment,l),s=!1},d(l){l&&(p(e),p(n),p(r)),oe(t)}}}function Vc(o){var h;let e,t,n,r,i,a,s,l,c,u;n=new Gt({props:{content:((h=o[7][o[28]])==null?void 0:h.description)??"",placement:"top-start",className:"flex flex-1 gap-2 items-center",$$slots:{default:[Vb]},$$scope:{ctx:o}}});function d(..._){return o[17](o[28],..._)}a=new Gm({props:{state:o[7][o[28]].enabled}}),a.$on("change",d);function f(){return o[18](o[28])}return{c(){e=M("button"),t=M("div"),te(n.$$.fragment),r=$(),i=M("div"),te(a.$$.fragment),s=$(),this.h()},l(_){e=P(_,"BUTTON",{class:!0});var y=I(e);t=P(y,"DIV",{class:!0});var v=I(t);re(n.$$.fragment,v),v.forEach(p),r=ee(y),i=P(y,"DIV",{class:!0});var m=I(i);re(a.$$.fragment,m),m.forEach(p),s=ee(y),y.forEach(p),this.h()},h(){g(t,"class","flex-1 truncate"),g(i,"class","shrink-0"),g(e,"class","flex w-full justify-between gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl")},m(_,y){U(_,e,y),k(e,t),ne(n,t,null),k(e,r),k(e,i),ne(a,i,null),k(e,s),l=!0,c||(u=Ie(e,"click",f),c=!0)},p(_,y){var b;o=_;const v={};y&128&&(v.content=((b=o[7][o[28]])==null?void 0:b.description)??""),y&33554560&&(v.$$scope={dirty:y,ctx:o}),n.$set(v);const m={};y&128&&(m.state=o[7][o[28]].enabled),a.$set(m)},i(_){l||(T(n.$$.fragment,_),T(a.$$.fragment,_),l=!0)},o(_){D(n.$$.fragment,_),D(a.$$.fragment,_),l=!1},d(_){_&&p(e),oe(n),oe(a),c=!1,u()}}}function Fb(o){let e,t,n,r=o[9].t("Capture")+"",i,a;return e=new qg({}),{c(){te(e.$$.fragment),t=$(),n=M("div"),i=Se(r),this.h()},l(s){re(e.$$.fragment,s),t=ee(s),n=P(s,"DIV",{class:!0});var l=I(n);i=Ae(l,r),l.forEach(p),this.h()},h(){g(n,"class","line-clamp-1")},m(s,l){ne(e,s,l),U(s,t,l),U(s,n,l),k(n,i),a=!0},p(s,l){(!a||l&512)&&r!==(r=s[9].t("Capture")+"")&&Ne(i,r)},i(s){a||(T(e.$$.fragment,s),a=!0)},o(s){D(e.$$.fragment,s),a=!1},d(s){s&&(p(t),p(n)),oe(e,s)}}}function Kb(o){let e,t;return e=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl "+(o[8]?"":"opacity-50"),$$slots:{default:[Fb]},$$scope:{ctx:o}}}),e.$on("click",o[19]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&256&&(i.class="flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl "+(n[8]?"":"opacity-50")),r&33554944&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function Gb(o){let e,t,n,r=o[9].t("Upload Files")+"",i,a;return e=new jg({}),{c(){te(e.$$.fragment),t=$(),n=M("div"),i=Se(r),this.h()},l(s){re(e.$$.fragment,s),t=ee(s),n=P(s,"DIV",{class:!0});var l=I(n);i=Ae(l,r),l.forEach(p),this.h()},h(){g(n,"class","line-clamp-1")},m(s,l){ne(e,s,l),U(s,t,l),U(s,n,l),k(n,i),a=!0},p(s,l){(!a||l&512)&&r!==(r=s[9].t("Upload Files")+"")&&Ne(i,r)},i(s){a||(T(e.$$.fragment,s),a=!0)},o(s){D(e.$$.fragment,s),a=!1},d(s){s&&(p(t),p(n)),oe(e,s)}}}function Wb(o){let e,t;return e=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl "+(o[8]?"":"opacity-50"),$$slots:{default:[Gb]},$$scope:{ctx:o}}}),e.$on("click",o[20]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&256&&(i.class="flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl "+(n[8]?"":"opacity-50")),r&33554944&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function Fc(o){let e,t;return e=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl",$$slots:{default:[Yb]},$$scope:{ctx:o}}}),e.$on("click",o[21]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&33554944&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function Yb(o){let e,t,n,r,i,a,s,l,c,u=o[9].t("Google Drive")+"",d;return{c(){e=be("svg"),t=be("path"),n=be("path"),r=be("path"),i=be("path"),a=be("path"),s=be("path"),l=$(),c=M("div"),d=Se(u),this.h()},l(f){e=ye(f,"svg",{xmlns:!0,viewBox:!0,class:!0});var h=I(e);t=ye(h,"path",{d:!0,fill:!0}),I(t).forEach(p),n=ye(h,"path",{d:!0,fill:!0}),I(n).forEach(p),r=ye(h,"path",{d:!0,fill:!0}),I(r).forEach(p),i=ye(h,"path",{d:!0,fill:!0}),I(i).forEach(p),a=ye(h,"path",{d:!0,fill:!0}),I(a).forEach(p),s=ye(h,"path",{d:!0,fill:!0}),I(s).forEach(p),h.forEach(p),l=ee(f),c=P(f,"DIV",{class:!0});var _=I(c);d=Ae(_,u),_.forEach(p),this.h()},h(){g(t,"d","m6.6 66.85 3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z"),g(t,"fill","#0066da"),g(n,"d","m43.65 25-13.75-23.8c-1.35.8-2.5 1.9-3.3 3.3l-25.4 44a9.06 9.06 0 0 0 -1.2 4.5h27.5z"),g(n,"fill","#00ac47"),g(r,"d","m73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l1.6-2.75 7.65-13.25c.8-1.4 1.2-2.95 1.2-4.5h-27.502l5.852 11.5z"),g(r,"fill","#ea4335"),g(i,"d","m43.65 25 13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2z"),g(i,"fill","#00832d"),g(a,"d","m59.8 53h-32.3l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h50.8c1.6 0 3.15-.45 4.5-1.2z"),g(a,"fill","#2684fc"),g(s,"d","m73.4 26.5-12.7-22c-.8-1.4-1.95-2.5-3.3-3.3l-13.75 23.8 16.15 28h27.45c0-1.55-.4-3.1-1.2-4.5z"),g(s,"fill","#ffba00"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 87.3 78"),g(e,"class","w-5 h-5"),g(c,"class","line-clamp-1")},m(f,h){U(f,e,h),k(e,t),k(e,n),k(e,r),k(e,i),k(e,a),k(e,s),U(f,l,h),U(f,c,h),k(c,d)},p(f,h){h&512&&u!==(u=f[9].t("Google Drive")+"")&&Ne(d,u)},d(f){f&&(p(e),p(l),p(c))}}}function Kc(o){let e,t;return e=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl",$$slots:{default:[qb]},$$scope:{ctx:o}}}),e.$on("click",o[22]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&33554944&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function qb(o){let e,t,n,r,i,a,s,l,c,u,d,f,h,_,y,v,m,b,w,C,O,S,E,H=o[9].t("OneDrive")+"",R;return{c(){e=be("svg"),t=be("mask"),n=be("path"),r=be("g"),i=be("path"),a=be("path"),s=be("path"),l=be("path"),c=be("defs"),u=be("linearGradient"),d=be("stop"),f=be("stop"),h=be("linearGradient"),_=be("stop"),y=be("stop"),v=be("linearGradient"),m=be("stop"),b=be("stop"),w=be("linearGradient"),C=be("stop"),O=be("stop"),S=$(),E=M("div"),R=Se(H),this.h()},l(L){e=ye(L,"svg",{xmlns:!0,viewBox:!0,class:!0,fill:!0});var F=I(e);t=ye(F,"mask",{id:!0,style:!0,maskUnits:!0,x:!0,y:!0,width:!0,height:!0});var q=I(t);n=ye(q,"path",{d:!0,fill:!0}),I(n).forEach(p),q.forEach(p),r=ye(F,"g",{mask:!0});var W=I(r);i=ye(W,"path",{d:!0,fill:!0}),I(i).forEach(p),a=ye(W,"path",{d:!0,fill:!0}),I(a).forEach(p),s=ye(W,"path",{d:!0,fill:!0}),I(s).forEach(p),l=ye(W,"path",{d:!0,fill:!0}),I(l).forEach(p),W.forEach(p),c=ye(F,"defs",{});var A=I(c);u=ye(A,"linearGradient",{id:!0,x1:!0,y1:!0,x2:!0,y2:!0,gradientUnits:!0});var V=I(u);d=ye(V,"stop",{"stop-color":!0}),I(d).forEach(p),f=ye(V,"stop",{offset:!0,"stop-color":!0}),I(f).forEach(p),V.forEach(p),h=ye(A,"linearGradient",{id:!0,x1:!0,y1:!0,x2:!0,y2:!0,gradientUnits:!0});var N=I(h);_=ye(N,"stop",{"stop-color":!0}),I(_).forEach(p),y=ye(N,"stop",{offset:!0,"stop-color":!0}),I(y).forEach(p),N.forEach(p),v=ye(A,"linearGradient",{id:!0,x1:!0,y1:!0,x2:!0,y2:!0,gradientUnits:!0});var G=I(v);m=ye(G,"stop",{"stop-color":!0}),I(m).forEach(p),b=ye(G,"stop",{offset:!0,"stop-color":!0}),I(b).forEach(p),G.forEach(p),w=ye(A,"linearGradient",{id:!0,x1:!0,y1:!0,x2:!0,y2:!0,gradientUnits:!0});var X=I(w);C=ye(X,"stop",{"stop-color":!0}),I(C).forEach(p),O=ye(X,"stop",{offset:!0,"stop-color":!0}),I(O).forEach(p),X.forEach(p),A.forEach(p),F.forEach(p),S=ee(L),E=P(L,"DIV",{class:!0});var Q=I(E);R=Ae(Q,H),Q.forEach(p),this.h()},h(){g(n,"d","M7.82979 26C3.50549 26 0 22.5675 0 18.3333C0 14.1921 3.35322 10.8179 7.54613 10.6716C9.27535 7.87166 12.4144 6 16 6C20.6308 6 24.5169 9.12183 25.5829 13.3335C29.1316 13.3603 32 16.1855 32 19.6667C32 23.0527 29 26 25.8723 25.9914L7.82979 26Z"),g(n,"fill","#C4C4C4"),g(t,"id","mask0_87_7796"),lt(t,"mask-type","alpha"),g(t,"maskUnits","userSpaceOnUse"),g(t,"x","0"),g(t,"y","6"),g(t,"width","32"),g(t,"height","20"),g(i,"d","M7.83017 26.0001C5.37824 26.0001 3.18957 24.8966 1.75391 23.1691L18.0429 16.3335L30.7089 23.4647C29.5926 24.9211 27.9066 26.0001 26.0004 25.9915C23.1254 26.0001 12.0629 26.0001 7.83017 26.0001Z"),g(i,"fill","url(#paint0_linear_87_7796)"),g(a,"d","M25.5785 13.3149L18.043 16.3334L30.709 23.4647C31.5199 22.4065 32.0004 21.0916 32.0004 19.6669C32.0004 16.1857 29.1321 13.3605 25.5833 13.3337C25.5817 13.3274 25.5801 13.3212 25.5785 13.3149Z"),g(a,"fill","url(#paint1_linear_87_7796)"),g(s,"d","M7.06445 10.7028L18.0423 16.3333L25.5779 13.3148C24.5051 9.11261 20.6237 6 15.9997 6C12.4141 6 9.27508 7.87166 7.54586 10.6716C7.3841 10.6773 7.22358 10.6877 7.06445 10.7028Z"),g(s,"fill","url(#paint2_linear_87_7796)"),g(l,"d","M1.7535 23.1687L18.0425 16.3331L7.06471 10.7026C3.09947 11.0792 0 14.3517 0 18.3331C0 20.1665 0.657197 21.8495 1.7535 23.1687Z"),g(l,"fill","url(#paint3_linear_87_7796)"),g(r,"mask","url(#mask0_87_7796)"),g(d,"stop-color","#2086B8"),g(f,"offset","1"),g(f,"stop-color","#46D3F6"),g(u,"id","paint0_linear_87_7796"),g(u,"x1","4.42591"),g(u,"y1","24.6668"),g(u,"x2","27.2309"),g(u,"y2","23.2764"),g(u,"gradientUnits","userSpaceOnUse"),g(_,"stop-color","#1694DB"),g(y,"offset","1"),g(y,"stop-color","#62C3FE"),g(h,"id","paint1_linear_87_7796"),g(h,"x1","23.8302"),g(h,"y1","19.6668"),g(h,"x2","30.2108"),g(h,"y2","15.2082"),g(h,"gradientUnits","userSpaceOnUse"),g(m,"stop-color","#0D3D78"),g(b,"offset","1"),g(b,"stop-color","#063B83"),g(v,"id","paint2_linear_87_7796"),g(v,"x1","8.51037"),g(v,"y1","7.33333"),g(v,"x2","23.3335"),g(v,"y2","15.9348"),g(v,"gradientUnits","userSpaceOnUse"),g(C,"stop-color","#16589B"),g(O,"offset","1"),g(O,"stop-color","#1464B7"),g(w,"id","paint3_linear_87_7796"),g(w,"x1","-0.340429"),g(w,"y1","19.9998"),g(w,"x2","14.5634"),g(w,"y2","14.4649"),g(w,"gradientUnits","userSpaceOnUse"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 32 32"),g(e,"class","w-5 h-5"),g(e,"fill","none"),g(E,"class","line-clamp-1")},m(L,F){U(L,e,F),k(e,t),k(t,n),k(e,r),k(r,i),k(r,a),k(r,s),k(r,l),k(e,c),k(c,u),k(u,d),k(u,f),k(c,h),k(h,_),k(h,y),k(c,v),k(v,m),k(v,b),k(c,w),k(w,C),k(w,O),U(L,S,F),U(L,E,F),k(E,R)},p(L,F){F&512&&H!==(H=L[9].t("OneDrive")+"")&&Ne(R,H)},d(L){L&&(p(e),p(S),p(E))}}}function jb(o){var h,_,y,v;let e=Object.keys(o[7]).length>0,t,n,r,i,a,s,l,c,u=e&&zc(o);n=new Gt({props:{content:o[8]?"":o[9].t("You do not have permission to upload files"),className:"w-full",$$slots:{default:[Kb]},$$scope:{ctx:o}}}),i=new Gt({props:{content:o[8]?"":o[9].t("You do not have permission to upload files"),className:"w-full",$$slots:{default:[Wb]},$$scope:{ctx:o}}});let d=((_=(h=o[10])==null?void 0:h.features)==null?void 0:_.enable_google_drive_integration)&&Fc(o),f=((v=(y=o[10])==null?void 0:y.features)==null?void 0:v.enable_onedrive_integration)&&Kc(o);return{c(){u&&u.c(),t=$(),te(n.$$.fragment),r=$(),te(i.$$.fragment),a=$(),d&&d.c(),s=$(),f&&f.c(),l=je()},l(m){u&&u.l(m),t=ee(m),re(n.$$.fragment,m),r=ee(m),re(i.$$.fragment,m),a=ee(m),d&&d.l(m),s=ee(m),f&&f.l(m),l=je()},m(m,b){u&&u.m(m,b),U(m,t,b),ne(n,m,b),U(m,r,b),ne(i,m,b),U(m,a,b),d&&d.m(m,b),U(m,s,b),f&&f.m(m,b),U(m,l,b),c=!0},p(m,b){var O,S,E,H;b&128&&(e=Object.keys(m[7]).length>0),e?u?(u.p(m,b),b&128&&T(u,1)):(u=zc(m),u.c(),T(u,1),u.m(t.parentNode,t)):u&&(Le(),D(u,1,1,()=>{u=null}),Ue());const w={};b&768&&(w.content=m[8]?"":m[9].t("You do not have permission to upload files")),b&33555202&&(w.$$scope={dirty:b,ctx:m}),n.$set(w);const C={};b&768&&(C.content=m[8]?"":m[9].t("You do not have permission to upload files")),b&33555204&&(C.$$scope={dirty:b,ctx:m}),i.$set(C),(S=(O=m[10])==null?void 0:O.features)!=null&&S.enable_google_drive_integration?d?(d.p(m,b),b&1024&&T(d,1)):(d=Fc(m),d.c(),T(d,1),d.m(s.parentNode,s)):d&&(Le(),D(d,1,1,()=>{d=null}),Ue()),(H=(E=m[10])==null?void 0:E.features)!=null&&H.enable_onedrive_integration?f?(f.p(m,b),b&1024&&T(f,1)):(f=Kc(m),f.c(),T(f,1),f.m(l.parentNode,l)):f&&(Le(),D(f,1,1,()=>{f=null}),Ue())},i(m){c||(T(u),T(n.$$.fragment,m),T(i.$$.fragment,m),T(d),T(f),c=!0)},o(m){D(u),D(n.$$.fragment,m),D(i.$$.fragment,m),D(d),D(f),c=!1},d(m){m&&(p(t),p(r),p(a),p(s),p(l)),u&&u.d(m),oe(n,m),oe(i,m),d&&d.d(m),f&&f.d(m)}}}function Qb(o){let e,t,n;return t=new Ms({props:{class:"w-full max-w-[220px] rounded-xl px-1 py-1  border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-sm",sideOffset:15,alignOffset:-8,side:"top",align:"start",transition:Ei,$$slots:{default:[jb]},$$scope:{ctx:o}}}),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(r){e=P(r,"DIV",{slot:!0});var i=I(e);re(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"slot","content")},m(r,i){U(r,e,i),ne(t,e,null),n=!0},p(r,i){const a={};i&33556383&&(a.$$scope={dirty:i,ctx:r}),t.$set(a)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){D(t.$$.fragment,r),n=!1},d(r){r&&p(e),oe(t)}}}function Xb(o){let e,t,n,r,i,a,s;function l(u){o[23](u)}let c={$$slots:{content:[Qb],default:[zb]},$$scope:{ctx:o}};return o[6]!==void 0&&(c.show=o[6]),n=new Rs({props:c}),Ye.push(()=>tt(n,"show",l)),n.$on("change",o[24]),{c(){e=M("input"),t=$(),te(n.$$.fragment),this.h()},l(u){e=P(u,"INPUT",{id:!0,type:!0,accept:!0,capture:!0,style:!0}),t=ee(u),re(n.$$.fragment,u),this.h()},h(){g(e,"id","camera-input"),g(e,"type","file"),g(e,"accept","image/*"),g(e,"capture","environment"),lt(e,"display","none")},m(u,d){U(u,e,d),U(u,t,d),ne(n,u,d),i=!0,a||(s=Ie(e,"change",o[13]),a=!0)},p(u,[d]){const f={};d&33556383&&(f.$$scope={dirty:d,ctx:u}),!r&&d&64&&(r=!0,f.show=u[6],et(()=>r=!1)),n.$set(f)},i(u){i||(T(n.$$.fragment,u),i=!0)},o(u){D(n.$$.fragment,u),i=!1},d(u){u&&(p(e),p(t)),oe(n,u),a=!1,s()}}}function Jb(o,e,t){let n,r,i,a;de(o,yr,V=>t(26,n=V)),de(o,Xo,V=>t(15,r=V)),de(o,Ci,V=>t(10,a=V));let{$$slots:s={},$$scope:l}=e;const c=on("i18n");de(o,c,V=>t(9,i=V));let{screenCaptureHandler:u}=e,{uploadFilesHandler:d}=e,{inputFilesHandler:f}=e,{uploadGoogleDriveHandler:h}=e,{uploadOneDriveHandler:_}=e,{selectedToolIds:y=[]}=e,{onClose:v}=e,m={},b=!1,w=!0;const C=async()=>{n===null&&await yr.set(await qa(localStorage.token)),t(7,m=n.reduce((V,N,G,X)=>(V[N.id]={name:N.name,description:N.meta.description,enabled:y.includes(N.id)},V),{}))},O=()=>{const V=navigator.userAgent||navigator.vendor||window.opera;return/android|iphone|ipad|ipod|windows phone/i.test(V)};function S(V){var G;const N=Array.from((G=V.target)==null?void 0:G.files);N&&N.length>0&&(console.log(N),f(N))}const E=async(V,N)=>{const G=N.detail;await rt(),G?t(0,y=[...y,V]):t(0,y=y.filter(X=>X!==V))},H=V=>{t(7,m[V].enabled=!m[V].enabled,m)},R=()=>{if(w)if(!O())u();else{const V=document.getElementById("camera-input");V&&V.click()}},L=()=>{w&&d()},F=()=>{h()},q=()=>{_()};function W(V){b=V,t(6,b)}const A=V=>{V.detail===!1&&v()};return o.$$set=V=>{"screenCaptureHandler"in V&&t(1,u=V.screenCaptureHandler),"uploadFilesHandler"in V&&t(2,d=V.uploadFilesHandler),"inputFilesHandler"in V&&t(14,f=V.inputFilesHandler),"uploadGoogleDriveHandler"in V&&t(3,h=V.uploadGoogleDriveHandler),"uploadOneDriveHandler"in V&&t(4,_=V.uploadOneDriveHandler),"selectedToolIds"in V&&t(0,y=V.selectedToolIds),"onClose"in V&&t(5,v=V.onClose),"$$scope"in V&&t(25,l=V.$$scope)},o.$$.update=()=>{var V,N;o.$$.dirty&64&&b&&C(),o.$$.dirty&32768&&t(8,w=r.role==="admin"||((N=(V=r==null?void 0:r.permissions)==null?void 0:V.chat)==null?void 0:N.file_upload))},[y,u,d,h,_,v,b,m,w,i,a,c,O,S,f,r,s,E,H,R,L,F,q,W,A,l]}class xb extends Ve{constructor(e){super(),Fe(this,e,Jb,Xb,Qe,{screenCaptureHandler:1,uploadFilesHandler:2,inputFilesHandler:14,uploadGoogleDriveHandler:3,uploadOneDriveHandler:4,selectedToolIds:0,onClose:5})}}function Gc(o,e,t){const n=o.slice();return n[0]=e[t],n[15]=t,n}function Wc(o){let e,t,n,r,i,a,s,l='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg>',c,u,d=o[3].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"",f,h=Pt(o[2]),_=[];for(let y=0;y<h.length;y+=1)_[y]=Yc(Gc(o,h,y));return{c(){e=M("div"),t=M("div"),n=M("div"),r=M("div");for(let y=0;y<_.length;y+=1)_[y].c();i=$(),a=M("div"),s=M("div"),s.innerHTML=l,c=$(),u=M("div"),f=Se(d),this.h()},l(y){e=P(y,"DIV",{id:!0,class:!0});var v=I(e);t=P(v,"DIV",{class:!0});var m=I(t);n=P(m,"DIV",{class:!0});var b=I(n);r=P(b,"DIV",{class:!0});var w=I(r);for(let S=0;S<_.length;S+=1)_[S].l(w);w.forEach(p),i=ee(b),a=P(b,"DIV",{class:!0});var C=I(a);s=P(C,"DIV",{"data-svelte-h":!0}),wt(s)!=="svelte-cdi12d"&&(s.innerHTML=l),c=ee(C),u=P(C,"DIV",{class:!0});var O=I(u);f=Ae(O,d),O.forEach(p),C.forEach(p),b.forEach(p),m.forEach(p),v.forEach(p),this.h()},h(){g(r,"class","m-1 overflow-y-auto p-1 space-y-0.5 scrollbar-hidden"),g(u,"class","line-clamp-1"),g(a,"class","px-2 pt-0.5 pb-1 text-xs text-gray-600 dark:text-gray-100 bg-white dark:bg-gray-900 rounded-b-xl flex items-center space-x-1"),g(n,"class","max-h-60 flex flex-col w-full rounded-xl bg-white dark:bg-gray-900 dark:text-gray-100"),g(t,"class","flex w-full rounded-xl border border-gray-100 dark:border-gray-850"),g(e,"id","commands-container"),g(e,"class","px-2 mb-2 text-left w-full absolute bottom-0 left-0 right-0 z-10")},m(y,v){U(y,e,v),k(e,t),k(t,n),k(n,r);for(let m=0;m<_.length;m+=1)_[m]&&_[m].m(r,null);k(n,i),k(n,a),k(a,s),k(a,c),k(a,u),k(u,f)},p(y,v){if(v&38){h=Pt(y[2]);let m;for(m=0;m<h.length;m+=1){const b=Gc(y,h,m);_[m]?_[m].p(b,v):(_[m]=Yc(b),_[m].c(),_[m].m(r,null))}for(;m<_.length;m+=1)_[m].d(1);_.length=h.length}v&8&&d!==(d=y[3].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"")&&Ne(f,d)},d(y){y&&p(e),so(_,y)}}}function Yc(o){let e,t,n=o[0].command+"",r,i,a,s=o[0].title+"",l,c,u,d,f;function h(){return o[11](o[0])}function _(){return o[12](o[15])}return{c(){e=M("button"),t=M("div"),r=Se(n),i=$(),a=M("div"),l=Se(s),c=$(),this.h()},l(y){e=P(y,"BUTTON",{class:!0,type:!0});var v=I(e);t=P(v,"DIV",{class:!0});var m=I(t);r=Ae(m,n),m.forEach(p),i=ee(v),a=P(v,"DIV",{class:!0});var b=I(a);l=Ae(b,s),b.forEach(p),c=ee(v),v.forEach(p),this.h()},h(){g(t,"class","font-medium text-black dark:text-gray-100"),g(a,"class","text-xs text-gray-600 dark:text-gray-100"),g(e,"class",u="px-3 py-1.5 rounded-xl w-full text-left "+(o[15]===o[1]?"  bg-gray-50 dark:bg-gray-850 selected-command-option-button":"")),g(e,"type","button")},m(y,v){U(y,e,v),k(e,t),k(t,r),k(e,i),k(e,a),k(a,l),k(e,c),d||(f=[Ie(e,"click",h),Ie(e,"mousemove",_),Ie(e,"focus",$b)],d=!0)},p(y,v){o=y,v&4&&n!==(n=o[0].command+"")&&Ne(r,n),v&4&&s!==(s=o[0].title+"")&&Ne(l,s),v&2&&u!==(u="px-3 py-1.5 rounded-xl w-full text-left "+(o[15]===o[1]?"  bg-gray-50 dark:bg-gray-850 selected-command-option-button":""))&&g(e,"class",u)},d(y){y&&p(e),d=!1,kn(f)}}}function Zb(o){let e,t=o[2].length>0&&Wc(o);return{c(){t&&t.c(),e=je()},l(n){t&&t.l(n),e=je()},m(n,r){t&&t.m(n,r),U(n,e,r)},p(n,[r]){n[2].length>0?t?t.p(n,r):(t=Wc(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Re,o:Re,d(n){n&&p(e),t&&t.d(n)}}}const $b=()=>{};function ey(o,e,t){let n,r,i;de(o,Xo,m=>t(13,n=m)),de(o,$d,m=>t(10,i=m));const a=on("i18n");de(o,a,m=>t(3,r=m));let{files:s}=e,{prompt:l=""}=e,{command:c=""}=e,u=0,d=[];const f=()=>{t(1,u=Math.max(0,u-1))},h=()=>{t(1,u=Math.min(u+1,d.length-1))},_=async m=>{let b=m.content;if(m.content.includes("{{CLIPBOARD}}")){const O=await navigator.clipboard.readText().catch(H=>(at.error(r.t("Failed to read clipboard contents")),"{{CLIPBOARD}}")),S=await navigator.clipboard.read();let E=null;for(const H of S)for(const R of H.types)if(R.startsWith("image/")){const L=await H.getType(R);E=URL.createObjectURL(L)}E&&t(6,s=[...s,{type:"image",url:E}]),b=b.replaceAll("{{CLIPBOARD}}",O)}if(m.content.includes("{{USER_LOCATION}}")){let O;try{O=await rm()}catch{at.error(r.t("Location access not allowed")),O="LOCATION_UNKNOWN"}b=b.replaceAll("{{USER_LOCATION}}",String(O))}if(m.content.includes("{{USER_NAME}}")){console.log(n);const O=n.name||"User";b=b.replaceAll("{{USER_NAME}}",O)}if(m.content.includes("{{USER_LANGUAGE}}")){const O=localStorage.getItem("locale")||"en-US";b=b.replaceAll("{{USER_LANGUAGE}}",O)}if(m.content.includes("{{CURRENT_DATE}}")){const O=im();b=b.replaceAll("{{CURRENT_DATE}}",O)}if(m.content.includes("{{CURRENT_TIME}}")){const O=sm();b=b.replaceAll("{{CURRENT_TIME}}",O)}if(m.content.includes("{{CURRENT_DATETIME}}")){const O=am();b=b.replaceAll("{{CURRENT_DATETIME}}",O)}if(m.content.includes("{{CURRENT_TIMEZONE}}")){const O=lm();b=b.replaceAll("{{CURRENT_TIMEZONE}}",O)}if(m.content.includes("{{CURRENT_WEEKDAY}}")){const O=cm();b=b.replaceAll("{{CURRENT_WEEKDAY}}",O)}t(0,l=b);const w=document.getElementById("chat-input-container"),C=document.getElementById("chat-input");await rt(),w&&(w.style.height="",w.style.height=Math.min(w.scrollHeight,200)+"px"),await rt(),C&&(C.focus(),C.dispatchEvent(new Event("input")))},y=m=>{_(m)},v=m=>{t(1,u=m)};return o.$$set=m=>{"files"in m&&t(6,s=m.files),"prompt"in m&&t(0,l=m.prompt),"command"in m&&t(7,c=m.command)},o.$$.update=()=>{o.$$.dirty&1152&&t(2,d=i.filter(m=>m.command.toLowerCase().includes(c.toLowerCase())).sort((m,b)=>m.title.localeCompare(b.title))),o.$$.dirty&128&&c&&t(1,u=0)},[l,u,d,r,a,_,s,c,f,h,i,y,v]}class ty extends Ve{constructor(e){super(),Fe(this,e,ey,Zb,Qe,{files:6,prompt:0,command:7,selectUp:8,selectDown:9})}get selectUp(){return this.$$.ctx[8]}get selectDown(){return this.$$.ctx[9]}}function qc(o,e,t){const n=o.slice();return n[19]=e[t],n[21]=t,n}function jc(o){let e,t,n,r,i,a,s,l=Pt(o[2]),c=[];for(let h=0;h<l.length;h+=1)c[h]=Qc(qc(o,l,h));function u(h,_){var y,v;if(_&1&&(a=null),_&1&&(s=null),a==null&&(a=!!h[0].split(" ").some(cy)),a)return ay;if(s==null&&(s=!!((v=(y=h[0].split(" "))==null?void 0:y.at(0))!=null&&v.substring(1).startsWith("http"))),s)return sy}let d=u(o,-1),f=d&&d(o);return{c(){e=M("div"),t=M("div"),n=M("div"),r=M("div");for(let h=0;h<c.length;h+=1)c[h].c();i=$(),f&&f.c(),this.h()},l(h){e=P(h,"DIV",{id:!0,class:!0});var _=I(e);t=P(_,"DIV",{class:!0});var y=I(t);n=P(y,"DIV",{class:!0});var v=I(n);r=P(v,"DIV",{class:!0});var m=I(r);for(let b=0;b<c.length;b+=1)c[b].l(m);i=ee(m),f&&f.l(m),m.forEach(p),v.forEach(p),y.forEach(p),_.forEach(p),this.h()},h(){g(r,"class","m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5 scrollbar-hidden"),g(n,"class","max-h-60 flex flex-col w-full rounded-xl bg-white dark:bg-gray-900 dark:text-gray-100"),g(t,"class","flex w-full rounded-xl border border-gray-100 dark:border-gray-850"),g(e,"id","commands-container"),g(e,"class","px-2 mb-2 text-left w-full absolute bottom-0 left-0 right-0 z-10")},m(h,_){U(h,e,_),k(e,t),k(t,n),k(n,r);for(let y=0;y<c.length;y+=1)c[y]&&c[y].m(r,null);k(r,i),f&&f.m(r,null)},p(h,_){if(_&38){l=Pt(h[2]);let y;for(y=0;y<l.length;y+=1){const v=qc(h,l,y);c[y]?c[y].p(v,_):(c[y]=Qc(v),c[y].c(),c[y].m(r,i))}for(;y<c.length;y+=1)c[y].d(1);c.length=l.length}d===(d=u(h,_))&&f?f.p(h,_):(f&&f.d(1),f=d&&d(h),f&&(f.c(),f.m(r,null)))},d(h){h&&p(e),so(c,h),f&&f.d()}}}function ny(o){let e,t="Collection";return{c(){e=M("div"),e.textContent=t,this.h()},l(n){e=P(n,"DIV",{class:!0,"data-svelte-h":!0}),wt(e)!=="svelte-1j93cxc"&&(e.textContent=t),this.h()},h(){g(e,"class","bg-green-500/20 text-green-700 dark:text-green-200 rounded-sm uppercase text-xs font-bold px-1 shrink-0")},m(n,r){U(n,e,r)},d(n){n&&p(e)}}}function oy(o){let e,t="File";return{c(){e=M("div"),e.textContent=t,this.h()},l(n){e=P(n,"DIV",{class:!0,"data-svelte-h":!0}),wt(e)!=="svelte-dn3g9i"&&(e.textContent=t),this.h()},h(){g(e,"class","bg-gray-500/20 text-gray-700 dark:text-gray-200 rounded-sm uppercase text-xs font-bold px-1 shrink-0")},m(n,r){U(n,e,r)},d(n){n&&p(e)}}}function ry(o){let e,t="Document";return{c(){e=M("div"),e.textContent=t,this.h()},l(n){e=P(n,"DIV",{class:!0,"data-svelte-h":!0}),wt(e)!=="svelte-2kpkct"&&(e.textContent=t),this.h()},h(){g(e,"class","bg-gray-500/20 text-gray-700 dark:text-gray-200 rounded-sm uppercase text-xs font-bold px-1 shrink-0")},m(n,r){U(n,e,r)},d(n){n&&p(e)}}}function iy(o){let e,t="Legacy";return{c(){e=M("div"),e.textContent=t,this.h()},l(n){e=P(n,"DIV",{class:!0,"data-svelte-h":!0}),wt(e)!=="svelte-8uyvzr"&&(e.textContent=t),this.h()},h(){g(e,"class","bg-gray-500/20 text-gray-700 dark:text-gray-200 rounded-sm uppercase text-xs font-bold px-1 shrink-0")},m(n,r){U(n,e,r)},d(n){n&&p(e)}}}function Qc(o){var C,O;let e,t,n,r,i,a=((C=o[19])==null?void 0:C.name)+"",s,l,c,u=((O=o[19])==null?void 0:O.description)+"",d,f,h,_;function y(S,E){var H,R,L;return S[19].legacy?iy:(R=(H=S[19])==null?void 0:H.meta)!=null&&R.document?ry:((L=S[19])==null?void 0:L.type)==="file"?oy:ny}let v=y(o),m=v(o);function b(){return o[13](o[19])}function w(){return o[14](o[21])}return{c(){e=M("button"),t=M("div"),n=M("div"),m.c(),r=$(),i=M("div"),s=Se(a),l=$(),c=M("div"),d=Se(u),this.h()},l(S){e=P(S,"BUTTON",{class:!0,type:!0});var E=I(e);t=P(E,"DIV",{});var H=I(t);n=P(H,"DIV",{class:!0});var R=I(n);m.l(R),r=ee(R),i=P(R,"DIV",{class:!0});var L=I(i);s=Ae(L,a),L.forEach(p),R.forEach(p),l=ee(H),c=P(H,"DIV",{class:!0});var F=I(c);d=Ae(F,u),F.forEach(p),H.forEach(p),E.forEach(p),this.h()},h(){g(i,"class","line-clamp-1"),g(n,"class","font-medium text-black dark:text-gray-100 flex items-center gap-1"),g(c,"class","text-xs text-gray-600 dark:text-gray-100 line-clamp-1"),g(e,"class",f="px-3 py-1.5 rounded-xl w-full text-left flex justify-between items-center "+(o[21]===o[1]?" bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button":"")),g(e,"type","button")},m(S,E){U(S,e,E),k(e,t),k(t,n),m.m(n,null),k(n,r),k(n,i),k(i,s),k(t,l),k(t,c),k(c,d),h||(_=[Ie(e,"click",b),Ie(e,"mousemove",w)],h=!0)},p(S,E){var H,R;o=S,v!==(v=y(o))&&(m.d(1),m=v(o),m&&(m.c(),m.m(n,r))),E&4&&a!==(a=((H=o[19])==null?void 0:H.name)+"")&&Ne(s,a),E&4&&u!==(u=((R=o[19])==null?void 0:R.description)+"")&&Ne(d,u),E&2&&f!==(f="px-3 py-1.5 rounded-xl w-full text-left flex justify-between items-center "+(o[21]===o[1]?" bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button":""))&&g(e,"class",f)},d(S){S&&p(e),m.d(),h=!1,kn(_)}}}function sy(o){var d,f;let e,t,n=((f=(d=o[0].split(" "))==null?void 0:d.at(0))==null?void 0:f.substring(1))+"",r,i,a,s=o[3].t("Web")+"",l,c,u;return{c(){e=M("button"),t=M("div"),r=Se(n),i=$(),a=M("div"),l=Se(s),this.h()},l(h){e=P(h,"BUTTON",{class:!0,type:!0});var _=I(e);t=P(_,"DIV",{class:!0});var y=I(t);r=Ae(y,n),y.forEach(p),i=ee(_),a=P(_,"DIV",{class:!0});var v=I(a);l=Ae(v,s),v.forEach(p),_.forEach(p),this.h()},h(){g(t,"class","font-medium text-black dark:text-gray-100 line-clamp-1"),g(a,"class","text-xs text-gray-600 line-clamp-1"),g(e,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button"),g(e,"type","button")},m(h,_){U(h,e,_),k(e,t),k(t,r),k(e,i),k(e,a),k(a,l),c||(u=Ie(e,"click",o[16]),c=!0)},p(h,_){var y,v;_&1&&n!==(n=((v=(y=h[0].split(" "))==null?void 0:y.at(0))==null?void 0:v.substring(1))+"")&&Ne(r,n),_&8&&s!==(s=h[3].t("Web")+"")&&Ne(l,s)},d(h){h&&p(e),c=!1,u()}}}function ay(o){var d,f;let e,t,n=((f=(d=o[0].split(" "))==null?void 0:d.at(0))==null?void 0:f.substring(1))+"",r,i,a,s=o[3].t("Youtube")+"",l,c,u;return{c(){e=M("button"),t=M("div"),r=Se(n),i=$(),a=M("div"),l=Se(s),this.h()},l(h){e=P(h,"BUTTON",{class:!0,type:!0});var _=I(e);t=P(_,"DIV",{class:!0});var y=I(t);r=Ae(y,n),y.forEach(p),i=ee(_),a=P(_,"DIV",{class:!0});var v=I(a);l=Ae(v,s),v.forEach(p),_.forEach(p),this.h()},h(){g(t,"class","font-medium text-black dark:text-gray-100 line-clamp-1"),g(a,"class","text-xs text-gray-600 line-clamp-1"),g(e,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button"),g(e,"type","button")},m(h,_){U(h,e,_),k(e,t),k(t,r),k(e,i),k(e,a),k(a,l),c||(u=Ie(e,"click",o[15]),c=!0)},p(h,_){var y,v;_&1&&n!==(n=((v=(y=h[0].split(" "))==null?void 0:y.at(0))==null?void 0:v.substring(1))+"")&&Ne(r,n),_&8&&s!==(s=h[3].t("Youtube")+"")&&Ne(l,s)},d(h){h&&p(e),c=!1,u()}}}function ly(o){var r,i;let e=o[2].length>0||((i=(r=o[0].split(" "))==null?void 0:r.at(0))==null?void 0:i.substring(1).startsWith("http")),t,n=e&&jc(o);return{c(){n&&n.c(),t=je()},l(a){n&&n.l(a),t=je()},m(a,s){n&&n.m(a,s),U(a,t,s)},p(a,[s]){var l,c;s&5&&(e=a[2].length>0||((c=(l=a[0].split(" "))==null?void 0:l.at(0))==null?void 0:c.substring(1).startsWith("http"))),e?n?n.p(a,s):(n=jc(a),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:Re,o:Re,d(a){a&&p(t),n&&n.d(a)}}}const cy=o=>o.substring(1).startsWith("https://www.youtube.com")||o.substring(1).startsWith("https://youtu.be");function uy(o,e,t){let n,r;de(o,ef,S=>t(17,n=S)),Qm.extend(Xm);const i=on("i18n");de(o,i,S=>t(3,r=S));let{prompt:a=""}=e,{command:s=""}=e;const l=Pn();let c=0,u=[],d=null,f=[];const h=()=>{t(1,c=Math.max(0,c-1))},_=()=>{t(1,c=Math.min(c+1,f.length-1))},y=async S=>{l("select",S),t(0,a=$i(a,s));const E=document.getElementById("chat-input");await rt(),E==null||E.focus(),await rt()},v=async S=>{l("url",S),t(0,a=$i(a,s));const E=document.getElementById("chat-input");await rt(),E==null||E.focus(),await rt()},m=async S=>{l("youtube",S),t(0,a=$i(a,s));const E=document.getElementById("chat-input");await rt(),E==null||E.focus(),await rt()};Jn(()=>{let S=n.filter(L=>{var F;return(F=L==null?void 0:L.meta)==null?void 0:F.document}).map(L=>({...L,type:"file"})),E=S.length>0?[{name:"All Documents",legacy:!0,type:"collection",description:"Deprecated (legacy collection), please create a new knowledge base.",title:r.t("All Documents"),collection_names:S.map(L=>L.id)},...S.reduce((L,F)=>{var q;return[...new Set([...L,...(((q=F==null?void 0:F.meta)==null?void 0:q.tags)??[]).map(W=>W.name)])]},[]).map(L=>({name:L,legacy:!0,type:"collection",description:"Deprecated (legacy collection), please create a new knowledge base.",collection_names:S.filter(F=>{var q;return(((q=F==null?void 0:F.meta)==null?void 0:q.tags)??[]).map(W=>W.name).includes(L)}).map(F=>F.id)}))]:[],H=n.filter(L=>{var F;return!((F=L==null?void 0:L.meta)!=null&&F.document)}).map(L=>({...L,type:"collection"})),R=n.length>0?[...n.reduce((L,F)=>[...new Set([...L,...((F==null?void 0:F.files)??[]).map(q=>({...q,collection:{name:F.name,description:F.description}}))])],[]).map(L=>{var F,q,W;return{...L,name:(F=L==null?void 0:L.meta)==null?void 0:F.name,description:`${(q=L==null?void 0:L.collection)==null?void 0:q.name} - ${(W=L==null?void 0:L.collection)==null?void 0:W.description}`,type:"file"}})]:[];t(11,u=[...H,...R,...E,...S].map(L=>{var F,q;return{...L,...L!=null&&L.legacy||(F=L==null?void 0:L.meta)!=null&&F.legacy||(q=L==null?void 0:L.meta)!=null&&q.document?{legacy:!0}:{}}})),t(12,d=new nf(u,{keys:["name","description"]}))});const b=S=>{console.log(S),y(S)},w=S=>{t(1,c=S)},C=()=>{var E,H;const S=(H=(E=a.split(" "))==null?void 0:E.at(0))==null?void 0:H.substring(1);xl(S)?m(S):at.error(r.t("Oops! Looks like the URL is invalid. Please double-check and try again."))},O=()=>{var E,H;const S=(H=(E=a.split(" "))==null?void 0:E.at(0))==null?void 0:H.substring(1);xl(S)?v(S):at.error(r.t("Oops! Looks like the URL is invalid. Please double-check and try again."))};return o.$$set=S=>{"prompt"in S&&t(0,a=S.prompt),"command"in S&&t(8,s=S.command)},o.$$.update=()=>{o.$$.dirty&6400&&d&&t(2,f=s.slice(1)?d.search(s).map(S=>S.item):u),o.$$.dirty&256&&s&&t(1,c=0)},[a,c,f,r,i,y,v,m,s,h,_,u,d,b,w,C,O]}class dy extends Ve{constructor(e){super(),Fe(this,e,uy,ly,Qe,{prompt:0,command:8,selectUp:9,selectDown:10})}get selectUp(){return this.$$.ctx[9]}get selectDown(){return this.$$.ctx[10]}}function Xc(o,e,t){const n=o.slice();return n[12]=e[t],n[14]=t,n}function Jc(o){let e,t,n,r,i=Pt(o[1]),a=[];for(let s=0;s<i.length;s+=1)a[s]=xc(Xc(o,i,s));return{c(){e=M("div"),t=M("div"),n=M("div"),r=M("div");for(let s=0;s<a.length;s+=1)a[s].c();this.h()},l(s){e=P(s,"DIV",{id:!0,class:!0});var l=I(e);t=P(l,"DIV",{class:!0});var c=I(t);n=P(c,"DIV",{class:!0});var u=I(n);r=P(u,"DIV",{class:!0});var d=I(r);for(let f=0;f<a.length;f+=1)a[f].l(d);d.forEach(p),u.forEach(p),c.forEach(p),l.forEach(p),this.h()},h(){g(r,"class","m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden"),g(n,"class","max-h-60 flex flex-col w-full rounded-xl bg-white dark:bg-gray-900 dark:text-gray-100"),g(t,"class","flex w-full rounded-xl border border-gray-100 dark:border-gray-850"),g(e,"id","commands-container"),g(e,"class","px-2 mb-2 text-left w-full absolute bottom-0 left-0 right-0 z-10")},m(s,l){U(s,e,l),k(e,t),k(t,n),k(n,r);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(r,null)},p(s,l){if(l&7){i=Pt(s[1]);let c;for(c=0;c<i.length;c+=1){const u=Xc(s,i,c);a[c]?a[c].p(u,l):(a[c]=xc(u),a[c].c(),a[c].m(r,null))}for(;c<a.length;c+=1)a[c].d(1);a.length=i.length}},d(s){s&&p(e),so(a,s)}}}function xc(o){let e,t,n,r,i,a,s=o[12].name+"",l,c,u,d,f;function h(){return o[7](o[12])}function _(){return o[8](o[14])}return{c(){e=M("button"),t=M("div"),n=M("img"),a=$(),l=Se(s),c=$(),this.h()},l(y){e=P(y,"BUTTON",{class:!0,type:!0});var v=I(e);t=P(v,"DIV",{class:!0});var m=I(t);n=P(m,"IMG",{src:!0,alt:!0,class:!0}),a=ee(m),l=Ae(m,s),m.forEach(p),c=ee(v),v.forEach(p),this.h()},h(){var y,v,m,b;qo(n.src,r=((m=(v=(y=o[12])==null?void 0:y.info)==null?void 0:v.meta)==null?void 0:m.profile_image_url)??"/static/favicon.png")||g(n,"src",r),g(n,"alt",i=((b=o[12])==null?void 0:b.name)??o[12].id),g(n,"class","rounded-full size-6 items-center mr-2"),g(t,"class","flex font-medium text-black dark:text-gray-100 line-clamp-1"),g(e,"class",u="px-3 py-1.5 rounded-xl w-full text-left "+(o[14]===o[0]?"bg-gray-50 dark:bg-gray-850 selected-command-option-button":"")),g(e,"type","button")},m(y,v){U(y,e,v),k(e,t),k(t,n),k(t,a),k(t,l),k(e,c),d||(f=[Ie(e,"click",h),Ie(e,"mousemove",_),Ie(e,"focus",hy)],d=!0)},p(y,v){var m,b,w,C;o=y,v&2&&!qo(n.src,r=((w=(b=(m=o[12])==null?void 0:m.info)==null?void 0:b.meta)==null?void 0:w.profile_image_url)??"/static/favicon.png")&&g(n,"src",r),v&2&&i!==(i=((C=o[12])==null?void 0:C.name)??o[12].id)&&g(n,"alt",i),v&2&&s!==(s=o[12].name+"")&&Ne(l,s),v&1&&u!==(u="px-3 py-1.5 rounded-xl w-full text-left "+(o[14]===o[0]?"bg-gray-50 dark:bg-gray-850 selected-command-option-button":""))&&g(e,"class",u)},d(y){y&&p(e),d=!1,kn(f)}}}function fy(o){let e,t=o[1].length>0&&Jc(o);return{c(){t&&t.c(),e=je()},l(n){t&&t.l(n),e=je()},m(n,r){t&&t.m(n,r),U(n,e,r)},p(n,[r]){n[1].length>0?t?t.p(n,r):(t=Jc(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Re,o:Re,d(n){n&&p(e),t&&t.d(n)}}}const hy=()=>{};function gy(o,e,t){let n;de(o,Tr,_=>t(6,n=_)),on("i18n");const r=Pn();let{command:i=""}=e,a=0,s=[],l=new nf(n.filter(_=>{var y,v;return!((v=(y=_==null?void 0:_.info)==null?void 0:y.meta)!=null&&v.hidden)}).map(_=>{var v,m,b,w,C;return{..._,modelName:_==null?void 0:_.name,tags:(b=(m=(v=_==null?void 0:_.info)==null?void 0:v.meta)==null?void 0:m.tags)==null?void 0:b.map(O=>O.name).join(" "),desc:(C=(w=_==null?void 0:_.info)==null?void 0:w.meta)==null?void 0:C.description}}),{keys:["value","tags","modelName"],threshold:.3});const c=()=>{t(0,a=Math.max(0,a-1))},u=()=>{t(0,a=Math.min(a+1,s.length-1))},d=async _=>{t(3,i=""),r("select",_)};Jn(async()=>{await rt();const _=document.getElementById("chat-input");await rt(),_==null||_.focus(),await rt()});const f=_=>{d(_)},h=_=>{t(0,a=_)};return o.$$set=_=>{"command"in _&&t(3,i=_.command)},o.$$.update=()=>{o.$$.dirty&72&&t(1,s=i.slice(1)?l.search(i).map(_=>_.item):n.filter(_=>{var y,v;return!((v=(y=_==null?void 0:_.info)==null?void 0:y.meta)!=null&&v.hidden)})),o.$$.dirty&8&&i&&t(0,a=0)},[a,s,d,i,c,u,n,f,h]}class my extends Ve{constructor(e){super(),Fe(this,e,gy,fy,Qe,{command:3,selectUp:4,selectDown:5})}get selectUp(){return this.$$.ctx[4]}get selectDown(){return this.$$.ctx[5]}}function Zc(o){let e,t,n,r;const i=[_y,py],a=[];function s(l,c){return l[4]?1:0}return e=s(o),t=a[e]=i[e](o),{c(){t.c(),n=je()},l(l){t.l(l),n=je()},m(l,c){a[e].m(l,c),U(l,n,c),r=!0},p(l,c){let u=e;e=s(l),e===u?a[e].p(l,c):(Le(),D(a[u],1,1,()=>{a[u]=null}),Ue(),t=a[e],t?t.p(l,c):(t=a[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){D(t),r=!1},d(l){l&&p(n),a[e].d(l)}}}function py(o){let e,t,n,r,i;return r=new Ps({}),{c(){e=M("div"),t=M("div"),n=M("div"),te(r.$$.fragment),this.h()},l(a){e=P(a,"DIV",{id:!0,class:!0});var s=I(e);t=P(s,"DIV",{class:!0});var l=I(t);n=P(l,"DIV",{class:!0});var c=I(n);re(r.$$.fragment,c),c.forEach(p),l.forEach(p),s.forEach(p),this.h()},h(){g(n,"class","max-h-60 flex flex-col w-full rounded-xl bg-white dark:bg-gray-900 dark:text-gray-100"),g(t,"class","flex w-full rounded-xl border border-gray-100 dark:border-gray-850"),g(e,"id","commands-container"),g(e,"class","px-2 mb-2 text-left w-full absolute bottom-0 left-0 right-0 z-10")},m(a,s){U(a,e,s),k(e,t),k(t,n),ne(r,n,null),i=!0},p:Re,i(a){i||(T(r.$$.fragment,a),i=!0)},o(a){D(r.$$.fragment,a),i=!1},d(a){a&&p(e),oe(r)}}}function _y(o){let e,t,n,r,i,a,s;const l=[vy,yy,by],c=[];function u(d,f){var h,_,y;return f&4&&(e=null),f&4&&(t=null),f&4&&(n=null),e==null&&(e=((h=d[2])==null?void 0:h.charAt(0))==="/"),e?0:(t==null&&(t=!!(((_=d[2])==null?void 0:_.charAt(0))==="#"&&d[2].startsWith("#")&&!d[2].includes("# ")||d[2].slice(0,2)==="\\#"&&d[2].startsWith("#")&&!d[2].includes("# "))),t?1:(n==null&&(n=((y=d[2])==null?void 0:y.charAt(0))==="@"),n?2:-1))}return~(r=u(o,-1))&&(i=c[r]=l[r](o)),{c(){i&&i.c(),a=je()},l(d){i&&i.l(d),a=je()},m(d,f){~r&&c[r].m(d,f),U(d,a,f),s=!0},p(d,f){let h=r;r=u(d,f),r===h?~r&&c[r].p(d,f):(i&&(Le(),D(c[h],1,1,()=>{c[h]=null}),Ue()),~r?(i=c[r],i?i.p(d,f):(i=c[r]=l[r](d),i.c()),T(i,1),i.m(a.parentNode,a)):i=null)},i(d){s||(T(i),s=!0)},o(d){D(i),s=!1},d(d){d&&p(a),~r&&c[r].d(d)}}}function by(o){let e,t,n={command:o[2]};return e=new my({props:n}),o[17](e),e.$on("select",o[18]),{c(){te(e.$$.fragment)},l(r){re(e.$$.fragment,r)},m(r,i){ne(e,r,i),t=!0},p(r,i){const a={};i&4&&(a.command=r[2]),e.$set(a)},i(r){t||(T(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){o[17](null),oe(e,r)}}}function yy(o){let e,t,n;function r(a){o[13](a)}let i={command:o[2].includes("\\#")?o[2].slice(2):o[2]};return o[0]!==void 0&&(i.prompt=o[0]),e=new dy({props:i}),o[12](e),Ye.push(()=>tt(e,"prompt",r)),e.$on("youtube",o[14]),e.$on("url",o[15]),e.$on("select",o[16]),{c(){te(e.$$.fragment)},l(a){re(e.$$.fragment,a)},m(a,s){ne(e,a,s),n=!0},p(a,s){const l={};s&4&&(l.command=a[2].includes("\\#")?a[2].slice(2):a[2]),!t&&s&1&&(t=!0,l.prompt=a[0],et(()=>t=!1)),e.$set(l)},i(a){n||(T(e.$$.fragment,a),n=!0)},o(a){D(e.$$.fragment,a),n=!1},d(a){o[12](null),oe(e,a)}}}function vy(o){let e,t,n,r;function i(l){o[10](l)}function a(l){o[11](l)}let s={command:o[2]};return o[0]!==void 0&&(s.prompt=o[0]),o[1]!==void 0&&(s.files=o[1]),e=new ty({props:s}),o[9](e),Ye.push(()=>tt(e,"prompt",i)),Ye.push(()=>tt(e,"files",a)),{c(){te(e.$$.fragment)},l(l){re(e.$$.fragment,l)},m(l,c){ne(e,l,c),r=!0},p(l,c){const u={};c&4&&(u.command=l[2]),!t&&c&1&&(t=!0,u.prompt=l[0],et(()=>t=!1)),!n&&c&2&&(n=!0,u.files=l[1],et(()=>n=!1)),e.$set(u)},i(l){r||(T(e.$$.fragment,l),r=!0)},o(l){D(e.$$.fragment,l),r=!1},d(l){o[9](null),oe(e,l)}}}function wy(o){let e,t,n=o[3]&&Zc(o);return{c(){n&&n.c(),e=je()},l(r){n&&n.l(r),e=je()},m(r,i){n&&n.m(r,i),U(r,e,i),t=!0},p(r,[i]){r[3]?n?(n.p(r,i),i&8&&T(n,1)):(n=Zc(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Le(),D(n,1,1,()=>{n=null}),Ue())},i(r){t||(T(n),t=!0)},o(r){D(n),t=!1},d(r){r&&p(e),n&&n.d(r)}}}function ky(o,e,t){const n=Pn();let{prompt:r=""}=e,{files:i=[]}=e,a=!1,s=null;const l=()=>{s==null||s.selectUp()},c=()=>{s==null||s.selectDown()};let u="",d=!1;const f=async()=>{t(4,a=!0),await Promise.all([(async()=>{$d.set(await qm(localStorage.token))})(),(async()=>{ef.set(await jm(localStorage.token))})()]),t(4,a=!1)};function h(E){Ye[E?"unshift":"push"](()=>{s=E,t(5,s)})}function _(E){r=E,t(0,r)}function y(E){i=E,t(1,i)}function v(E){Ye[E?"unshift":"push"](()=>{s=E,t(5,s)})}function m(E){r=E,t(0,r)}const b=E=>{console.log(E),n("upload",{type:"youtube",data:E.detail})},w=E=>{console.log(E),n("upload",{type:"web",data:E.detail})},C=E=>{console.log(E),!i.find(H=>H.id===E.detail.id)&&(t(1,i=[...i,{...E.detail,status:"processed"}]),n("select"))};function O(E){Ye[E?"unshift":"push"](()=>{s=E,t(5,s)})}const S=E=>{t(0,r=$i(r,u)),n("select",{type:"model",data:E.detail})};return o.$$set=E=>{"prompt"in E&&t(0,r=E.prompt),"files"in E&&t(1,i=E.files)},o.$$.update=()=>{var E,H;o.$$.dirty&1&&t(2,u=((H=(E=r==null?void 0:r.split(`
`).pop())==null?void 0:E.split(" "))==null?void 0:H.pop())??""),o.$$.dirty&4&&t(3,d=["/","#","@"].includes(u==null?void 0:u.charAt(0))||u.slice(0,2)==="\\#"),o.$$.dirty&8&&d&&f()},[r,i,u,d,a,s,n,l,c,h,_,y,v,m,b,w,C,O,S]}class Cy extends Ve{constructor(e){super(),Fe(this,e,ky,wy,Qe,{prompt:0,files:1,selectUp:7,selectDown:8})}get selectUp(){return this.$$.ctx[7]}get selectDown(){return this.$$.ctx[8]}}function Ey(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{"aria-hidden":!0,xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var r=I(e);t=ye(r,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"fill-rule","evenodd"),g(t,"d","M12 5a7 7 0 0 0-7 7v1.17c.313-.11.65-.17 1-.17h2a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H6a3 3 0 0 1-3-3v-6a9 9 0 0 1 18 0v6a3 3 0 0 1-3 3h-2a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h2c.35 0 .687.06 1 .17V12a7 7 0 0 0-7-7Z"),g(t,"clip-rule","evenodd"),g(e,"aria-hidden","true"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","currentColor"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(n,r){U(n,e,r),k(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Re,o:Re,d(n){n&&p(e)}}}function Iy(o,e,t){let{className:n="w-4 h-4"}=e,{strokeWidth:r="0"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class Ty extends Ve{constructor(e){super(),Fe(this,e,Iy,Ey,Qe,{className:0,strokeWidth:1})}}function Sy(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{class:!0,"stroke-width":!0,"aria-hidden":!0,xmlns:!0,fill:!0,viewBox:!0});var r=I(e);t=ye(r,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"stroke","currentColor"),g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"stroke-width","2"),g(t,"d","m3 16 5-7 6 6.5m6.5 2.5L16 13l-4.286 6M14 10h.01M4 19h16a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1Z"),g(e,"class",o[0]),g(e,"stroke-width",o[1]),g(e,"aria-hidden","true"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24")},m(n,r){U(n,e,r),k(e,t)},p(n,[r]){r&1&&g(e,"class",n[0]),r&2&&g(e,"stroke-width",n[1])},i:Re,o:Re,d(n){n&&p(e)}}}function Ay(o,e,t){let{className:n="size-4"}=e,{strokeWidth:r="1.5"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class Ry extends Ve{constructor(e){super(),Fe(this,e,Ay,Sy,Qe,{className:0,strokeWidth:1})}}function My(o){let e,t,n,r;return{c(){e=be("svg"),t=be("g"),n=be("path"),r=be("path"),this.h()},l(i){e=ye(i,"svg",{xmlns:!0,fill:!0,width:!0,height:!0,version:!0,viewBox:!0,"xml:space":!0,class:!0});var a=I(e);t=ye(a,"g",{});var s=I(t);n=ye(s,"path",{d:!0}),I(n).forEach(p),r=ye(s,"path",{d:!0}),I(r).forEach(p),s.forEach(p),a.forEach(p),this.h()},h(){g(n,"d",`M196.926,55.171c-0.11-5.785-0.215-11.25-0.215-16.537c0-4.142-3.357-7.5-7.5-7.5c-32.075,0-56.496-9.218-76.852-29.01\r
        c-2.912-2.832-7.546-2.831-10.457,0c-20.354,19.792-44.771,29.01-76.844,29.01c-4.142,0-7.5,3.358-7.5,7.5\r
        c0,5.288-0.104,10.755-0.215,16.541c-1.028,53.836-2.436,127.567,87.331,158.682c0.796,0.276,1.626,0.414,2.456,0.414\r
        c0.83,0,1.661-0.138,2.456-0.414C199.36,182.741,197.954,109.008,196.926,55.171z M107.131,198.812\r
        c-76.987-27.967-75.823-89.232-74.79-143.351c0.062-3.248,0.122-6.396,0.164-9.482c30.04-1.268,54.062-10.371,74.626-28.285\r
        c20.566,17.914,44.592,27.018,74.634,28.285c0.042,3.085,0.102,6.231,0.164,9.477C182.961,109.577,184.124,170.844,107.131,198.812\r
        z`),g(r,"d",`M132.958,81.082l-36.199,36.197l-15.447-15.447c-2.929-2.928-7.678-2.928-10.606,0c-2.929,2.93-2.929,7.678,0,10.607\r
        l20.75,20.75c1.464,1.464,3.384,2.196,5.303,2.196c1.919,0,3.839-0.732,5.303-2.196l41.501-41.5\r
        c2.93-2.929,2.93-7.678,0.001-10.606C140.636,78.154,135.887,78.153,132.958,81.082z`),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","currentColor"),g(e,"width","800px"),g(e,"height","800px"),g(e,"version","1.1"),g(e,"viewBox","0 0 214.27 214.27"),g(e,"xml:space","preserve"),g(e,"class",o[0])},m(i,a){U(i,e,a),k(e,t),k(t,n),k(t,r)},p(i,[a]){a&1&&g(e,"class",i[0])},i:Re,o:Re,d(i){i&&p(e)}}}function Py(o,e,t){let{className:n="w-4 h-4"}=e;return o.$$set=r=>{"className"in r&&t(0,n=r.className)},[n]}class Oy extends Ve{constructor(e){super(),Fe(this,e,Py,My,Qe,{className:0})}}function $c(o,e,t){const n=o.slice();return n[35]=e[t],n[37]=t,n}function eu(o){let e,t;return e=new Gt({props:{content:"This chat won't appear in history and your messages will not be saved.",className:"w-full flex justify-center mb-0.5",placement:"top",$$slots:{default:[Ny]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function Ny(o){let e,t,n,r;return t=new op({props:{strokeWidth:"2.5",className:"size-5"}}),{c(){e=M("div"),te(t.$$.fragment),n=Se(" Temporary Chat"),this.h()},l(i){e=P(i,"DIV",{class:!0});var a=I(e);re(t.$$.fragment,a),n=Ae(a," Temporary Chat"),a.forEach(p),this.h()},h(){g(e,"class","flex items-center gap-2 text-gray-500 font-medium text-lg my-2 w-fit")},m(i,a){U(i,e,a),ne(t,e,null),k(e,n),r=!0},p:Re,i(i){r||(T(t.$$.fragment,i),r=!0)},o(i){D(t.$$.fragment,i),r=!1},d(i){i&&p(e),oe(t)}}}function Dy(o){let e,t,n,r,i,a;function s(){return o[23](o[37])}return{c(){e=M("button"),t=M("img"),r=$(),this.h()},l(l){e=P(l,"BUTTON",{});var c=I(e);t=P(c,"IMG",{crossorigin:!0,src:!0,class:!0,alt:!0,draggable:!0}),c.forEach(p),r=ee(l),this.h()},h(){var l,c,u;g(t,"crossorigin","anonymous"),qo(t.src,n=((u=(c=(l=o[35])==null?void 0:l.info)==null?void 0:c.meta)==null?void 0:u.profile_image_url)??(o[15].language==="dg-DG"?"/doge.png":`${hi}/static/favicon.png`))||g(t,"src",n),g(t,"class","size-9 @sm:size-10 rounded-full border-[1px] border-gray-100 dark:border-none"),g(t,"alt","logo"),g(t,"draggable","false")},m(l,c){U(l,e,c),k(e,t),U(l,r,c),i||(a=Ie(e,"click",s),i=!0)},p(l,c){var u,d,f;o=l,c[0]&40960&&!qo(t.src,n=((f=(d=(u=o[35])==null?void 0:u.info)==null?void 0:d.meta)==null?void 0:f.profile_image_url)??(o[15].language==="dg-DG"?"/doge.png":`${hi}/static/favicon.png`))&&g(t,"src",n)},d(l){l&&(p(e),p(r)),i=!1,a()}}}function tu(o){var n,r,i;let e,t;return e=new Gt({props:{content:(((i=(r=(n=o[13][o[37]])==null?void 0:n.info)==null?void 0:r.meta)==null?void 0:i.tags)??[]).map(ru).join(", "),placement:"top",$$slots:{default:[Dy]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(a){re(e.$$.fragment,a)},m(a,s){ne(e,a,s),t=!0},p(a,s){var c,u,d;const l={};s[0]&8192&&(l.content=(((d=(u=(c=a[13][a[37]])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.tags)??[]).map(ru).join(", ")),s[0]&57344|s[1]&128&&(l.$$scope={dirty:s,ctx:a}),e.$set(l)},i(a){t||(T(e.$$.fragment,a),t=!0)},o(a){D(e.$$.fragment,a),t=!1},d(a){oe(e,a)}}}function Hy(o){let e=o[15].t("Hello, {{name}}",{name:o[17].name})+"",t;return{c(){t=Se(e)},l(n){t=Ae(n,e)},m(n,r){U(n,t,r)},p(n,r){r[0]&163840&&e!==(e=n[15].t("Hello, {{name}}",{name:n[17].name})+"")&&Ne(t,e)},d(n){n&&p(t)}}}function Ly(o){var n;let e=((n=o[13][o[14]])==null?void 0:n.name)+"",t;return{c(){t=Se(e)},l(r){t=Ae(r,e)},m(r,i){U(r,t,i)},p(r,i){var a;i[0]&24576&&e!==(e=((a=r[13][r[14]])==null?void 0:a.name)+"")&&Ne(t,e)},d(r){r&&p(t)}}}function nu(o){var a,s,l,c,u,d;let e,t,n,r;e=new Gt({props:{className:" w-fit",content:is.parse(rs(((l=(s=(a=o[13][o[14]])==null?void 0:a.info)==null?void 0:s.meta)==null?void 0:l.description)??"")),placement:"top",$$slots:{default:[Uy]},$$scope:{ctx:o}}});let i=((d=(u=(c=o[13][o[14]])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.user)&&ou(o);return{c(){te(e.$$.fragment),t=$(),i&&i.c(),n=je()},l(f){re(e.$$.fragment,f),t=ee(f),i&&i.l(f),n=je()},m(f,h){ne(e,f,h),U(f,t,h),i&&i.m(f,h),U(f,n,h),r=!0},p(f,h){var y,v,m,b,w,C;const _={};h[0]&24576&&(_.content=is.parse(rs(((m=(v=(y=f[13][f[14]])==null?void 0:y.info)==null?void 0:v.meta)==null?void 0:m.description)??""))),h[0]&24576|h[1]&128&&(_.$$scope={dirty:h,ctx:f}),e.$set(_),(C=(w=(b=f[13][f[14]])==null?void 0:b.info)==null?void 0:w.meta)!=null&&C.user?i?i.p(f,h):(i=ou(f),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},i(f){r||(T(e.$$.fragment,f),r=!0)},o(f){D(e.$$.fragment,f),r=!1},d(f){f&&(p(t),p(n)),oe(e,f),i&&i.d(f)}}}function Uy(o){var r,i,a;let e,t,n=is.parse(rs((a=(i=(r=o[13][o[14]])==null?void 0:r.info)==null?void 0:i.meta)==null?void 0:a.description))+"";return{c(){e=M("div"),t=new Vg(!1),this.h()},l(s){e=P(s,"DIV",{class:!0});var l=I(e);t=Fg(l,!1),l.forEach(p),this.h()},h(){t.a=null,g(e,"class","mt-0.5 px-2 text-sm font-normal text-gray-500 dark:text-gray-400 line-clamp-2 max-w-xl markdown")},m(s,l){U(s,e,l),t.m(n,e)},p(s,l){var c,u,d;l[0]&24576&&n!==(n=is.parse(rs((d=(u=(c=s[13][s[14]])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.description))+"")&&t.p(n)},d(s){s&&p(e)}}}function ou(o){let e,t;function n(a,s){var l,c,u;return(u=(c=(l=a[13][a[14]])==null?void 0:l.info)==null?void 0:c.meta)!=null&&u.user.community?zy:By}let r=n(o),i=r(o);return{c(){e=M("div"),t=Se(`By\r
								`),i.c(),this.h()},l(a){e=P(a,"DIV",{class:!0});var s=I(e);t=Ae(s,`By\r
								`),i.l(s),s.forEach(p),this.h()},h(){g(e,"class","mt-0.5 text-sm font-normal text-gray-400 dark:text-gray-500")},m(a,s){U(a,e,s),k(e,t),i.m(e,null)},p(a,s){r===(r=n(a))&&i?i.p(a,s):(i.d(1),i=r(a),i&&(i.c(),i.m(e,null)))},d(a){a&&p(e),i.d()}}}function By(o){var n,r,i;let e=((i=(r=(n=o[13][o[14]])==null?void 0:n.info)==null?void 0:r.meta)==null?void 0:i.user.name)+"",t;return{c(){t=Se(e)},l(a){t=Ae(a,e)},m(a,s){U(a,t,s)},p(a,s){var l,c,u;s[0]&24576&&e!==(e=((u=(c=(l=a[13][a[14]])==null?void 0:l.info)==null?void 0:c.meta)==null?void 0:u.user.name)+"")&&Ne(t,e)},d(a){a&&p(t)}}}function zy(o){var i,a,s,l,c,u,d,f,h;let e,t=((s=(a=(i=o[13][o[14]])==null?void 0:i.info)==null?void 0:a.meta)!=null&&s.user.name?(u=(c=(l=o[13][o[14]])==null?void 0:l.info)==null?void 0:c.meta)==null?void 0:u.user.name:`@${(h=(f=(d=o[13][o[14]])==null?void 0:d.info)==null?void 0:f.meta)==null?void 0:h.user.username}`)+"",n,r;return{c(){e=M("a"),n=Se(t),this.h()},l(_){e=P(_,"A",{href:!0});var y=I(e);n=Ae(y,t),y.forEach(p),this.h()},h(){var _,y,v;g(e,"href",r="https://openwebui.com/m/"+((v=(y=(_=o[13][o[14]])==null?void 0:_.info)==null?void 0:y.meta)==null?void 0:v.user.username))},m(_,y){U(_,e,y),k(e,n)},p(_,y){var v,m,b,w,C,O,S,E,H,R,L,F;y[0]&24576&&t!==(t=((b=(m=(v=_[13][_[14]])==null?void 0:v.info)==null?void 0:m.meta)!=null&&b.user.name?(O=(C=(w=_[13][_[14]])==null?void 0:w.info)==null?void 0:C.meta)==null?void 0:O.user.name:`@${(H=(E=(S=_[13][_[14]])==null?void 0:S.info)==null?void 0:E.meta)==null?void 0:H.user.username}`)+"")&&Ne(n,t),y[0]&24576&&r!==(r="https://openwebui.com/m/"+((F=(L=(R=_[13][_[14]])==null?void 0:R.info)==null?void 0:L.meta)==null?void 0:F.user.username))&&g(e,"href",r)},d(_){_&&p(e)}}}function Vy(o){var xe,gt,Et,Bt,Xt,Ot,rn,Wt,Nt,tn;let e,t,n,r,i,a,s,l,c,u,d,f,h,_,y,v,m,b,w,C,O,S,E,H,R,L,F,q,W,A,V,N,G,X=o[16]&&eu(o),Q=Pt(o[13]),j=[];for(let ie=0;ie<Q.length;ie+=1)j[ie]=tu($c(o,Q,ie));const ue=ie=>D(j[ie],1,1,()=>{j[ie]=null});function B(ie,Ge){var nt;return(nt=ie[13][ie[14]])!=null&&nt.name?Ly:Hy}let x=B(o),J=x(o),ce=(((Et=(gt=(xe=o[13][o[14]])==null?void 0:xe.info)==null?void 0:gt.meta)==null?void 0:Et.description)??null)&&nu(o);function me(ie){o[24](ie)}function se(ie){o[25](ie)}function Be(ie){o[26](ie)}function He(ie){o[27](ie)}function Y(ie){o[28](ie)}function Xe(ie){o[29](ie)}function Ke(ie){o[30](ie)}function mt(ie){o[31](ie)}let fe={history:o[12],selectedModels:o[11],transparentBackground:o[8],stopResponse:o[10],createMessagePair:o[9],placeholder:o[15].t("How can I help you today?")};return o[3]!==void 0&&(fe.files=o[3]),o[2]!==void 0&&(fe.prompt=o[2]),o[0]!==void 0&&(fe.autoScroll=o[0]),o[4]!==void 0&&(fe.selectedToolIds=o[4]),o[5]!==void 0&&(fe.imageGenerationEnabled=o[5]),o[6]!==void 0&&(fe.codeInterpreterEnabled=o[6]),o[7]!==void 0&&(fe.webSearchEnabled=o[7]),o[1]!==void 0&&(fe.atSelectedModel=o[1]),b=new tg({props:fe}),Ye.push(()=>tt(b,"files",me)),Ye.push(()=>tt(b,"prompt",se)),Ye.push(()=>tt(b,"autoScroll",Be)),Ye.push(()=>tt(b,"selectedToolIds",He)),Ye.push(()=>tt(b,"imageGenerationEnabled",Y)),Ye.push(()=>tt(b,"codeInterpreterEnabled",Xe)),Ye.push(()=>tt(b,"webSearchEnabled",Ke)),Ye.push(()=>tt(b,"atSelectedModel",mt)),b.$on("upload",o[32]),b.$on("submit",o[33]),V=new np({props:{suggestionPrompts:((Ot=(Xt=(Bt=o[1])==null?void 0:Bt.info)==null?void 0:Xt.meta)==null?void 0:Ot.suggestion_prompts)??((Nt=(Wt=(rn=o[13][o[14]])==null?void 0:rn.info)==null?void 0:Wt.meta)==null?void 0:Nt.suggestion_prompts)??((tn=o[18])==null?void 0:tn.default_prompt_suggestions)??[],inputValue:o[2]}}),V.$on("select",o[34]),{c(){e=M("div"),X&&X.c(),t=$(),n=M("div"),r=M("div"),i=M("div"),a=M("div"),s=M("div");for(let ie=0;ie<j.length;ie+=1)j[ie].c();c=$(),u=M("div"),J.c(),f=$(),h=M("div"),_=M("div"),ce&&ce.c(),v=$(),m=M("div"),te(b.$$.fragment),q=$(),W=M("div"),A=M("div"),te(V.$$.fragment),this.h()},l(ie){e=P(ie,"DIV",{class:!0});var Ge=I(e);X&&X.l(Ge),t=ee(Ge),n=P(Ge,"DIV",{class:!0});var nt=I(n);r=P(nt,"DIV",{class:!0});var vt=I(r);i=P(vt,"DIV",{class:!0});var Me=I(i);a=P(Me,"DIV",{class:!0});var Yt=I(a);s=P(Yt,"DIV",{class:!0});var Tt=I(s);for(let Rt=0;Rt<j.length;Rt+=1)j[Rt].l(Tt);Tt.forEach(p),Yt.forEach(p),c=ee(Me),u=P(Me,"DIV",{class:!0});var he=I(u);J.l(he),he.forEach(p),Me.forEach(p),f=ee(vt),h=P(vt,"DIV",{class:!0});var qe=I(h);_=P(qe,"DIV",{});var Oe=I(_);ce&&ce.l(Oe),Oe.forEach(p),qe.forEach(p),v=ee(vt),m=P(vt,"DIV",{class:!0});var $e=I(m);re(b.$$.fragment,$e),$e.forEach(p),vt.forEach(p),nt.forEach(p),q=ee(Ge),W=P(Ge,"DIV",{class:!0});var It=I(W);A=P(It,"DIV",{class:!0});var kt=I(A);re(V.$$.fragment,kt),kt.forEach(p),It.forEach(p),Ge.forEach(p),this.h()},h(){g(s,"class","flex -space-x-4 mb-0.5"),g(a,"class","flex shrink-0 justify-center"),g(u,"class","text-3xl @sm:text-4xl line-clamp-1"),g(i,"class","flex flex-row justify-center gap-3 @sm:gap-3.5 w-fit px-5"),g(h,"class","flex mt-1 mb-2"),g(m,"class",F="text-base font-normal @md:max-w-3xl w-full py-3 "+(o[1]?"mt-2":"")),g(r,"class","w-full flex flex-col justify-center items-center"),g(n,"class","w-full text-3xl text-gray-800 dark:text-gray-100 text-center flex items-center gap-4 font-primary"),g(A,"class","mx-5"),g(W,"class","mx-auto max-w-2xl font-primary"),g(e,"class","m-auto w-full max-w-6xl px-2 @2xl:px-20 translate-y-6 py-24 text-center")},m(ie,Ge){U(ie,e,Ge),X&&X.m(e,null),k(e,t),k(e,n),k(n,r),k(r,i),k(i,a),k(a,s);for(let nt=0;nt<j.length;nt+=1)j[nt]&&j[nt].m(s,null);k(i,c),k(i,u),J.m(u,null),k(r,f),k(r,h),k(h,_),ce&&ce.m(_,null),k(r,v),k(r,m),ne(b,m,null),k(e,q),k(e,W),k(W,A),ne(V,A,null),G=!0},p(ie,Ge){var Me,Yt,Tt,he,qe,Oe,$e,It,kt,Rt;if(ie[16]?X?Ge[0]&65536&&T(X,1):(X=eu(ie),X.c(),T(X,1),X.m(e,t)):X&&(Le(),D(X,1,1,()=>{X=null}),Ue()),Ge[0]&57344){Q=Pt(ie[13]);let pt;for(pt=0;pt<Q.length;pt+=1){const dn=$c(ie,Q,pt);j[pt]?(j[pt].p(dn,Ge),T(j[pt],1)):(j[pt]=tu(dn),j[pt].c(),T(j[pt],1),j[pt].m(s,null))}for(Le(),pt=Q.length;pt<j.length;pt+=1)ue(pt);Ue()}x===(x=B(ie))&&J?J.p(ie,Ge):(J.d(1),J=x(ie),J&&(J.c(),J.m(u,null))),((Tt=(Yt=(Me=ie[13][ie[14]])==null?void 0:Me.info)==null?void 0:Yt.meta)==null?void 0:Tt.description)??null?ce?(ce.p(ie,Ge),Ge[0]&24576&&T(ce,1)):(ce=nu(ie),ce.c(),T(ce,1),ce.m(_,null)):ce&&(Le(),D(ce,1,1,()=>{ce=null}),Ue());const nt={};Ge[0]&4096&&(nt.history=ie[12]),Ge[0]&2048&&(nt.selectedModels=ie[11]),Ge[0]&256&&(nt.transparentBackground=ie[8]),Ge[0]&1024&&(nt.stopResponse=ie[10]),Ge[0]&512&&(nt.createMessagePair=ie[9]),Ge[0]&32768&&(nt.placeholder=ie[15].t("How can I help you today?")),!w&&Ge[0]&8&&(w=!0,nt.files=ie[3],et(()=>w=!1)),!C&&Ge[0]&4&&(C=!0,nt.prompt=ie[2],et(()=>C=!1)),!O&&Ge[0]&1&&(O=!0,nt.autoScroll=ie[0],et(()=>O=!1)),!S&&Ge[0]&16&&(S=!0,nt.selectedToolIds=ie[4],et(()=>S=!1)),!E&&Ge[0]&32&&(E=!0,nt.imageGenerationEnabled=ie[5],et(()=>E=!1)),!H&&Ge[0]&64&&(H=!0,nt.codeInterpreterEnabled=ie[6],et(()=>H=!1)),!R&&Ge[0]&128&&(R=!0,nt.webSearchEnabled=ie[7],et(()=>R=!1)),!L&&Ge[0]&2&&(L=!0,nt.atSelectedModel=ie[1],et(()=>L=!1)),b.$set(nt),(!G||Ge[0]&2&&F!==(F="text-base font-normal @md:max-w-3xl w-full py-3 "+(ie[1]?"mt-2":"")))&&g(m,"class",F);const vt={};Ge[0]&286722&&(vt.suggestionPrompts=((Oe=(qe=(he=ie[1])==null?void 0:he.info)==null?void 0:qe.meta)==null?void 0:Oe.suggestion_prompts)??((kt=(It=($e=ie[13][ie[14]])==null?void 0:$e.info)==null?void 0:It.meta)==null?void 0:kt.suggestion_prompts)??((Rt=ie[18])==null?void 0:Rt.default_prompt_suggestions)??[]),Ge[0]&4&&(vt.inputValue=ie[2]),V.$set(vt)},i(ie){if(!G){T(X);for(let Ge=0;Ge<Q.length;Ge+=1)T(j[Ge]);ie&&(l||pr(()=>{l=Ui(s,zi,{duration:100}),l.start()})),ie&&(d||pr(()=>{d=Ui(u,zi,{duration:100}),d.start()})),T(ce),ie&&(y||pr(()=>{y=Ui(_,zi,{duration:100,delay:50}),y.start()})),T(b.$$.fragment,ie),T(V.$$.fragment,ie),ie&&(N||pr(()=>{N=Ui(W,zi,{duration:200,delay:200}),N.start()})),G=!0}},o(ie){D(X),j=j.filter(Boolean);for(let Ge=0;Ge<j.length;Ge+=1)D(j[Ge]);D(ce),D(b.$$.fragment,ie),D(V.$$.fragment,ie),G=!1},d(ie){ie&&p(e),X&&X.d(),so(j,ie),J.d(),ce&&ce.d(),oe(b),oe(V)}}}const ru=o=>o.name.toUpperCase();function Fy(o,e,t){let n,r,i,a,s;de(o,Tr,B=>t(22,n=B)),de(o,Ss,B=>t(16,i=B)),de(o,Xo,B=>t(17,a=B)),de(o,Ci,B=>t(18,s=B));const l=Pn(),c=on("i18n");de(o,c,B=>t(15,r=B));let{transparentBackground:u=!1}=e,{createMessagePair:d}=e,{stopResponse:f}=e,{autoScroll:h=!1}=e,{atSelectedModel:_}=e,{selectedModels:y}=e,{history:v}=e,{prompt:m=""}=e,{files:b=[]}=e,{selectedToolIds:w=[]}=e,{imageGenerationEnabled:C=!1}=e,{codeInterpreterEnabled:O=!1}=e,{webSearchEnabled:S=!1}=e,E=[];const H=async B=>{let x=B;if(B.includes("{{CLIPBOARD}}")){const me=await navigator.clipboard.readText().catch(se=>(at.error(r.t("Failed to read clipboard contents")),"{{CLIPBOARD}}"));x=B.replaceAll("{{CLIPBOARD}}",me),console.log("Clipboard text:",me,x)}t(2,m=x),console.log(m),await rt();const J=document.getElementById("chat-input-container"),ce=document.getElementById("chat-input");J&&(J.style.height="",J.style.height=Math.min(J.scrollHeight,200)+"px"),await rt(),ce&&(ce.focus(),ce.dispatchEvent(new Event("input"))),await rt()};let R=0;Jn(()=>{});const L=B=>{t(14,R=B)};function F(B){b=B,t(3,b)}function q(B){m=B,t(2,m)}function W(B){h=B,t(0,h)}function A(B){w=B,t(4,w)}function V(B){C=B,t(5,C)}function N(B){O=B,t(6,O)}function G(B){S=B,t(7,S)}function X(B){_=B,t(1,_)}const Q=B=>{l("upload",B.detail)},j=B=>{l("submit",B.detail)},ue=B=>{H(B.detail)};return o.$$set=B=>{"transparentBackground"in B&&t(8,u=B.transparentBackground),"createMessagePair"in B&&t(9,d=B.createMessagePair),"stopResponse"in B&&t(10,f=B.stopResponse),"autoScroll"in B&&t(0,h=B.autoScroll),"atSelectedModel"in B&&t(1,_=B.atSelectedModel),"selectedModels"in B&&t(11,y=B.selectedModels),"history"in B&&t(12,v=B.history),"prompt"in B&&t(2,m=B.prompt),"files"in B&&t(3,b=B.files),"selectedToolIds"in B&&t(4,w=B.selectedToolIds),"imageGenerationEnabled"in B&&t(5,C=B.imageGenerationEnabled),"codeInterpreterEnabled"in B&&t(6,O=B.codeInterpreterEnabled),"webSearchEnabled"in B&&t(7,S=B.webSearchEnabled)},o.$$.update=()=>{o.$$.dirty[0]&4196352&&t(13,E=y.map(B=>n.find(x=>x.id===B))),o.$$.dirty[0]&10240&&y.length>0&&t(14,R=E.length-1)},[h,_,m,b,w,C,O,S,u,d,f,y,v,E,R,r,i,a,s,l,c,H,n,L,F,q,W,A,V,N,G,X,Q,j,ue]}class Ky extends Ve{constructor(e){super(),Fe(this,e,Fy,Vy,Qe,{transparentBackground:8,createMessagePair:9,stopResponse:10,autoScroll:0,atSelectedModel:1,selectedModels:11,history:12,prompt:2,files:3,selectedToolIds:4,imageGenerationEnabled:5,codeInterpreterEnabled:6,webSearchEnabled:7},null,[-1,-1])}}function iu(o,e,t){const n=o.slice();return n[92]=e[t],n[94]=t,n}function su(o,e,t){const n=o.slice();return n[95]=e[t],n[97]=t,n}function au(o){var G,X;let e,t,n,r,i,a,s,l,c,u,d,f,h,_,y,v,m,b,w,C,O,S,E,H,R=o[6]===!1&&((G=o[12])==null?void 0:G.currentId)&&lu(o),L=(o[0]!==void 0||o[3].length>0||o[5]||(((X=o[25])==null?void 0:X.webSearch)??!1)==="always"||o[4]||o[7])&&cu(o);function F(Q){o[45](Q)}function q(Q){o[46](Q)}let W={};o[1]!==void 0&&(W.prompt=o[1]),o[2]!==void 0&&(W.files=o[2]),l=new Cy({props:W}),o[44](l),Ye.push(()=>tt(l,"prompt",F)),Ye.push(()=>tt(l,"files",q)),l.$on("upload",o[47]),l.$on("select",o[48]);const A=[Yy,Wy],V=[];function N(Q,j){return Q[17]?0:1}return b=N(o),w=V[b]=A[b](o),{c(){e=M("div"),t=M("div"),n=M("div"),r=M("div"),R&&R.c(),i=$(),a=M("div"),L&&L.c(),s=$(),te(l.$$.fragment),f=$(),h=M("div"),_=M("div"),y=M("div"),v=M("input"),m=$(),w.c(),this.h()},l(Q){e=P(Q,"DIV",{class:!0});var j=I(e);t=P(j,"DIV",{class:!0});var ue=I(t);n=P(ue,"DIV",{class:!0});var B=I(n);r=P(B,"DIV",{class:!0});var x=I(r);R&&R.l(x),x.forEach(p),i=ee(B),a=P(B,"DIV",{class:!0});var J=I(a);L&&L.l(J),s=ee(J),re(l.$$.fragment,J),J.forEach(p),B.forEach(p),ue.forEach(p),f=ee(j),h=P(j,"DIV",{class:!0});var ce=I(h);_=P(ce,"DIV",{class:!0});var me=I(_);y=P(me,"DIV",{class:!0});var se=I(y);v=P(se,"INPUT",{type:!0}),m=ee(se),w.l(se),se.forEach(p),me.forEach(p),ce.forEach(p),j.forEach(p),this.h()},h(){var Q,j;g(r,"class","relative"),g(a,"class","w-full relative"),g(n,"class",d="flex flex-col px-3 "+(((Q=o[25])==null?void 0:Q.widescreenMode)??null?"max-w-full":"max-w-6xl")+" w-full"),g(t,"class","mx-auto inset-x-0 bg-transparent flex justify-center"),g(v,"type","file"),v.hidden=!0,v.multiple=!0,g(y,"class",""),g(_,"class",C=(((j=o[25])==null?void 0:j.widescreenMode)??null?"max-w-full":"max-w-6xl")+" px-2.5 mx-auto inset-x-0"),g(h,"class",O=o[8]?"bg-transparent":"bg-white dark:bg-gray-900"),g(e,"class","w-full font-primary")},m(Q,j){U(Q,e,j),k(e,t),k(t,n),k(n,r),R&&R.m(r,null),k(n,i),k(n,a),L&&L.m(a,null),k(a,s),ne(l,a,null),k(e,f),k(e,h),k(h,_),k(_,y),k(y,v),o[49](v),k(y,m),V[b].m(y,null),S=!0,E||(H=[Ie(v,"change",o[50]),Ie(v,"change",o[51])],E=!0)},p(Q,j){var x,J,ce,me;Q[6]===!1&&((x=Q[12])!=null&&x.currentId)?R?R.p(Q,j):(R=lu(Q),R.c(),R.m(r,null)):R&&(R.d(1),R=null),Q[0]!==void 0||Q[3].length>0||Q[5]||(((J=Q[25])==null?void 0:J.webSearch)??!1)==="always"||Q[4]||Q[7]?L?(L.p(Q,j),j[0]&33554617&&T(L,1)):(L=cu(Q),L.c(),T(L,1),L.m(a,s)):L&&(Le(),D(L,1,1,()=>{L=null}),Ue());const ue={};!c&&j[0]&2&&(c=!0,ue.prompt=Q[1],et(()=>c=!1)),!u&&j[0]&4&&(u=!0,ue.files=Q[2],et(()=>u=!1)),l.$set(ue),(!S||j[0]&33554432&&d!==(d="flex flex-col px-3 "+(((ce=Q[25])==null?void 0:ce.widescreenMode)??null?"max-w-full":"max-w-6xl")+" w-full"))&&g(n,"class",d);let B=b;b=N(Q),b===B?V[b].p(Q,j):(Le(),D(V[B],1,1,()=>{V[B]=null}),Ue(),w=V[b],w?w.p(Q,j):(w=V[b]=A[b](Q),w.c()),T(w,1),w.m(y,null)),(!S||j[0]&33554432&&C!==(C=(((me=Q[25])==null?void 0:me.widescreenMode)??null?"max-w-full":"max-w-6xl")+" px-2.5 mx-auto inset-x-0"))&&g(_,"class",C),(!S||j[0]&256&&O!==(O=Q[8]?"bg-transparent":"bg-white dark:bg-gray-900"))&&g(h,"class",O)},i(Q){S||(T(L),T(l.$$.fragment,Q),T(w),S=!0)},o(Q){D(L),D(l.$$.fragment,Q),D(w),S=!1},d(Q){Q&&p(e),R&&R.d(),L&&L.d(),o[44](null),oe(l),o[49](null),V[b].d(),E=!1,kn(H)}}}function lu(o){let e,t,n='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd"></path></svg>',r,i;return{c(){e=M("div"),t=M("button"),t.innerHTML=n,this.h()},l(a){e=P(a,"DIV",{class:!0});var s=I(e);t=P(s,"BUTTON",{class:!0,"data-svelte-h":!0}),wt(t)!=="svelte-h8r9o0"&&(t.innerHTML=n),s.forEach(p),this.h()},h(){g(t,"class","bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full pointer-events-auto"),g(e,"class","absolute -top-12 left-0 right-0 flex justify-center z-30 pointer-events-none")},m(a,s){U(a,e,s),k(e,t),r||(i=Ie(t,"click",o[40]),r=!0)},p:Re,d(a){a&&p(e),r=!1,i()}}}function cu(o){var f,h,_;let e,t,n,r,i,a,s=o[3].length>0&&uu(o),l=(o[5]||(((h=(f=o[27])==null?void 0:f.features)==null?void 0:h.enable_web_search)&&(((_=o[25])==null?void 0:_.webSearch)??!1))==="always")&&hu(o),c=o[4]&&gu(o),u=o[7]&&mu(o),d=o[0]!==void 0&&pu(o);return{c(){e=M("div"),s&&s.c(),t=$(),l&&l.c(),n=$(),c&&c.c(),r=$(),u&&u.c(),i=$(),d&&d.c(),this.h()},l(y){e=P(y,"DIV",{class:!0});var v=I(e);s&&s.l(v),t=ee(v),l&&l.l(v),n=ee(v),c&&c.l(v),r=ee(v),u&&u.l(v),i=ee(v),d&&d.l(v),v.forEach(p),this.h()},h(){g(e,"class","px-3 pb-0.5 pt-1.5 text-left w-full flex flex-col absolute bottom-0 left-0 right-0 bg-linear-to-t from-white dark:from-gray-900 z-10")},m(y,v){U(y,e,v),s&&s.m(e,null),k(e,t),l&&l.m(e,null),k(e,n),c&&c.m(e,null),k(e,r),u&&u.m(e,null),k(e,i),d&&d.m(e,null),a=!0},p(y,v){var m,b,w;y[3].length>0?s?(s.p(y,v),v[0]&8&&T(s,1)):(s=uu(y),s.c(),T(s,1),s.m(e,t)):s&&(Le(),D(s,1,1,()=>{s=null}),Ue()),y[5]||(((b=(m=y[27])==null?void 0:m.features)==null?void 0:b.enable_web_search)&&(((w=y[25])==null?void 0:w.webSearch)??!1))==="always"?l?l.p(y,v):(l=hu(y),l.c(),l.m(e,n)):l&&(l.d(1),l=null),y[4]?c?c.p(y,v):(c=gu(y),c.c(),c.m(e,r)):c&&(c.d(1),c=null),y[7]?u?u.p(y,v):(u=mu(y),u.c(),u.m(e,i)):u&&(u.d(1),u=null),y[0]!==void 0?d?(d.p(y,v),v[0]&1&&T(d,1)):(d=pu(y),d.c(),T(d,1),d.m(e,null)):d&&(Le(),D(d,1,1,()=>{d=null}),Ue())},i(y){a||(T(s),T(d),a=!0)},o(y){D(s),D(d),a=!1},d(y){y&&p(e),s&&s.d(),l&&l.d(),c&&c.d(),u&&u.d(),d&&d.d()}}}function uu(o){let e,t,n,r='<span class="relative flex size-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"></span> <span class="relative inline-flex rounded-full size-2 bg-yellow-500"></span></span>',i,a,s=[],l=new Map,c,u=Pt(o[3].map(o[41]));const d=f=>f[97];for(let f=0;f<u.length;f+=1){let h=su(o,u,f),_=d(h);l.set(_,s[f]=fu(_,h))}return{c(){e=M("div"),t=M("div"),n=M("div"),n.innerHTML=r,i=$(),a=M("div");for(let f=0;f<s.length;f+=1)s[f].c();this.h()},l(f){e=P(f,"DIV",{class:!0});var h=I(e);t=P(h,"DIV",{class:!0});var _=I(t);n=P(_,"DIV",{class:!0,"data-svelte-h":!0}),wt(n)!=="svelte-1exsj7u"&&(n.innerHTML=r),i=ee(_),a=P(_,"DIV",{class:!0});var y=I(a);for(let v=0;v<s.length;v+=1)s[v].l(y);y.forEach(p),_.forEach(p),h.forEach(p),this.h()},h(){g(n,"class","pl-1"),g(a,"class","text-ellipsis line-clamp-1 flex"),g(t,"class","flex items-center gap-2.5 text-sm dark:text-gray-500"),g(e,"class","flex items-center justify-between w-full")},m(f,h){U(f,e,h),k(e,t),k(t,n),k(t,i),k(t,a);for(let _=0;_<s.length;_+=1)s[_]&&s[_].m(a,null);c=!0},p(f,h){h[0]&536870920&&(u=Pt(f[3].map(f[41])),Le(),s=Is(s,h,d,1,f,u,l,a,Ts,fu,null,su),Ue())},i(f){if(!c){for(let h=0;h<u.length;h+=1)T(s[h]);c=!0}},o(f){for(let h=0;h<s.length;h+=1)D(s[h]);c=!1},d(f){f&&p(e);for(let h=0;h<s.length;h+=1)s[h].d()}}}function Gy(o){let e=o[95].name+"",t;return{c(){t=Se(e)},l(n){t=Ae(n,e)},m(n,r){U(n,t,r)},p(n,r){r[0]&536870920&&e!==(e=n[95].name+"")&&Ne(t,e)},d(n){n&&p(t)}}}function du(o){let e,t=", ";return{c(){e=M("span"),e.textContent=t},l(n){e=P(n,"SPAN",{"data-svelte-h":!0}),wt(e)!=="svelte-1okzske"&&(e.textContent=t)},m(n,r){U(n,e,r)},d(n){n&&p(e)}}}function fu(o,e){var l,c;let t,n,r,i,a;n=new Gt({props:{content:((c=(l=e[95])==null?void 0:l.meta)==null?void 0:c.description)??"",className:" "+(e[97]!==0?"pl-0.5":"")+" shrink-0",placement:"top",$$slots:{default:[Gy]},$$scope:{ctx:e}}});let s=e[97]!==e[3].length-1&&du();return{key:o,first:null,c(){t=je(),te(n.$$.fragment),r=$(),s&&s.c(),i=je(),this.h()},l(u){t=je(),re(n.$$.fragment,u),r=ee(u),s&&s.l(u),i=je(),this.h()},h(){this.first=t},m(u,d){U(u,t,d),ne(n,u,d),U(u,r,d),s&&s.m(u,d),U(u,i,d),a=!0},p(u,d){var h,_;e=u;const f={};d[0]&536870920&&(f.content=((_=(h=e[95])==null?void 0:h.meta)==null?void 0:_.description)??""),d[0]&536870920&&(f.className=" "+(e[97]!==0?"pl-0.5":"")+" shrink-0"),d[0]&536870920|d[3]&32&&(f.$$scope={dirty:d,ctx:e}),n.$set(f),e[97]!==e[3].length-1?s||(s=du(),s.c(),s.m(i.parentNode,i)):s&&(s.d(1),s=null)},i(u){a||(T(n.$$.fragment,u),a=!0)},o(u){D(n.$$.fragment,u),a=!1},d(u){u&&(p(t),p(r),p(i)),oe(n,u),s&&s.d(u)}}}function hu(o){let e,t,n,r='<span class="relative flex size-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span> <span class="relative inline-flex rounded-full size-2 bg-blue-500"></span></span>',i,a,s=o[26].t("Search the internet")+"",l;return{c(){e=M("div"),t=M("div"),n=M("div"),n.innerHTML=r,i=$(),a=M("div"),l=Se(s),this.h()},l(c){e=P(c,"DIV",{class:!0});var u=I(e);t=P(u,"DIV",{class:!0});var d=I(t);n=P(d,"DIV",{class:!0,"data-svelte-h":!0}),wt(n)!=="svelte-19sghfm"&&(n.innerHTML=r),i=ee(d),a=P(d,"DIV",{class:!0});var f=I(a);l=Ae(f,s),f.forEach(p),d.forEach(p),u.forEach(p),this.h()},h(){g(n,"class","pl-1"),g(a,"class","translate-y-[0.5px]"),g(t,"class","flex items-center gap-2.5 text-sm dark:text-gray-500"),g(e,"class","flex items-center justify-between w-full")},m(c,u){U(c,e,u),k(e,t),k(t,n),k(t,i),k(t,a),k(a,l)},p(c,u){u[0]&67108864&&s!==(s=c[26].t("Search the internet")+"")&&Ne(l,s)},d(c){c&&p(e)}}}function gu(o){let e,t,n,r='<span class="relative flex size-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-teal-400 opacity-75"></span> <span class="relative inline-flex rounded-full size-2 bg-teal-500"></span></span>',i,a,s=o[26].t("Generate an image")+"",l;return{c(){e=M("div"),t=M("div"),n=M("div"),n.innerHTML=r,i=$(),a=M("div"),l=Se(s),this.h()},l(c){e=P(c,"DIV",{class:!0});var u=I(e);t=P(u,"DIV",{class:!0});var d=I(t);n=P(d,"DIV",{class:!0,"data-svelte-h":!0}),wt(n)!=="svelte-kf1e3u"&&(n.innerHTML=r),i=ee(d),a=P(d,"DIV",{class:!0});var f=I(a);l=Ae(f,s),f.forEach(p),d.forEach(p),u.forEach(p),this.h()},h(){g(n,"class","pl-1"),g(a,"class","translate-y-[0.5px]"),g(t,"class","flex items-center gap-2.5 text-sm dark:text-gray-500"),g(e,"class","flex items-center justify-between w-full")},m(c,u){U(c,e,u),k(e,t),k(t,n),k(t,i),k(t,a),k(a,l)},p(c,u){u[0]&67108864&&s!==(s=c[26].t("Generate an image")+"")&&Ne(l,s)},d(c){c&&p(e)}}}function mu(o){let e,t,n,r='<span class="relative flex size-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span> <span class="relative inline-flex rounded-full size-2 bg-green-500"></span></span>',i,a,s=o[26].t("Execute code for analysis")+"",l;return{c(){e=M("div"),t=M("div"),n=M("div"),n.innerHTML=r,i=$(),a=M("div"),l=Se(s),this.h()},l(c){e=P(c,"DIV",{class:!0});var u=I(e);t=P(u,"DIV",{class:!0});var d=I(t);n=P(d,"DIV",{class:!0,"data-svelte-h":!0}),wt(n)!=="svelte-12j611w"&&(n.innerHTML=r),i=ee(d),a=P(d,"DIV",{class:!0});var f=I(a);l=Ae(f,s),f.forEach(p),d.forEach(p),u.forEach(p),this.h()},h(){g(n,"class","pl-1"),g(a,"class","translate-y-[0.5px]"),g(t,"class","flex items-center gap-2.5 text-sm dark:text-gray-500"),g(e,"class","flex items-center justify-between w-full")},m(c,u){U(c,e,u),k(e,t),k(t,n),k(t,i),k(t,a),k(a,l)},p(c,u){u[0]&67108864&&s!==(s=c[26].t("Execute code for analysis")+"")&&Ne(l,s)},d(c){c&&p(e)}}}function pu(o){let e,t,n,r,i,a,s,l,c=o[0].name+"",u,d,f,h,_,y,v,m;return _=new Os({}),{c(){e=M("div"),t=M("div"),n=M("img"),i=$(),a=M("div"),s=Se("Talking to "),l=M("span"),u=Se(c),d=$(),f=M("div"),h=M("button"),te(_.$$.fragment),this.h()},l(b){e=P(b,"DIV",{class:!0});var w=I(e);t=P(w,"DIV",{class:!0});var C=I(t);n=P(C,"IMG",{crossorigin:!0,alt:!0,class:!0,src:!0}),i=ee(C),a=P(C,"DIV",{class:!0});var O=I(a);s=Ae(O,"Talking to "),l=P(O,"SPAN",{class:!0});var S=I(l);u=Ae(S,c),S.forEach(p),O.forEach(p),C.forEach(p),d=ee(w),f=P(w,"DIV",{});var E=I(f);h=P(E,"BUTTON",{class:!0});var H=I(h);re(_.$$.fragment,H),H.forEach(p),E.forEach(p),w.forEach(p),this.h()},h(){var b,w,C;g(n,"crossorigin","anonymous"),g(n,"alt","model profile"),g(n,"class","size-3.5 max-w-[28px] object-cover rounded-full"),qo(n.src,r=((C=(w=(b=o[14].find(o[42]))==null?void 0:b.info)==null?void 0:w.meta)==null?void 0:C.profile_image_url)??(o[26].language==="dg-DG"?"/doge.png":`${hi}/static/favicon.png`))||g(n,"src",r),g(l,"class","font-medium"),g(a,"class","translate-y-[0.5px]"),g(t,"class","pl-[1px] flex items-center gap-2 text-sm dark:text-gray-500"),g(h,"class","flex items-center dark:text-gray-500"),g(e,"class","flex items-center justify-between w-full")},m(b,w){U(b,e,w),k(e,t),k(t,n),k(t,i),k(t,a),k(a,s),k(a,l),k(l,u),k(e,d),k(e,f),k(f,h),ne(_,h,null),y=!0,v||(m=Ie(h,"click",o[43]),v=!0)},p(b,w){var C,O,S;(!y||w[0]&67125249&&!qo(n.src,r=((S=(O=(C=b[14].find(b[42]))==null?void 0:C.info)==null?void 0:O.meta)==null?void 0:S.profile_image_url)??(b[26].language==="dg-DG"?"/doge.png":`${hi}/static/favicon.png`)))&&g(n,"src",r),(!y||w[0]&1)&&c!==(c=b[0].name+"")&&Ne(u,c)},i(b){y||(T(_.$$.fragment,b),y=!0)},o(b){D(_.$$.fragment,b),y=!1},d(b){b&&p(e),oe(_),v=!1,m()}}}function Wy(o){var X,Q;let e,t,n,r,i,a,s,l,c,u,d,f,h,_,y,v,m,b,w,C,O,S,E=o[2].length>0&&_u(o);const H=[Jy,Xy],R=[];function L(j,ue){var B;return((B=j[25])==null?void 0:B.richTextInput)??!0?0:1}i=L(o),a=R[i]=H[i](o);function F(j){o[78](j)}let q={screenCaptureHandler:o[36],inputFilesHandler:o[38],uploadFilesHandler:o[74],uploadGoogleDriveHandler:o[75],uploadOneDriveHandler:o[76],onClose:o[77],$$slots:{default:[xy]},$$scope:{ctx:o}};o[3]!==void 0&&(q.selectedToolIds=o[3]),u=new xb({props:q}),Ye.push(()=>tt(u,"selectedToolIds",F));let W=o[28]&&vu(o),A=(!((X=o[12])!=null&&X.currentId)||((Q=o[12].messages[o[12].currentId])==null?void 0:Q.done)==!0)&&Eu(o);const V=[rv,ov],N=[];function G(j,ue){var B;return!j[12].currentId||((B=j[12].messages[j[12].currentId])==null?void 0:B.done)==!0?0:1}return m=G(o),b=N[m]=V[m](o),{c(){e=M("form"),t=M("div"),E&&E.c(),n=$(),r=M("div"),a.c(),s=$(),l=M("div"),c=M("div"),te(u.$$.fragment),f=$(),h=M("div"),W&&W.c(),_=$(),y=M("div"),A&&A.c(),v=$(),b.c(),this.h()},l(j){e=P(j,"FORM",{class:!0});var ue=I(e);t=P(ue,"DIV",{class:!0,dir:!0});var B=I(t);E&&E.l(B),n=ee(B),r=P(B,"DIV",{class:!0});var x=I(r);a.l(x),x.forEach(p),s=ee(B),l=P(B,"DIV",{class:!0});var J=I(l);c=P(J,"DIV",{class:!0});var ce=I(c);re(u.$$.fragment,ce),f=ee(ce),h=P(ce,"DIV",{class:!0});var me=I(h);W&&W.l(me),me.forEach(p),ce.forEach(p),_=ee(J),y=P(J,"DIV",{class:!0});var se=I(y);A&&A.l(se),v=ee(se),b.l(se),se.forEach(p),J.forEach(p),B.forEach(p),ue.forEach(p),this.h()},h(){var j;g(r,"class","px-2.5"),g(h,"class","flex gap-0.5 items-center overflow-x-auto scrollbar-none flex-1"),g(c,"class","ml-1 self-end gap-0.5 flex items-center flex-1 max-w-[80%]"),g(y,"class","self-end flex space-x-1 mr-1 shrink-0"),g(l,"class","flex justify-between mt-1.5 mb-2.5 mx-0.5 max-w-full"),g(t,"class","flex-1 flex flex-col relative w-full rounded-3xl px-1 bg-gray-600/5 dark:bg-gray-400/5 dark:text-gray-100"),g(t,"dir",w=((j=o[25])==null?void 0:j.chatDirection)??"LTR"),g(e,"class","w-full flex gap-1.5")},m(j,ue){U(j,e,ue),k(e,t),E&&E.m(t,null),k(t,n),k(t,r),R[i].m(r,null),k(t,s),k(t,l),k(l,c),ne(u,c,null),k(c,f),k(c,h),W&&W.m(h,null),k(l,_),k(l,y),A&&A.m(y,null),k(y,v),N[m].m(y,null),C=!0,O||(S=Ie(e,"submit",Jr(o[86])),O=!0)},p(j,ue){var ce,me,se;j[2].length>0?E?(E.p(j,ue),ue[0]&4&&T(E,1)):(E=_u(j),E.c(),T(E,1),E.m(t,n)):E&&(Le(),D(E,1,1,()=>{E=null}),Ue());let B=i;i=L(j),i===B?R[i].p(j,ue):(Le(),D(R[B],1,1,()=>{R[B]=null}),Ue(),a=R[i],a?a.p(j,ue):(a=R[i]=H[i](j),a.c()),T(a,1),a.m(r,null));const x={};ue[0]&1048576&&(x.uploadFilesHandler=j[74]),ue[0]&67108864&&(x.uploadGoogleDriveHandler=j[75]),ue[3]&32&&(x.$$scope={dirty:ue,ctx:j}),!d&&ue[0]&8&&(d=!0,x.selectedToolIds=j[3],et(()=>d=!1)),u.$set(x),j[28]?W?(W.p(j,ue),ue[0]&268435456&&T(W,1)):(W=vu(j),W.c(),T(W,1),W.m(h,null)):W&&(Le(),D(W,1,1,()=>{W=null}),Ue()),!((ce=j[12])!=null&&ce.currentId)||((me=j[12].messages[j[12].currentId])==null?void 0:me.done)==!0?A?(A.p(j,ue),ue[0]&4096&&T(A,1)):(A=Eu(j),A.c(),T(A,1),A.m(y,v)):A&&(Le(),D(A,1,1,()=>{A=null}),Ue());let J=m;m=G(j),m===J?N[m].p(j,ue):(Le(),D(N[J],1,1,()=>{N[J]=null}),Ue(),b=N[m],b?b.p(j,ue):(b=N[m]=V[m](j),b.c()),T(b,1),b.m(y,null)),(!C||ue[0]&33554432&&w!==(w=((se=j[25])==null?void 0:se.chatDirection)??"LTR"))&&g(t,"dir",w)},i(j){C||(T(E),T(a),T(u.$$.fragment,j),T(W),T(A),T(b),C=!0)},o(j){D(E),D(a),D(u.$$.fragment,j),D(W),D(A),D(b),C=!1},d(j){j&&p(e),E&&E.d(),R[i].d(),oe(u),W&&W.d(),A&&A.d(),N[m].d(),O=!1,S()}}}function Yy(o){let e,t,n;function r(a){o[52](a)}let i={};return o[17]!==void 0&&(i.recording=o[17]),e=new Wm({props:i}),Ye.push(()=>tt(e,"recording",r)),e.$on("cancel",o[53]),e.$on("confirm",o[54]),{c(){te(e.$$.fragment)},l(a){re(e.$$.fragment,a)},m(a,s){ne(e,a,s),n=!0},p(a,s){const l={};!t&&s[0]&131072&&(t=!0,l.recording=a[17],et(()=>t=!1)),e.$set(l)},i(a){n||(T(e.$$.fragment,a),n=!0)},o(a){D(e.$$.fragment,a),n=!1},d(a){oe(e,a)}}}function _u(o){let e,t,n=Pt(o[2]),r=[];for(let a=0;a<n.length;a+=1)r[a]=yu(iu(o,n,a));const i=a=>D(r[a],1,1,()=>{r[a]=null});return{c(){e=M("div");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){e=P(a,"DIV",{class:!0});var s=I(e);for(let l=0;l<r.length;l+=1)r[l].l(s);s.forEach(p),this.h()},h(){g(e,"class","mx-2 mt-2.5 -mb-1 flex items-center flex-wrap gap-2")},m(a,s){U(a,e,s);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(e,null);t=!0},p(a,s){if(s[0]&83888133){n=Pt(a[2]);let l;for(l=0;l<n.length;l+=1){const c=iu(a,n,l);r[l]?(r[l].p(c,s),T(r[l],1)):(r[l]=yu(c),r[l].c(),T(r[l],1),r[l].m(e,null))}for(Le(),l=n.length;l<r.length;l+=1)i(l);Ue()}},i(a){if(!t){for(let s=0;s<n.length;s+=1)T(r[s]);t=!0}},o(a){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)D(r[s]);t=!1},d(a){a&&p(e),so(r,a)}}}function qy(o){var i;let e,t;function n(){return o[57](o[92],o[94])}function r(){return o[58](o[92])}return e=new of({props:{item:o[92],name:o[92].name,type:o[92].type,size:(i=o[92])==null?void 0:i.size,loading:o[92].status==="uploading",dismissible:!0,edit:!0}}),e.$on("dismiss",n),e.$on("click",r),{c(){te(e.$$.fragment)},l(a){re(e.$$.fragment,a)},m(a,s){ne(e,a,s),t=!0},p(a,s){var c;o=a;const l={};s[0]&4&&(l.item=o[92]),s[0]&4&&(l.name=o[92].name),s[0]&4&&(l.type=o[92].type),s[0]&4&&(l.size=(c=o[92])==null?void 0:c.size),s[0]&4&&(l.loading=o[92].status==="uploading"),e.$set(l)},i(a){t||(T(e.$$.fragment,a),t=!0)},o(a){D(e.$$.fragment,a),t=!1},d(a){oe(e,a)}}}function jy(o){let e,t,n,r,i,a,s,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-4"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg>',c,u,d,f;n=new xm({props:{src:o[92].url,alt:"input",imageClassName:" size-14 rounded-xl object-cover"}});let h=(o[0]?o[24].length===0:o[11].length!==o[24].length)&&bu(o);function _(){return o[56](o[94])}return{c(){e=M("div"),t=M("div"),te(n.$$.fragment),r=$(),h&&h.c(),i=$(),a=M("div"),s=M("button"),s.innerHTML=l,c=$(),this.h()},l(y){e=P(y,"DIV",{class:!0});var v=I(e);t=P(v,"DIV",{class:!0});var m=I(t);re(n.$$.fragment,m),r=ee(m),h&&h.l(m),m.forEach(p),i=ee(v),a=P(v,"DIV",{class:!0});var b=I(a);s=P(b,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),wt(s)!=="svelte-4ewxlv"&&(s.innerHTML=l),b.forEach(p),c=ee(v),v.forEach(p),this.h()},h(){g(t,"class","relative flex items-center"),g(s,"class","bg-white text-black border border-white rounded-full group-hover:visible invisible transition"),g(s,"type","button"),g(a,"class","absolute -top-1 -right-1"),g(e,"class","relative group")},m(y,v){U(y,e,v),k(e,t),ne(n,t,null),k(t,r),h&&h.m(t,null),k(e,i),k(e,a),k(a,s),k(e,c),u=!0,d||(f=Ie(s,"click",_),d=!0)},p(y,v){o=y;const m={};v[0]&4&&(m.src=o[92].url),n.$set(m),(o[0]?o[24].length===0:o[11].length!==o[24].length)?h?(h.p(o,v),v[0]&16779265&&T(h,1)):(h=bu(o),h.c(),T(h,1),h.m(t,null)):h&&(Le(),D(h,1,1,()=>{h=null}),Ue())},i(y){u||(T(n.$$.fragment,y),T(h),u=!0)},o(y){D(n.$$.fragment,y),D(h),u=!1},d(y){y&&p(e),oe(n),h&&h.d(),d=!1,f()}}}function bu(o){let e,t;return e=new Gt({props:{className:" absolute top-1 left-1",content:o[26].t("{{ models }}",{models:[...o[0]?[o[0]]:o[11]].filter(o[55]).join(", ")}),$$slots:{default:[Qy]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&83888129&&(i.content=n[26].t("{{ models }}",{models:[...n[0]?[n[0]]:n[11]].filter(n[55]).join(", ")})),r[3]&32&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function Qy(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var r=I(e);t=ye(r,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"fill-rule","evenodd"),g(t,"d","M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z"),g(t,"clip-rule","evenodd"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 24 24"),g(e,"fill","currentColor"),g(e,"class","size-4 fill-yellow-300")},m(n,r){U(n,e,r),k(e,t)},p:Re,d(n){n&&p(e)}}}function yu(o){let e,t,n,r;const i=[jy,qy],a=[];function s(l,c){return l[92].type==="image"?0:1}return e=s(o),t=a[e]=i[e](o),{c(){t.c(),n=je()},l(l){t.l(l),n=je()},m(l,c){a[e].m(l,c),U(l,n,c),r=!0},p(l,c){let u=e;e=s(l),e===u?a[e].p(l,c):(Le(),D(a[u],1,1,()=>{a[u]=null}),Ue(),t=a[e],t?t.p(l,c):(t=a[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){D(t),r=!1},d(l){l&&p(n),a[e].d(l)}}}function Xy(o){let e,t,n,r;return{c(){e=M("textarea"),this.h()},l(i){e=P(i,"TEXTAREA",{id:!0,class:!0,placeholder:!0,rows:!0}),I(e).forEach(p),this.h()},h(){g(e,"id","chat-input"),g(e,"class","scrollbar-hidden bg-transparent dark:text-gray-100 outline-hidden w-full pt-3 px-1 resize-none"),g(e,"placeholder",t=o[13]?o[13]:o[26].t("Send a Message")),g(e,"rows","1")},m(i,a){U(i,e,a),o[66](e),io(e,o[1]),n||(r=[Ie(e,"input",o[67]),Ie(e,"compositionstart",o[68]),Ie(e,"compositionend",o[69]),Ie(e,"keydown",o[70]),Ie(e,"input",o[71]),Ie(e,"focus",o[72]),Ie(e,"paste",o[73])],n=!0)},p(i,a){a[0]&67117056&&t!==(t=i[13]?i[13]:i[26].t("Send a Message"))&&g(e,"placeholder",t),a[0]&2&&io(e,i[1])},i:Re,o:Re,d(i){i&&p(e),o[66](null),n=!1,kn(r)}}}function Jy(o){var s,l,c;let e,t,n,r;function i(u){o[63](u)}let a={id:"chat-input",messageInput:!0,shiftEnter:!(((s=o[25])==null?void 0:s.ctrlEnterToSend)??!1)&&(!o[30]||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)),placeholder:o[13]?o[13]:o[26].t("Send a Message"),largeTextAsFile:((l=o[25])==null?void 0:l.largeTextAsFile)??!1,autocomplete:(c=o[27])==null?void 0:c.features.enable_autocomplete_generation,generateAutoCompletion:o[59],oncompositionstart:o[60],oncompositionend:o[61]};return o[1]!==void 0&&(a.value=o[1]),t=new Ym({props:a}),o[62](t),Ye.push(()=>tt(t,"value",i)),t.$on("keydown",o[64]),t.$on("paste",o[65]),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(u){e=P(u,"DIV",{class:!0});var d=I(e);re(t.$$.fragment,d),d.forEach(p),this.h()},h(){g(e,"class","scrollbar-hidden text-left bg-transparent dark:text-gray-100 outline-hidden w-full pt-3 px-1 resize-none h-fit max-h-80 overflow-auto")},m(u,d){U(u,e,d),ne(t,e,null),r=!0},p(u,d){var h,_,y;const f={};d[0]&1107296256&&(f.shiftEnter=!(((h=u[25])==null?void 0:h.ctrlEnterToSend)??!1)&&(!u[30]||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0))),d[0]&67117056&&(f.placeholder=u[13]?u[13]:u[26].t("Send a Message")),d[0]&33554432&&(f.largeTextAsFile=((_=u[25])==null?void 0:_.largeTextAsFile)??!1),d[0]&134217728&&(f.autocomplete=(y=u[27])==null?void 0:y.features.enable_autocomplete_generation),d[0]&67145728&&(f.generateAutoCompletion=u[59]),d[0]&262144&&(f.oncompositionstart=u[60]),d[0]&262144&&(f.oncompositionend=u[61]),!n&&d[0]&2&&(n=!0,f.value=u[1],et(()=>n=!1)),t.$set(f)},i(u){r||(T(t.$$.fragment,u),r=!0)},o(u){D(t.$$.fragment,u),r=!1},d(u){u&&p(e),o[62](null),oe(t)}}}function xy(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"></path></svg>';return{c(){e=M("button"),e.innerHTML=t,this.h()},l(n){e=P(n,"BUTTON",{class:!0,type:!0,"aria-label":!0,"data-svelte-h":!0}),wt(e)!=="svelte-ys0us"&&(e.innerHTML=t),this.h()},h(){g(e,"class","bg-transparent hover:bg-gray-100 text-gray-800 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5 outline-hidden focus:outline-hidden"),g(e,"type","button"),g(e,"aria-label","More")},m(n,r){U(n,e,r)},p:Re,d(n){n&&p(e)}}}function vu(o){var u,d,f,h,_,y,v,m,b,w,C,O,S,E,H;let e,t,n,r,i,a;e=new Gt({props:{content:"Données confidentielles",placement:"top",$$slots:{default:[Zy]},$$scope:{ctx:o}}});let s=((d=(u=o[27])==null?void 0:u.features)==null?void 0:d.enable_web_search)&&(o[28].role==="admin"||((_=(h=(f=o[28])==null?void 0:f.permissions)==null?void 0:h.features)==null?void 0:_.web_search))&&wu(o),l=((v=(y=o[27])==null?void 0:y.features)==null?void 0:v.enable_image_generation)&&(o[28].role==="admin"||((w=(b=(m=o[28])==null?void 0:m.permissions)==null?void 0:b.features)==null?void 0:w.image_generation))&&ku(o),c=((O=(C=o[27])==null?void 0:C.features)==null?void 0:O.enable_code_interpreter)&&(o[28].role==="admin"||((H=(E=(S=o[28])==null?void 0:S.permissions)==null?void 0:E.features)==null?void 0:H.code_interpreter))&&Cu(o);return{c(){te(e.$$.fragment),t=$(),s&&s.c(),n=$(),l&&l.c(),r=$(),c&&c.c(),i=je()},l(R){re(e.$$.fragment,R),t=ee(R),s&&s.l(R),n=ee(R),l&&l.l(R),r=ee(R),c&&c.l(R),i=je()},m(R,L){ne(e,R,L),U(R,t,L),s&&s.m(R,L),U(R,n,L),l&&l.m(R,L),U(R,r,L),c&&c.m(R,L),U(R,i,L),a=!0},p(R,L){var q,W,A,V,N,G,X,Q,j,ue,B,x,J,ce,me;const F={};L[0]&4096|L[1]&1|L[3]&32&&(F.$$scope={dirty:L,ctx:R}),e.$set(F),(W=(q=R[27])==null?void 0:q.features)!=null&&W.enable_web_search&&(R[28].role==="admin"||(N=(V=(A=R[28])==null?void 0:A.permissions)==null?void 0:V.features)!=null&&N.web_search)?s?(s.p(R,L),L[0]&402653184&&T(s,1)):(s=wu(R),s.c(),T(s,1),s.m(n.parentNode,n)):s&&(Le(),D(s,1,1,()=>{s=null}),Ue()),(X=(G=R[27])==null?void 0:G.features)!=null&&X.enable_image_generation&&(R[28].role==="admin"||(ue=(j=(Q=R[28])==null?void 0:Q.permissions)==null?void 0:j.features)!=null&&ue.image_generation)?l?(l.p(R,L),L[0]&402653184&&T(l,1)):(l=ku(R),l.c(),T(l,1),l.m(r.parentNode,r)):l&&(Le(),D(l,1,1,()=>{l=null}),Ue()),(x=(B=R[27])==null?void 0:B.features)!=null&&x.enable_code_interpreter&&(R[28].role==="admin"||(me=(ce=(J=R[28])==null?void 0:J.permissions)==null?void 0:ce.features)!=null&&me.code_interpreter)?c?(c.p(R,L),L[0]&402653184&&T(c,1)):(c=Cu(R),c.c(),T(c,1),c.m(i.parentNode,i)):c&&(Le(),D(c,1,1,()=>{c=null}),Ue())},i(R){a||(T(e.$$.fragment,R),T(s),T(l),T(c),a=!0)},o(R){D(e.$$.fragment,R),D(s),D(l),D(c),a=!1},d(R){R&&(p(t),p(n),p(r),p(i)),oe(e,R),s&&s.d(R),l&&l.d(R),c&&c.d(R)}}}function Zy(o){let e,t,n,r,i="Données confidentielles",a,s,l,c,u;return t=new Oy({props:{class:"size-5"}}),{c(){e=M("button"),te(t.$$.fragment),n=$(),r=M("span"),a=Se(i),this.h()},l(d){e=P(d,"BUTTON",{type:!0,class:!0});var f=I(e);re(t.$$.fragment,f),n=ee(f),r=P(f,"SPAN",{class:!0});var h=I(r);a=Ae(h,i),h.forEach(p),f.forEach(p),this.h()},h(){g(r,"class","hidden @sm:block whitespace-nowrap overflow-hidden text-ellipsis translate-y-[0.5px] mr-0.5"),g(e,"type","button"),g(e,"class",s="px-1.5 @sm:px-2.5 py-1.5 flex gap-1.5 items-center text-sm rounded-full font-medium transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden "+(o[31]?"bg-gray-100 dark:bg-gray-500/20 text-green-400 dark:text-green-400":"bg-transparent text-gray-600 dark:text-gray-300 border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800"))},m(d,f){U(d,e,f),ne(t,e,null),k(e,n),k(e,r),k(r,a),l=!0,c||(u=Ie(e,"click",Jr(o[79])),c=!0)},p(d,f){(!l||f[1]&1&&s!==(s="px-1.5 @sm:px-2.5 py-1.5 flex gap-1.5 items-center text-sm rounded-full font-medium transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden "+(d[31]?"bg-gray-100 dark:bg-gray-500/20 text-green-400 dark:text-green-400":"bg-transparent text-gray-600 dark:text-gray-300 border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800")))&&g(e,"class",s)},i(d){l||(T(t.$$.fragment,d),l=!0)},o(d){D(t.$$.fragment,d),l=!1},d(d){d&&p(e),oe(t),c=!1,u()}}}function wu(o){let e,t;return e=new Gt({props:{content:o[26].t("Search the internet"),placement:"top",$$slots:{default:[$y]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&67108864&&(i.content=n[26].t("Search the internet")),r[0]&100663328|r[3]&32&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function $y(o){let e,t,n,r,i=o[26].t("Web Search")+"",a,s,l,c,u;return t=new tp({props:{className:"size-5",strokeWidth:"1.75"}}),{c(){e=M("button"),te(t.$$.fragment),n=$(),r=M("span"),a=Se(i),this.h()},l(d){e=P(d,"BUTTON",{type:!0,class:!0});var f=I(e);re(t.$$.fragment,f),n=ee(f),r=P(f,"SPAN",{class:!0});var h=I(r);a=Ae(h,i),h.forEach(p),f.forEach(p),this.h()},h(){var d;g(r,"class","hidden @sm:block whitespace-nowrap overflow-hidden text-ellipsis translate-y-[0.5px] mr-0.5"),g(e,"type","button"),g(e,"class",s="px-1.5 @sm:px-2.5 py-1.5 flex gap-1.5 items-center text-sm rounded-full font-medium transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden "+(o[5]||(((d=o[25])==null?void 0:d.webSearch)??!1)==="always"?"bg-blue-100 dark:bg-blue-500/20 text-blue-500 dark:text-blue-400":"bg-transparent text-gray-600 dark:text-gray-300 border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800"))},m(d,f){U(d,e,f),ne(t,e,null),k(e,n),k(e,r),k(r,a),l=!0,c||(u=Ie(e,"click",Jr(o[80])),c=!0)},p(d,f){var h;(!l||f[0]&67108864)&&i!==(i=d[26].t("Web Search")+"")&&Ne(a,i),(!l||f[0]&33554464&&s!==(s="px-1.5 @sm:px-2.5 py-1.5 flex gap-1.5 items-center text-sm rounded-full font-medium transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden "+(d[5]||(((h=d[25])==null?void 0:h.webSearch)??!1)==="always"?"bg-blue-100 dark:bg-blue-500/20 text-blue-500 dark:text-blue-400":"bg-transparent text-gray-600 dark:text-gray-300 border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800")))&&g(e,"class",s)},i(d){l||(T(t.$$.fragment,d),l=!0)},o(d){D(t.$$.fragment,d),l=!1},d(d){d&&p(e),oe(t),c=!1,u()}}}function ku(o){let e,t;return e=new Gt({props:{content:o[26].t("Generate an image"),placement:"top",$$slots:{default:[ev]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&67108864&&(i.content=n[26].t("Generate an image")),r[0]&67108880|r[3]&32&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function ev(o){let e,t,n,r,i=o[26].t("Image")+"",a,s,l,c,u;return t=new Ry({props:{className:"size-5",strokeWidth:"1.75"}}),{c(){e=M("button"),te(t.$$.fragment),n=$(),r=M("span"),a=Se(i),this.h()},l(d){e=P(d,"BUTTON",{type:!0,class:!0});var f=I(e);re(t.$$.fragment,f),n=ee(f),r=P(f,"SPAN",{class:!0});var h=I(r);a=Ae(h,i),h.forEach(p),f.forEach(p),this.h()},h(){g(r,"class","hidden @sm:block whitespace-nowrap overflow-hidden text-ellipsis translate-y-[0.5px] mr-0.5"),g(e,"type","button"),g(e,"class",s="px-1.5 @sm:px-2.5 py-1.5 flex gap-1.5 items-center text-sm rounded-full font-medium transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden "+(o[4]?"bg-gray-100 dark:bg-gray-500/20 text-gray-600 dark:text-gray-400":"bg-transparent text-gray-600 dark:text-gray-300 border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 "))},m(d,f){U(d,e,f),ne(t,e,null),k(e,n),k(e,r),k(r,a),l=!0,c||(u=Ie(e,"click",Jr(o[81])),c=!0)},p(d,f){(!l||f[0]&67108864)&&i!==(i=d[26].t("Image")+"")&&Ne(a,i),(!l||f[0]&16&&s!==(s="px-1.5 @sm:px-2.5 py-1.5 flex gap-1.5 items-center text-sm rounded-full font-medium transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden "+(d[4]?"bg-gray-100 dark:bg-gray-500/20 text-gray-600 dark:text-gray-400":"bg-transparent text-gray-600 dark:text-gray-300 border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 ")))&&g(e,"class",s)},i(d){l||(T(t.$$.fragment,d),l=!0)},o(d){D(t.$$.fragment,d),l=!1},d(d){d&&p(e),oe(t),c=!1,u()}}}function Cu(o){let e,t;return e=new Gt({props:{content:o[26].t("Execute code for analysis"),placement:"top",$$slots:{default:[tv]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&67108864&&(i.content=n[26].t("Execute code for analysis")),r[0]&67108992|r[3]&32&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function tv(o){let e,t,n,r,i=o[26].t("Code Interpreter")+"",a,s,l,c,u;return t=new Jm({props:{className:"size-5",strokeWidth:"1.75"}}),{c(){e=M("button"),te(t.$$.fragment),n=$(),r=M("span"),a=Se(i),this.h()},l(d){e=P(d,"BUTTON",{type:!0,class:!0});var f=I(e);re(t.$$.fragment,f),n=ee(f),r=P(f,"SPAN",{class:!0});var h=I(r);a=Ae(h,i),h.forEach(p),f.forEach(p),this.h()},h(){g(r,"class","hidden @sm:block whitespace-nowrap overflow-hidden text-ellipsis translate-y-[0.5px] mr-0.5"),g(e,"type","button"),g(e,"class",s="px-1.5 @sm:px-2.5 py-1.5 flex gap-1.5 items-center text-sm rounded-full font-medium transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden "+(o[7]?"bg-gray-100 dark:bg-gray-500/20 text-gray-600 dark:text-gray-400":"bg-transparent text-gray-600 dark:text-gray-300 border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 "))},m(d,f){U(d,e,f),ne(t,e,null),k(e,n),k(e,r),k(r,a),l=!0,c||(u=Ie(e,"click",Jr(o[82])),c=!0)},p(d,f){(!l||f[0]&67108864)&&i!==(i=d[26].t("Code Interpreter")+"")&&Ne(a,i),(!l||f[0]&128&&s!==(s="px-1.5 @sm:px-2.5 py-1.5 flex gap-1.5 items-center text-sm rounded-full font-medium transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden "+(d[7]?"bg-gray-100 dark:bg-gray-500/20 text-gray-600 dark:text-gray-400":"bg-transparent text-gray-600 dark:text-gray-300 border-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 ")))&&g(e,"class",s)},i(d){l||(T(t.$$.fragment,d),l=!0)},o(d){D(t.$$.fragment,d),l=!1},d(d){d&&p(e),oe(t),c=!1,u()}}}function Eu(o){let e,t;return e=new Gt({props:{content:o[26].t("Record voice"),$$slots:{default:[nv]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&67108864&&(i.content=n[26].t("Record voice")),r[0]&67239936|r[3]&32&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function nv(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 translate-y-[0.5px]"><path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"></path><path d="M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"></path></svg>',n,r;return{c(){e=M("button"),e.innerHTML=t,this.h()},l(i){e=P(i,"BUTTON",{id:!0,class:!0,type:!0,"aria-label":!0,"data-svelte-h":!0}),wt(e)!=="svelte-4nqm9k"&&(e.innerHTML=t),this.h()},h(){g(e,"id","voice-input-button"),g(e,"class","text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 transition rounded-full p-1.5 mr-0.5 self-center"),g(e,"type","button"),g(e,"aria-label","Voice Input")},m(i,a){U(i,e,a),n||(r=Ie(e,"click",o[83]),n=!0)},p:Re,d(i){i&&p(e),n=!1,r()}}}function ov(o){let e,t,n;return t=new Gt({props:{content:o[26].t("Stop"),$$slots:{default:[iv]},$$scope:{ctx:o}}}),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);re(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"class","flex items-center")},m(r,i){U(r,e,i),ne(t,e,null),n=!0},p(r,i){const a={};i[0]&67108864&&(a.content=r[26].t("Stop")),i[0]&1024|i[3]&32&&(a.$$scope={dirty:i,ctx:r}),t.$set(a)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){D(t.$$.fragment,r),n=!1},d(r){r&&p(e),oe(t)}}}function rv(o){let e,t,n,r;const i=[av,sv],a=[];function s(l,c){return l[1]===""&&l[2].length===0?0:1}return e=s(o),t=a[e]=i[e](o),{c(){t.c(),n=je()},l(l){t.l(l),n=je()},m(l,c){a[e].m(l,c),U(l,n,c),r=!0},p(l,c){let u=e;e=s(l),e===u?a[e].p(l,c):(Le(),D(a[u],1,1,()=>{a[u]=null}),Ue(),t=a[e],t?t.p(l,c):(t=a[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){D(t),r=!1},d(l){l&&p(n),a[e].d(l)}}}function iv(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z" clip-rule="evenodd"></path></svg>',n,r;return{c(){e=M("button"),e.innerHTML=t,this.h()},l(i){e=P(i,"BUTTON",{class:!0,"data-svelte-h":!0}),wt(e)!=="svelte-nqxd5x"&&(e.innerHTML=t),this.h()},h(){g(e,"class","bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5")},m(i,a){U(i,e,a),n||(r=Ie(e,"click",o[85]),n=!0)},p:Re,d(i){i&&p(e),n=!1,r()}}}function sv(o){let e,t,n;return t=new Gt({props:{content:o[26].t("Send message"),$$slots:{default:[lv]},$$scope:{ctx:o}}}),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);re(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"class","flex items-center")},m(r,i){U(r,e,i),ne(t,e,null),n=!0},p(r,i){const a={};i[0]&67108864&&(a.content=r[26].t("Send message")),i[0]&33554470|i[3]&32&&(a.$$scope={dirty:i,ctx:r}),t.$set(a)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){D(t.$$.fragment,r),n=!1},d(r){r&&p(e),oe(t)}}}function av(o){let e,t,n;return t=new Gt({props:{content:o[26].t("Call"),$$slots:{default:[cv]},$$scope:{ctx:o}}}),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);re(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"class","flex items-center")},m(r,i){U(r,e,i),ne(t,e,null),n=!0},p(r,i){const a={};i[0]&67108864&&(a.content=r[26].t("Call")),i[0]&234883104|i[1]&2|i[3]&32&&(a.$$scope={dirty:i,ctx:r}),t.$set(a)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){D(t.$$.fragment,r),n=!1},d(r){r&&p(e),oe(t)}}}function lv(o){let e,t,n,r,i;return{c(){e=M("button"),t=be("svg"),n=be("path"),this.h()},l(a){e=P(a,"BUTTON",{id:!0,class:!0,type:!0});var s=I(e);t=ye(s,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var l=I(t);n=ye(l,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),I(n).forEach(p),l.forEach(p),s.forEach(p),this.h()},h(){var a;g(n,"fill-rule","evenodd"),g(n,"d","M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z"),g(n,"clip-rule","evenodd"),g(t,"xmlns","http://www.w3.org/2000/svg"),g(t,"viewBox","0 0 16 16"),g(t,"fill","currentColor"),g(t,"class","size-5"),g(e,"id","send-message-button"),g(e,"class",r=(o[1]===""&&o[2].length===0?"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled":o[5]||(((a=o[25])==null?void 0:a.webSearch)??!1)==="always"?"bg-blue-500 text-white hover:bg-blue-400 ":"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ")+" transition rounded-full p-1.5 self-center"),g(e,"type","submit"),e.disabled=i=o[1]===""&&o[2].length===0},m(a,s){U(a,e,s),k(e,t),k(t,n)},p(a,s){var l;s[0]&33554470&&r!==(r=(a[1]===""&&a[2].length===0?"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled":a[5]||(((l=a[25])==null?void 0:l.webSearch)??!1)==="always"?"bg-blue-500 text-white hover:bg-blue-400 ":"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ")+" transition rounded-full p-1.5 self-center")&&g(e,"class",r),s[0]&6&&i!==(i=a[1]===""&&a[2].length===0)&&(e.disabled=i)},d(a){a&&p(e)}}}function cv(o){let e,t,n,r,i,a;return t=new Ty({props:{className:"size-5"}}),{c(){e=M("button"),te(t.$$.fragment),this.h()},l(s){e=P(s,"BUTTON",{class:!0,type:!0,"aria-label":!0});var l=I(e);re(t.$$.fragment,l),l.forEach(p),this.h()},h(){var s;g(e,"class",n=(o[5]||(((s=o[25])==null?void 0:s.webSearch)??!1)==="always"?"bg-blue-500 text-white hover:bg-blue-400 ":"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100")+" transition rounded-full p-1.5 self-center"),g(e,"type","button"),g(e,"aria-label","Call")},m(s,l){U(s,e,l),ne(t,e,null),r=!0,i||(a=Ie(e,"click",o[84]),i=!0)},p(s,l){var c;(!r||l[0]&33554464&&n!==(n=(s[5]||(((c=s[25])==null?void 0:c.webSearch)??!1)==="always"?"bg-blue-500 text-white hover:bg-blue-400 ":"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100")+" transition rounded-full p-1.5 self-center"))&&g(e,"class",n)},i(s){r||(T(t.$$.fragment,s),r=!0)},o(s){D(t.$$.fragment,s),r=!1},d(s){s&&p(e),oe(t),i=!1,a()}}}function uv(o){let e,t,n,r;e=new Qg({props:{show:o[23]}});let i=o[16]&&au(o);return{c(){te(e.$$.fragment),t=$(),i&&i.c(),n=je()},l(a){re(e.$$.fragment,a),t=ee(a),i&&i.l(a),n=je()},m(a,s){ne(e,a,s),U(a,t,s),i&&i.m(a,s),U(a,n,s),r=!0},p(a,s){const l={};s[0]&8388608&&(l.show=a[23]),e.$set(l),a[16]?i?(i.p(a,s),s[0]&65536&&T(i,1)):(i=au(a),i.c(),T(i,1),i.m(n.parentNode,n)):i&&(Le(),D(i,1,1,()=>{i=null}),Ue())},i(a){r||(T(e.$$.fragment,a),T(i),r=!0)},o(a){D(e.$$.fragment,a),D(i),r=!1},d(a){a&&(p(t),p(n)),oe(e,a),i&&i.d(a)}}}function dv(o,e,t){let n,r,i,a,s,l,c,u,d;de(o,zo,K=>t(25,n=K)),de(o,Ci,K=>t(27,i=K)),de(o,Xo,K=>t(28,a=K)),de(o,Tr,K=>t(14,s=K)),de(o,yr,K=>t(29,l=K)),de(o,As,K=>t(30,c=K)),de(o,_r,K=>t(31,u=K)),de(o,pa,K=>t(32,d=K));const f=Pn(),h=on("i18n");de(o,h,K=>t(26,r=K));let{transparentBackground:_=!1}=e,{onChange:y=()=>{}}=e,{createMessagePair:v}=e,{stopResponse:m}=e,{autoScroll:b=!1}=e,{atSelectedModel:w=void 0}=e,{selectedModels:C}=e,O=[],{history:S}=e,{prompt:E=""}=e,{files:H=[]}=e,{selectedToolIds:R=[]}=e,{imageGenerationEnabled:L=!1}=e,{webSearchEnabled:F=!1}=e,{codeInterpreterEnabled:q=!1}=e,W=!1,A=!1,V=!1,N,G,X,Q,j=!1,{placeholder:ue=""}=e,B=[];const x=()=>{const K=document.getElementById("messages-container");K.scrollTo({top:K.scrollHeight,behavior:"smooth"})},J=async()=>{try{const K=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"never"},audio:!1}),Pe=document.createElement("video");Pe.srcObject=K,await Pe.play();const Ze=document.createElement("canvas");Ze.width=Pe.videoWidth,Ze.height=Pe.videoHeight,Ze.getContext("2d").drawImage(Pe,0,0,Ze.width,Ze.height),K.getTracks().forEach(it=>it.stop()),window.focus();const We=Ze.toDataURL("image/png");t(2,H=[...H,{type:"image",url:We}]),Pe.srcObject=null}catch(K){console.error("Error capturing screen:",K)}},ce=async(K,Pe=!1)=>{var We,it,On,zn;if((a==null?void 0:a.role)!=="admin"&&!(((it=(We=a==null?void 0:a.permissions)==null?void 0:We.chat)==null?void 0:it.file_upload)??!0))return at.error(r.t("You do not have permission to upload files.")),null;const Ze=Uo(),ut={type:"file",file:"",id:null,url:"",name:K.name,collection_name:"",status:"uploading",size:K.size,error:"",itemId:Ze,...Pe?{context:"full"}:{}};if(ut.size==0)return at.error(r.t("You cannot upload an empty file.")),null;t(2,H=[...H,ut]);try{const Ct=await Fm(localStorage.token,K);Ct?(console.log("File upload completed:",{id:Ct.id,name:ut.name,collection:(On=Ct==null?void 0:Ct.meta)==null?void 0:On.collection_name}),Ct.error&&(console.warn("File upload warning:",Ct.error),at.warning(Ct.error)),ut.status="uploaded",ut.file=Ct,ut.id=Ct.id,ut.collection_name=((zn=Ct==null?void 0:Ct.meta)==null?void 0:zn.collection_name)||(Ct==null?void 0:Ct.collection_name),ut.url=`${Zg}/files/${Ct.id}`,t(2,H)):t(2,H=H.filter(cn=>(cn==null?void 0:cn.itemId)!==Ze))}catch(Ct){at.error(`${Ct}`),t(2,H=H.filter(cn=>(cn==null?void 0:cn.itemId)!==Ze))}},me=async K=>{console.log("Input files handler called with:",K),K.forEach(Pe=>{var Ze,ut,We,it;if(console.log("Processing file:",{name:Pe.name,type:Pe.type,size:Pe.size,extension:Pe.name.split(".").at(-1)}),(((Ze=i==null?void 0:i.file)==null?void 0:Ze.max_size)??null)!==null&&Pe.size>(((ut=i==null?void 0:i.file)==null?void 0:ut.max_size)??0)*1024*1024){console.log("File exceeds max size limit:",{fileSize:Pe.size,maxSize:(((We=i==null?void 0:i.file)==null?void 0:We.max_size)??0)*1024*1024}),at.error(r.t("File size should not exceed {{maxSize}} MB.",{maxSize:(it=i==null?void 0:i.file)==null?void 0:it.max_size}));return}if(["image/gif","image/webp","image/jpeg","image/png","image/avif"].includes(Pe.type)){if(B.length===0){at.error(r.t("Selected model(s) do not support image inputs"));return}let On=new FileReader;On.onload=async zn=>{var cn,to;let Ct=zn.target.result;if((n==null?void 0:n.imageCompression)??!1){const lo=((cn=n==null?void 0:n.imageCompressionSize)==null?void 0:cn.width)??null,ko=((to=n==null?void 0:n.imageCompressionSize)==null?void 0:to.height)??null;(lo||ko)&&(Ct=await um(Ct,lo,ko))}t(2,H=[...H,{type:"image",url:`${Ct}`}])},On.readAsDataURL(Pe)}else ce(Pe)})},se=K=>{K.key==="Escape"&&(console.log("Escape"),t(23,j=!1))},Be=K=>{var Pe,Ze;K.preventDefault(),(Ze=(Pe=K.dataTransfer)==null?void 0:Pe.types)!=null&&Ze.includes("Files")?t(23,j=!0):t(23,j=!1)},He=()=>{t(23,j=!1)},Y=async K=>{var Pe,Ze;if(K.preventDefault(),console.log(K),(Pe=K.dataTransfer)!=null&&Pe.files){const ut=Array.from((Ze=K.dataTransfer)==null?void 0:Ze.files);ut&&ut.length>0&&(console.log(ut),me(ut))}t(23,j=!1)};Jn(async()=>{t(16,W=!0),window.setTimeout(()=>{const Pe=document.getElementById("chat-input");Pe==null||Pe.focus()},0),window.addEventListener("keydown",se),await rt();const K=document.getElementById("chat-container");K==null||K.addEventListener("dragover",Be),K==null||K.addEventListener("drop",Y),K==null||K.addEventListener("dragleave",He),(S==null?void 0:S.is_confidential)===void 0||(S==null?void 0:S.is_confidential)===!1?_r.set(!1):_r.set(!0)}),Qo(()=>{console.log("destroy"),window.removeEventListener("keydown",se);const K=document.getElementById("chat-container");K&&(K==null||K.removeEventListener("dragover",Be),K==null||K.removeEventListener("drop",Y),K==null||K.removeEventListener("dragleave",He))});const Xe=()=>{t(6,b=!0),x()},Ke=K=>l?l.find(Pe=>Pe.id===K):{id:K,name:K},mt=K=>K.id===w.id,fe=()=>{t(0,w=void 0)};function xe(K){Ye[K?"unshift":"push"](()=>{X=K,t(21,X)})}function gt(K){E=K,t(1,E)}function Et(K){H=K,t(2,H)}const Bt=K=>{f("upload",K.detail)},Xt=K=>{const Pe=K.detail;(Pe==null?void 0:Pe.type)==="model"&&t(0,w=Pe.data);const Ze=document.getElementById("chat-input");Ze==null||Ze.focus()};function Ot(K){Ye[K?"unshift":"push"](()=>{G=K,t(20,G)})}function rn(){Q=this.files,t(22,Q)}const Wt=async()=>{if(Q&&Q.length>0){const K=Array.from(Q);me(K)}else at.error(r.t("File not found."));t(20,G.value="",G)};function Nt(K){A=K,t(17,A)}const tn=async()=>{var K;t(17,A=!1),await rt(),(K=document.getElementById("chat-input"))==null||K.focus()},ie=async K=>{var ut;const{text:Pe,filename:Ze}=K.detail;t(1,E=`${E}${Pe} `),t(17,A=!1),await rt(),(ut=document.getElementById("chat-input"))==null||ut.focus(),((n==null?void 0:n.speechAutoSend)??!1)&&f("submit",E)},Ge=K=>!B.includes(K),nt=K=>{H.splice(K,1),t(2,H)},vt=async(K,Pe)=>{K.type!=="collection"&&!(K!=null&&K.collection)&&K.id&&await Km(localStorage.token,K.id),H.splice(Pe,1),t(2,H)},Me=K=>{console.log(K)},Yt=async K=>{(O.length===0||!O.at(0))&&at.error(r.t("Please select a model first."));const Pe=await Pm(localStorage.token,O.at(0),K,S!=null&&S.currentId?qn(S,S.currentId):null).catch(Ze=>(console.log(Ze),null));return console.log(Pe),Pe},Tt=()=>t(18,V=!0),he=()=>t(18,V=!1);function qe(K){Ye[K?"unshift":"push"](()=>{N=K,t(19,N)})}function Oe(K){E=K,t(1,E)}const $e=async K=>{var ut;K=K.detail.event;const Pe=K.ctrlKey||K.metaKey,Ze=document.getElementById("commands-container");if(K.key==="Escape"&&m(),Pe&&K.key==="Enter"&&K.shiftKey&&(K.preventDefault(),v(E)),E===""&&Pe&&K.key.toLowerCase()==="r"){K.preventDefault(),console.log("regenerate");const We=[...document.getElementsByClassName("regenerate-response-button")].at(-1);We==null||We.click()}if(E===""&&K.key=="ArrowUp"){K.preventDefault();const We=[...document.getElementsByClassName("user-message")].at(-1);if(We){We.scrollIntoView({block:"center"});const it=[...document.getElementsByClassName("edit-user-message-button")].at(-1);it==null||it.click()}}if(Ze){if(Ze&&K.key==="ArrowUp"&&(K.preventDefault(),X.selectUp(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),Ze&&K.key==="ArrowDown"&&(K.preventDefault(),X.selectDown(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),Ze&&K.key==="Tab"){K.preventDefault();const We=[...document.getElementsByClassName("selected-command-option-button")].at(-1);We==null||We.click()}if(Ze&&K.key==="Enter"){K.preventDefault();const We=[...document.getElementsByClassName("selected-command-option-button")].at(-1);We?We==null||We.click():(ut=document.getElementById("send-message-button"))==null||ut.click()}}else if(!c||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)){if(V)return;((n==null?void 0:n.ctrlEnterToSend)??!1?(K.key==="Enter"||K.keyCode===13)&&Pe:(K.key==="Enter"||K.keyCode===13)&&!K.shiftKey)&&(K.preventDefault(),(E!==""||H.length>0)&&f("submit",E))}K.key==="Escape"&&(console.log("Escape"),t(0,w=void 0),t(3,R=[]),t(5,F=!1),t(4,L=!1))},It=async K=>{K=K.detail.event,console.log(K);const Pe=K.clipboardData||window.clipboardData;if(Pe&&Pe.items){for(const Ze of Pe.items)if(Ze.type.indexOf("image")!==-1){const ut=Ze.getAsFile(),We=new FileReader;We.onload=function(it){t(2,H=[...H,{type:"image",url:`${it.target.result}`}])},We.readAsDataURL(ut)}else if(Ze.type==="text/plain"&&((n==null?void 0:n.largeTextAsFile)??!1)){const ut=Pe.getData("text/plain");if(ut.length>Xl){K.preventDefault();const We=new Blob([ut],{type:"text/plain"}),it=new File([We],`Pasted_Text_${Date.now()}.txt`,{type:"text/plain"});await ce(it,!0)}}}};function kt(K){Ye[K?"unshift":"push"](()=>{N=K,t(19,N)})}function Rt(){E=this.value,t(1,E)}const pt=()=>t(18,V=!0),dn=()=>t(18,V=!1),sn=async K=>{var ut;const Pe=K.ctrlKey||K.metaKey;console.log("keydown",K);const Ze=document.getElementById("commands-container");if(K.key==="Escape"&&m(),Pe&&K.key==="Enter"&&K.shiftKey&&(K.preventDefault(),v(E)),E===""&&Pe&&K.key.toLowerCase()==="r"){K.preventDefault(),console.log("regenerate");const We=[...document.getElementsByClassName("regenerate-response-button")].at(-1);We==null||We.click()}if(E===""&&K.key=="ArrowUp"){K.preventDefault();const We=[...document.getElementsByClassName("user-message")].at(-1),it=[...document.getElementsByClassName("edit-user-message-button")].at(-1);console.log(We),We.scrollIntoView({block:"center"}),it==null||it.click()}if(Ze){if(Ze&&K.key==="ArrowUp"&&(K.preventDefault(),X.selectUp(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),Ze&&K.key==="ArrowDown"&&(K.preventDefault(),X.selectDown(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),Ze&&K.key==="Enter"){K.preventDefault();const We=[...document.getElementsByClassName("selected-command-option-button")].at(-1);K.shiftKey?t(1,E=`${E}
`):We?We==null||We.click():(ut=document.getElementById("send-message-button"))==null||ut.click()}if(Ze&&K.key==="Tab"){K.preventDefault();const We=[...document.getElementsByClassName("selected-command-option-button")].at(-1);We==null||We.click()}}else if(!c||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)){if(V)return;console.log("keypress",K);const We=K.ctrlKey||K.metaKey,it=(n==null?void 0:n.ctrlEnterToSend)??!1?(K.key==="Enter"||K.keyCode===13)&&We:(K.key==="Enter"||K.keyCode===13)&&!K.shiftKey;console.log("Enter pressed:",it),it&&K.preventDefault(),(E!==""||H.length>0)&&it&&f("submit",E)}if(K.key==="Tab"){const We=dm(E);if(We.length>0){const it=We.at(0),On=E;t(1,E=E.substring(0,(it==null?void 0:it.endIndex)+1)),await rt(),K.target.scrollTop=K.target.scrollHeight,t(1,E=On),await rt(),K.preventDefault(),K.target.setSelectionRange(it==null?void 0:it.startIndex,it.endIndex+1)}K.target.style.height="",K.target.style.height=Math.min(K.target.scrollHeight,320)+"px"}K.key==="Escape"&&(console.log("Escape"),t(0,w=void 0),t(3,R=[]),t(5,F=!1),t(4,L=!1))},Jt=async K=>{K.target.style.height="",K.target.style.height=Math.min(K.target.scrollHeight,320)+"px"},qt=async K=>{K.target.style.height="",K.target.style.height=Math.min(K.target.scrollHeight,320)+"px"},fn=async K=>{const Pe=K.clipboardData||window.clipboardData;if(Pe&&Pe.items){for(const Ze of Pe.items)if(Ze.type.indexOf("image")!==-1){const ut=Ze.getAsFile(),We=new FileReader;We.onload=function(it){t(2,H=[...H,{type:"image",url:`${it.target.result}`}])},We.readAsDataURL(ut)}else if(Ze.type==="text/plain"&&((n==null?void 0:n.largeTextAsFile)??!1)){const ut=Pe.getData("text/plain");if(ut.length>Xl){K.preventDefault();const We=new Blob([ut],{type:"text/plain"}),it=new File([We],`Pasted_Text_${Date.now()}.txt`,{type:"text/plain"});await ce(it,!0)}}}},bn=()=>{G.click()},Cn=async()=>{try{const K=await n1();if(K){const Pe=new File([K.blob],K.name,{type:K.blob.type});await ce(Pe)}else console.log("No file was selected from Google Drive")}catch(K){console.error("Google Drive Error:",K),at.error(r.t("Error accessing Google Drive: {{error}}",{error:K.message}))}},xt=async()=>{try{const K=await Ub();if(K){const Pe=new File([K.blob],K.name,{type:K.blob.type||"application/octet-stream"});await ce(Pe)}else console.log("No file was selected from OneDrive")}catch(K){console.error("OneDrive Error:",K)}},Ht=async()=>{await rt();const K=document.getElementById("chat-input");K==null||K.focus()};function xn(K){R=K,t(3,R)}const Bn=()=>{S.is_confidential===void 0||S.is_confidential===!1?(_r.set(!u),at.success("Mode confidentiel activé. Un modèle local sera utilisé pour répondre à votre demande.")):S.is_confidential===!0&&at.error("Vous ne pouvez pas désactiver le mode confidentiel car la conversation contient des données confidentielles.")},Zn=()=>t(5,F=!F),ao=()=>t(4,L=!L),wo=()=>t(7,q=!q),Do=async()=>{try{let K=await navigator.mediaDevices.getUserMedia({audio:!0}).catch(function(Pe){return at.error(r.t("Permission denied when accessing microphone: {{error}}",{error:Pe})),null});K&&(t(17,A=!0),K.getTracks().forEach(Ze=>Ze.stop())),K=null}catch{at.error(r.t("Permission denied when accessing microphone"))}},$n=async()=>{var K,Pe,Ze,ut,We;if(C.length>1){at.error(r.t("Select only one model to call"));return}if(i.audio.stt.engine==="web"){at.error(r.t("Call feature is not supported when using Web STT engine"));return}try{let it=await navigator.mediaDevices.getUserMedia({audio:!0});it&&it.getTracks().forEach(zn=>zn.stop()),it=null,((Pe=(K=n.audio)==null?void 0:K.tts)==null?void 0:Pe.engine)==="browser-kokoro"&&(d||(await pa.set(new rp({dtype:((We=(ut=(Ze=n.audio)==null?void 0:Ze.tts)==null?void 0:ut.engineConfig)==null?void 0:We.dtype)??"fp32"})),await d.init())),jn.set(!0),nn.set(!0)}catch{at.error(r.t("Permission denied when accessing media devices"))}},eo=()=>{m()},yn=()=>{f("submit",E)};return o.$$set=K=>{"transparentBackground"in K&&t(8,_=K.transparentBackground),"onChange"in K&&t(39,y=K.onChange),"createMessagePair"in K&&t(9,v=K.createMessagePair),"stopResponse"in K&&t(10,m=K.stopResponse),"autoScroll"in K&&t(6,b=K.autoScroll),"atSelectedModel"in K&&t(0,w=K.atSelectedModel),"selectedModels"in K&&t(11,C=K.selectedModels),"history"in K&&t(12,S=K.history),"prompt"in K&&t(1,E=K.prompt),"files"in K&&t(2,H=K.files),"selectedToolIds"in K&&t(3,R=K.selectedToolIds),"imageGenerationEnabled"in K&&t(4,L=K.imageGenerationEnabled),"webSearchEnabled"in K&&t(5,F=K.webSearchEnabled),"codeInterpreterEnabled"in K&&t(7,q=K.codeInterpreterEnabled),"placeholder"in K&&t(13,ue=K.placeholder)},o.$$.update=()=>{o.$$.dirty[0]&2049&&t(15,O=w!==void 0?[w.id]:C),o.$$.dirty[0]&62|o.$$.dirty[1]&256&&y({prompt:E,files:H,selectedToolIds:R,imageGenerationEnabled:L,webSearchEnabled:F}),o.$$.dirty[0]&18433&&t(24,B=[...w?[w]:C].filter(K=>{var Pe,Ze,ut,We;return((We=(ut=(Ze=(Pe=s.find(it=>it.id===K))==null?void 0:Pe.info)==null?void 0:Ze.meta)==null?void 0:ut.capabilities)==null?void 0:We.vision)??!0}))},[w,E,H,R,L,F,b,q,_,v,m,C,S,ue,s,O,W,A,V,N,G,X,Q,j,B,n,r,i,a,l,c,u,d,f,h,x,J,ce,me,y,Xe,Ke,mt,fe,xe,gt,Et,Bt,Xt,Ot,rn,Wt,Nt,tn,ie,Ge,nt,vt,Me,Yt,Tt,he,qe,Oe,$e,It,kt,Rt,pt,dn,sn,Jt,qt,fn,bn,Cn,xt,Ht,xn,Bn,Zn,ao,wo,Do,$n,eo,yn]}class tg extends Ve{constructor(e){super(),Fe(this,e,dv,uv,Qe,{transparentBackground:8,onChange:39,createMessagePair:9,stopResponse:10,autoScroll:6,atSelectedModel:0,selectedModels:11,history:12,prompt:1,files:2,selectedToolIds:3,imageGenerationEnabled:4,webSearchEnabled:5,codeInterpreterEnabled:7,placeholder:13},null,[-1,-1,-1,-1])}}const{Boolean:fv}=Wa;function Iu(o,e,t){const n=o.slice();return n[15]=e[t],n[16]=e,n[17]=t,n}function hv(o){let e,t,n;return t=new Gt({props:{content:o[4].t("Remove Model"),$$slots:{default:[mv]},$$scope:{ctx:o}}}),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);re(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"class","self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]")},m(r,i){U(r,e,i),ne(t,e,null),n=!0},p(r,i){const a={};i&16&&(a.content=r[4].t("Remove Model")),i&262147&&(a.$$scope={dirty:i,ctx:r}),t.$set(a)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){D(t.$$.fragment,r),n=!1},d(r){r&&p(e),oe(t)}}}function gv(o){let e,t,n;return t=new Gt({props:{content:o[4].t("Add Model"),$$slots:{default:[pv]},$$scope:{ctx:o}}}),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);re(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"class","self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]")},m(r,i){U(r,e,i),ne(t,e,null),n=!0},p(r,i){const a={};i&16&&(a.content=r[4].t("Add Model")),i&262147&&(a.$$scope={dirty:i,ctx:r}),t.$set(a)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){D(t.$$.fragment,r),n=!1},d(r){r&&p(e),oe(t)}}}function mv(o){let e,t,n,r,i;function a(){return o[12](o[17])}return{c(){e=M("button"),t=be("svg"),n=be("path"),this.h()},l(s){e=P(s,"BUTTON",{"aria-label":!0});var l=I(e);t=ye(l,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var c=I(t);n=ye(c,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),I(n).forEach(p),c.forEach(p),l.forEach(p),this.h()},h(){g(n,"stroke-linecap","round"),g(n,"stroke-linejoin","round"),g(n,"d","M19.5 12h-15"),g(t,"xmlns","http://www.w3.org/2000/svg"),g(t,"fill","none"),g(t,"viewBox","0 0 24 24"),g(t,"stroke-width","2"),g(t,"stroke","currentColor"),g(t,"class","size-3"),e.disabled=o[1],g(e,"aria-label","Remove Model")},m(s,l){U(s,e,l),k(e,t),k(t,n),r||(i=Ie(e,"click",a),r=!0)},p(s,l){o=s,l&2&&(e.disabled=o[1])},d(s){s&&p(e),r=!1,i()}}}function pv(o){let e,t,n,r,i;return{c(){e=M("button"),t=be("svg"),n=be("path"),this.h()},l(a){e=P(a,"BUTTON",{class:!0,"aria-label":!0});var s=I(e);t=ye(s,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var l=I(t);n=ye(l,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),I(n).forEach(p),l.forEach(p),s.forEach(p),this.h()},h(){g(n,"stroke-linecap","round"),g(n,"stroke-linejoin","round"),g(n,"d","M12 6v12m6-6H6"),g(t,"xmlns","http://www.w3.org/2000/svg"),g(t,"fill","none"),g(t,"viewBox","0 0 24 24"),g(t,"stroke-width","2"),g(t,"stroke","currentColor"),g(t,"class","size-3.5"),g(e,"class",""),e.disabled=o[1],g(e,"aria-label","Add Model")},m(a,s){U(a,e,s),k(e,t),k(t,n),r||(i=Ie(e,"click",o[11]),r=!0)},p(a,s){s&2&&(e.disabled=a[1])},d(a){a&&p(e),r=!1,i()}}}function Tu(o){var v,m,b;let e,t,n,r,i,a,s,l,c,u;function d(w){o[10](w,o[15],o[16],o[17])}let f={id:`${o[17]}`,placeholder:o[4].t("Select a model"),items:o[3].map(o[9]).filter(Boolean),showTemporaryChatControl:o[6].role==="user"?((b=(m=(v=o[6])==null?void 0:v.permissions)==null?void 0:m.chat)==null?void 0:b.temporary)??!0:!0};o[15]!==void 0&&(f.value=o[15]),r=new sp({props:f}),Ye.push(()=>tt(r,"value",d));const h=[gv,hv],_=[];function y(w,C){return w[17]===0?0:1}return s=y(o),l=_[s]=h[s](o),{c(){e=M("div"),t=M("div"),n=M("div"),te(r.$$.fragment),a=$(),l.c(),c=$(),this.h()},l(w){e=P(w,"DIV",{class:!0});var C=I(e);t=P(C,"DIV",{class:!0});var O=I(t);n=P(O,"DIV",{class:!0});var S=I(n);re(r.$$.fragment,S),S.forEach(p),O.forEach(p),a=ee(C),l.l(C),c=ee(C),C.forEach(p),this.h()},h(){g(n,"class","mr-1 max-w-full"),g(t,"class","overflow-hidden w-full"),g(e,"class","flex w-full max-w-fit")},m(w,C){U(w,e,C),k(e,t),k(t,n),ne(r,n,null),k(e,a),_[s].m(e,null),k(e,c),u=!0},p(w,C){var S,E,H;o=w;const O={};C&16&&(O.placeholder=o[4].t("Select a model")),C&40&&(O.items=o[3].map(o[9]).filter(Boolean)),C&64&&(O.showTemporaryChatControl=o[6].role==="user"?((H=(E=(S=o[6])==null?void 0:S.permissions)==null?void 0:E.chat)==null?void 0:H.temporary)??!0:!0),!i&&C&1&&(i=!0,O.value=o[15],et(()=>i=!1)),r.$set(O),l.p(o,C)},i(w){u||(T(r.$$.fragment,w),T(l),u=!0)},o(w){D(r.$$.fragment,w),D(l),u=!1},d(w){w&&p(e),oe(r),_[s].d()}}}function Su(o){let e,t,n=o[4].t("Set as default")+"",r,i,a;return{c(){e=M("div"),t=M("button"),r=Se(n),this.h()},l(s){e=P(s,"DIV",{class:!0});var l=I(e);t=P(l,"BUTTON",{});var c=I(t);r=Ae(c,n),c.forEach(p),l.forEach(p),this.h()},h(){g(e,"class","absolute text-left mt-[1px] ml-1 text-[0.7rem] text-gray-500 font-primary")},m(s,l){U(s,e,l),k(e,t),k(t,r),i||(a=Ie(t,"click",o[8]),i=!0)},p(s,l){l&16&&n!==(n=s[4].t("Set as default")+"")&&Ne(r,n)},d(s){s&&p(e),i=!1,a()}}}function _v(o){let e,t,n,r,i=Pt(o[0]),a=[];for(let c=0;c<i.length;c+=1)a[c]=Tu(Iu(o,i,c));const s=c=>D(a[c],1,1,()=>{a[c]=null});let l=o[2]&&Su(o);return{c(){e=M("div");for(let c=0;c<a.length;c+=1)a[c].c();t=$(),l&&l.c(),n=je(),this.h()},l(c){e=P(c,"DIV",{class:!0});var u=I(e);for(let d=0;d<a.length;d+=1)a[d].l(u);u.forEach(p),t=ee(c),l&&l.l(c),n=je(),this.h()},h(){g(e,"class","flex flex-col w-full items-start")},m(c,u){U(c,e,u);for(let d=0;d<a.length;d+=1)a[d]&&a[d].m(e,null);U(c,t,u),l&&l.m(c,u),U(c,n,u),r=!0},p(c,[u]){if(u&123){i=Pt(c[0]);let d;for(d=0;d<i.length;d+=1){const f=Iu(c,i,d);a[d]?(a[d].p(f,u),T(a[d],1)):(a[d]=Tu(f),a[d].c(),T(a[d],1),a[d].m(e,null))}for(Le(),d=i.length;d<a.length;d+=1)s(d);Ue()}c[2]?l?l.p(c,u):(l=Su(c),l.c(),l.m(n.parentNode,n)):l&&(l.d(1),l=null)},i(c){if(!r){for(let u=0;u<i.length;u+=1)T(a[u]);r=!0}},o(c){a=a.filter(fv);for(let u=0;u<a.length;u+=1)D(a[u]);r=!1},d(c){c&&(p(e),p(t),p(n)),so(a,c),l&&l.d(c)}}}function bv(o,e,t){let n,r,i,a,s;de(o,Tr,b=>t(3,n=b)),de(o,zo,b=>t(13,i=b)),de(o,_r,b=>t(5,a=b)),de(o,Xo,b=>t(6,s=b));const l=on("i18n");de(o,l,b=>t(4,r=b));let{selectedModels:c=[""]}=e,{disabled:u=!1}=e,{showSetDefault:d=!0}=e;const f=async()=>{if(c.filter(w=>w==="").length){at.error(r.t("Choose a model before saving..."));return}zo.set({...i,models:c}),await Mm(localStorage.token,{ui:i}),at.success(r.t("Default model updated"))},h=_r.subscribe(b=>{t(0,c=[""])});Qo(()=>{h()});const _=b=>{const w=b.name.split(".")[0];let C;if(w==="confidential")C=!0;else if(w==="non-confidential")C=!1;else return;if(C===a)return{value:b.id,label:b.name,model:b}};function y(b,w,C,O){C[O]=b,t(0,c),t(3,n)}const v=()=>{t(0,c=[...c,""])},m=b=>{c.splice(b,1),t(0,c),t(3,n)};return o.$$set=b=>{"selectedModels"in b&&t(0,c=b.selectedModels),"disabled"in b&&t(1,u=b.disabled),"showSetDefault"in b&&t(2,d=b.showSetDefault)},o.$$.update=()=>{o.$$.dirty&9&&c.length>0&&n.length>0&&t(0,c=c.map(b=>n.map(w=>w.id).includes(b)?b:""))},[c,u,d,n,r,a,s,l,f,_,y,v,m]}class yv extends Ve{constructor(e){super(),Fe(this,e,bv,_v,Qe,{selectedModels:0,disabled:1,showSetDefault:2})}}function vv(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var r=I(e);t=ye(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(n,r){U(n,e,r),k(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Re,o:Re,d(n){n&&p(e)}}}function wv(o,e,t){let{className:n="size-4"}=e,{strokeWidth:r="2"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}let kv=class extends Ve{constructor(e){super(),Fe(this,e,wv,vv,Qe,{className:0,strokeWidth:1})}};function Cv(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{xmlns:!0,viewBox:!0,stroke:!0,fill:!0,class:!0,"stroke-width":!0});var r=I(e);t=ye(r,"path",{d:!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"d","M18.75 12.75h1.5a.75.75 0 0 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5ZM12 6a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 12 6ZM12 18a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 12 18ZM3.75 6.75h1.5a.75.75 0 1 0 0-1.5h-1.5a.75.75 0 0 0 0 1.5ZM5.25 18.75h-1.5a.75.75 0 0 1 0-1.5h1.5a.75.75 0 0 1 0 1.5ZM3 12a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 3 12ZM9 3.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5ZM12.75 12a2.25 2.25 0 1 1 4.5 0 2.25 2.25 0 0 1-4.5 0ZM9 15.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 24 24"),g(e,"stroke","currentColor"),g(e,"fill","currentColor"),g(e,"class",o[0]),g(e,"stroke-width",o[1])},m(n,r){U(n,e,r),k(e,t)},p(n,[r]){r&1&&g(e,"class",n[0]),r&2&&g(e,"stroke-width",n[1])},i:Re,o:Re,d(n){n&&p(e)}}}function Ev(o,e,t){let{className:n="w-4 h-4"}=e,{strokeWidth:r="1.5"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class Ul extends Ve{constructor(e){super(),Fe(this,e,Ev,Cv,Qe,{className:0,strokeWidth:1})}}function Iv(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var r=I(e);t=ye(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(n,r){U(n,e,r),k(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Re,o:Re,d(n){n&&p(e)}}}function Tv(o,e,t){let{className:n="size-4"}=e,{strokeWidth:r="2"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class Sv extends Ve{constructor(e){super(),Fe(this,e,Tv,Iv,Qe,{className:0,strokeWidth:1})}}function Av(o){let e;const t=o[13].default,n=gn(t,o,o[23],null);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i&8388608)&&mn(n,t,r,r[23],e?_n(t,r[23],i,null):pn(r[23]),null)},i(r){e||(T(n,r),e=!0)},o(r){D(n,r),e=!1},d(r){n&&n.d(r)}}}function Au(o){let e,t;return e=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-controls-button",$$slots:{default:[Rv]},$$scope:{ctx:o}}}),e.$on("click",o[14]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&8388640&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function Rv(o){let e,t,n,r=o[5].t("Controls")+"",i,a;return e=new Ul({props:{className:" size-4",strokeWidth:"0.5"}}),{c(){te(e.$$.fragment),t=$(),n=M("div"),i=Se(r),this.h()},l(s){re(e.$$.fragment,s),t=ee(s),n=P(s,"DIV",{class:!0});var l=I(n);i=Ae(l,r),l.forEach(p),this.h()},h(){g(n,"class","flex items-center")},m(s,l){ne(e,s,l),U(s,t,l),U(s,n,l),k(n,i),a=!0},p(s,l){(!a||l&32)&&r!==(r=s[5].t("Controls")+"")&&Ne(i,r)},i(s){a||(T(e.$$.fragment,s),a=!0)},o(s){D(e.$$.fragment,s),a=!1},d(s){s&&(p(t),p(n)),oe(e,s)}}}function Ru(o){let e,t;return e=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-share-button",$$slots:{default:[Mv]},$$scope:{ctx:o}}}),e.$on("click",o[15]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&8388640&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function Mv(o){let e,t,n,r,i=o[5].t("Share")+"",a;return{c(){e=be("svg"),t=be("path"),n=$(),r=M("div"),a=Se(i),this.h()},l(s){e=ye(s,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var l=I(e);t=ye(l,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),I(t).forEach(p),l.forEach(p),n=ee(s),r=P(s,"DIV",{class:!0});var c=I(r);a=Ae(c,i),c.forEach(p),this.h()},h(){g(t,"fill-rule","evenodd"),g(t,"d","M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z"),g(t,"clip-rule","evenodd"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 24 24"),g(e,"fill","currentColor"),g(e,"class","size-4"),g(r,"class","flex items-center")},m(s,l){U(s,e,l),k(e,t),U(s,n,l),U(s,r,l),k(r,a)},p(s,l){l&32&&i!==(i=s[5].t("Share")+"")&&Ne(a,i)},d(s){s&&(p(e),p(n),p(r))}}}function Pv(o){let e,t,n,r=o[5].t("Overview")+"",i,a;return e=new kv({props:{className:" size-4",strokeWidth:"1.5"}}),{c(){te(e.$$.fragment),t=$(),n=M("div"),i=Se(r),this.h()},l(s){re(e.$$.fragment,s),t=ee(s),n=P(s,"DIV",{class:!0});var l=I(n);i=Ae(l,r),l.forEach(p),this.h()},h(){g(n,"class","flex items-center")},m(s,l){ne(e,s,l),U(s,t,l),U(s,n,l),k(n,i),a=!0},p(s,l){(!a||l&32)&&r!==(r=s[5].t("Overview")+"")&&Ne(i,r)},i(s){a||(T(e.$$.fragment,s),a=!0)},o(s){D(e.$$.fragment,s),a=!1},d(s){s&&(p(t),p(n)),oe(e,s)}}}function Ov(o){let e,t,n,r=o[5].t("Artifacts")+"",i,a;return e=new Sv({props:{className:" size-4",strokeWidth:"1.5"}}),{c(){te(e.$$.fragment),t=$(),n=M("div"),i=Se(r),this.h()},l(s){re(e.$$.fragment,s),t=ee(s),n=P(s,"DIV",{class:!0});var l=I(n);i=Ae(l,r),l.forEach(p),this.h()},h(){g(n,"class","flex items-center")},m(s,l){ne(e,s,l),U(s,t,l),U(s,n,l),k(n,i),a=!0},p(s,l){(!a||l&32)&&r!==(r=s[5].t("Artifacts")+"")&&Ne(i,r)},i(s){a||(T(e.$$.fragment,s),a=!0)},o(s){D(e.$$.fragment,s),a=!1},d(s){s&&(p(t),p(n)),oe(e,s)}}}function Nv(o){let e,t,n,r,i=o[5].t("Download")+"",a;return{c(){e=be("svg"),t=be("path"),n=$(),r=M("div"),a=Se(i),this.h()},l(s){e=ye(s,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var l=I(e);t=ye(l,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),I(t).forEach(p),l.forEach(p),n=ee(s),r=P(s,"DIV",{class:!0});var c=I(r);a=Ae(c,i),c.forEach(p),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width","1.5"),g(e,"stroke","currentColor"),g(e,"class","size-4"),g(r,"class","flex items-center")},m(s,l){U(s,e,l),k(e,t),U(s,n,l),U(s,r,l),k(r,a)},p(s,l){l&32&&i!==(i=s[5].t("Download")+"")&&Ne(a,i)},d(s){s&&(p(e),p(n),p(r))}}}function Dv(o){let e,t=o[5].t("Export chat (.json)")+"",n;return{c(){e=M("div"),n=Se(t),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);n=Ae(i,t),i.forEach(p),this.h()},h(){g(e,"class","flex items-center line-clamp-1")},m(r,i){U(r,e,i),k(e,n)},p(r,i){i&32&&t!==(t=r[5].t("Export chat (.json)")+"")&&Ne(n,t)},d(r){r&&p(e)}}}function Hv(o){let e,t=o[5].t("Plain text (.txt)")+"",n;return{c(){e=M("div"),n=Se(t),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);n=Ae(i,t),i.forEach(p),this.h()},h(){g(e,"class","flex items-center line-clamp-1")},m(r,i){U(r,e,i),k(e,n)},p(r,i){i&32&&t!==(t=r[5].t("Plain text (.txt)")+"")&&Ne(n,t)},d(r){r&&p(e)}}}function Lv(o){let e,t=o[5].t("PDF document (.pdf)")+"",n;return{c(){e=M("div"),n=Se(t),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);n=Ae(i,t),i.forEach(p),this.h()},h(){g(e,"class","flex items-center line-clamp-1")},m(r,i){U(r,e,i),k(e,n)},p(r,i){i&32&&t!==(t=r[5].t("PDF document (.pdf)")+"")&&Ne(n,t)},d(r){r&&p(e)}}}function Uv(o){let e,t,n,r,i,a;return e=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Dv]},$$scope:{ctx:o}}}),e.$on("click",o[18]),n=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Hv]},$$scope:{ctx:o}}}),n.$on("click",o[19]),i=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Lv]},$$scope:{ctx:o}}}),i.$on("click",o[20]),{c(){te(e.$$.fragment),t=$(),te(n.$$.fragment),r=$(),te(i.$$.fragment)},l(s){re(e.$$.fragment,s),t=ee(s),re(n.$$.fragment,s),r=ee(s),re(i.$$.fragment,s)},m(s,l){ne(e,s,l),U(s,t,l),ne(n,s,l),U(s,r,l),ne(i,s,l),a=!0},p(s,l){const c={};l&8388640&&(c.$$scope={dirty:l,ctx:s}),e.$set(c);const u={};l&8388640&&(u.$$scope={dirty:l,ctx:s}),n.$set(u);const d={};l&8388640&&(d.$$scope={dirty:l,ctx:s}),i.$set(d)},i(s){a||(T(e.$$.fragment,s),T(n.$$.fragment,s),T(i.$$.fragment,s),a=!0)},o(s){D(e.$$.fragment,s),D(n.$$.fragment,s),D(i.$$.fragment,s),a=!1},d(s){s&&(p(t),p(r)),oe(e,s),oe(n,s),oe(i,s)}}}function Bv(o){let e,t,n,r;return e=new Em({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Nv]},$$scope:{ctx:o}}}),n=new Im({props:{class:"w-full rounded-xl px-1 py-1.5 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",transition:Ei,sideOffset:8,$$slots:{default:[Uv]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment),t=$(),te(n.$$.fragment)},l(i){re(e.$$.fragment,i),t=ee(i),re(n.$$.fragment,i)},m(i,a){ne(e,i,a),U(i,t,a),ne(n,i,a),r=!0},p(i,a){const s={};a&8388640&&(s.$$scope={dirty:a,ctx:i}),e.$set(s);const l={};a&8388640&&(l.$$scope={dirty:a,ctx:i}),n.$set(l)},i(i){r||(T(e.$$.fragment,i),T(n.$$.fragment,i),r=!0)},o(i){D(e.$$.fragment,i),D(n.$$.fragment,i),r=!1},d(i){i&&p(t),oe(e,i),oe(n,i)}}}function zv(o){let e,t,n,r=o[5].t("Copy")+"",i,a;return e=new Zm({props:{className:" size-4",strokeWidth:"1.5"}}),{c(){te(e.$$.fragment),t=$(),n=M("div"),i=Se(r),this.h()},l(s){re(e.$$.fragment,s),t=ee(s),n=P(s,"DIV",{class:!0});var l=I(n);i=Ae(l,r),l.forEach(p),this.h()},h(){g(n,"class","flex items-center")},m(s,l){ne(e,s,l),U(s,t,l),U(s,n,l),k(n,i),a=!0},p(s,l){(!a||l&32)&&r!==(r=s[5].t("Copy")+"")&&Ne(i,r)},i(s){a||(T(e.$$.fragment,s),a=!0)},o(s){D(e.$$.fragment,s),a=!1},d(s){s&&(p(t),p(n)),oe(e,s)}}}function Mu(o){let e,t,n,r,i;return r=new Tm({props:{chatId:o[1].id}}),{c(){e=M("hr"),t=$(),n=M("div"),te(r.$$.fragment),this.h()},l(a){e=P(a,"HR",{class:!0}),t=ee(a),n=P(a,"DIV",{class:!0});var s=I(n);re(r.$$.fragment,s),s.forEach(p),this.h()},h(){g(e,"class","border-gray-100 dark:border-gray-850 my-0.5"),g(n,"class","flex p-1")},m(a,s){U(a,e,s),U(a,t,s),U(a,n,s),ne(r,n,null),i=!0},p(a,s){const l={};s&2&&(l.chatId=a[1].id),r.$set(l)},i(a){i||(T(r.$$.fragment,a),i=!0)},o(a){D(r.$$.fragment,a),i=!1},d(a){a&&(p(e),p(t),p(n)),oe(r)}}}function Vv(o){let e,t,n,r,i,a,s,l,c,u,d,f,h=o[4]&&Au(o),_=!o[3]&&Ru(o);n=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-overview-button",$$slots:{default:[Pv]},$$scope:{ctx:o}}}),n.$on("click",o[16]),i=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-overview-button",$$slots:{default:[Ov]},$$scope:{ctx:o}}}),i.$on("click",o[17]),s=new Cm({props:{$$slots:{default:[Bv]},$$scope:{ctx:o}}}),c=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-copy-button",$$slots:{default:[zv]},$$scope:{ctx:o}}}),c.$on("click",o[21]);let y=!o[3]&&Mu(o);return{c(){h&&h.c(),e=$(),_&&_.c(),t=$(),te(n.$$.fragment),r=$(),te(i.$$.fragment),a=$(),te(s.$$.fragment),l=$(),te(c.$$.fragment),u=$(),y&&y.c(),d=je()},l(v){h&&h.l(v),e=ee(v),_&&_.l(v),t=ee(v),re(n.$$.fragment,v),r=ee(v),re(i.$$.fragment,v),a=ee(v),re(s.$$.fragment,v),l=ee(v),re(c.$$.fragment,v),u=ee(v),y&&y.l(v),d=je()},m(v,m){h&&h.m(v,m),U(v,e,m),_&&_.m(v,m),U(v,t,m),ne(n,v,m),U(v,r,m),ne(i,v,m),U(v,a,m),ne(s,v,m),U(v,l,m),ne(c,v,m),U(v,u,m),y&&y.m(v,m),U(v,d,m),f=!0},p(v,m){v[4]?h?(h.p(v,m),m&16&&T(h,1)):(h=Au(v),h.c(),T(h,1),h.m(e.parentNode,e)):h&&(Le(),D(h,1,1,()=>{h=null}),Ue()),v[3]?_&&(Le(),D(_,1,1,()=>{_=null}),Ue()):_?(_.p(v,m),m&8&&T(_,1)):(_=Ru(v),_.c(),T(_,1),_.m(t.parentNode,t));const b={};m&8388640&&(b.$$scope={dirty:m,ctx:v}),n.$set(b);const w={};m&8388640&&(w.$$scope={dirty:m,ctx:v}),i.$set(w);const C={};m&8388640&&(C.$$scope={dirty:m,ctx:v}),s.$set(C);const O={};m&8388640&&(O.$$scope={dirty:m,ctx:v}),c.$set(O),v[3]?y&&(Le(),D(y,1,1,()=>{y=null}),Ue()):y?(y.p(v,m),m&8&&T(y,1)):(y=Mu(v),y.c(),T(y,1),y.m(d.parentNode,d))},i(v){f||(T(h),T(_),T(n.$$.fragment,v),T(i.$$.fragment,v),T(s.$$.fragment,v),T(c.$$.fragment,v),T(y),f=!0)},o(v){D(h),D(_),D(n.$$.fragment,v),D(i.$$.fragment,v),D(s.$$.fragment,v),D(c.$$.fragment,v),D(y),f=!1},d(v){v&&(p(e),p(t),p(r),p(a),p(l),p(u),p(d)),h&&h.d(v),_&&_.d(v),oe(n,v),oe(i,v),oe(s,v),oe(c,v),y&&y.d(v)}}}function Fv(o){let e,t,n;return t=new Ms({props:{class:"w-full max-w-[200px] rounded-xl px-1 py-1.5  z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",sideOffset:8,side:"bottom",align:"end",transition:Ei,$$slots:{default:[Vv]},$$scope:{ctx:o}}}),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(r){e=P(r,"DIV",{slot:!0});var i=I(e);re(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"slot","content")},m(r,i){U(r,e,i),ne(t,e,null),n=!0},p(r,i){const a={};i&8388667&&(a.$$scope={dirty:i,ctx:r}),t.$set(a)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){D(t.$$.fragment,r),n=!1},d(r){r&&p(e),oe(t)}}}function Kv(o){let e,t;return e=new Rs({props:{$$slots:{content:[Fv],default:[Av]},$$scope:{ctx:o}}}),e.$on("change",o[22]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,[r]){const i={};r&8388667&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function Gv(o,e,t){let n,r,i;de(o,Ss,q=>t(3,n=q)),de(o,As,q=>t(4,r=q));let{$$slots:a={},$$scope:s}=e;const{saveAs:l}=ap,c=on("i18n");de(o,c,q=>t(5,i=q));let{shareEnabled:u=!1}=e,{shareHandler:d}=e,{downloadHandler:f}=e,{chat:h}=e,{onClose:_=()=>{}}=e;const y=async()=>{const q=h.chat.history;return qn(q,q.currentId).reduce((V,N,G,X)=>`${V}### ${N.role.toUpperCase()}
${N.content}

`,"").trim()},v=async()=>{const q=await y();let W=new Blob([q],{type:"text/plain"});l(W,`chat-${h.chat.title}.txt`)},m=async()=>{const q=h.chat.history,W=qn(q,q.currentId),A=await lp(localStorage.token,h.chat.title,W),V=window.URL.createObjectURL(A),N=document.createElement("a");N.href=V,N.download=`chat-${h.chat.title}.pdf`,document.body.appendChild(N),N.click(),document.body.removeChild(N),window.URL.revokeObjectURL(V)},b=async()=>{if(h.id){let q=null;h.id==="local"||n?q=h:q=await ba(localStorage.token,h.id);let W=new Blob([JSON.stringify([q])],{type:"application/json"});l(W,`chat-export-${Date.now()}.json`)}},w=async()=>{await nn.set(!0),await Fo.set(!1),await Mo.set(!1)},C=()=>{d()},O=async()=>{await nn.set(!0),await Fo.set(!0),await Mo.set(!1)},S=async()=>{await nn.set(!0),await Mo.set(!0),await Fo.set(!1)},E=()=>{b()},H=()=>{v()},R=()=>{m()},L=async()=>{await Ya(await y()).catch(W=>{console.error(W)})&&at.success(i.t("Copied to clipboard"))},F=q=>{q.detail===!1&&_()};return o.$$set=q=>{"shareEnabled"in q&&t(11,u=q.shareEnabled),"shareHandler"in q&&t(0,d=q.shareHandler),"downloadHandler"in q&&t(12,f=q.downloadHandler),"chat"in q&&t(1,h=q.chat),"onClose"in q&&t(2,_=q.onClose),"$$scope"in q&&t(23,s=q.$$scope)},[d,h,_,n,r,i,c,y,v,m,b,u,f,a,w,C,O,S,E,H,R,L,F,s]}class Wv extends Ve{constructor(e){super(),Fe(this,e,Gv,Kv,Qe,{shareEnabled:11,shareHandler:0,downloadHandler:12,chat:1,onClose:2})}}function Pu(o){let e,t,n;function r(a){o[18](a)}let i={showSetDefault:!o[2]};return o[0]!==void 0&&(i.selectedModels=o[0]),e=new yv({props:i}),Ye.push(()=>tt(e,"selectedModels",r)),{c(){te(e.$$.fragment)},l(a){re(e.$$.fragment,a)},m(a,s){ne(e,a,s),n=!0},p(a,s){const l={};s&4&&(l.showSetDefault=!a[2]),!t&&s&1&&(t=!0,l.selectedModels=a[0],et(()=>t=!1)),e.$set(l)},i(a){n||(T(e.$$.fragment,a),n=!0)},o(a){D(e.$$.fragment,a),n=!1},d(a){oe(e,a)}}}function Yv(o){let e,t;return e=new Gt({props:{content:o[12].t("Controls"),$$slots:{default:[jv]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&4096&&(i.content=n[12].t("Controls")),r&67117056&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function qv(o){let e,t;return e=new Wv({props:{chat:o[3],shareEnabled:o[2],shareHandler:o[19],downloadHandler:o[20],$$slots:{default:[Qv]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&8&&(i.chat=n[3]),r&4&&(i.shareEnabled=n[2]),r&32&&(i.shareHandler=n[19]),r&64&&(i.downloadHandler=n[20]),r&67108864&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function jv(o){let e,t,n,r,i,a;return n=new Ul({props:{className:" size-5",strokeWidth:"0.5"}}),{c(){e=M("button"),t=M("div"),te(n.$$.fragment),this.h()},l(s){e=P(s,"BUTTON",{class:!0,"aria-label":!0});var l=I(e);t=P(l,"DIV",{class:!0});var c=I(t);re(n.$$.fragment,c),c.forEach(p),l.forEach(p),this.h()},h(){g(t,"class","m-auto self-center"),g(e,"class","flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(e,"aria-label","Controls")},m(s,l){U(s,e,l),k(e,t),ne(n,t,null),r=!0,i||(a=Ie(e,"click",o[21]),i=!0)},p:Re,i(s){r||(T(n.$$.fragment,s),r=!0)},o(s){D(n.$$.fragment,s),r=!1},d(s){s&&p(e),oe(n),i=!1,a()}}}function Qv(o){let e,t='<div class="m-auto self-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"></path></svg></div>';return{c(){e=M("button"),e.innerHTML=t,this.h()},l(n){e=P(n,"BUTTON",{class:!0,id:!0,"data-svelte-h":!0}),wt(e)!=="svelte-xd5mtd"&&(e.innerHTML=t),this.h()},h(){g(e,"class","flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(e,"id","chat-context-menu-button")},m(n,r){U(n,e,r)},p:Re,d(n){n&&p(e)}}}function Ou(o){let e,t;return e=new Gt({props:{content:o[12].t("Controls"),$$slots:{default:[Xv]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&4096&&(i.content=n[12].t("Controls")),r&67117056&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function Xv(o){let e,t,n,r,i,a;return n=new Ul({props:{className:" size-5",strokeWidth:"0.5"}}),{c(){e=M("button"),t=M("div"),te(n.$$.fragment),this.h()},l(s){e=P(s,"BUTTON",{class:!0,"aria-label":!0});var l=I(e);t=P(l,"DIV",{class:!0});var c=I(t);re(n.$$.fragment,c),c.forEach(p),l.forEach(p),this.h()},h(){g(t,"class","m-auto self-center"),g(e,"class","flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(e,"aria-label","Controls")},m(s,l){U(s,e,l),k(e,t),ne(n,t,null),r=!0,i||(a=Ie(e,"click",o[22]),i=!0)},p:Re,i(s){r||(T(n.$$.fragment,s),r=!0)},o(s){D(n.$$.fragment,s),r=!1},d(s){s&&p(e),oe(n),i=!1,a()}}}function Jv(o){let e,t,n,r,i,a,s;return n=new Am({props:{className:" size-5",strokeWidth:"2"}}),{c(){e=M("button"),t=M("div"),te(n.$$.fragment),this.h()},l(l){e=P(l,"BUTTON",{id:!0,class:!0,"aria-label":!0});var c=I(e);t=P(c,"DIV",{class:!0});var u=I(t);re(n.$$.fragment,u),u.forEach(p),c.forEach(p),this.h()},h(){g(t,"class","m-auto self-center"),g(e,"id","new-chat-button"),g(e,"class",r="flex "+(o[8]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(e,"aria-label","New Chat")},m(l,c){U(l,e,c),k(e,t),ne(n,t,null),i=!0,a||(s=Ie(e,"click",o[23]),a=!0)},p(l,c){(!i||c&256&&r!==(r="flex "+(l[8]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-850 transition"))&&g(e,"class",r)},i(l){i||(T(n.$$.fragment,l),i=!0)},o(l){D(n.$$.fragment,l),i=!1},d(l){l&&p(e),oe(n),a=!1,s()}}}function Nu(o){let e,t;return e=new cp({props:{className:"max-w-[200px]",role:o[11].role,$$slots:{default:[xv]},$$scope:{ctx:o}}}),e.$on("show",o[24]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&2048&&(i.role=n[11].role),r&67110912&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function xv(o){let e,t,n,r;return{c(){e=M("button"),t=M("div"),n=M("img"),this.h()},l(i){e=P(i,"BUTTON",{class:!0,"aria-label":!0});var a=I(e);t=P(a,"DIV",{class:!0});var s=I(t);n=P(s,"IMG",{src:!0,class:!0,alt:!0,draggable:!0}),s.forEach(p),a.forEach(p),this.h()},h(){qo(n.src,r=o[11].profile_image_url)||g(n,"src",r),g(n,"class","size-6 object-cover rounded-full"),g(n,"alt","User profile"),g(n,"draggable","false"),g(t,"class","self-center"),g(e,"class","select-none flex rounded-xl p-1.5 w-full hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(e,"aria-label","User Menu")},m(i,a){U(i,e,a),k(e,t),k(t,n)},p(i,a){a&2048&&!qo(n.src,r=i[11].profile_image_url)&&g(n,"src",r)},d(i){i&&p(e)}}}function Zv(o){var j,ue,B;let e,t,n,r,i,a,s,l,c,u,d,f,h,_,y,v,m,b,w,C,O,S,E,H,R,L,F;function q(x){o[16](x)}let W={chatId:o[7]};o[5]!==void 0&&(W.show=o[5]),e=new Sm({props:W}),Ye.push(()=>tt(e,"show",q)),f=new up({});let A=o[4]&&Pu(o);const V=[qv,Yv],N=[];function G(x,J){var ce,me,se;return x[2]&&x[3]&&(x[3].id||x[9])?0:x[10]&&(x[11].role==="admin"||(se=(me=(ce=x[11])==null?void 0:ce.permissions)==null?void 0:me.chat)!=null&&se.controls)?1:-1}~(w=G(o))&&(C=N[w]=V[w](o));let X=!o[10]&&(o[11].role==="admin"||((B=(ue=(j=o[11])==null?void 0:j.permissions)==null?void 0:ue.chat)==null?void 0:B.controls))&&Ou(o);E=new Gt({props:{content:o[12].t("New Chat"),$$slots:{default:[Jv]},$$scope:{ctx:o}}});let Q=o[11]!==void 0&&Nu(o);return{c(){te(e.$$.fragment),n=$(),r=M("nav"),i=M("div"),a=$(),s=M("div"),l=M("div"),c=M("div"),u=M("button"),d=M("div"),te(f.$$.fragment),_=$(),y=M("div"),A&&A.c(),m=$(),b=M("div"),C&&C.c(),O=$(),X&&X.c(),S=$(),te(E.$$.fragment),H=$(),Q&&Q.c(),this.h()},l(x){re(e.$$.fragment,x),n=ee(x),r=P(x,"NAV",{class:!0});var J=I(r);i=P(J,"DIV",{class:!0}),I(i).forEach(p),a=ee(J),s=P(J,"DIV",{class:!0});var ce=I(s);l=P(ce,"DIV",{class:!0});var me=I(l);c=P(me,"DIV",{class:!0});var se=I(c);u=P(se,"BUTTON",{id:!0,class:!0,"aria-label":!0});var Be=I(u);d=P(Be,"DIV",{class:!0});var He=I(d);re(f.$$.fragment,He),He.forEach(p),Be.forEach(p),se.forEach(p),_=ee(me),y=P(me,"DIV",{class:!0});var Y=I(y);A&&A.l(Y),Y.forEach(p),m=ee(me),b=P(me,"DIV",{class:!0});var Xe=I(b);C&&C.l(Xe),O=ee(Xe),X&&X.l(Xe),S=ee(Xe),re(E.$$.fragment,Xe),H=ee(Xe),Q&&Q.l(Xe),Xe.forEach(p),me.forEach(p),ce.forEach(p),J.forEach(p),this.h()},h(){g(i,"class","bg-linear-to-b via-50% from-white via-white to-transparent dark:from-gray-900 dark:via-gray-900 dark:to-transparent pointer-events-none absolute inset-0 -bottom-7 z-[-1]"),g(d,"class","m-auto self-center"),g(u,"id","sidebar-toggle-button"),g(u,"class","cursor-pointer px-2 py-2 flex rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition"),g(u,"aria-label","Toggle Sidebar"),g(c,"class",h=(o[8]?"md:hidden":"")+" mr-1 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),g(y,"class",v="flex-1 overflow-hidden max-w-full py-0.5 "+(o[8]?"ml-1":"")),g(b,"class","self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),g(l,"class","flex items-center w-full max-w-full"),g(s,"class","flex max-w-full w-full mx-auto px-1 pt-0.5 bg-transparent"),g(r,"class","sticky top-0 z-30 w-full px-1.5 py-1.5 -mb-8 flex items-center drag-region")},m(x,J){ne(e,x,J),U(x,n,J),U(x,r,J),k(r,i),k(r,a),k(r,s),k(s,l),k(l,c),k(c,u),k(u,d),ne(f,d,null),k(l,_),k(l,y),A&&A.m(y,null),k(l,m),k(l,b),~w&&N[w].m(b,null),k(b,O),X&&X.m(b,null),k(b,S),ne(E,b,null),k(b,H),Q&&Q.m(b,null),R=!0,L||(F=Ie(u,"click",o[17]),L=!0)},p(x,[J]){var Be,He,Y;const ce={};J&128&&(ce.chatId=x[7]),!t&&J&32&&(t=!0,ce.show=x[5],et(()=>t=!1)),e.$set(ce),(!R||J&256&&h!==(h=(x[8]?"md:hidden":"")+" mr-1 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"))&&g(c,"class",h),x[4]?A?(A.p(x,J),J&16&&T(A,1)):(A=Pu(x),A.c(),T(A,1),A.m(y,null)):A&&(Le(),D(A,1,1,()=>{A=null}),Ue()),(!R||J&256&&v!==(v="flex-1 overflow-hidden max-w-full py-0.5 "+(x[8]?"ml-1":"")))&&g(y,"class",v);let me=w;w=G(x),w===me?~w&&N[w].p(x,J):(C&&(Le(),D(N[me],1,1,()=>{N[me]=null}),Ue()),~w?(C=N[w],C?C.p(x,J):(C=N[w]=V[w](x),C.c()),T(C,1),C.m(b,O)):C=null),!x[10]&&(x[11].role==="admin"||(Y=(He=(Be=x[11])==null?void 0:Be.permissions)==null?void 0:He.chat)!=null&&Y.controls)?X?(X.p(x,J),J&3072&&T(X,1)):(X=Ou(x),X.c(),T(X,1),X.m(b,S)):X&&(Le(),D(X,1,1,()=>{X=null}),Ue());const se={};J&4096&&(se.content=x[12].t("New Chat")),J&67109122&&(se.$$scope={dirty:J,ctx:x}),E.$set(se),x[11]!==void 0?Q?(Q.p(x,J),J&2048&&T(Q,1)):(Q=Nu(x),Q.c(),T(Q,1),Q.m(b,null)):Q&&(Le(),D(Q,1,1,()=>{Q=null}),Ue())},i(x){R||(T(e.$$.fragment,x),T(f.$$.fragment,x),T(A),T(C),T(X),T(E.$$.fragment,x),T(Q),R=!0)},o(x){D(e.$$.fragment,x),D(f.$$.fragment,x),D(A),D(C),D(X),D(E.$$.fragment,x),D(Q),R=!1},d(x){x&&(p(n),p(r)),oe(e,x),oe(f),A&&A.d(),~w&&N[w].d(),X&&X.d(),oe(E),Q&&Q.d(),L=!1,F()}}}function $v(o,e,t){let n,r,i,a,s,l,c,u;de(o,tf,W=>t(25,n=W)),de(o,gr,W=>t(7,r=W)),de(o,_a,W=>t(8,i=W)),de(o,Ss,W=>t(9,a=W)),de(o,As,W=>t(10,s=W)),de(o,Xo,W=>t(11,l=W)),de(o,nn,W=>t(13,u=W));const d=on("i18n");de(o,d,W=>t(12,c=W));let{initNewChat:f}=e,{title:h=n}=e,{shareEnabled:_=!1}=e,{chat:y}=e,{selectedModels:v}=e,{showModelSelector:m=!0}=e,b=!1,w=!1;function C(W){b=W,t(5,b)}const O=()=>{_a.set(!i)};function S(W){v=W,t(0,v)}const E=()=>{t(5,b=!b)},H=()=>{t(6,w=!w)},R=async()=>{await nn.set(!u)},L=async()=>{await nn.set(!u)},F=()=>{f()},q=W=>{W.detail==="archived-chat"&&$g.set(!0)};return o.$$set=W=>{"initNewChat"in W&&t(1,f=W.initNewChat),"title"in W&&t(15,h=W.title),"shareEnabled"in W&&t(2,_=W.shareEnabled),"chat"in W&&t(3,y=W.chat),"selectedModels"in W&&t(0,v=W.selectedModels),"showModelSelector"in W&&t(4,m=W.showModelSelector)},[v,f,_,y,m,b,w,r,i,a,s,l,c,u,d,h,C,O,S,E,H,R,L,F,q]}class ew extends Ve{constructor(e){super(),Fe(this,e,$v,Zv,Qe,{initNewChat:1,title:15,shareEnabled:2,chat:3,selectedModels:0,showModelSelector:4})}}function Qt(o){if(typeof o=="string"||typeof o=="number")return""+o;let e="";if(Array.isArray(o))for(let t=0,n;t<o.length;t++)(n=Qt(o[t]))!==""&&(e+=(e&&" ")+n);else for(let t in o)o[t]&&(e+=(e&&" ")+t);return e}const Ri={error001:()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",error002:()=>"It looks like you've created a new nodeTypes or edgeTypes object. If this wasn't on purpose please define the nodeTypes/edgeTypes outside of the component or memoize them.",error003:o=>`Node type "${o}" not found. Using fallback type "default".`,error004:()=>"The React Flow parent container needs a width and a height to render the graph.",error005:()=>"Only child nodes can use a parent extent.",error006:()=>"Can't create edge. An edge needs a source and a target.",error007:o=>`The old edge with id=${o} does not exist.`,error009:o=>`Marker type "${o}" doesn't exist.`,error008:(o,{id:e,sourceHandle:t,targetHandle:n})=>`Couldn't create edge for ${o} handle id: "${o==="source"?t:n}", edge id: ${e}.`,error010:()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",error011:o=>`Edge type "${o}" not found. Using fallback type "default".`,error012:o=>`Node with id "${o}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,error013:(o="react")=>`It seems that you haven't loaded the styles. Please import '@xyflow/${o}/dist/style.css' or base.css to make sure everything is working properly.`},bs=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]];var Ir;(function(o){o.Strict="strict",o.Loose="loose"})(Ir||(Ir={}));var Oo;(function(o){o.Free="free",o.Vertical="vertical",o.Horizontal="horizontal"})(Oo||(Oo={}));var ys;(function(o){o.Partial="partial",o.Full="full"})(ys||(ys={}));const Va={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var Fr;(function(o){o.Bezier="default",o.Straight="straight",o.Step="step",o.SmoothStep="smoothstep",o.SimpleBezier="simplebezier"})(Fr||(Fr={}));var vs;(function(o){o.Arrow="arrow",o.ArrowClosed="arrowclosed"})(vs||(vs={}));var ht;(function(o){o.Left="left",o.Top="top",o.Right="right",o.Bottom="bottom"})(ht||(ht={}));const Du={[ht.Left]:ht.Right,[ht.Right]:ht.Left,[ht.Top]:ht.Bottom,[ht.Bottom]:ht.Top};function tw(o,e){if(!o&&!e)return!0;if(!o||!e||o.size!==e.size)return!1;if(!o.size&&!e.size)return!0;for(const t of o.keys())if(!e.has(t))return!1;return!0}function Hu(o,e,t){if(!t)return;const n=[];o.forEach((r,i)=>{e!=null&&e.has(i)||n.push(r)}),n.length&&t(n)}function Lu(o){return o===null?null:o?"valid":"invalid"}const nw=o=>"id"in o&&"source"in o&&"target"in o,ow=o=>"id"in o&&"position"in o&&!("source"in o)&&!("target"in o),Bl=o=>"id"in o&&"internals"in o&&!("source"in o)&&!("target"in o),qs=(o,e=[0,0])=>{const{width:t,height:n}=$r(o),r=o.origin??e,i=t*r[0],a=n*r[1];return{x:o.position.x-i,y:o.position.y-a}},rw=(o,e={nodeOrigin:[0,0],nodeLookup:void 0})=>{if(o.length===0)return{x:0,y:0,width:0,height:0};const t=o.reduce((n,r)=>{const i=typeof r=="string";let a=!e.nodeLookup&&!i?r:void 0;e.nodeLookup&&(a=i?e.nodeLookup.get(r):Bl(r)?r:e.nodeLookup.get(r.id));const s=a?ws(a,e.nodeOrigin):{x:0,y:0,x2:0,y2:0};return Qs(n,s)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return Xs(t)},js=(o,e={})=>{if(o.size===0)return{x:0,y:0,width:0,height:0};let t={x:1/0,y:1/0,x2:-1/0,y2:-1/0};return o.forEach(n=>{if(e.filter===void 0||e.filter(n)){const r=ws(n);t=Qs(t,r)}}),Xs(t)},ng=(o,e,[t,n,r]=[0,0,1],i=!1,a=!1)=>{const s={...Mi(e,[t,n,r]),width:e.width/r,height:e.height/r},l=[];for(const c of o.values()){const{measured:u,selectable:d=!0,hidden:f=!1}=c;if(a&&!d||f)continue;const h=u.width??c.width??c.initialWidth??null,_=u.height??c.height??c.initialHeight??null,y=vi(s,Qr(c)),v=(h??0)*(_??0),m=i&&y>0;(!c.internals.handleBounds||m||y>=v||c.dragging)&&l.push(c)}return l},Fa=(o,e)=>{const t=new Set;return o.forEach(n=>{t.add(n.id)}),e.filter(n=>t.has(n.source)||t.has(n.target))};function Uu(o,e){const t=new Map,n=e!=null&&e.nodes?new Set(e.nodes.map(r=>r.id)):null;return o.forEach(r=>{r.measured.width&&r.measured.height&&((e==null?void 0:e.includeHiddenNodes)||!r.hidden)&&(!n||n.has(r.id))&&t.set(r.id,r)}),t}async function Bu({nodes:o,width:e,height:t,panZoom:n,minZoom:r,maxZoom:i},a){if(o.size===0)return Promise.resolve(!1);const s=js(o),l=Vl(s,e,t,(a==null?void 0:a.minZoom)??r,(a==null?void 0:a.maxZoom)??i,(a==null?void 0:a.padding)??.1);return await n.setViewport(l,{duration:a==null?void 0:a.duration}),Promise.resolve(!0)}function iw({nodeId:o,nextPosition:e,nodeLookup:t,nodeOrigin:n=[0,0],nodeExtent:r,onError:i}){const a=t.get(o),s=a.parentId?t.get(a.parentId):void 0,{x:l,y:c}=s?s.internals.positionAbsolute:{x:0,y:0},u=a.origin??n;let d=r;if(a.extent==="parent"&&!a.expandParent)if(!s)i==null||i("005",Ri.error005());else{const h=s.measured.width,_=s.measured.height;h&&_&&(d=[[l,c],[l+h,c+_]])}else s&&wi(a.extent)&&(d=[[a.extent[0][0]+l,a.extent[0][1]+c],[a.extent[1][0]+l,a.extent[1][1]+c]]);const f=wi(d)?jr(e,d,a.measured):e;return{position:{x:f.x-l+a.measured.width*u[0],y:f.y-c+a.measured.height*u[1]},positionAbsolute:f}}async function og({nodesToRemove:o=[],edgesToRemove:e=[],nodes:t,edges:n,onBeforeDelete:r}){const i=new Set(o.map(f=>f.id)),a=[];for(const f of t){if(f.deletable===!1)continue;const h=i.has(f.id),_=!h&&f.parentId&&a.find(y=>y.id===f.parentId);(h||_)&&a.push(f)}const s=new Set(e.map(f=>f.id)),l=n.filter(f=>f.deletable!==!1),u=Fa(a,l);for(const f of l)s.has(f.id)&&!u.find(_=>_.id===f.id)&&u.push(f);if(!r)return{edges:u,nodes:a};const d=await r({nodes:a,edges:u});return typeof d=="boolean"?d?{edges:u,nodes:a}:{edges:[],nodes:[]}:d}const qr=(o,e=0,t=1)=>Math.min(Math.max(o,e),t),jr=(o={x:0,y:0},e,t)=>({x:qr(o.x,e[0][0],e[1][0]-((t==null?void 0:t.width)??0)),y:qr(o.y,e[0][1],e[1][1]-((t==null?void 0:t.height)??0))});function rg(o,e,t){const{width:n,height:r}=$r(t),{x:i,y:a}=t.internals.positionAbsolute;return jr(o,[[i,a],[i+n,a+r]],e)}const zu=(o,e,t)=>o<e?qr(Math.abs(o-e),1,e)/e:o>t?-qr(Math.abs(o-t),1,e)/e:0,ig=(o,e,t=15,n=40)=>{const r=zu(o.x,n,e.width-n)*t,i=zu(o.y,n,e.height-n)*t;return[r,i]},Qs=(o,e)=>({x:Math.min(o.x,e.x),y:Math.min(o.y,e.y),x2:Math.max(o.x2,e.x2),y2:Math.max(o.y2,e.y2)}),Ka=({x:o,y:e,width:t,height:n})=>({x:o,y:e,x2:o+t,y2:e+n}),Xs=({x:o,y:e,x2:t,y2:n})=>({x:o,y:e,width:t-o,height:n-e}),Qr=(o,e=[0,0])=>{var r,i;const{x:t,y:n}=Bl(o)?o.internals.positionAbsolute:qs(o,e);return{x:t,y:n,width:((r=o.measured)==null?void 0:r.width)??o.width??o.initialWidth??0,height:((i=o.measured)==null?void 0:i.height)??o.height??o.initialHeight??0}},ws=(o,e=[0,0])=>{var r,i;const{x:t,y:n}=Bl(o)?o.internals.positionAbsolute:qs(o,e);return{x:t,y:n,x2:t+(((r=o.measured)==null?void 0:r.width)??o.width??o.initialWidth??0),y2:n+(((i=o.measured)==null?void 0:i.height)??o.height??o.initialHeight??0)}},sw=(o,e)=>Xs(Qs(Ka(o),Ka(e))),vi=(o,e)=>{const t=Math.max(0,Math.min(o.x+o.width,e.x+e.width)-Math.max(o.x,e.x)),n=Math.max(0,Math.min(o.y+o.height,e.y+e.height)-Math.max(o.y,e.y));return Math.ceil(t*n)},Vu=o=>po(o.width)&&po(o.height)&&po(o.x)&&po(o.y),po=o=>!isNaN(o)&&isFinite(o),aw=(o,e)=>{},zl=(o,e=[1,1])=>({x:e[0]*Math.round(o.x/e[0]),y:e[1]*Math.round(o.y/e[1])}),Mi=({x:o,y:e},[t,n,r],i=!1,a=[1,1])=>{const s={x:(o-t)/r,y:(e-n)/r};return i?zl(s,a):s},sg=({x:o,y:e},[t,n,r])=>({x:o*r+t,y:e*r+n}),Vl=(o,e,t,n,r,i)=>{const a=e/(o.width*(1+i)),s=t/(o.height*(1+i)),l=Math.min(a,s),c=qr(l,n,r),u=o.x+o.width/2,d=o.y+o.height/2,f=e/2-u*c,h=t/2-d*c;return{x:f,y:h,zoom:c}},ks=()=>{var o;return typeof navigator<"u"&&((o=navigator==null?void 0:navigator.userAgent)==null?void 0:o.indexOf("Mac"))>=0};function wi(o){return o!==void 0&&o!=="parent"}function $r(o){var e,t;return{width:((e=o.measured)==null?void 0:e.width)??o.width??o.initialWidth??0,height:((t=o.measured)==null?void 0:t.height)??o.height??o.initialHeight??0}}function Fu(o){var e,t;return(((e=o.measured)==null?void 0:e.width)??o.width??o.initialWidth)!==void 0&&(((t=o.measured)==null?void 0:t.height)??o.height??o.initialHeight)!==void 0}function lw(o,e={width:0,height:0},t,n,r){let i=t;const a={...o};for(;i;){const s=n.get(i);if(i=s==null?void 0:s.parentId,s){const l=s.origin||r;a.x+=s.internals.positionAbsolute.x-(e.width??0)*l[0],a.y+=s.internals.positionAbsolute.y-(e.height??0)*l[1]}}return a}function da(o,{snapGrid:e=[0,0],snapToGrid:t=!1,transform:n}){const{x:r,y:i}=Wo(o),a=Mi({x:r,y:i},n),{x:s,y:l}=t?zl(a,e):a;return{xSnapped:s,ySnapped:l,...a}}const ag=o=>({width:o.offsetWidth,height:o.offsetHeight}),cw=o=>{var e;return((e=o.getRootNode)==null?void 0:e.call(o))||(window==null?void 0:window.document)},uw=["INPUT","SELECT","TEXTAREA"];function dw(o){var n,r;const e=((r=(n=o.composedPath)==null?void 0:n.call(o))==null?void 0:r[0])||o.target;return uw.includes(e==null?void 0:e.nodeName)||(e==null?void 0:e.hasAttribute("contenteditable"))||!!(e!=null&&e.closest(".nokey"))}const lg=o=>"clientX"in o,Wo=(o,e)=>{var i,a;const t=lg(o),n=t?o.clientX:(i=o.touches)==null?void 0:i[0].clientX,r=t?o.clientY:(a=o.touches)==null?void 0:a[0].clientY;return{x:n-((e==null?void 0:e.left)??0),y:r-((e==null?void 0:e.top)??0)}},Ku=(o,e,t,n,r)=>{const i=e.querySelectorAll(`.${o}`);return!i||!i.length?null:Array.from(i).map(a=>{const s=a.getBoundingClientRect();return{id:a.getAttribute("data-handleid"),type:o,nodeId:r,position:a.getAttribute("data-handlepos"),x:(s.left-t.left)/n,y:(s.top-t.top)/n,...ag(a)}})};function fw({sourceX:o,sourceY:e,targetX:t,targetY:n,sourceControlX:r,sourceControlY:i,targetControlX:a,targetControlY:s}){const l=o*.125+r*.375+a*.375+t*.125,c=e*.125+i*.375+s*.375+n*.125,u=Math.abs(l-o),d=Math.abs(c-e);return[l,c,u,d]}function xi(o,e){return o>=0?.5*o:e*25*Math.sqrt(-o)}function Gu({pos:o,x1:e,y1:t,x2:n,y2:r,c:i}){switch(o){case ht.Left:return[e-xi(e-n,i),t];case ht.Right:return[e+xi(n-e,i),t];case ht.Top:return[e,t-xi(t-r,i)];case ht.Bottom:return[e,t+xi(r-t,i)]}}function cg({sourceX:o,sourceY:e,sourcePosition:t=ht.Bottom,targetX:n,targetY:r,targetPosition:i=ht.Top,curvature:a=.25}){const[s,l]=Gu({pos:t,x1:o,y1:e,x2:n,y2:r,c:a}),[c,u]=Gu({pos:i,x1:n,y1:r,x2:o,y2:e,c:a}),[d,f,h,_]=fw({sourceX:o,sourceY:e,targetX:n,targetY:r,sourceControlX:s,sourceControlY:l,targetControlX:c,targetControlY:u});return[`M${o},${e} C${s},${l} ${c},${u} ${n},${r}`,d,f,h,_]}function ug({sourceX:o,sourceY:e,targetX:t,targetY:n}){const r=Math.abs(t-o)/2,i=t<o?t+r:t-r,a=Math.abs(n-e)/2,s=n<e?n+a:n-a;return[i,s,r,a]}function hw({sourceNode:o,targetNode:e,selected:t=!1,zIndex:n=0,elevateOnSelect:r=!1}){if(!r)return n;const i=t||e.selected||o.selected,a=Math.max(o.internals.z||0,e.internals.z||0,1e3);return n+(i?a:0)}function gw({sourceNode:o,targetNode:e,width:t,height:n,transform:r}){const i=Qs(ws(o),ws(e));i.x===i.x2&&(i.x2+=1),i.y===i.y2&&(i.y2+=1);const a={x:-r[0]/r[2],y:-r[1]/r[2],width:t/r[2],height:n/r[2]};return vi(a,Xs(i))>0}const mw=({source:o,sourceHandle:e,target:t,targetHandle:n})=>`xy-edge__${o}${e||""}-${t}${n||""}`,pw=(o,e)=>e.some(t=>t.source===o.source&&t.target===o.target&&(t.sourceHandle===o.sourceHandle||!t.sourceHandle&&!o.sourceHandle)&&(t.targetHandle===o.targetHandle||!t.targetHandle&&!o.targetHandle)),_w=(o,e)=>{if(!o.source||!o.target)return e;let t;return nw(o)?t={...o}:t={...o,id:mw(o)},pw(t,e)?e:(t.sourceHandle===null&&delete t.sourceHandle,t.targetHandle===null&&delete t.targetHandle,e.concat(t))};function dg({sourceX:o,sourceY:e,targetX:t,targetY:n}){const[r,i,a,s]=ug({sourceX:o,sourceY:e,targetX:t,targetY:n});return[`M ${o},${e}L ${t},${n}`,r,i,a,s]}const Wu={[ht.Left]:{x:-1,y:0},[ht.Right]:{x:1,y:0},[ht.Top]:{x:0,y:-1},[ht.Bottom]:{x:0,y:1}},bw=({source:o,sourcePosition:e=ht.Bottom,target:t})=>e===ht.Left||e===ht.Right?o.x<t.x?{x:1,y:0}:{x:-1,y:0}:o.y<t.y?{x:0,y:1}:{x:0,y:-1},Yu=(o,e)=>Math.sqrt(Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2));function yw({source:o,sourcePosition:e=ht.Bottom,target:t,targetPosition:n=ht.Top,center:r,offset:i}){const a=Wu[e],s=Wu[n],l={x:o.x+a.x*i,y:o.y+a.y*i},c={x:t.x+s.x*i,y:t.y+s.y*i},u=bw({source:l,sourcePosition:e,target:c}),d=u.x!==0?"x":"y",f=u[d];let h=[],_,y;const v={x:0,y:0},m={x:0,y:0},[b,w,C,O]=ug({sourceX:o.x,sourceY:o.y,targetX:t.x,targetY:t.y});if(a[d]*s[d]===-1){_=r.x??b,y=r.y??w;const E=[{x:_,y:l.y},{x:_,y:c.y}],H=[{x:l.x,y},{x:c.x,y}];a[d]===f?h=d==="x"?E:H:h=d==="x"?H:E}else{const E=[{x:l.x,y:c.y}],H=[{x:c.x,y:l.y}];if(d==="x"?h=a.x===f?H:E:h=a.y===f?E:H,e===n){const W=Math.abs(o[d]-t[d]);if(W<=i){const A=Math.min(i-1,i-W);a[d]===f?v[d]=(l[d]>o[d]?-1:1)*A:m[d]=(c[d]>t[d]?-1:1)*A}}if(e!==n){const W=d==="x"?"y":"x",A=a[d]===s[W],V=l[W]>c[W],N=l[W]<c[W];(a[d]===1&&(!A&&V||A&&N)||a[d]!==1&&(!A&&N||A&&V))&&(h=d==="x"?E:H)}const R={x:l.x+v.x,y:l.y+v.y},L={x:c.x+m.x,y:c.y+m.y},F=Math.max(Math.abs(R.x-h[0].x),Math.abs(L.x-h[0].x)),q=Math.max(Math.abs(R.y-h[0].y),Math.abs(L.y-h[0].y));F>=q?(_=(R.x+L.x)/2,y=h[0].y):(_=h[0].x,y=(R.y+L.y)/2)}return[[o,{x:l.x+v.x,y:l.y+v.y},...h,{x:c.x+m.x,y:c.y+m.y},t],_,y,C,O]}function vw(o,e,t,n){const r=Math.min(Yu(o,e)/2,Yu(e,t)/2,n),{x:i,y:a}=e;if(o.x===i&&i===t.x||o.y===a&&a===t.y)return`L${i} ${a}`;if(o.y===a){const c=o.x<t.x?-1:1,u=o.y<t.y?1:-1;return`L ${i+r*c},${a}Q ${i},${a} ${i},${a+r*u}`}const s=o.x<t.x?1:-1,l=o.y<t.y?-1:1;return`L ${i},${a+r*l}Q ${i},${a} ${i+r*s},${a}`}function Cs({sourceX:o,sourceY:e,sourcePosition:t=ht.Bottom,targetX:n,targetY:r,targetPosition:i=ht.Top,borderRadius:a=5,centerX:s,centerY:l,offset:c=20}){const[u,d,f,h,_]=yw({source:{x:o,y:e},sourcePosition:t,target:{x:n,y:r},targetPosition:i,center:{x:s,y:l},offset:c});return[u.reduce((v,m,b)=>{let w="";return b>0&&b<u.length-1?w=vw(u[b-1],m,u[b+1],a):w=`${b===0?"M":"L"}${m.x} ${m.y}`,v+=w,v},""),d,f,h,_]}function qu(o){var e;return o&&!!(o.internals.handleBounds||(e=o.handles)!=null&&e.length)&&!!(o.measured.width||o.width||o.initialWidth)}function ww(o){var d;const{sourceNode:e,targetNode:t}=o;if(!qu(e)||!qu(t))return null;const n=e.internals.handleBounds||ju(e.handles),r=t.internals.handleBounds||ju(t.handles),i=Qu((n==null?void 0:n.source)??[],o.sourceHandle),a=Qu(o.connectionMode===Ir.Strict?(r==null?void 0:r.target)??[]:((r==null?void 0:r.target)??[]).concat((r==null?void 0:r.source)??[]),o.targetHandle);if(!i||!a)return(d=o.onError)==null||d.call(o,"008",Ri.error008(i?"target":"source",{id:o.id,sourceHandle:o.sourceHandle,targetHandle:o.targetHandle})),null;const s=(i==null?void 0:i.position)||ht.Bottom,l=(a==null?void 0:a.position)||ht.Top,c=ki(e,i,s),u=ki(t,a,l);return{sourceX:c.x,sourceY:c.y,targetX:u.x,targetY:u.y,sourcePosition:s,targetPosition:l}}function ju(o){if(!o)return null;const e=[],t=[];for(const n of o)n.width=n.width??1,n.height=n.height??1,n.type==="source"?e.push(n):n.type==="target"&&t.push(n);return{source:e,target:t}}function ki(o,e,t=ht.Left,n=!1){const r=((e==null?void 0:e.x)??0)+o.internals.positionAbsolute.x,i=((e==null?void 0:e.y)??0)+o.internals.positionAbsolute.y,{width:a,height:s}=e??$r(o);if(n)return{x:r+a/2,y:i+s/2};switch((e==null?void 0:e.position)??t){case ht.Top:return{x:r+a/2,y:i};case ht.Right:return{x:r+a,y:i+s/2};case ht.Bottom:return{x:r+a/2,y:i+s};case ht.Left:return{x:r,y:i+s/2}}}function Qu(o,e){return o&&(e?o.find(t=>t.id===e):o[0])||null}function Ga(o,e){return o?typeof o=="string"?o:`${e?`${e}__`:""}${Object.keys(o).sort().map(n=>`${n}=${o[n]}`).join("&")}`:""}function kw(o,{id:e,defaultColor:t,defaultMarkerStart:n,defaultMarkerEnd:r}){const i=new Set;return o.reduce((a,s)=>([s.markerStart||n,s.markerEnd||r].forEach(l=>{if(l&&typeof l=="object"){const c=Ga(l,e);i.has(c)||(a.push({id:c,color:l.color||t,...l}),i.add(c))}}),a),[]).sort((a,s)=>a.id.localeCompare(s.id))}const fg={nodeOrigin:[0,0],nodeExtent:bs,elevateNodesOnSelect:!0,defaults:{}},Cw={...fg,checkEquality:!0};function hg(o,e){const t={...o};for(const n in e)e[n]!==void 0&&(t[n]=e[n]);return t}function gg(o,e,t,n){var s,l;const r=hg(Cw,n),i=new Map(e),a=r!=null&&r.elevateNodesOnSelect?1e3:0;e.clear(),t.clear();for(const c of o){let u=i.get(c.id);if(r.checkEquality&&c===(u==null?void 0:u.internals.userNode))e.set(c.id,u);else{const d=qs(c,r.nodeOrigin),f=wi(c.extent)?c.extent:r.nodeExtent,h=jr(d,f,$r(c));u={...r.defaults,...c,measured:{width:(s=c.measured)==null?void 0:s.width,height:(l=c.measured)==null?void 0:l.height},internals:{positionAbsolute:h,handleBounds:c.measured?u==null?void 0:u.internals.handleBounds:void 0,z:pg(c,a),userNode:c}},e.set(c.id,u)}c.parentId&&mg(u,e,t,n)}}function Ew(o,e){if(!o.parentId)return;const t=e.get(o.parentId);t?t.set(o.id,o):e.set(o.parentId,new Map([[o.id,o]]))}function mg(o,e,t,n){const{elevateNodesOnSelect:r,nodeOrigin:i,nodeExtent:a}=hg(fg,n),s=o.parentId,l=e.get(s);if(!l){console.warn(`Parent node ${s} not found. Please make sure that parent nodes are in front of their child nodes in the nodes array.`);return}Ew(o,t);const c=r?1e3:0,{x:u,y:d,z:f}=Iw(o,l,i,a,c),{positionAbsolute:h}=o.internals,_=u!==h.x||d!==h.y;(_||f!==o.internals.z)&&(o.internals={...o.internals,positionAbsolute:_?{x:u,y:d}:h,z:f})}function pg(o,e){return(po(o.zIndex)?o.zIndex:0)+(o.selected?e:0)}function Iw(o,e,t,n,r){const{x:i,y:a}=e.internals.positionAbsolute,s=$r(o),l=qs(o,t),c=wi(o.extent)?jr(l,o.extent,s):l;let u=jr({x:i+c.x,y:a+c.y},n,s);o.extent==="parent"&&(u=rg(u,s,e));const d=pg(o,r),f=e.internals.z??0;return{x:u.x,y:u.y,z:f>d?f:d}}function Tw(o,e,t,n=[0,0]){var a;const r=[],i=new Map;for(const s of o){const l=e.get(s.parentId);if(!l)continue;const c=((a=i.get(s.parentId))==null?void 0:a.expandedRect)??Qr(l),u=sw(c,s.rect);i.set(s.parentId,{expandedRect:u,parent:l})}return i.size>0&&i.forEach(({expandedRect:s,parent:l},c)=>{var w;const u=l.internals.positionAbsolute,d=$r(l),f=l.origin??n,h=s.x<u.x?Math.round(Math.abs(u.x-s.x)):0,_=s.y<u.y?Math.round(Math.abs(u.y-s.y)):0,y=Math.max(d.width,Math.round(s.width)),v=Math.max(d.height,Math.round(s.height)),m=(y-d.width)*f[0],b=(v-d.height)*f[1];(h>0||_>0||m||b)&&(r.push({id:c,type:"position",position:{x:l.position.x-h+m,y:l.position.y-_+b}}),(w=t.get(c))==null||w.forEach(C=>{o.some(O=>O.id===C.id)||r.push({id:C.id,type:"position",position:{x:C.position.x+h,y:C.position.y+_}})})),(d.width<s.width||d.height<s.height||h||_)&&r.push({id:c,type:"dimensions",setAttributes:!0,dimensions:{width:y+(h?f[0]*h-m:0),height:v+(_?f[1]*_-b:0)}})}),r}function Sw(o,e,t,n,r,i){const a=n==null?void 0:n.querySelector(".xyflow__viewport");let s=!1;if(!a)return{changes:[],updatedInternals:s};const l=[],c=window.getComputedStyle(a),{m22:u}=new window.DOMMatrixReadOnly(c.transform),d=[];for(const f of o.values()){const h=e.get(f.id);if(h)if(h.hidden)h.internals={...h.internals,handleBounds:void 0},s=!0;else{const _=ag(f.nodeElement),y=h.measured.width!==_.width||h.measured.height!==_.height;if(!!(_.width&&_.height&&(y||!h.internals.handleBounds||f.force))){const m=f.nodeElement.getBoundingClientRect(),b=wi(h.extent)?h.extent:i;let{positionAbsolute:w}=h.internals;h.parentId&&h.extent==="parent"?w=rg(w,_,e.get(h.parentId)):b&&(w=jr(w,b,_)),h.measured=_,h.internals={...h.internals,positionAbsolute:w,handleBounds:{source:Ku("source",f.nodeElement,m,u,h.id),target:Ku("target",f.nodeElement,m,u,h.id)}},h.parentId&&mg(h,e,t,{nodeOrigin:r}),s=!0,y&&(l.push({id:h.id,type:"dimensions",dimensions:_}),h.expandParent&&h.parentId&&d.push({id:h.id,parentId:h.parentId,rect:Qr(h,r)}))}}}if(d.length>0){const f=Tw(d,e,t,r);l.push(...f)}return{changes:l,updatedInternals:s}}async function Aw({delta:o,panZoom:e,transform:t,translateExtent:n,width:r,height:i}){if(!e||!o.x&&!o.y)return Promise.resolve(!1);const a=await e.setViewportConstrained({x:t[0]+o.x,y:t[1]+o.y,zoom:t[2]},[[0,0],[r,i]],n),s=!!a&&(a.x!==t[0]||a.y!==t[1]||a.k!==t[2]);return Promise.resolve(s)}function _g(o,e,t){o.clear(),e.clear();for(const n of t){const{source:r,target:i,sourceHandle:a=null,targetHandle:s=null}=n,l=`${r}-source-${a}`,c=`${i}-target-${s}`,u=o.get(l)||new Map,d=o.get(c)||new Map,f={edgeId:n.id,source:r,target:i,sourceHandle:a,targetHandle:s};e.set(n.id,n),o.set(l,u.set(`${i}-${s}`,f)),o.set(c,d.set(`${r}-${a}`,f))}}function bg(o,e){if(!o.parentId)return!1;const t=e.get(o.parentId);return t?t.selected?!0:bg(t,e):!1}function Xu(o,e,t){let n=o;do{if(n!=null&&n.matches(e))return!0;if(n===t)return!1;n=n.parentElement}while(n);return!1}function Rw(o,e,t,n){const r=new Map;for(const[i,a]of o)if((a.selected||a.id===n)&&(!a.parentId||!bg(a,o))&&(a.draggable||e&&typeof a.draggable>"u")){const s=o.get(i);s&&r.set(i,{id:i,position:s.position||{x:0,y:0},distance:{x:t.x-s.internals.positionAbsolute.x,y:t.y-s.internals.positionAbsolute.y},extent:s.extent,parentId:s.parentId,origin:s.origin,expandParent:s.expandParent,internals:{positionAbsolute:s.internals.positionAbsolute||{x:0,y:0}},measured:{width:s.measured.width??0,height:s.measured.height??0}})}return r}function fa({nodeId:o,dragItems:e,nodeLookup:t,dragging:n=!0}){var a,s;const r=[];for(const[l,c]of e){const u=(a=t.get(l))==null?void 0:a.internals.userNode;u&&r.push({...u,position:c.position,dragging:n})}if(!o)return[r[0],r];const i=t.get(o).internals.userNode;return[{...i,position:((s=e.get(o))==null?void 0:s.position)||i.position,dragging:n},r]}function Mw({onNodeMouseDown:o,getStoreItems:e,onDragStart:t,onDrag:n,onDragStop:r}){let i={x:null,y:null},a=0,s=new Map,l=!1,c={x:0,y:0},u=null,d=!1,f=null,h=!1;function _({noDragClassName:v,handleSelector:m,domNode:b,isSelectable:w,nodeId:C,nodeClickDistance:O=0}){f=mo(b);function S({x:L,y:F},q){const{nodeLookup:W,nodeExtent:A,snapGrid:V,snapToGrid:N,nodeOrigin:G,onNodeDrag:X,onSelectionDrag:Q,onError:j,updateNodePositions:ue}=e();i={x:L,y:F};let B=!1,x={x:0,y:0,x2:0,y2:0};if(s.size>1&&A){const J=js(s);x=Ka(J)}for(const[J,ce]of s){let me={x:L-ce.distance.x,y:F-ce.distance.y};N&&(me=zl(me,V));let se=[[A[0][0],A[0][1]],[A[1][0],A[1][1]]];if(s.size>1&&A&&!ce.extent){const{positionAbsolute:Y}=ce.internals,Xe=Y.x-x.x+A[0][0],Ke=Y.x+ce.measured.width-x.x2+A[1][0],mt=Y.y-x.y+A[0][1],fe=Y.y+ce.measured.height-x.y2+A[1][1];se=[[Xe,mt],[Ke,fe]]}const{position:Be,positionAbsolute:He}=iw({nodeId:J,nextPosition:me,nodeLookup:W,nodeExtent:se,nodeOrigin:G,onError:j});B=B||ce.position.x!==Be.x||ce.position.y!==Be.y,ce.position=Be,ce.internals.positionAbsolute=He}if(B&&(ue(s,!0),q&&(n||X||!C&&Q))){const[J,ce]=fa({nodeId:C,dragItems:s,nodeLookup:W});n==null||n(q,s,J,ce),X==null||X(q,J,ce),C||Q==null||Q(q,ce)}}async function E(){if(!u)return;const{transform:L,panBy:F,autoPanSpeed:q}=e(),[W,A]=ig(c,u,q);(W!==0||A!==0)&&(i.x=(i.x??0)-W/L[2],i.y=(i.y??0)-A/L[2],await F({x:W,y:A})&&S(i,null)),a=requestAnimationFrame(E)}function H(L){var B;const{nodeLookup:F,multiSelectionActive:q,nodesDraggable:W,transform:A,snapGrid:V,snapToGrid:N,selectNodesOnDrag:G,onNodeDragStart:X,onSelectionDragStart:Q,unselectNodesAndEdges:j}=e();d=!0,(!G||!w)&&!q&&C&&((B=F.get(C))!=null&&B.selected||j()),w&&G&&C&&(o==null||o(C));const ue=da(L.sourceEvent,{transform:A,snapGrid:V,snapToGrid:N});if(i=ue,s=Rw(F,W,ue,C),s.size>0&&(t||X||!C&&Q)){const[x,J]=fa({nodeId:C,dragItems:s,nodeLookup:F});t==null||t(L.sourceEvent,s,x,J),X==null||X(L.sourceEvent,x,J),C||Q==null||Q(L.sourceEvent,J)}}const R=Mp().clickDistance(O).on("start",L=>{const{domNode:F,nodeDragThreshold:q,transform:W,snapGrid:A,snapToGrid:V}=e();h=!1,q===0&&H(L),i=da(L.sourceEvent,{transform:W,snapGrid:A,snapToGrid:V}),u=(F==null?void 0:F.getBoundingClientRect())||null,c=Wo(L.sourceEvent,u)}).on("drag",L=>{const{autoPanOnNodeDrag:F,transform:q,snapGrid:W,snapToGrid:A,nodeDragThreshold:V}=e(),N=da(L.sourceEvent,{transform:q,snapGrid:W,snapToGrid:A});if(L.sourceEvent.type==="touchmove"&&L.sourceEvent.touches.length>1&&(h=!0),!h){if(!l&&F&&d&&(l=!0,E()),!d){const G=N.xSnapped-(i.x??0),X=N.ySnapped-(i.y??0);Math.sqrt(G*G+X*X)>V&&H(L)}(i.x!==N.xSnapped||i.y!==N.ySnapped)&&s&&d&&(c=Wo(L.sourceEvent,u),S(N,L.sourceEvent))}}).on("end",L=>{if(!(!d||h)&&(l=!1,d=!1,cancelAnimationFrame(a),s.size>0)){const{nodeLookup:F,updateNodePositions:q,onNodeDragStop:W,onSelectionDragStop:A}=e();if(q(s,!1),r||W||!C&&A){const[V,N]=fa({nodeId:C,dragItems:s,nodeLookup:F,dragging:!1});r==null||r(L.sourceEvent,s,V,N),W==null||W(L.sourceEvent,V,N),C||A==null||A(L.sourceEvent,N)}}}).filter(L=>{const F=L.target;return!L.button&&(!v||!Xu(F,`.${v}`,b))&&(!m||Xu(F,m,b))});f.call(R)}function y(){f==null||f.on(".drag",null)}return{update:_,destroy:y}}function Pw(o,e,t){const n=[],r={x:o.x-t,y:o.y-t,width:t*2,height:t*2};for(const i of e.values())vi(r,Qr(i))>0&&n.push(i);return n}const Ow=250;function Nw(o,e,t,n){var s,l;let r=[],i=1/0;const a=Pw(o,t,e+Ow);for(const c of a){const u=[...((s=c.internals.handleBounds)==null?void 0:s.source)??[],...((l=c.internals.handleBounds)==null?void 0:l.target)??[]];for(const d of u){if(n.nodeId===d.nodeId&&n.type===d.type&&n.id===d.id)continue;const{x:f,y:h}=ki(c,d,d.position,!0),_=Math.sqrt(Math.pow(f-o.x,2)+Math.pow(h-o.y,2));_>e||(_<i?(r=[{...d,x:f,y:h}],i=_):_===i&&r.push({...d,x:f,y:h}))}}if(!r.length)return null;if(r.length>1){const c=n.type==="source"?"target":"source";return r.find(u=>u.type===c)??r[0]}return r[0]}function yg(o,e,t,n,r,i=!1){var c,u,d;const a=n.get(o);if(!a)return null;const s=r==="strict"?(c=a.internals.handleBounds)==null?void 0:c[e]:[...((u=a.internals.handleBounds)==null?void 0:u.source)??[],...((d=a.internals.handleBounds)==null?void 0:d.target)??[]],l=(t?s==null?void 0:s.find(f=>f.id===t):s==null?void 0:s[0])??null;return l&&i?{...l,...ki(a,l,l.position,!0)}:l}function vg(o,e){return o||(e!=null&&e.classList.contains("target")?"target":e!=null&&e.classList.contains("source")?"source":null)}function Dw(o,e){let t=null;return e?t=!0:o&&!e&&(t=!1),t}const wg=()=>!0;function Hw(o,{connectionMode:e,connectionRadius:t,handleId:n,nodeId:r,edgeUpdaterType:i,isTarget:a,domNode:s,nodeLookup:l,lib:c,autoPanOnConnect:u,flowId:d,panBy:f,cancelConnection:h,onConnectStart:_,onConnect:y,onConnectEnd:v,isValidConnection:m=wg,onReconnectEnd:b,updateConnection:w,getTransform:C,getFromHandle:O,autoPanSpeed:S}){const E=cw(o.target);let H=0,R;const{x:L,y:F}=Wo(o),q=E==null?void 0:E.elementFromPoint(L,F),W=vg(i,q),A=s==null?void 0:s.getBoundingClientRect();if(!A||!W)return;const V=yg(r,W,n,l,e);if(!V)return;let N=Wo(o,A),G=!1,X=null,Q=!1,j=null;function ue(){if(!u||!A)return;const[He,Y]=ig(N,A,S);f({x:He,y:Y}),H=requestAnimationFrame(ue)}const B={...V,nodeId:r,type:W,position:V.position},x=l.get(r),ce={inProgress:!0,isValid:null,from:ki(x,B,ht.Left,!0),fromHandle:B,fromPosition:B.position,fromNode:x,to:N,toHandle:null,toPosition:Du[B.position],toNode:null};w(ce);let me=ce;_==null||_(o,{nodeId:r,handleId:n,handleType:W});function se(He){if(!O()||!B){Be(He);return}const Y=C();N=Wo(He,A),R=Nw(Mi(N,Y,!1,[1,1]),t,l,B),G||(ue(),G=!0);const Xe=kg(He,{handle:R,connectionMode:e,fromNodeId:r,fromHandleId:n,fromType:a?"target":"source",isValidConnection:m,doc:E,lib:c,flowId:d,nodeLookup:l});j=Xe.handleDomNode,X=Xe.connection,Q=Dw(!!R,Xe.isValid);const Ke={...me,isValid:Q,to:R&&Q?sg({x:R.x,y:R.y},Y):N,toHandle:Xe.toHandle,toPosition:Q&&Xe.toHandle?Xe.toHandle.position:Du[B.position],toNode:Xe.toHandle?l.get(Xe.toHandle.nodeId):null};Q&&R&&me.toHandle&&Ke.toHandle&&me.toHandle.type===Ke.toHandle.type&&me.toHandle.nodeId===Ke.toHandle.nodeId&&me.toHandle.id===Ke.toHandle.id&&me.to.x===Ke.to.x&&me.to.y===Ke.to.y||(w(Ke),me=Ke)}function Be(He){(R||j)&&X&&Q&&(y==null||y(X));const{inProgress:Y,...Xe}=me,Ke={...Xe,toPosition:me.toHandle?me.toPosition:null};v==null||v(He,Ke),i&&(b==null||b(He,Ke)),h(),cancelAnimationFrame(H),G=!1,Q=!1,X=null,j=null,E.removeEventListener("mousemove",se),E.removeEventListener("mouseup",Be),E.removeEventListener("touchmove",se),E.removeEventListener("touchend",Be)}E.addEventListener("mousemove",se),E.addEventListener("mouseup",Be),E.addEventListener("touchmove",se),E.addEventListener("touchend",Be)}function kg(o,{handle:e,connectionMode:t,fromNodeId:n,fromHandleId:r,fromType:i,doc:a,lib:s,flowId:l,isValidConnection:c=wg,nodeLookup:u}){const d=i==="target",f=e?a.querySelector(`.${s}-flow__handle[data-id="${l}-${e==null?void 0:e.nodeId}-${e==null?void 0:e.id}-${e==null?void 0:e.type}"]`):null,{x:h,y:_}=Wo(o),y=a.elementFromPoint(h,_),v=y!=null&&y.classList.contains(`${s}-flow__handle`)?y:f,m={handleDomNode:v,isValid:!1,connection:null,toHandle:null};if(v){const b=vg(void 0,v),w=v.getAttribute("data-nodeid"),C=v.getAttribute("data-handleid"),O=v.classList.contains("connectable"),S=v.classList.contains("connectableend");if(!w||!b)return m;const E={source:d?w:n,sourceHandle:d?C:r,target:d?n:w,targetHandle:d?r:C};m.connection=E;const R=O&&S&&(t===Ir.Strict?d&&b==="source"||!d&&b==="target":w!==n||C!==r);m.isValid=R&&c(E),m.toHandle=yg(w,b,C,u,t,!1)}return m}const Lw={onPointerDown:Hw,isValid:kg},Uw=(o,e)=>o.x!==e.x||o.y!==e.y||o.zoom!==e.k,Js=o=>({x:o.x,y:o.y,zoom:o.k}),ha=({x:o,y:e,zoom:t})=>Qa.translate(o,e).scale(t),Lr=(o,e)=>o.target.closest(`.${e}`),Cg=(o,e)=>e===2&&Array.isArray(o)&&o.includes(2),ga=(o,e=0,t=()=>{})=>{const n=typeof e=="number"&&e>0;return n||t(),n?o.transition().duration(e).on("end",t):o},Eg=o=>{const e=o.ctrlKey&&ks()?10:1;return-o.deltaY*(o.deltaMode===1?.05:o.deltaMode?1:.002)*e};function Bw({zoomPanValues:o,noWheelClassName:e,d3Selection:t,d3Zoom:n,panOnScrollMode:r,panOnScrollSpeed:i,zoomOnPinch:a,onPanZoomStart:s,onPanZoom:l,onPanZoomEnd:c}){return u=>{if(Lr(u,e))return!1;u.preventDefault(),u.stopImmediatePropagation();const d=t.property("__zoom").k||1;if(u.ctrlKey&&a){const v=To(u),m=Eg(u),b=d*Math.pow(2,m);n.scaleTo(t,b,v,u);return}const f=u.deltaMode===1?20:1;let h=r===Oo.Vertical?0:u.deltaX*f,_=r===Oo.Horizontal?0:u.deltaY*f;!ks()&&u.shiftKey&&r!==Oo.Vertical&&(h=u.deltaY*f,_=0),n.translateBy(t,-(h/d)*i,-(_/d)*i,{internal:!0});const y=Js(t.property("__zoom"));clearTimeout(o.panScrollTimeout),o.isPanScrolling||(o.isPanScrolling=!0,s==null||s(u,y)),o.isPanScrolling&&(l==null||l(u,y),o.panScrollTimeout=setTimeout(()=>{c==null||c(u,y),o.isPanScrolling=!1},150))}}function zw({noWheelClassName:o,preventScrolling:e,d3ZoomHandler:t}){return function(n,r){if(!e&&n.type==="wheel"&&!n.ctrlKey||Lr(n,o))return null;n.preventDefault(),t.call(this,n,r)}}function Vw({zoomPanValues:o,onDraggingChange:e,onPanZoomStart:t}){return n=>{var i,a,s;if((i=n.sourceEvent)!=null&&i.internal)return;const r=Js(n.transform);o.mouseButton=((a=n.sourceEvent)==null?void 0:a.button)||0,o.isZoomingOrPanning=!0,o.prevViewport=r,((s=n.sourceEvent)==null?void 0:s.type)==="mousedown"&&e(!0),t&&(t==null||t(n.sourceEvent,r))}}function Fw({zoomPanValues:o,panOnDrag:e,onPaneContextMenu:t,onTransformChange:n,onPanZoom:r}){return i=>{var a,s;o.usedRightMouseButton=!!(t&&Cg(e,o.mouseButton??0)),(a=i.sourceEvent)!=null&&a.sync||n([i.transform.x,i.transform.y,i.transform.k]),r&&!((s=i.sourceEvent)!=null&&s.internal)&&(r==null||r(i.sourceEvent,Js(i.transform)))}}function Kw({zoomPanValues:o,panOnDrag:e,panOnScroll:t,onDraggingChange:n,onPanZoomEnd:r,onPaneContextMenu:i}){return a=>{var s;if(!((s=a.sourceEvent)!=null&&s.internal)&&(o.isZoomingOrPanning=!1,i&&Cg(e,o.mouseButton??0)&&!o.usedRightMouseButton&&a.sourceEvent&&i(a.sourceEvent),o.usedRightMouseButton=!1,n(!1),r&&Uw(o.prevViewport,a.transform))){const l=Js(a.transform);o.prevViewport=l,clearTimeout(o.timerId),o.timerId=setTimeout(()=>{r==null||r(a.sourceEvent,l)},t?150:0)}}}function Gw({zoomActivationKeyPressed:o,zoomOnScroll:e,zoomOnPinch:t,panOnDrag:n,panOnScroll:r,zoomOnDoubleClick:i,userSelectionActive:a,noWheelClassName:s,noPanClassName:l,lib:c}){return u=>{var _;const d=o||e,f=t&&u.ctrlKey;if(u.button===1&&u.type==="mousedown"&&(Lr(u,`${c}-flow__node`)||Lr(u,`${c}-flow__edge`)))return!0;if(!n&&!d&&!r&&!i&&!t||a||Lr(u,s)&&u.type==="wheel"||Lr(u,l)&&(u.type!=="wheel"||r&&u.type==="wheel"&&!o)||!t&&u.ctrlKey&&u.type==="wheel")return!1;if(!t&&u.type==="touchstart"&&((_=u.touches)==null?void 0:_.length)>1)return u.preventDefault(),!1;if(!d&&!r&&!f&&u.type==="wheel"||!n&&(u.type==="mousedown"||u.type==="touchstart")||Array.isArray(n)&&!n.includes(u.button)&&u.type==="mousedown")return!1;const h=Array.isArray(n)&&n.includes(u.button)||!u.button||u.button<=1;return(!u.ctrlKey||u.type==="wheel")&&h}}function Ww({domNode:o,minZoom:e,maxZoom:t,paneClickDistance:n,translateExtent:r,viewport:i,onPanZoom:a,onPanZoomStart:s,onPanZoomEnd:l,onDraggingChange:c}){const u={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{x:0,y:0,zoom:0},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=o.getBoundingClientRect(),f=Fp().clickDistance(!po(n)||n<0?0:n).scaleExtent([e,t]).translateExtent(r),h=mo(o).call(f);w({x:i.x,y:i.y,zoom:qr(i.zoom,e,t)},[[0,0],[d.width,d.height]],r);const _=h.on("wheel.zoom"),y=h.on("dblclick.zoom");f.wheelDelta(Eg);function v(q,W){return h?new Promise(A=>{f==null||f.transform(ga(h,W==null?void 0:W.duration,()=>A(!0)),q)}):Promise.resolve(!1)}function m({noWheelClassName:q,noPanClassName:W,onPaneContextMenu:A,userSelectionActive:V,panOnScroll:N,panOnDrag:G,panOnScrollMode:X,panOnScrollSpeed:Q,preventScrolling:j,zoomOnPinch:ue,zoomOnScroll:B,zoomOnDoubleClick:x,zoomActivationKeyPressed:J,lib:ce,onTransformChange:me}){V&&!u.isZoomingOrPanning&&b();const Be=N&&!J&&!V?Bw({zoomPanValues:u,noWheelClassName:q,d3Selection:h,d3Zoom:f,panOnScrollMode:X,panOnScrollSpeed:Q,zoomOnPinch:ue,onPanZoomStart:s,onPanZoom:a,onPanZoomEnd:l}):zw({noWheelClassName:q,preventScrolling:j,d3ZoomHandler:_});if(h.on("wheel.zoom",Be,{passive:!1}),!V){const Y=Vw({zoomPanValues:u,onDraggingChange:c,onPanZoomStart:s});f.on("start",Y);const Xe=Fw({zoomPanValues:u,panOnDrag:G,onPaneContextMenu:!!A,onPanZoom:a,onTransformChange:me});f.on("zoom",Xe);const Ke=Kw({zoomPanValues:u,panOnDrag:G,panOnScroll:N,onPaneContextMenu:A,onPanZoomEnd:l,onDraggingChange:c});f.on("end",Ke)}const He=Gw({zoomActivationKeyPressed:J,panOnDrag:G,zoomOnScroll:B,panOnScroll:N,zoomOnDoubleClick:x,zoomOnPinch:ue,userSelectionActive:V,noPanClassName:W,noWheelClassName:q,lib:ce});f.filter(He),x?h.on("dblclick.zoom",y):h.on("dblclick.zoom",null)}function b(){f.on("zoom",null)}async function w(q,W,A){const V=ha(q),N=f==null?void 0:f.constrain()(V,W,A);return N&&await v(N),new Promise(G=>G(N))}async function C(q,W){const A=ha(q);return await v(A,W),new Promise(V=>V(A))}function O(q){if(h){const W=ha(q),A=h.property("__zoom");(A.k!==q.zoom||A.x!==q.x||A.y!==q.y)&&(f==null||f.transform(h,W,null,{sync:!0}))}}function S(){const q=h?$m(h.node()):{x:0,y:0,k:1};return{x:q.x,y:q.y,zoom:q.k}}function E(q,W){return h?new Promise(A=>{f==null||f.scaleTo(ga(h,W==null?void 0:W.duration,()=>A(!0)),q)}):Promise.resolve(!1)}function H(q,W){return h?new Promise(A=>{f==null||f.scaleBy(ga(h,W==null?void 0:W.duration,()=>A(!0)),q)}):Promise.resolve(!1)}function R(q){f==null||f.scaleExtent(q)}function L(q){f==null||f.translateExtent(q)}function F(q){const W=!po(q)||q<0?0:q;f==null||f.clickDistance(W)}return{update:m,destroy:b,setViewport:C,setViewportConstrained:w,getViewport:S,scaleTo:E,scaleBy:H,setScaleExtent:R,setTranslateExtent:L,syncViewport:O,setClickDistance:F}}var Ju;(function(o){o.Line="line",o.Handle="handle"})(Ju||(Ju={}));function Yw(o){let e,t,n,r,i,a;const s=o[45].default,l=gn(s,o,o[44],null);return{c(){e=M("div"),l&&l.c(),this.h()},l(c){e=P(c,"DIV",{"data-handleid":!0,"data-nodeid":!0,"data-handlepos":!0,"data-id":!0,class:!0,style:!0,role:!0,tabindex:!0});var u=I(e);l&&l.l(u),u.forEach(p),this.h()},h(){g(e,"data-handleid",o[6]),g(e,"data-nodeid",o[14]),g(e,"data-handlepos",o[2]),g(e,"data-id",t=o[13]+"-"+o[14]+"-"+(o[0]||null)+"-"+o[1]),g(e,"class",n=Qt(["svelte-flow__handle",`svelte-flow__handle-${o[2]}`,"nodrag","nopan",o[2],o[4]])),g(e,"style",o[3]),g(e,"role","button"),g(e,"tabindex","-1"),ft(e,"valid",o[7]),ft(e,"connectingto",o[5]),ft(e,"connectingfrom",o[9]),ft(e,"source",!o[11]),ft(e,"target",o[11]),ft(e,"connectablestart",o[12]),ft(e,"connectableend",o[12]),ft(e,"connectable",o[12]),ft(e,"connectionindicator",o[12]&&(!o[10]||o[8]))},m(c,u){U(c,e,u),l&&l.m(e,null),r=!0,i||(a=[Ie(e,"mousedown",o[32]),Ie(e,"touchstart",o[32])],i=!0)},p(c,u){l&&l.p&&(!r||u[1]&8192)&&mn(l,s,c,c[44],r?_n(s,c[44],u,null):pn(c[44]),null),(!r||u[0]&64)&&g(e,"data-handleid",c[6]),(!r||u[0]&4)&&g(e,"data-handlepos",c[2]),(!r||u[0]&8195&&t!==(t=c[13]+"-"+c[14]+"-"+(c[0]||null)+"-"+c[1]))&&g(e,"data-id",t),(!r||u[0]&20&&n!==(n=Qt(["svelte-flow__handle",`svelte-flow__handle-${c[2]}`,"nodrag","nopan",c[2],c[4]])))&&g(e,"class",n),(!r||u[0]&8)&&g(e,"style",c[3]),(!r||u[0]&148)&&ft(e,"valid",c[7]),(!r||u[0]&52)&&ft(e,"connectingto",c[5]),(!r||u[0]&532)&&ft(e,"connectingfrom",c[9]),(!r||u[0]&2068)&&ft(e,"source",!c[11]),(!r||u[0]&2068)&&ft(e,"target",c[11]),(!r||u[0]&4116)&&ft(e,"connectablestart",c[12]),(!r||u[0]&4116)&&ft(e,"connectableend",c[12]),(!r||u[0]&4116)&&ft(e,"connectable",c[12]),(!r||u[0]&5396)&&ft(e,"connectionindicator",c[12]&&(!c[10]||c[8]))},i(c){r||(T(l,c),r=!0)},o(c){D(l,c),r=!1},d(c){c&&p(e),l&&l.d(c),i=!1,kn(a)}}}function qw(o,e,t){let n,r,i,a,s,l,c,u,d,f,h,_,y,v,m,b,w,C,O,S,E,H,R,L,F,{$$slots:q={},$$scope:W}=e,{id:A=void 0}=e,{type:V="source"}=e,{position:N=ht.Top}=e,{style:G=void 0}=e,{isValidConnection:X=void 0}=e,{onconnect:Q=void 0}=e,{ondisconnect:j=void 0}=e,{isConnectable:ue=void 0}=e,{class:B=void 0}=e;const x=on("svelteflow__node_id"),J=on("svelteflow__node_connectable");de(o,J,Me=>t(43,F=Me));const ce=ln(),{connectionMode:me,domNode:se,nodeLookup:Be,connectionRadius:He,viewport:Y,isValidConnection:Xe,lib:Ke,addEdge:mt,onedgecreate:fe,panBy:xe,cancelConnection:gt,updateConnection:Et,autoPanOnConnect:Bt,edges:Xt,connectionLookup:Ot,onconnect:rn,onconnectstart:Wt,onconnectend:Nt,flowId:tn,connection:ie}=ce;de(o,me,Me=>t(40,f=Me)),de(o,se,Me=>t(55,R=Me)),de(o,Be,Me=>t(54,H=Me)),de(o,He,Me=>t(56,L=Me)),de(o,Y,Me=>t(46,y=Me)),de(o,Xe,Me=>t(51,C=Me)),de(o,Ke,Me=>t(53,E=Me)),de(o,fe,Me=>t(50,w=Me)),de(o,Bt,Me=>t(52,S=Me)),de(o,Xt,Me=>t(42,_=Me)),de(o,Ot,Me=>t(41,h=Me)),de(o,rn,Me=>t(49,b=Me)),de(o,Wt,Me=>t(48,m=Me)),de(o,Nt,Me=>t(47,v=Me)),de(o,tn,Me=>t(13,O=Me)),de(o,ie,Me=>t(39,d=Me));function Ge(Me){const Yt=lg(Me);(Yt&&Me.button===0||!Yt)&&Lw.onPointerDown(Me,{handleId:i,nodeId:x,isTarget:n,connectionRadius:L,domNode:R,nodeLookup:H,connectionMode:f,lib:E,autoPanOnConnect:S,flowId:O,isValidConnection:X??C,updateConnection:Et,cancelConnection:gt,panBy:xe,onConnect:Tt=>{const he=w?w(Tt):Tt;he&&(mt(he),b==null||b(Tt))},onConnectStart:(Tt,he)=>{m==null||m(Tt,{nodeId:he.nodeId,handleId:he.handleId,handleType:he.handleType})},onConnectEnd:(Tt,he)=>{v==null||v(Tt,he)},getTransform:()=>[y.x,y.y,y.zoom],getFromHandle:()=>d.fromHandle})}let nt=null,vt;return o.$$set=Me=>{"id"in Me&&t(0,A=Me.id),"type"in Me&&t(1,V=Me.type),"position"in Me&&t(2,N=Me.position),"style"in Me&&t(3,G=Me.style),"isValidConnection"in Me&&t(33,X=Me.isValidConnection),"onconnect"in Me&&t(34,Q=Me.onconnect),"ondisconnect"in Me&&t(35,j=Me.ondisconnect),"isConnectable"in Me&&t(36,ue=Me.isConnectable),"class"in Me&&t(4,B=Me.class),"$$scope"in Me&&t(44,W=Me.$$scope)},o.$$.update=()=>{var Me,Yt,Tt,he,qe,Oe,$e,It,kt;if(o.$$.dirty[0]&2&&t(11,n=V==="target"),o.$$.dirty[1]&4128&&t(12,r=ue!==void 0?ue:F),o.$$.dirty[0]&1&&t(6,i=A||null),o.$$.dirty[0]&3|o.$$.dirty[1]&3096&&(Q||j)&&t(38,vt=h.get(`${x}-${V}-${A||null}`)),o.$$.dirty[1]&216){if(nt&&!tw(vt,nt)){const Rt=vt??new Map;Hu(nt,Rt,j),Hu(Rt,nt,Q)}t(37,nt=vt??new Map)}o.$$.dirty[1]&256&&t(10,a=!!d.fromHandle),o.$$.dirty[0]&66|o.$$.dirty[1]&256&&t(9,s=((Me=d.fromHandle)==null?void 0:Me.nodeId)===x&&((Yt=d.fromHandle)==null?void 0:Yt.type)===V&&((Tt=d.fromHandle)==null?void 0:Tt.id)===i),o.$$.dirty[0]&66|o.$$.dirty[1]&256&&t(5,l=((he=d.toHandle)==null?void 0:he.nodeId)===x&&((qe=d.toHandle)==null?void 0:qe.type)===V&&((Oe=d.toHandle)==null?void 0:Oe.id)===i),o.$$.dirty[0]&66|o.$$.dirty[1]&768&&t(8,c=f===Ir.Strict?(($e=d.fromHandle)==null?void 0:$e.type)!==V:x!==((It=d.fromHandle)==null?void 0:It.nodeId)||i!==((kt=d.fromHandle)==null?void 0:kt.id)),o.$$.dirty[0]&32|o.$$.dirty[1]&256&&t(7,u=l&&d.isValid)},[A,V,N,G,B,l,i,u,c,s,a,n,r,O,x,J,me,se,Be,He,Y,Xe,Ke,fe,Bt,Xt,Ot,rn,Wt,Nt,tn,ie,Ge,X,Q,j,ue,nt,vt,d,f,h,_,F,W,q]}class Xr extends Ve{constructor(e){super(),Fe(this,e,qw,Yw,Qe,{id:0,type:1,position:2,style:3,isValidConnection:33,onconnect:34,ondisconnect:35,isConnectable:36,class:4},null,[-1,-1])}}function jw(o){var l;let e,t,n=((l=o[0])==null?void 0:l.label)+"",r,i,a,s;return e=new Xr({props:{type:"target",position:o[1]??ht.Top}}),a=new Xr({props:{type:"source",position:o[2]??ht.Bottom}}),{c(){te(e.$$.fragment),t=$(),r=Se(n),i=$(),te(a.$$.fragment)},l(c){re(e.$$.fragment,c),t=ee(c),r=Ae(c,n),i=ee(c),re(a.$$.fragment,c)},m(c,u){ne(e,c,u),U(c,t,u),U(c,r,u),U(c,i,u),ne(a,c,u),s=!0},p(c,[u]){var h;const d={};u&2&&(d.position=c[1]??ht.Top),e.$set(d),(!s||u&1)&&n!==(n=((h=c[0])==null?void 0:h.label)+"")&&Ne(r,n);const f={};u&4&&(f.position=c[2]??ht.Bottom),a.$set(f)},i(c){s||(T(e.$$.fragment,c),T(a.$$.fragment,c),s=!0)},o(c){D(e.$$.fragment,c),D(a.$$.fragment,c),s=!1},d(c){c&&(p(t),p(r),p(i)),oe(e,c),oe(a,c)}}}function Qw(o,e,t){const n=["data","targetPosition","sourcePosition"];an(e,n);let{data:r={label:"Node"}}=e,{targetPosition:i=void 0}=e,{sourcePosition:a=void 0}=e;return o.$$set=s=>{e=Dt(Dt({},e),vo(s)),t(3,an(e,n)),"data"in s&&t(0,r=s.data),"targetPosition"in s&&t(1,i=s.targetPosition),"sourcePosition"in s&&t(2,a=s.sourcePosition)},[r,i,a]}class Ig extends Ve{constructor(e){super(),Fe(this,e,Qw,jw,Qe,{data:0,targetPosition:1,sourcePosition:2})}}function Xw(o){var a;let e=((a=o[0])==null?void 0:a.label)+"",t,n,r,i;return r=new Xr({props:{type:"source",position:o[1]??ht.Bottom}}),{c(){t=Se(e),n=$(),te(r.$$.fragment)},l(s){t=Ae(s,e),n=ee(s),re(r.$$.fragment,s)},m(s,l){U(s,t,l),U(s,n,l),ne(r,s,l),i=!0},p(s,[l]){var u;(!i||l&1)&&e!==(e=((u=s[0])==null?void 0:u.label)+"")&&Ne(t,e);const c={};l&2&&(c.position=s[1]??ht.Bottom),r.$set(c)},i(s){i||(T(r.$$.fragment,s),i=!0)},o(s){D(r.$$.fragment,s),i=!1},d(s){s&&(p(t),p(n)),oe(r,s)}}}function Jw(o,e,t){const n=["data","sourcePosition"];an(e,n);let{data:r={label:"Node"}}=e,{sourcePosition:i=void 0}=e;return o.$$set=a=>{e=Dt(Dt({},e),vo(a)),t(2,an(e,n)),"data"in a&&t(0,r=a.data),"sourcePosition"in a&&t(1,i=a.sourcePosition)},[r,i]}class xw extends Ve{constructor(e){super(),Fe(this,e,Jw,Xw,Qe,{data:0,sourcePosition:1})}}function Zw(o){var a;let e=((a=o[0])==null?void 0:a.label)+"",t,n,r,i;return r=new Xr({props:{type:"target",position:o[1]??ht.Top}}),{c(){t=Se(e),n=$(),te(r.$$.fragment)},l(s){t=Ae(s,e),n=ee(s),re(r.$$.fragment,s)},m(s,l){U(s,t,l),U(s,n,l),ne(r,s,l),i=!0},p(s,[l]){var u;(!i||l&1)&&e!==(e=((u=s[0])==null?void 0:u.label)+"")&&Ne(t,e);const c={};l&2&&(c.position=s[1]??ht.Top),r.$set(c)},i(s){i||(T(r.$$.fragment,s),i=!0)},o(s){D(r.$$.fragment,s),i=!1},d(s){s&&(p(t),p(n)),oe(r,s)}}}function $w(o,e,t){const n=["data","targetPosition"];an(e,n);let{data:r={label:"Node"}}=e,{targetPosition:i=void 0}=e;return o.$$set=a=>{e=Dt(Dt({},e),vo(a)),t(2,an(e,n)),"data"in a&&t(0,r=a.data),"targetPosition"in a&&t(1,i=a.targetPosition)},[r,i]}class ek extends Ve{constructor(e){super(),Fe(this,e,$w,Zw,Qe,{data:0,targetPosition:1})}}function tk(o,e,t){const n=[];return an(e,n),o.$$set=r=>{e=Dt(Dt({},e),vo(r)),t(0,an(e,n))},[]}class nk extends Ve{constructor(e){super(),Fe(this,e,tk,null,Qe,{})}}function xu(o,e,t){if(!e)return;const n=t?e.querySelector(t):e;n&&n.appendChild(o)}function ok(o,{target:e,domNode:t}){return xu(o,t,e),{async update({target:n,domNode:r}){xu(o,r,n)},destroy(){o.parentNode&&o.parentNode.removeChild(o)}}}function rk(o){let e,t,n,r,i;const a=o[3].default,s=gn(a,o,o[2],null);return{c(){e=M("div"),s&&s.c()},l(l){e=P(l,"DIV",{});var c=I(e);s&&s.l(c),c.forEach(p)},m(l,c){U(l,e,c),s&&s.m(e,null),n=!0,r||(i=Vn(t=ok.call(null,e,{target:".svelte-flow__edgelabel-renderer",domNode:o[0]})),r=!0)},p(l,[c]){s&&s.p&&(!n||c&4)&&mn(s,a,l,l[2],n?_n(a,l[2],c,null):pn(l[2]),null),t&&vn(t.update)&&c&1&&t.update.call(null,{target:".svelte-flow__edgelabel-renderer",domNode:l[0]})},i(l){n||(T(s,l),n=!0)},o(l){D(s,l),n=!1},d(l){l&&p(e),s&&s.d(l),r=!1,i()}}}function ik(o,e,t){let n,{$$slots:r={},$$scope:i}=e;const{domNode:a}=ln();return de(o,a,s=>t(0,n=s)),o.$$set=s=>{"$$scope"in s&&t(2,i=s.$$scope)},[n,a,i,r]}class sk extends Ve{constructor(e){super(),Fe(this,e,ik,rk,Qe,{})}}function Tg(){const{edgeLookup:o,selectionRect:e,selectionRectMode:t,multiselectionKeyPressed:n,addSelectedEdges:r,unselectNodesAndEdges:i,elementsSelectable:a}=ln();return s=>{const l=pe(o).get(s);if(!l){console.warn("012",Ri.error012(s));return}(l.selectable||pe(a)&&typeof l.selectable>"u")&&(e.set(null),t.set(null),l.selected?l.selected&&pe(n)&&i({nodes:[],edges:[l]}):r([s]))}}function ak(o){let e,t,n=`translate(-50%, -50%) translate(${o[1]}px,${o[2]}px)`,r,i,a;const s=o[5].default,l=gn(s,o,o[7],null);return{c(){e=M("div"),l&&l.c(),this.h()},l(c){e=P(c,"DIV",{class:!0,style:!0,role:!0,tabindex:!0});var u=I(e);l&&l.l(u),u.forEach(p),this.h()},h(){g(e,"class","svelte-flow__edge-label"),g(e,"style",t="pointer-events: all;"+o[0]),g(e,"role","button"),g(e,"tabindex","-1"),lt(e,"transform",n)},m(c,u){U(c,e,u),l&&l.m(e,null),r=!0,i||(a=[Ie(e,"keyup",ck),Ie(e,"click",o[6])],i=!0)},p(c,u){l&&l.p&&(!r||u&128)&&mn(l,s,c,c[7],r?_n(s,c[7],u,null):pn(c[7]),null),(!r||u&1&&t!==(t="pointer-events: all;"+c[0]))&&g(e,"style",t);const d=u&1;(u&7&&n!==(n=`translate(-50%, -50%) translate(${c[1]}px,${c[2]}px)`)||d)&&lt(e,"transform",n)},i(c){r||(T(l,c),r=!0)},o(c){D(l,c),r=!1},d(c){c&&p(e),l&&l.d(c),i=!1,kn(a)}}}function lk(o){let e,t;return e=new sk({props:{$$slots:{default:[ak]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,[r]){const i={};r&135&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}const ck=()=>{};function uk(o,e,t){let{$$slots:n={},$$scope:r}=e,{style:i=void 0}=e,{x:a=void 0}=e,{y:s=void 0}=e;const l=Tg(),c=on("svelteflow__edge_id"),u=()=>{c&&l(c)};return o.$$set=d=>{"style"in d&&t(0,i=d.style),"x"in d&&t(1,a=d.x),"y"in d&&t(2,s=d.y),"$$scope"in d&&t(7,r=d.$$scope)},[i,a,s,l,c,n,u,r]}class dk extends Ve{constructor(e){super(),Fe(this,e,uk,lk,Qe,{style:0,x:1,y:2})}}function fk(o){let e;return{c(){e=be("path"),this.h()},l(t){e=ye(t,"path",{d:!0,"stroke-opacity":!0,"stroke-width":!0,fill:!0,class:!0}),I(e).forEach(p),this.h()},h(){g(e,"d",o[1]),g(e,"stroke-opacity",0),g(e,"stroke-width",o[10]),g(e,"fill","none"),g(e,"class","svelte-flow__edge-interaction")},m(t,n){U(t,e,n)},p(t,n){n&2&&g(e,"d",t[1])},d(t){t&&p(e)}}}function Zu(o){let e,t;return e=new dk({props:{x:o[3],y:o[4],style:o[5],$$slots:{default:[hk]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&8&&(i.x=n[3]),r&16&&(i.y=n[4]),r&32&&(i.style=n[5]),r&4100&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function hk(o){let e;return{c(){e=Se(o[2])},l(t){e=Ae(t,o[2])},m(t,n){U(t,e,n)},p(t,n){n&4&&Ne(e,t[2])},d(t){t&&p(e)}}}function gk(o){let e,t,n,r,i,a,s=o[10]&&fk(o),l=o[2]&&Zu(o);return{c(){e=be("path"),n=$(),s&&s.c(),r=$(),l&&l.c(),i=je(),this.h()},l(c){e=ye(c,"path",{id:!0,d:!0,class:!0,"marker-start":!0,"marker-end":!0,fill:!0,style:!0}),I(e).forEach(p),n=ee(c),s&&s.l(c),r=ee(c),l&&l.l(c),i=je(),this.h()},h(){g(e,"id",o[0]),g(e,"d",o[1]),g(e,"class",t=Qt(["svelte-flow__edge-path",o[9]])),g(e,"marker-start",o[6]),g(e,"marker-end",o[7]),g(e,"fill","none"),g(e,"style",o[8])},m(c,u){U(c,e,u),U(c,n,u),s&&s.m(c,u),U(c,r,u),l&&l.m(c,u),U(c,i,u),a=!0},p(c,[u]){(!a||u&1)&&g(e,"id",c[0]),(!a||u&2)&&g(e,"d",c[1]),(!a||u&512&&t!==(t=Qt(["svelte-flow__edge-path",c[9]])))&&g(e,"class",t),(!a||u&64)&&g(e,"marker-start",c[6]),(!a||u&128)&&g(e,"marker-end",c[7]),(!a||u&256)&&g(e,"style",c[8]),c[10]&&s.p(c,u),c[2]?l?(l.p(c,u),u&4&&T(l,1)):(l=Zu(c),l.c(),T(l,1),l.m(i.parentNode,i)):l&&(Le(),D(l,1,1,()=>{l=null}),Ue())},i(c){a||(T(l),a=!0)},o(c){D(l),a=!1},d(c){c&&(p(e),p(n),p(r),p(i)),s&&s.d(c),l&&l.d(c)}}}function mk(o,e,t){let{id:n=void 0}=e,{path:r}=e,{label:i=void 0}=e,{labelX:a=void 0}=e,{labelY:s=void 0}=e,{labelStyle:l=void 0}=e,{markerStart:c=void 0}=e,{markerEnd:u=void 0}=e,{style:d=void 0}=e,{interactionWidth:f=20}=e,{class:h=void 0}=e,_=f===void 0?20:f;return o.$$set=y=>{"id"in y&&t(0,n=y.id),"path"in y&&t(1,r=y.path),"label"in y&&t(2,i=y.label),"labelX"in y&&t(3,a=y.labelX),"labelY"in y&&t(4,s=y.labelY),"labelStyle"in y&&t(5,l=y.labelStyle),"markerStart"in y&&t(6,c=y.markerStart),"markerEnd"in y&&t(7,u=y.markerEnd),"style"in y&&t(8,d=y.style),"interactionWidth"in y&&t(11,f=y.interactionWidth),"class"in y&&t(9,h=y.class)},[n,r,i,a,s,l,c,u,d,h,_,f]}class xs extends Ve{constructor(e){super(),Fe(this,e,mk,gk,Qe,{id:0,path:1,label:2,labelX:3,labelY:4,labelStyle:5,markerStart:6,markerEnd:7,style:8,interactionWidth:11,class:9})}}function pk(o){let e,t;return e=new xs({props:{path:o[8],labelX:o[7],labelY:o[6],label:o[0],labelStyle:o[1],markerStart:o[3],markerEnd:o[4],interactionWidth:o[5],style:o[2]}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,[r]){const i={};r&256&&(i.path=n[8]),r&128&&(i.labelX=n[7]),r&64&&(i.labelY=n[6]),r&1&&(i.label=n[0]),r&2&&(i.labelStyle=n[1]),r&8&&(i.markerStart=n[3]),r&16&&(i.markerEnd=n[4]),r&32&&(i.interactionWidth=n[5]),r&4&&(i.style=n[2]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function _k(o,e,t){let n,r,i;const a=["label","labelStyle","style","markerStart","markerEnd","interactionWidth","sourceX","sourceY","sourcePosition","targetX","targetY","targetPosition"];an(e,a);let{label:s=void 0}=e,{labelStyle:l=void 0}=e,{style:c=void 0}=e,{markerStart:u=void 0}=e,{markerEnd:d=void 0}=e,{interactionWidth:f=void 0}=e,{sourceX:h}=e,{sourceY:_}=e,{sourcePosition:y}=e,{targetX:v}=e,{targetY:m}=e,{targetPosition:b}=e;return o.$$set=w=>{e=Dt(Dt({},e),vo(w)),t(15,an(e,a)),"label"in w&&t(0,s=w.label),"labelStyle"in w&&t(1,l=w.labelStyle),"style"in w&&t(2,c=w.style),"markerStart"in w&&t(3,u=w.markerStart),"markerEnd"in w&&t(4,d=w.markerEnd),"interactionWidth"in w&&t(5,f=w.interactionWidth),"sourceX"in w&&t(9,h=w.sourceX),"sourceY"in w&&t(10,_=w.sourceY),"sourcePosition"in w&&t(11,y=w.sourcePosition),"targetX"in w&&t(12,v=w.targetX),"targetY"in w&&t(13,m=w.targetY),"targetPosition"in w&&t(14,b=w.targetPosition)},o.$$.update=()=>{o.$$.dirty&32256&&t(8,[n,r,i]=cg({sourceX:h,sourceY:_,targetX:v,targetY:m,sourcePosition:y,targetPosition:b}),n,(t(7,r),t(9,h),t(10,_),t(12,v),t(13,m),t(11,y),t(14,b)),(t(6,i),t(9,h),t(10,_),t(12,v),t(13,m),t(11,y),t(14,b)))},[s,l,c,u,d,f,i,r,n,h,_,y,v,m,b]}class Sg extends Ve{constructor(e){super(),Fe(this,e,_k,pk,Qe,{label:0,labelStyle:1,style:2,markerStart:3,markerEnd:4,interactionWidth:5,sourceX:9,sourceY:10,sourcePosition:11,targetX:12,targetY:13,targetPosition:14})}}function bk(o){let e,t;return e=new xs({props:{path:o[8],labelX:o[7],labelY:o[6],label:o[0],labelStyle:o[1],markerStart:o[3],markerEnd:o[4],interactionWidth:o[5],style:o[2]}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,[r]){const i={};r&256&&(i.path=n[8]),r&128&&(i.labelX=n[7]),r&64&&(i.labelY=n[6]),r&1&&(i.label=n[0]),r&2&&(i.labelStyle=n[1]),r&8&&(i.markerStart=n[3]),r&16&&(i.markerEnd=n[4]),r&32&&(i.interactionWidth=n[5]),r&4&&(i.style=n[2]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function yk(o,e,t){let n,r,i;const a=["label","labelStyle","style","markerStart","markerEnd","interactionWidth","sourceX","sourceY","sourcePosition","targetX","targetY","targetPosition"];an(e,a);let{label:s=void 0}=e,{labelStyle:l=void 0}=e,{style:c=void 0}=e,{markerStart:u=void 0}=e,{markerEnd:d=void 0}=e,{interactionWidth:f=void 0}=e,{sourceX:h}=e,{sourceY:_}=e,{sourcePosition:y}=e,{targetX:v}=e,{targetY:m}=e,{targetPosition:b}=e;return o.$$set=w=>{e=Dt(Dt({},e),vo(w)),t(15,an(e,a)),"label"in w&&t(0,s=w.label),"labelStyle"in w&&t(1,l=w.labelStyle),"style"in w&&t(2,c=w.style),"markerStart"in w&&t(3,u=w.markerStart),"markerEnd"in w&&t(4,d=w.markerEnd),"interactionWidth"in w&&t(5,f=w.interactionWidth),"sourceX"in w&&t(9,h=w.sourceX),"sourceY"in w&&t(10,_=w.sourceY),"sourcePosition"in w&&t(11,y=w.sourcePosition),"targetX"in w&&t(12,v=w.targetX),"targetY"in w&&t(13,m=w.targetY),"targetPosition"in w&&t(14,b=w.targetPosition)},o.$$.update=()=>{o.$$.dirty&32256&&t(8,[n,r,i]=Cs({sourceX:h,sourceY:_,targetX:v,targetY:m,sourcePosition:y,targetPosition:b}),n,(t(7,r),t(9,h),t(10,_),t(12,v),t(13,m),t(11,y),t(14,b)),(t(6,i),t(9,h),t(10,_),t(12,v),t(13,m),t(11,y),t(14,b)))},[s,l,c,u,d,f,i,r,n,h,_,y,v,m,b]}class vk extends Ve{constructor(e){super(),Fe(this,e,yk,bk,Qe,{label:0,labelStyle:1,style:2,markerStart:3,markerEnd:4,interactionWidth:5,sourceX:9,sourceY:10,sourcePosition:11,targetX:12,targetY:13,targetPosition:14})}}function wk(o){let e,t;return e=new xs({props:{path:o[8],labelX:o[7],labelY:o[6],label:o[0],labelStyle:o[1],markerStart:o[3],markerEnd:o[4],interactionWidth:o[5],style:o[2]}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,[r]){const i={};r&256&&(i.path=n[8]),r&128&&(i.labelX=n[7]),r&64&&(i.labelY=n[6]),r&1&&(i.label=n[0]),r&2&&(i.labelStyle=n[1]),r&8&&(i.markerStart=n[3]),r&16&&(i.markerEnd=n[4]),r&32&&(i.interactionWidth=n[5]),r&4&&(i.style=n[2]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function kk(o,e,t){let n,r,i;const a=["label","labelStyle","style","markerStart","markerEnd","interactionWidth","sourceX","sourceY","targetX","targetY"];an(e,a);let{label:s=void 0}=e,{labelStyle:l=void 0}=e,{style:c=void 0}=e,{markerStart:u=void 0}=e,{markerEnd:d=void 0}=e,{interactionWidth:f=void 0}=e,{sourceX:h}=e,{sourceY:_}=e,{targetX:y}=e,{targetY:v}=e;return o.$$set=m=>{e=Dt(Dt({},e),vo(m)),t(13,an(e,a)),"label"in m&&t(0,s=m.label),"labelStyle"in m&&t(1,l=m.labelStyle),"style"in m&&t(2,c=m.style),"markerStart"in m&&t(3,u=m.markerStart),"markerEnd"in m&&t(4,d=m.markerEnd),"interactionWidth"in m&&t(5,f=m.interactionWidth),"sourceX"in m&&t(9,h=m.sourceX),"sourceY"in m&&t(10,_=m.sourceY),"targetX"in m&&t(11,y=m.targetX),"targetY"in m&&t(12,v=m.targetY)},o.$$.update=()=>{o.$$.dirty&7680&&t(8,[n,r,i]=dg({sourceX:h,sourceY:_,targetX:y,targetY:v}),n,(t(7,r),t(9,h),t(10,_),t(11,y),t(12,v)),(t(6,i),t(9,h),t(10,_),t(11,y),t(12,v)))},[s,l,c,u,d,f,i,r,n,h,_,y,v]}class Ck extends Ve{constructor(e){super(),Fe(this,e,kk,wk,Qe,{label:0,labelStyle:1,style:2,markerStart:3,markerEnd:4,interactionWidth:5,sourceX:9,sourceY:10,targetX:11,targetY:12})}}function Ek(o){let e,t;return e=new xs({props:{path:o[8],labelX:o[7],labelY:o[6],label:o[0],labelStyle:o[1],markerStart:o[3],markerEnd:o[4],interactionWidth:o[5],style:o[2]}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,[r]){const i={};r&256&&(i.path=n[8]),r&128&&(i.labelX=n[7]),r&64&&(i.labelY=n[6]),r&1&&(i.label=n[0]),r&2&&(i.labelStyle=n[1]),r&8&&(i.markerStart=n[3]),r&16&&(i.markerEnd=n[4]),r&32&&(i.interactionWidth=n[5]),r&4&&(i.style=n[2]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function Ik(o,e,t){let n,r,i;const a=["label","labelStyle","style","markerStart","markerEnd","interactionWidth","sourceX","sourceY","sourcePosition","targetX","targetY","targetPosition"];an(e,a);let{label:s=void 0}=e,{labelStyle:l=void 0}=e,{style:c=void 0}=e,{markerStart:u=void 0}=e,{markerEnd:d=void 0}=e,{interactionWidth:f=void 0}=e,{sourceX:h}=e,{sourceY:_}=e,{sourcePosition:y}=e,{targetX:v}=e,{targetY:m}=e,{targetPosition:b}=e;return o.$$set=w=>{e=Dt(Dt({},e),vo(w)),t(15,an(e,a)),"label"in w&&t(0,s=w.label),"labelStyle"in w&&t(1,l=w.labelStyle),"style"in w&&t(2,c=w.style),"markerStart"in w&&t(3,u=w.markerStart),"markerEnd"in w&&t(4,d=w.markerEnd),"interactionWidth"in w&&t(5,f=w.interactionWidth),"sourceX"in w&&t(9,h=w.sourceX),"sourceY"in w&&t(10,_=w.sourceY),"sourcePosition"in w&&t(11,y=w.sourcePosition),"targetX"in w&&t(12,v=w.targetX),"targetY"in w&&t(13,m=w.targetY),"targetPosition"in w&&t(14,b=w.targetPosition)},o.$$.update=()=>{o.$$.dirty&32256&&t(8,[n,r,i]=Cs({sourceX:h,sourceY:_,targetX:v,targetY:m,sourcePosition:y,targetPosition:b,borderRadius:0}),n,(t(7,r),t(9,h),t(10,_),t(12,v),t(13,m),t(11,y),t(14,b)),(t(6,i),t(9,h),t(10,_),t(12,v),t(13,m),t(11,y),t(14,b)))},[s,l,c,u,d,f,i,r,n,h,_,y,v,m,b]}class Tk extends Ve{constructor(e){super(),Fe(this,e,Ik,Ek,Qe,{label:0,labelStyle:1,style:2,markerStart:3,markerEnd:4,interactionWidth:5,sourceX:9,sourceY:10,sourcePosition:11,targetX:12,targetY:13,targetPosition:14})}}function Sk(o,e){const t=o.set,n=e.set,r=pe(o),i=pe(e);let s=r.length===0&&i.length>0?i:r;o.set(s);const l=c=>{const u=t(c);return s=u,n(s),u};o.set=e.set=l,o.update=e.update=c=>l(c(s))}function Ak(o,e){const t=o.set,n=e.set;let r=pe(e);o.set(r);const i=a=>{t(a),n(a),r=a};o.set=e.set=i,o.update=e.update=a=>i(a(r))}const Rk=(o,e,t)=>{if(!t)return;const n=pe(o),r=e.set,i=t.set;let a=t?pe(t):{x:0,y:0,zoom:1};e.set(a),e.set=s=>(r(s),i(s),a=s,s),t.set=s=>(n==null||n.syncViewport(s),r(s),i(s),a=s,s),e.update=s=>{e.set(s(a))},t.update=s=>{t.set(s(a))}},Mk=(o,e,t,n=[0,0],r=bs)=>{const{subscribe:i,set:a,update:s}=ot([]);let l=o,c={},u=!0;const d=y=>(gg(y,e,t,{elevateNodesOnSelect:u,nodeOrigin:n,nodeExtent:r,defaults:c,checkEquality:!1}),l=y,a(l),l),f=y=>d(y(l)),h=y=>{c=y},_=y=>{u=y.elevateNodesOnSelect??u};return d(l),{subscribe:i,set:d,update:f,setDefaultOptions:h,setOptions:_}},Pk=(o,e,t,n)=>{const{subscribe:r,set:i,update:a}=ot([]);let s=o,l={};const c=f=>{const h=l?f.map(_=>({...l,..._})):f;_g(e,t,h),s=h,i(s)},u=f=>c(f(s)),d=f=>{l=f};return c(s),{subscribe:r,set:c,update:u,setDefaultOptions:d}},Ag={input:xw,output:ek,default:Ig,group:nk},Rg={straight:Ck,smoothstep:vk,default:Sg,step:Tk},Ok=({nodes:o=[],edges:e=[],width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:a})=>{const s=new Map,l=new Map,c=new Map,u=new Map,d=i??[0,0],f=a??bs;gg(o,s,l,{nodeExtent:f,nodeOrigin:d,elevateNodesOnSelect:!1,checkEquality:!1}),_g(c,u,e);let h={x:0,y:0,zoom:1};if(r&&t&&n){const _=js(s,{filter:y=>!!((y.width||y.initialWidth)&&(y.height||y.initialHeight))});h=Vl(_,t,n,.5,2,.1)}return{flowId:ot(null),nodes:Mk(o,s,l,d,f),nodeLookup:ho(s),parentLookup:ho(l),edgeLookup:ho(u),visibleNodes:ho([]),edges:Pk(e,c,u),visibleEdges:ho([]),connectionLookup:ho(c),height:ot(500),width:ot(500),minZoom:ot(.5),maxZoom:ot(2),nodeOrigin:ot(d),nodeDragThreshold:ot(1),nodeExtent:ot(f),translateExtent:ot(bs),autoPanOnNodeDrag:ot(!0),autoPanOnConnect:ot(!0),fitViewOnInit:ot(!1),fitViewOnInitDone:ot(!1),fitViewOptions:ot(void 0),panZoom:ot(null),snapGrid:ot(null),dragging:ot(!1),selectionRect:ot(null),selectionKeyPressed:ot(!1),multiselectionKeyPressed:ot(!1),deleteKeyPressed:ot(!1),panActivationKeyPressed:ot(!1),zoomActivationKeyPressed:ot(!1),selectionRectMode:ot(null),selectionMode:ot(ys.Partial),nodeTypes:ot(Ag),edgeTypes:ot(Rg),viewport:ot(h),connectionMode:ot(Ir.Strict),domNode:ot(null),connection:ho(Va),connectionLineType:ot(Fr.Bezier),connectionRadius:ot(20),isValidConnection:ot(()=>!0),nodesDraggable:ot(!0),nodesConnectable:ot(!0),elementsSelectable:ot(!0),selectNodesOnDrag:ot(!0),markers:ho([]),defaultMarkerColor:ot("#b1b1b7"),lib:ho("svelte"),onlyRenderVisibleElements:ot(!1),onerror:ot(aw),ondelete:ot(void 0),onedgecreate:ot(void 0),onconnect:ot(void 0),onconnectstart:ot(void 0),onconnectend:ot(void 0),onbeforedelete:ot(void 0),nodesInitialized:ot(!1),edgesInitialized:ot(!1),viewportInitialized:ot(!1),initialized:ho(!1)}};function Nk(o){const e=Ur([o.edges,o.nodes,o.nodeLookup,o.onlyRenderVisibleElements,o.viewport,o.width,o.height],([t,,n,r,i,a,s])=>r&&a&&s?t.filter(c=>{const u=n.get(c.source),d=n.get(c.target);return u&&d&&gw({sourceNode:u,targetNode:d,width:a,height:s,transform:[i.x,i.y,i.zoom]})}):t);return Ur([e,o.nodes,o.nodeLookup,o.connectionMode,o.onerror],([t,,n,r,i])=>t.reduce((s,l)=>{const c=n.get(l.source),u=n.get(l.target);if(!c||!u)return s;const d=ww({id:l.id,sourceNode:c,targetNode:u,sourceHandle:l.sourceHandle||null,targetHandle:l.targetHandle||null,connectionMode:r,onError:i});return d&&s.push({...l,zIndex:hw({selected:l.selected,zIndex:l.zIndex,sourceNode:c,targetNode:u,elevateOnSelect:!1}),...d}),s},[]))}function Dk(o){return Ur([o.nodeLookup,o.onlyRenderVisibleElements,o.width,o.height,o.viewport,o.nodes],([e,t,n,r,i])=>{const a=[i.x,i.y,i.zoom];return t?ng(e,{x:0,y:0,width:n,height:r},a,!0):Array.from(e.values())})}const Zs=Symbol();function Mg({nodes:o,edges:e,width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:a}){const s=Ok({nodes:o,edges:e,width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:a});function l(N){s.nodeTypes.set({...Ag,...N})}function c(N){s.edgeTypes.set({...Rg,...N})}function u(N){const G=pe(s.edges);s.edges.set(_w(N,G))}const d=(N,G=!1)=>{var Q;const X=pe(s.nodeLookup);for(const[j,ue]of N){const B=(Q=X.get(j))==null?void 0:Q.internals.userNode;B&&(B.position=ue.position,B.dragging=G)}s.nodes.update(j=>j)};function f(N){var j,ue,B;const G=pe(s.nodeLookup),{changes:X,updatedInternals:Q}=Sw(N,G,pe(s.parentLookup),pe(s.domNode),pe(s.nodeOrigin));if(Q){if(!pe(s.fitViewOnInitDone)&&pe(s.fitViewOnInit)){const x=pe(s.fitViewOptions),J=_({...x,nodes:x==null?void 0:x.nodes});s.fitViewOnInitDone.set(J)}for(const x of X){const J=(j=G.get(x.id))==null?void 0:j.internals.userNode;if(J)switch(x.type){case"dimensions":{const ce={...J.measured,...x.dimensions};x.setAttributes&&(J.width=((ue=x.dimensions)==null?void 0:ue.width)??J.width,J.height=((B=x.dimensions)==null?void 0:B.height)??J.height),J.measured=ce;break}case"position":J.position=x.position??J.position;break}}s.nodes.update(x=>x),pe(s.nodesInitialized)||s.nodesInitialized.set(!0)}}function h(N){const G=pe(s.panZoom);if(!G)return Promise.resolve(!1);const X=Uu(pe(s.nodeLookup),N);return Bu({nodes:X,width:pe(s.width),height:pe(s.height),minZoom:pe(s.minZoom),maxZoom:pe(s.maxZoom),panZoom:G},N)}function _(N){const G=pe(s.panZoom);if(!G)return!1;const X=Uu(pe(s.nodeLookup),N);return Bu({nodes:X,width:pe(s.width),height:pe(s.height),minZoom:pe(s.minZoom),maxZoom:pe(s.maxZoom),panZoom:G},N),X.size>0}function y(N,G){const X=pe(s.panZoom);return X?X.scaleBy(N,G):Promise.resolve(!1)}function v(N){return y(1.2,N)}function m(N){return y(1/1.2,N)}function b(N){const G=pe(s.panZoom);G&&(G.setScaleExtent([N,pe(s.maxZoom)]),s.minZoom.set(N))}function w(N){const G=pe(s.panZoom);G&&(G.setScaleExtent([pe(s.minZoom),N]),s.maxZoom.set(N))}function C(N){const G=pe(s.panZoom);G&&(G.setTranslateExtent(N),s.translateExtent.set(N))}function O(N){let G=!1;return N.forEach(X=>{X.selected&&(X.selected=!1,G=!0)}),G}function S(N){var G;(G=pe(s.panZoom))==null||G.setClickDistance(N)}function E(N){O((N==null?void 0:N.nodes)||pe(s.nodes))&&s.nodes.set(pe(s.nodes)),O((N==null?void 0:N.edges)||pe(s.edges))&&s.edges.set(pe(s.edges))}s.deleteKeyPressed.subscribe(async N=>{var G;if(N){const X=pe(s.nodes),Q=pe(s.edges),j=X.filter(J=>J.selected),ue=Q.filter(J=>J.selected),{nodes:B,edges:x}=await og({nodesToRemove:j,edgesToRemove:ue,nodes:X,edges:Q,onBeforeDelete:pe(s.onbeforedelete)});(B.length||x.length)&&(s.nodes.update(J=>J.filter(ce=>!B.some(me=>me.id===ce.id))),s.edges.update(J=>J.filter(ce=>!x.some(me=>me.id===ce.id))),(G=pe(s.ondelete))==null||G({nodes:B,edges:x}))}});function H(N){const G=pe(s.multiselectionKeyPressed);s.nodes.update(X=>X.map(Q=>{const j=N.includes(Q.id),ue=G&&Q.selected||j;return Q.selected=ue,Q})),G||s.edges.update(X=>X.map(Q=>(Q.selected=!1,Q)))}function R(N){const G=pe(s.multiselectionKeyPressed);s.edges.update(X=>X.map(Q=>{const j=N.includes(Q.id),ue=G&&Q.selected||j;return Q.selected=ue,Q})),G||s.nodes.update(X=>X.map(Q=>(Q.selected=!1,Q)))}function L(N){var X;const G=(X=pe(s.nodes))==null?void 0:X.find(Q=>Q.id===N);if(!G){console.warn("012",Ri.error012(N));return}s.selectionRect.set(null),s.selectionRectMode.set(null),G.selected?G.selected&&pe(s.multiselectionKeyPressed)&&E({nodes:[G],edges:[]}):H([N])}function F(N){const G=pe(s.viewport);return Aw({delta:N,panZoom:pe(s.panZoom),transform:[G.x,G.y,G.zoom],translateExtent:pe(s.translateExtent),width:pe(s.width),height:pe(s.height)})}const q=ot(Va),W=N=>{q.set({...N})};function A(){q.set(Va)}function V(){s.fitViewOnInitDone.set(!1),s.selectionRect.set(null),s.selectionRectMode.set(null),s.snapGrid.set(null),s.isValidConnection.set(()=>!0),E(),A()}return{...s,visibleEdges:Nk(s),visibleNodes:Dk(s),connection:Ur([q,s.viewport],([N,G])=>N.inProgress?{...N,to:Mi(N.to,[G.x,G.y,G.zoom])}:{...N}),markers:Ur([s.edges,s.defaultMarkerColor,s.flowId],([N,G,X])=>kw(N,{defaultColor:G,id:X})),initialized:(()=>{let N=!1;const G=pe(s.nodes).length,X=pe(s.edges).length;return Ur([s.nodesInitialized,s.edgesInitialized,s.viewportInitialized],([Q,j,ue])=>N||(G===0?N=ue:X===0?N=ue&&Q:N=ue&&Q&&j,N))})(),syncNodeStores:N=>Sk(s.nodes,N),syncEdgeStores:N=>Ak(s.edges,N),syncViewport:N=>Rk(s.panZoom,s.viewport,N),setNodeTypes:l,setEdgeTypes:c,addEdge:u,updateNodePositions:d,updateNodeInternals:f,zoomIn:v,zoomOut:m,fitView:N=>h(N),setMinZoom:b,setMaxZoom:w,setTranslateExtent:C,setPaneClickDistance:S,unselectNodesAndEdges:E,addSelectedNodes:H,addSelectedEdges:R,handleNodeSelection:L,panBy:F,updateConnection:W,cancelConnection:A,reset:V}}function ln(){const o=on(Zs);if(!o)throw new Error("In order to use useStore you need to wrap your component in a <SvelteFlowProvider />");return o.getStore()}function Hk({nodes:o,edges:e,width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:a}){const s=Mg({nodes:o,edges:e,width:t,height:n,fitView:r,nodeOrigin:i,nodeExtent:a});return fi(Zs,{getStore:()=>s}),s}function Lk(o,e){const{panZoom:t,minZoom:n,maxZoom:r,initialViewport:i,viewport:a,dragging:s,translateExtent:l,paneClickDistance:c}=e,u=Ww({domNode:o,minZoom:n,maxZoom:r,translateExtent:l,viewport:i,paneClickDistance:c,onDraggingChange:s.set}),d=u.getViewport();return a.set(d),t.set(u),u.update(e),{update(f){u.update(f)}}}function Uk(o){let e,t,n,r,i;const a=o[35].default,s=gn(a,o,o[34],null);return{c(){e=M("div"),s&&s.c(),this.h()},l(l){e=P(l,"DIV",{class:!0});var c=I(e);s&&s.l(c),c.forEach(p),this.h()},h(){g(e,"class","svelte-flow__zoom svelte-4xkw84")},m(l,c){U(l,e,c),s&&s.m(e,null),n=!0,r||(i=Vn(t=Lk.call(null,e,{viewport:o[18],minZoom:o[12],maxZoom:o[13],initialViewport:o[11],dragging:o[23],panZoom:o[19],onPanZoomStart:o[0],onPanZoom:o[1],onPanZoomEnd:o[2],zoomOnScroll:o[5],zoomOnDoubleClick:o[6],zoomOnPinch:o[7],panOnScroll:o[9],panOnDrag:o[10],panOnScrollSpeed:.5,panOnScrollMode:o[3]||Oo.Free,zoomActivationKeyPressed:o[14],preventScrolling:typeof o[4]=="boolean"?o[4]:!0,noPanClassName:"nopan",noWheelClassName:"nowheel",userSelectionActive:!!o[15],translateExtent:o[16],lib:o[17],paneClickDistance:o[8],onTransformChange:o[29]})),r=!0)},p(l,c){s&&s.p&&(!n||c[1]&8)&&mn(s,a,l,l[34],n?_n(a,l[34],c,null):pn(l[34]),null),t&&vn(t.update)&&c[0]&262143&&t.update.call(null,{viewport:l[18],minZoom:l[12],maxZoom:l[13],initialViewport:l[11],dragging:l[23],panZoom:l[19],onPanZoomStart:l[0],onPanZoom:l[1],onPanZoomEnd:l[2],zoomOnScroll:l[5],zoomOnDoubleClick:l[6],zoomOnPinch:l[7],panOnScroll:l[9],panOnDrag:l[10],panOnScrollSpeed:.5,panOnScrollMode:l[3]||Oo.Free,zoomActivationKeyPressed:l[14],preventScrolling:typeof l[4]=="boolean"?l[4]:!0,noPanClassName:"nopan",noWheelClassName:"nowheel",userSelectionActive:!!l[15],translateExtent:l[16],lib:l[17],paneClickDistance:l[8],onTransformChange:l[29]})},i(l){n||(T(s,l),n=!0)},o(l){D(s,l),n=!1},d(l){l&&p(e),s&&s.d(l),r=!1,i()}}}function Bk(o,e,t){let n,r,i,a,s,l,c,u,d,f,h,{$$slots:_={},$$scope:y}=e,{initialViewport:v=void 0}=e,{onMoveStart:m=void 0}=e,{onMove:b=void 0}=e,{onMoveEnd:w=void 0}=e,{panOnScrollMode:C}=e,{preventScrolling:O}=e,{zoomOnScroll:S}=e,{zoomOnDoubleClick:E}=e,{zoomOnPinch:H}=e,{panOnDrag:R}=e,{panOnScroll:L}=e,{paneClickDistance:F}=e;const{viewport:q,panZoom:W,selectionRect:A,minZoom:V,maxZoom:N,dragging:G,translateExtent:X,lib:Q,panActivationKeyPressed:j,zoomActivationKeyPressed:ue,viewportInitialized:B}=ln();de(o,A,J=>t(15,d=J)),de(o,V,J=>t(12,l=J)),de(o,N,J=>t(13,c=J)),de(o,X,J=>t(16,f=J)),de(o,Q,J=>t(17,h=J)),de(o,j,J=>t(33,s=J)),de(o,ue,J=>t(14,u=J)),de(o,B,J=>t(36,a=J));const x=J=>q.set({x:J[0],y:J[1],zoom:J[2]});return Jn(()=>{ns(B,a=!0,a)}),o.$$set=J=>{"initialViewport"in J&&t(30,v=J.initialViewport),"onMoveStart"in J&&t(0,m=J.onMoveStart),"onMove"in J&&t(1,b=J.onMove),"onMoveEnd"in J&&t(2,w=J.onMoveEnd),"panOnScrollMode"in J&&t(3,C=J.panOnScrollMode),"preventScrolling"in J&&t(4,O=J.preventScrolling),"zoomOnScroll"in J&&t(5,S=J.zoomOnScroll),"zoomOnDoubleClick"in J&&t(6,E=J.zoomOnDoubleClick),"zoomOnPinch"in J&&t(7,H=J.zoomOnPinch),"panOnDrag"in J&&t(31,R=J.panOnDrag),"panOnScroll"in J&&t(32,L=J.panOnScroll),"paneClickDistance"in J&&t(8,F=J.paneClickDistance),"$$scope"in J&&t(34,y=J.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&1073741824&&t(11,n=v||{x:0,y:0,zoom:1}),o.$$.dirty[1]&5&&t(10,r=s||R),o.$$.dirty[1]&6&&t(9,i=s||L)},[m,b,w,C,O,S,E,H,F,i,r,n,l,c,u,d,f,h,q,W,A,V,N,G,X,Q,j,ue,B,x,v,R,L,s,y,_]}class zk extends Ve{constructor(e){super(),Fe(this,e,Bk,Uk,Qe,{initialViewport:30,onMoveStart:0,onMove:1,onMoveEnd:2,panOnScrollMode:3,preventScrolling:4,zoomOnScroll:5,zoomOnDoubleClick:6,zoomOnPinch:7,panOnDrag:31,panOnScroll:32,paneClickDistance:8},null,[-1,-1])}}function Vk(o){let e,t,n,r;const i=o[28].default,a=gn(i,o,o[27],null);return{c(){e=M("div"),a&&a.c(),this.h()},l(s){e=P(s,"DIV",{class:!0});var l=I(e);a&&a.l(l),l.forEach(p),this.h()},h(){g(e,"class","svelte-flow__pane svelte-1esy7hx"),ft(e,"draggable",o[0]===!0||Array.isArray(o[0])&&o[0].includes(0)),ft(e,"dragging",o[4]),ft(e,"selection",o[1])},m(s,l){U(s,e,l),a&&a.m(e,null),o[29](e),t=!0,n||(r=[Ie(e,"click",function(){vn(o[3]?void 0:Zi(o[15],o[2]))&&(o[3]?void 0:Zi(o[15],o[2])).apply(this,arguments)}),Ie(e,"pointerdown",function(){vn(o[3]?o[16]:void 0)&&(o[3]?o[16]:void 0).apply(this,arguments)}),Ie(e,"pointermove",function(){vn(o[3]?o[17]:void 0)&&(o[3]?o[17]:void 0).apply(this,arguments)}),Ie(e,"pointerup",function(){vn(o[3]?o[18]:void 0)&&(o[3]?o[18]:void 0).apply(this,arguments)}),Ie(e,"contextmenu",function(){vn(Zi(o[19],o[2]))&&Zi(o[19],o[2]).apply(this,arguments)})],n=!0)},p(s,l){o=s,a&&a.p&&(!t||l[0]&134217728)&&mn(a,i,o,o[27],t?_n(i,o[27],l,null):pn(o[27]),null),(!t||l[0]&1)&&ft(e,"draggable",o[0]===!0||Array.isArray(o[0])&&o[0].includes(0)),(!t||l[0]&16)&&ft(e,"dragging",o[4]),(!t||l[0]&2)&&ft(e,"selection",o[1])},i(s){t||(T(a,s),t=!0)},o(s){D(a,s),t=!1},d(s){s&&p(e),a&&a.d(s),o[29](null),n=!1,kn(r)}}}function Zi(o,e){return t=>{t.target===e&&(o==null||o(t))}}function $u(o){return e=>{const t=o.includes(e.id);return e.selected!==t&&(e.selected=t),e}}function Fk(o,e,t){let n,r,i,a,s,l,c,u,d,f,h,_,y,{$$slots:v={},$$scope:m}=e,{panOnDrag:b=void 0}=e,{selectionOnDrag:w=void 0}=e;const C=Pn(),{nodes:O,nodeLookup:S,edges:E,viewport:H,dragging:R,elementsSelectable:L,selectionRect:F,selectionRectMode:q,selectionKeyPressed:W,selectionMode:A,panActivationKeyPressed:V,unselectNodesAndEdges:N}=ln();de(o,S,se=>t(36,d=se)),de(o,E,se=>t(33,l=se)),de(o,H,se=>t(35,u=se)),de(o,R,se=>t(4,y=se)),de(o,L,se=>t(25,h=se)),de(o,F,se=>t(24,f=se)),de(o,q,se=>t(23,s=se)),de(o,W,se=>t(22,a=se)),de(o,A,se=>t(34,c=se)),de(o,V,se=>t(26,_=se));let G,X=null,Q=[],j=!1;function ue(se){if(j){j=!1;return}C("paneclick",{event:se}),N(),q.set(null)}function B(se){var Y,Xe;if(X=G.getBoundingClientRect(),!L||!r||se.button!==0||se.target!==G||!X)return;(Xe=(Y=se.target)==null?void 0:Y.setPointerCapture)==null||Xe.call(Y,se.pointerId);const{x:Be,y:He}=Wo(se,X);N(),F.set({width:0,height:0,startX:Be,startY:He,x:Be,y:He})}function x(se){if(!r||!X||!f)return;j=!0;const Be=Wo(se,X),He=f.startX??0,Y=f.startY??0,Xe={...f,x:Be.x<He?Be.x:He,y:Be.y<Y?Be.y:Y,width:Math.abs(Be.x-He),height:Math.abs(Be.y-Y)},Ke=Q.map(gt=>gt.id),mt=Fa(Q,l).map(gt=>gt.id);Q=ng(d,Xe,[u.x,u.y,u.zoom],c===ys.Partial,!0);const fe=Fa(Q,l).map(gt=>gt.id),xe=Q.map(gt=>gt.id);(Ke.length!==xe.length||xe.some(gt=>!Ke.includes(gt)))&&O.update(gt=>gt.map($u(xe))),(mt.length!==fe.length||fe.some(gt=>!mt.includes(gt)))&&E.update(gt=>gt.map($u(fe))),q.set("user"),F.set(Xe)}function J(se){var Be,He;se.button===0&&((He=(Be=se.target)==null?void 0:Be.releasePointerCapture)==null||He.call(Be,se.pointerId),!r&&s==="user"&&se.target===G&&(ue==null||ue(se)),F.set(null),Q.length>0&&ns(q,s="nodes",s),a&&(j=!1))}const ce=se=>{if(Array.isArray(n)&&(n!=null&&n.includes(2))){se.preventDefault();return}C("panecontextmenu",{event:se})};function me(se){Ye[se?"unshift":"push"](()=>{G=se,t(2,G)})}return o.$$set=se=>{"panOnDrag"in se&&t(0,b=se.panOnDrag),"selectionOnDrag"in se&&t(20,w=se.selectionOnDrag),"$$scope"in se&&t(27,m=se.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&67108865&&t(21,n=_||b),o.$$.dirty[0]&24117248&&t(1,r=a||f||w&&n!==!0),o.$$.dirty[0]&41943042&&t(3,i=h&&(r||s==="user"))},[b,r,G,i,y,S,E,H,R,L,F,q,W,A,V,ue,B,x,J,ce,w,n,a,s,f,h,_,m,v,me]}class Kk extends Ve{constructor(e){super(),Fe(this,e,Fk,Vk,Qe,{panOnDrag:0,selectionOnDrag:20},null,[-1,-1])}}function Gk(o){let e,t;const n=o[3].default,r=gn(n,o,o[2],null);return{c(){e=M("div"),r&&r.c(),this.h()},l(i){e=P(i,"DIV",{class:!0,style:!0});var a=I(e);r&&r.l(a),a.forEach(p),this.h()},h(){g(e,"class","svelte-flow__viewport xyflow__viewport svelte-1floaup"),lt(e,"transform","translate("+o[0].x+"px, "+o[0].y+"px) scale("+o[0].zoom+")")},m(i,a){U(i,e,a),r&&r.m(e,null),t=!0},p(i,[a]){r&&r.p&&(!t||a&4)&&mn(r,n,i,i[2],t?_n(n,i[2],a,null):pn(i[2]),null),(!t||a&1)&&lt(e,"transform","translate("+i[0].x+"px, "+i[0].y+"px) scale("+i[0].zoom+")")},i(i){t||(T(r,i),t=!0)},o(i){D(r,i),t=!1},d(i){i&&p(e),r&&r.d(i)}}}function Wk(o,e,t){let n,{$$slots:r={},$$scope:i}=e;const{viewport:a}=ln();return de(o,a,s=>t(0,n=s)),o.$$set=s=>{"$$scope"in s&&t(2,i=s.$$scope)},[n,a,i,r]}class Yk extends Ve{constructor(e){super(),Fe(this,e,Wk,Gk,Qe,{})}}function Pg(o,e){const{store:t,onDrag:n,onDragStart:r,onDragStop:i,onNodeMouseDown:a}=e,s=Mw({onDrag:n,onDragStart:r,onDragStop:i,onNodeMouseDown:a,getStoreItems:()=>{const c=pe(t.snapGrid),u=pe(t.viewport);return{nodes:pe(t.nodes),nodeLookup:pe(t.nodeLookup),edges:pe(t.edges),nodeExtent:pe(t.nodeExtent),snapGrid:c||[0,0],snapToGrid:!!c,nodeOrigin:pe(t.nodeOrigin),multiSelectionActive:pe(t.multiselectionKeyPressed),domNode:pe(t.domNode),transform:[u.x,u.y,u.zoom],autoPanOnNodeDrag:pe(t.autoPanOnNodeDrag),nodesDraggable:pe(t.nodesDraggable),selectNodesOnDrag:pe(t.selectNodesOnDrag),nodeDragThreshold:pe(t.nodeDragThreshold),unselectNodesAndEdges:t.unselectNodesAndEdges,updateNodePositions:t.updateNodePositions,panBy:t.panBy}}});function l(c,u){if(u.disabled){s.destroy();return}s.update({domNode:c,noDragClassName:u.noDragClass,handleSelector:u.handleSelector,nodeId:u.nodeId,isSelectable:u.isSelectable,nodeClickDistance:u.nodeClickDistance})}return l(o,e),{update(c){l(o,c)},destroy(){s.destroy()}}}function qk({width:o,height:e,initialWidth:t,initialHeight:n,measuredWidth:r,measuredHeight:i}){if(r===void 0&&i===void 0){const a=o??t,s=e??n;return{width:a?`width:${a}px;`:"",height:s?`height:${s}px;`:""}}return{width:o?`width:${o}px;`:"",height:e?`height:${e}px;`:""}}function ed(o){let e,t,n,r,i,a=`translate(${o[12]}px, ${o[13]}px)`,s,l,c;var u=o[27];function d(f,h){return{props:{data:f[2],id:f[1],selected:f[3],selectable:f[5],deletable:f[7],sourcePosition:f[14],targetPosition:f[15],zIndex:f[16],dragging:f[9],draggable:f[4],dragHandle:f[19],parentId:f[21],type:f[25],isConnectable:f[28],positionAbsoluteX:f[12],positionAbsoluteY:f[13],width:f[17],height:f[18]}}}return u&&(t=os(u,d(o))),{c(){e=M("div"),t&&te(t.$$.fragment),this.h()},l(f){e=P(f,"DIV",{"data-id":!0,class:!0,style:!0});var h=I(e);t&&re(t.$$.fragment,h),h.forEach(p),this.h()},h(){g(e,"data-id",o[1]),g(e,"class",n=Qt(["svelte-flow__node",`svelte-flow__node-${o[25]}`,o[23]])),g(e,"style",r=(o[10]??"")+";"+o[26].width+o[26].height),ft(e,"dragging",o[9]),ft(e,"selected",o[3]),ft(e,"draggable",o[4]),ft(e,"connectable",o[6]),ft(e,"selectable",o[5]),ft(e,"nopan",o[4]),ft(e,"parent",o[11]),lt(e,"z-index",o[16]),lt(e,"transform",a),lt(e,"visibility",o[20]?"visible":"hidden")},m(f,h){U(f,e,h),t&&ne(t,e,null),o[50](e),s=!0,l||(c=[Vn(i=Pg.call(null,e,{nodeId:o[1],isSelectable:o[5],disabled:!1,handleSelector:o[19],noDragClass:"nodrag",nodeClickDistance:o[22],onNodeMouseDown:o[31],onDrag:o[47],onDragStart:o[48],onDragStop:o[49],store:o[29]})),Ie(e,"click",o[34]),Ie(e,"mouseenter",o[51]),Ie(e,"mouseleave",o[52]),Ie(e,"mousemove",o[53]),Ie(e,"contextmenu",o[54])],l=!0)},p(f,h){if(h[0]&134217728&&u!==(u=f[27])){if(t){Le();const y=t;D(y.$$.fragment,1,0,()=>{oe(y,1)}),Ue()}u?(t=os(u,d(f)),te(t.$$.fragment),T(t.$$.fragment,1),ne(t,e,null)):t=null}else if(u){const y={};h[0]&4&&(y.data=f[2]),h[0]&2&&(y.id=f[1]),h[0]&8&&(y.selected=f[3]),h[0]&32&&(y.selectable=f[5]),h[0]&128&&(y.deletable=f[7]),h[0]&16384&&(y.sourcePosition=f[14]),h[0]&32768&&(y.targetPosition=f[15]),h[0]&65536&&(y.zIndex=f[16]),h[0]&512&&(y.dragging=f[9]),h[0]&16&&(y.draggable=f[4]),h[0]&524288&&(y.dragHandle=f[19]),h[0]&2097152&&(y.parentId=f[21]),h[0]&33554432&&(y.type=f[25]),h[0]&268435456&&(y.isConnectable=f[28]),h[0]&4096&&(y.positionAbsoluteX=f[12]),h[0]&8192&&(y.positionAbsoluteY=f[13]),h[0]&131072&&(y.width=f[17]),h[0]&262144&&(y.height=f[18]),t.$set(y)}(!s||h[0]&2)&&g(e,"data-id",f[1]),(!s||h[0]&41943040&&n!==(n=Qt(["svelte-flow__node",`svelte-flow__node-${f[25]}`,f[23]])))&&g(e,"class",n),(!s||h[0]&67109888&&r!==(r=(f[10]??"")+";"+f[26].width+f[26].height))&&g(e,"style",r),i&&vn(i.update)&&h[0]&4718626&&i.update.call(null,{nodeId:f[1],isSelectable:f[5],disabled:!1,handleSelector:f[19],noDragClass:"nodrag",nodeClickDistance:f[22],onNodeMouseDown:f[31],onDrag:f[47],onDragStart:f[48],onDragStop:f[49],store:f[29]}),(!s||h[0]&41943552)&&ft(e,"dragging",f[9]),(!s||h[0]&41943048)&&ft(e,"selected",f[3]),(!s||h[0]&41943056)&&ft(e,"draggable",f[4]),(!s||h[0]&41943104)&&ft(e,"connectable",f[6]),(!s||h[0]&41943072)&&ft(e,"selectable",f[5]),(!s||h[0]&41943056)&&ft(e,"nopan",f[4]),(!s||h[0]&41945088)&&ft(e,"parent",f[11]);const _=h[0]&67109888;(h[0]&67175424||_)&&lt(e,"z-index",f[16]),(h[0]&67122176&&a!==(a=`translate(${f[12]}px, ${f[13]}px)`)||_)&&lt(e,"transform",a),(h[0]&68158464||_)&&lt(e,"visibility",f[20]?"visible":"hidden")},i(f){s||(t&&T(t.$$.fragment,f),s=!0)},o(f){t&&D(t.$$.fragment,f),s=!1},d(f){f&&p(e),t&&oe(t),o[50](null),l=!1,kn(c)}}}function jk(o){let e,t,n=!o[8]&&ed(o);return{c(){n&&n.c(),e=je()},l(r){n&&n.l(r),e=je()},m(r,i){n&&n.m(r,i),U(r,e,i),t=!0},p(r,i){r[8]?n&&(Le(),D(n,1,1,()=>{n=null}),Ue()):n?(n.p(r,i),i[0]&256&&T(n,1)):(n=ed(r),n.c(),T(n,1),n.m(e.parentNode,e))},i(r){t||(T(n),t=!0)},o(r){D(n),t=!1},d(r){r&&p(e),n&&n.d(r)}}}function Qk(o,e,t){let n,r,i,a,s,l,{node:c}=e,{id:u}=e,{data:d={}}=e,{selected:f=!1}=e,{draggable:h=void 0}=e,{selectable:_=void 0}=e,{connectable:y=!0}=e,{deletable:v=!0}=e,{hidden:m=!1}=e,{dragging:b=!1}=e,{resizeObserver:w=null}=e,{style:C=void 0}=e,{type:O="default"}=e,{isParent:S=!1}=e,{positionX:E}=e,{positionY:H}=e,{sourcePosition:R=void 0}=e,{targetPosition:L=void 0}=e,{zIndex:F}=e,{measuredWidth:q=void 0}=e,{measuredHeight:W=void 0}=e,{initialWidth:A=void 0}=e,{initialHeight:V=void 0}=e,{width:N=void 0}=e,{height:G=void 0}=e,{dragHandle:X=void 0}=e,{initialized:Q=!1}=e,{parentId:j=void 0}=e,{nodeClickDistance:ue=void 0}=e,{class:B=""}=e;const x=ln(),{nodeTypes:J,nodeDragThreshold:ce,selectNodesOnDrag:me,handleNodeSelection:se,updateNodeInternals:Be}=x;de(o,J,ie=>t(46,s=ie));let He,Y=null;const Xe=Pn(),Ke=ot(y);de(o,Ke,ie=>t(28,l=ie));let mt,fe,xe;fi("svelteflow__node_id",u),fi("svelteflow__node_connectable",Ke),Qo(()=>{Y&&(w==null||w.unobserve(Y))});function gt(ie){_&&(!pe(me)||!h||pe(ce)>0)&&se(u),Xe("nodeclick",{node:c.internals.userNode,event:ie})}const Et=(ie,Ge,nt,vt)=>{Xe("nodedrag",{event:ie,targetNode:nt,nodes:vt})},Bt=(ie,Ge,nt,vt)=>{Xe("nodedragstart",{event:ie,targetNode:nt,nodes:vt})},Xt=(ie,Ge,nt,vt)=>{Xe("nodedragstop",{event:ie,targetNode:nt,nodes:vt})};function Ot(ie){Ye[ie?"unshift":"push"](()=>{He=ie,t(24,He)})}const rn=ie=>Xe("nodemouseenter",{node:c,event:ie}),Wt=ie=>Xe("nodemouseleave",{node:c,event:ie}),Nt=ie=>Xe("nodemousemove",{node:c,event:ie}),tn=ie=>Xe("nodecontextmenu",{node:c,event:ie});return o.$$set=ie=>{"node"in ie&&t(0,c=ie.node),"id"in ie&&t(1,u=ie.id),"data"in ie&&t(2,d=ie.data),"selected"in ie&&t(3,f=ie.selected),"draggable"in ie&&t(4,h=ie.draggable),"selectable"in ie&&t(5,_=ie.selectable),"connectable"in ie&&t(6,y=ie.connectable),"deletable"in ie&&t(7,v=ie.deletable),"hidden"in ie&&t(8,m=ie.hidden),"dragging"in ie&&t(9,b=ie.dragging),"resizeObserver"in ie&&t(35,w=ie.resizeObserver),"style"in ie&&t(10,C=ie.style),"type"in ie&&t(36,O=ie.type),"isParent"in ie&&t(11,S=ie.isParent),"positionX"in ie&&t(12,E=ie.positionX),"positionY"in ie&&t(13,H=ie.positionY),"sourcePosition"in ie&&t(14,R=ie.sourcePosition),"targetPosition"in ie&&t(15,L=ie.targetPosition),"zIndex"in ie&&t(16,F=ie.zIndex),"measuredWidth"in ie&&t(37,q=ie.measuredWidth),"measuredHeight"in ie&&t(38,W=ie.measuredHeight),"initialWidth"in ie&&t(39,A=ie.initialWidth),"initialHeight"in ie&&t(40,V=ie.initialHeight),"width"in ie&&t(17,N=ie.width),"height"in ie&&t(18,G=ie.height),"dragHandle"in ie&&t(19,X=ie.dragHandle),"initialized"in ie&&t(20,Q=ie.initialized),"parentId"in ie&&t(21,j=ie.parentId),"nodeClickDistance"in ie&&t(22,ue=ie.nodeClickDistance),"class"in ie&&t(23,B=ie.class)},o.$$.update=()=>{o.$$.dirty[1]&32&&t(25,n=O||"default"),o.$$.dirty[0]&33554432|o.$$.dirty[1]&32768&&t(45,r=!!s[n]),o.$$.dirty[0]&33554432|o.$$.dirty[1]&32768&&t(27,i=s[n]||Ig),o.$$.dirty[1]&16416&&(r||console.warn("003",Ri.error003(O))),o.$$.dirty[0]&393216|o.$$.dirty[1]&960&&t(26,a=qk({width:N,height:G,initialWidth:A,initialHeight:V,measuredWidth:q,measuredHeight:W})),o.$$.dirty[0]&64&&Ke.set(!!y),o.$$.dirty[0]&50380802|o.$$.dirty[1]&14336&&((mt&&n!==mt||fe&&R!==fe||xe&&L!==xe)&&requestAnimationFrame(()=>Be(new Map([[u,{id:u,nodeElement:He,force:!0}]]))),t(42,mt=n),t(43,fe=R),t(44,xe=L)),o.$$.dirty[0]&17825792|o.$$.dirty[1]&1040&&w&&(He!==Y||!Q)&&(Y&&w.unobserve(Y),He&&w.observe(He),t(41,Y=He))},[c,u,d,f,h,_,y,v,m,b,C,S,E,H,R,L,F,N,G,X,Q,j,ue,B,He,n,a,i,l,x,J,se,Xe,Ke,gt,w,O,q,W,A,V,Y,mt,fe,xe,r,s,Et,Bt,Xt,Ot,rn,Wt,Nt,tn]}class Xk extends Ve{constructor(e){super(),Fe(this,e,Qk,jk,xd,{node:0,id:1,data:2,selected:3,draggable:4,selectable:5,connectable:6,deletable:7,hidden:8,dragging:9,resizeObserver:35,style:10,type:36,isParent:11,positionX:12,positionY:13,sourcePosition:14,targetPosition:15,zIndex:16,measuredWidth:37,measuredHeight:38,initialWidth:39,initialHeight:40,width:17,height:18,dragHandle:19,initialized:20,parentId:21,nodeClickDistance:22,class:23},null,[-1,-1])}}const{Map:Jk}=Wa;function td(o,e,t){const n=o.slice();return n[21]=e[t],n}function nd(o,e){let t,n,r;return n=new Xk({props:{node:e[21],id:e[21].id,data:e[21].data,selected:!!e[21].selected,hidden:!!e[21].hidden,draggable:!!(e[21].draggable||e[2]&&typeof e[21].draggable>"u"),selectable:!!(e[21].selectable||e[3]&&typeof e[21].selectable>"u"),connectable:!!(e[21].connectable||e[4]&&typeof e[21].connectable>"u"),deletable:e[21].deletable??!0,positionX:e[21].internals.positionAbsolute.x,positionY:e[21].internals.positionAbsolute.y,isParent:e[5].has(e[21].id),style:e[21].style,class:e[21].class,type:e[21].type??"default",sourcePosition:e[21].sourcePosition,targetPosition:e[21].targetPosition,dragging:e[21].dragging,zIndex:e[21].internals.z??0,dragHandle:e[21].dragHandle,initialized:Fu(e[21]),width:e[21].width,height:e[21].height,initialWidth:e[21].initialWidth,initialHeight:e[21].initialHeight,measuredWidth:e[21].measured.width,measuredHeight:e[21].measured.height,parentId:e[21].parentId,resizeObserver:e[11],nodeClickDistance:e[0]}}),n.$on("nodeclick",e[12]),n.$on("nodemouseenter",e[13]),n.$on("nodemousemove",e[14]),n.$on("nodemouseleave",e[15]),n.$on("nodedrag",e[16]),n.$on("nodedragstart",e[17]),n.$on("nodedragstop",e[18]),n.$on("nodecontextmenu",e[19]),{key:o,first:null,c(){t=je(),te(n.$$.fragment),this.h()},l(i){t=je(),re(n.$$.fragment,i),this.h()},h(){this.first=t},m(i,a){U(i,t,a),ne(n,i,a),r=!0},p(i,a){e=i;const s={};a&2&&(s.node=e[21]),a&2&&(s.id=e[21].id),a&2&&(s.data=e[21].data),a&2&&(s.selected=!!e[21].selected),a&2&&(s.hidden=!!e[21].hidden),a&6&&(s.draggable=!!(e[21].draggable||e[2]&&typeof e[21].draggable>"u")),a&10&&(s.selectable=!!(e[21].selectable||e[3]&&typeof e[21].selectable>"u")),a&18&&(s.connectable=!!(e[21].connectable||e[4]&&typeof e[21].connectable>"u")),a&2&&(s.deletable=e[21].deletable??!0),a&2&&(s.positionX=e[21].internals.positionAbsolute.x),a&2&&(s.positionY=e[21].internals.positionAbsolute.y),a&34&&(s.isParent=e[5].has(e[21].id)),a&2&&(s.style=e[21].style),a&2&&(s.class=e[21].class),a&2&&(s.type=e[21].type??"default"),a&2&&(s.sourcePosition=e[21].sourcePosition),a&2&&(s.targetPosition=e[21].targetPosition),a&2&&(s.dragging=e[21].dragging),a&2&&(s.zIndex=e[21].internals.z??0),a&2&&(s.dragHandle=e[21].dragHandle),a&2&&(s.initialized=Fu(e[21])),a&2&&(s.width=e[21].width),a&2&&(s.height=e[21].height),a&2&&(s.initialWidth=e[21].initialWidth),a&2&&(s.initialHeight=e[21].initialHeight),a&2&&(s.measuredWidth=e[21].measured.width),a&2&&(s.measuredHeight=e[21].measured.height),a&2&&(s.parentId=e[21].parentId),a&1&&(s.nodeClickDistance=e[0]),n.$set(s)},i(i){r||(T(n.$$.fragment,i),r=!0)},o(i){D(n.$$.fragment,i),r=!1},d(i){i&&p(t),oe(n,i)}}}function xk(o){let e,t=[],n=new Jk,r,i=Pt(o[1]);const a=s=>s[21].id;for(let s=0;s<i.length;s+=1){let l=td(o,i,s),c=a(l);n.set(c,t[s]=nd(c,l))}return{c(){e=M("div");for(let s=0;s<t.length;s+=1)t[s].c();this.h()},l(s){e=P(s,"DIV",{class:!0});var l=I(e);for(let c=0;c<t.length;c+=1)t[c].l(l);l.forEach(p),this.h()},h(){g(e,"class","svelte-flow__nodes svelte-tf4uy4")},m(s,l){U(s,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);r=!0},p(s,[l]){l&2111&&(i=Pt(s[1]),Le(),t=Is(t,l,a,1,s,i,n,e,Ts,nd,null,td),Ue())},i(s){if(!r){for(let l=0;l<i.length;l+=1)T(t[l]);r=!0}},o(s){for(let l=0;l<t.length;l+=1)D(t[l]);r=!1},d(s){s&&p(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function Zk(o,e,t){let n,r,i,a,s,{nodeClickDistance:l=0}=e;const{visibleNodes:c,nodesDraggable:u,nodesConnectable:d,elementsSelectable:f,updateNodeInternals:h,parentLookup:_}=ln();de(o,c,H=>t(1,n=H)),de(o,u,H=>t(2,r=H)),de(o,d,H=>t(4,a=H)),de(o,f,H=>t(3,i=H)),de(o,_,H=>t(5,s=H));const y=typeof ResizeObserver>"u"?null:new ResizeObserver(H=>{const R=new Map;H.forEach(L=>{const F=L.target.getAttribute("data-id");R.set(F,{id:F,nodeElement:L.target,force:!0})}),h(R)});Qo(()=>{y==null||y.disconnect()});function v(H){St.call(this,o,H)}function m(H){St.call(this,o,H)}function b(H){St.call(this,o,H)}function w(H){St.call(this,o,H)}function C(H){St.call(this,o,H)}function O(H){St.call(this,o,H)}function S(H){St.call(this,o,H)}function E(H){St.call(this,o,H)}return o.$$set=H=>{"nodeClickDistance"in H&&t(0,l=H.nodeClickDistance)},[l,n,r,i,a,s,c,u,d,f,_,y,v,m,b,w,C,O,S,E]}class $k extends Ve{constructor(e){super(),Fe(this,e,Zk,xk,Qe,{nodeClickDistance:0})}}function od(o){let e,t,n,r,i,a,s,l;var c=o[27];function u(d,f){return{props:{id:d[0],source:d[1],target:d[2],sourceX:d[14],sourceY:d[15],targetX:d[16],targetY:d[17],sourcePosition:d[18],targetPosition:d[19],animated:d[6],selected:d[7],label:d[10],labelStyle:d[11],data:d[3],style:d[4],interactionWidth:d[21],selectable:d[24],deletable:d[8]??!0,type:d[23],sourceHandleId:d[12],targetHandleId:d[13],markerStart:d[26],markerEnd:d[25]}}}return c&&(n=os(c,u(o))),{c(){e=be("svg"),t=be("g"),n&&te(n.$$.fragment),this.h()},l(d){e=ye(d,"svg",{});var f=I(e);t=ye(f,"g",{class:!0,"data-id":!0,"aria-label":!0,role:!0});var h=I(t);n&&re(n.$$.fragment,h),h.forEach(p),f.forEach(p),this.h()},h(){g(t,"class",r=Qt(["svelte-flow__edge",o[22]])),g(t,"data-id",o[0]),g(t,"aria-label",i=o[20]===null?void 0:o[20]?o[20]:`Edge from ${o[1]} to ${o[2]}`),g(t,"role","img"),ft(t,"animated",o[6]),ft(t,"selected",o[7]),ft(t,"selectable",o[24]),lt(e,"z-index",o[5])},m(d,f){U(d,e,f),k(e,t),n&&ne(n,t,null),a=!0,s||(l=[Ie(t,"click",o[32]),Ie(t,"contextmenu",o[41]),Ie(t,"mouseenter",o[42]),Ie(t,"mouseleave",o[43])],s=!0)},p(d,f){if(f[0]&134217728&&c!==(c=d[27])){if(n){Le();const h=n;D(h.$$.fragment,1,0,()=>{oe(h,1)}),Ue()}c?(n=os(c,u(d)),te(n.$$.fragment),T(n.$$.fragment,1),ne(n,t,null)):n=null}else if(c){const h={};f[0]&1&&(h.id=d[0]),f[0]&2&&(h.source=d[1]),f[0]&4&&(h.target=d[2]),f[0]&16384&&(h.sourceX=d[14]),f[0]&32768&&(h.sourceY=d[15]),f[0]&65536&&(h.targetX=d[16]),f[0]&131072&&(h.targetY=d[17]),f[0]&262144&&(h.sourcePosition=d[18]),f[0]&524288&&(h.targetPosition=d[19]),f[0]&64&&(h.animated=d[6]),f[0]&128&&(h.selected=d[7]),f[0]&1024&&(h.label=d[10]),f[0]&2048&&(h.labelStyle=d[11]),f[0]&8&&(h.data=d[3]),f[0]&16&&(h.style=d[4]),f[0]&2097152&&(h.interactionWidth=d[21]),f[0]&16777216&&(h.selectable=d[24]),f[0]&256&&(h.deletable=d[8]??!0),f[0]&8388608&&(h.type=d[23]),f[0]&4096&&(h.sourceHandleId=d[12]),f[0]&8192&&(h.targetHandleId=d[13]),f[0]&67108864&&(h.markerStart=d[26]),f[0]&33554432&&(h.markerEnd=d[25]),n.$set(h)}(!a||f[0]&4194304&&r!==(r=Qt(["svelte-flow__edge",d[22]])))&&g(t,"class",r),(!a||f[0]&1)&&g(t,"data-id",d[0]),(!a||f[0]&1048582&&i!==(i=d[20]===null?void 0:d[20]?d[20]:`Edge from ${d[1]} to ${d[2]}`))&&g(t,"aria-label",i),(!a||f[0]&4194368)&&ft(t,"animated",d[6]),(!a||f[0]&4194432)&&ft(t,"selected",d[7]),(!a||f[0]&20971520)&&ft(t,"selectable",d[24]),f[0]&32&&lt(e,"z-index",d[5])},i(d){a||(n&&T(n.$$.fragment,d),a=!0)},o(d){n&&D(n.$$.fragment,d),a=!1},d(d){d&&p(e),n&&oe(n),s=!1,kn(l)}}}function eC(o){let e,t,n=!o[9]&&od(o);return{c(){n&&n.c(),e=je()},l(r){n&&n.l(r),e=je()},m(r,i){n&&n.m(r,i),U(r,e,i),t=!0},p(r,i){r[9]?n&&(Le(),D(n,1,1,()=>{n=null}),Ue()):n?(n.p(r,i),i[0]&512&&T(n,1)):(n=od(r),n.c(),T(n,1),n.m(e.parentNode,e))},i(r){t||(T(n),t=!0)},o(r){D(n),t=!1},d(r){r&&p(e),n&&n.d(r)}}}function tC(o,e,t){let n,r,i,a,s,l,c,u,d,{id:f}=e,{type:h="default"}=e,{source:_=""}=e,{target:y=""}=e,{data:v={}}=e,{style:m=void 0}=e,{zIndex:b=void 0}=e,{animated:w=!1}=e,{selected:C=!1}=e,{selectable:O=void 0}=e,{deletable:S=void 0}=e,{hidden:E=!1}=e,{label:H=void 0}=e,{labelStyle:R=void 0}=e,{markerStart:L=void 0}=e,{markerEnd:F=void 0}=e,{sourceHandle:q=void 0}=e,{targetHandle:W=void 0}=e,{sourceX:A}=e,{sourceY:V}=e,{targetX:N}=e,{targetY:G}=e,{sourcePosition:X}=e,{targetPosition:Q}=e,{ariaLabel:j=void 0}=e,{interactionWidth:ue=void 0}=e,{class:B=""}=e;fi("svelteflow__edge_id",f);const{edgeLookup:x,edgeTypes:J,flowId:ce,elementsSelectable:me}=ln();de(o,x,fe=>t(44,l=fe)),de(o,J,fe=>t(40,d=fe)),de(o,ce,fe=>t(39,u=fe)),de(o,me,fe=>t(38,c=fe));const se=Pn(),Be=Tg();function He(fe){const xe=l.get(f);xe&&(Be(f),se("edgeclick",{event:fe,edge:xe}))}function Y(fe,xe){const gt=l.get(f);gt&&se(xe,{event:fe,edge:gt})}const Xe=fe=>{Y(fe,"edgecontextmenu")},Ke=fe=>{Y(fe,"edgemouseenter")},mt=fe=>{Y(fe,"edgemouseleave")};return o.$$set=fe=>{"id"in fe&&t(0,f=fe.id),"type"in fe&&t(34,h=fe.type),"source"in fe&&t(1,_=fe.source),"target"in fe&&t(2,y=fe.target),"data"in fe&&t(3,v=fe.data),"style"in fe&&t(4,m=fe.style),"zIndex"in fe&&t(5,b=fe.zIndex),"animated"in fe&&t(6,w=fe.animated),"selected"in fe&&t(7,C=fe.selected),"selectable"in fe&&t(35,O=fe.selectable),"deletable"in fe&&t(8,S=fe.deletable),"hidden"in fe&&t(9,E=fe.hidden),"label"in fe&&t(10,H=fe.label),"labelStyle"in fe&&t(11,R=fe.labelStyle),"markerStart"in fe&&t(36,L=fe.markerStart),"markerEnd"in fe&&t(37,F=fe.markerEnd),"sourceHandle"in fe&&t(12,q=fe.sourceHandle),"targetHandle"in fe&&t(13,W=fe.targetHandle),"sourceX"in fe&&t(14,A=fe.sourceX),"sourceY"in fe&&t(15,V=fe.sourceY),"targetX"in fe&&t(16,N=fe.targetX),"targetY"in fe&&t(17,G=fe.targetY),"sourcePosition"in fe&&t(18,X=fe.sourcePosition),"targetPosition"in fe&&t(19,Q=fe.targetPosition),"ariaLabel"in fe&&t(20,j=fe.ariaLabel),"interactionWidth"in fe&&t(21,ue=fe.interactionWidth),"class"in fe&&t(22,B=fe.class)},o.$$.update=()=>{o.$$.dirty[1]&8&&t(23,n=h||"default"),o.$$.dirty[0]&8388608|o.$$.dirty[1]&512&&t(27,r=d[n]||Sg),o.$$.dirty[1]&288&&t(26,i=L?`url('#${Ga(L,u)}')`:void 0),o.$$.dirty[1]&320&&t(25,a=F?`url('#${Ga(F,u)}')`:void 0),o.$$.dirty[1]&144&&t(24,s=O??c)},[f,_,y,v,m,b,w,C,S,E,H,R,q,W,A,V,N,G,X,Q,j,ue,B,n,s,a,i,r,x,J,ce,me,He,Y,h,O,L,F,c,u,d,Xe,Ke,mt]}class nC extends Ve{constructor(e){super(),Fe(this,e,tC,eC,xd,{id:0,type:34,source:1,target:2,data:3,style:4,zIndex:5,animated:6,selected:7,selectable:35,deletable:8,hidden:9,label:10,labelStyle:11,markerStart:36,markerEnd:37,sourceHandle:12,targetHandle:13,sourceX:14,sourceY:15,targetX:16,targetY:17,sourcePosition:18,targetPosition:19,ariaLabel:20,interactionWidth:21,class:22},null,[-1,-1])}}function oC(o,e,t){let{onMount:n=void 0}=e,{onDestroy:r=void 0}=e;return Jn(()=>(n==null||n(),r)),o.$$set=i=>{"onMount"in i&&t(0,n=i.onMount),"onDestroy"in i&&t(1,r=i.onDestroy)},[n,r]}class rC extends Ve{constructor(e){super(),Fe(this,e,oC,null,Qe,{onMount:0,onDestroy:1})}}function rd(o,e,t){const n=o.slice();return n[2]=e[t],n}function id(o,e){let t,n,r;const i=[e[2]];let a={};for(let s=0;s<i.length;s+=1)a=Dt(a,i[s]);return n=new fC({props:a}),{key:o,first:null,c(){t=je(),te(n.$$.fragment),this.h()},l(s){t=je(),re(n.$$.fragment,s),this.h()},h(){this.first=t},m(s,l){U(s,t,l),ne(n,s,l),r=!0},p(s,l){e=s;const c=l&1?rr(i,[gi(e[2])]):{};n.$set(c)},i(s){r||(T(n.$$.fragment,s),r=!0)},o(s){D(n.$$.fragment,s),r=!1},d(s){s&&p(t),oe(n,s)}}}function iC(o){let e,t=[],n=new Map,r,i=Pt(o[0]);const a=s=>s[2].id;for(let s=0;s<i.length;s+=1){let l=rd(o,i,s),c=a(l);n.set(c,t[s]=id(c,l))}return{c(){e=be("defs");for(let s=0;s<t.length;s+=1)t[s].c()},l(s){e=ye(s,"defs",{});var l=I(e);for(let c=0;c<t.length;c+=1)t[c].l(l);l.forEach(p)},m(s,l){U(s,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);r=!0},p(s,[l]){l&1&&(i=Pt(s[0]),Le(),t=Is(t,l,a,1,s,i,n,e,Ts,id,null,rd),Ue())},i(s){if(!r){for(let l=0;l<i.length;l+=1)T(t[l]);r=!0}},o(s){for(let l=0;l<t.length;l+=1)D(t[l]);r=!1},d(s){s&&p(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function sC(o,e,t){let n;const{markers:r}=ln();return de(o,r,i=>t(0,n=i)),[n,r]}class aC extends Ve{constructor(e){super(),Fe(this,e,sC,iC,Qe,{})}}function lC(o){let e;return{c(){e=be("polyline"),this.h()},l(t){e=ye(t,"polyline",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,fill:!0,points:!0}),I(e).forEach(p),this.h()},h(){g(e,"stroke",o[6]),g(e,"stroke-linecap","round"),g(e,"stroke-linejoin","round"),g(e,"stroke-width",o[7]),g(e,"fill",o[6]),g(e,"points","-5,-4 0,0 -5,4 -5,-4")},m(t,n){U(t,e,n)},p(t,n){n&64&&g(e,"stroke",t[6]),n&128&&g(e,"stroke-width",t[7]),n&64&&g(e,"fill",t[6])},d(t){t&&p(e)}}}function cC(o){let e;return{c(){e=be("polyline"),this.h()},l(t){e=ye(t,"polyline",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,fill:!0,points:!0}),I(e).forEach(p),this.h()},h(){g(e,"stroke",o[6]),g(e,"stroke-linecap","round"),g(e,"stroke-linejoin","round"),g(e,"stroke-width",o[7]),g(e,"fill","none"),g(e,"points","-5,-4 0,0 -5,4")},m(t,n){U(t,e,n)},p(t,n){n&64&&g(e,"stroke",t[6]),n&128&&g(e,"stroke-width",t[7])},d(t){t&&p(e)}}}function uC(o){let e,t,n;function r(s,l){if(s[1]===vs.Arrow)return cC;if(s[1]===vs.ArrowClosed)return lC}let i=r(o),a=i&&i(o);return{c(){e=be("marker"),a&&a.c(),this.h()},l(s){e=ye(s,"marker",{class:!0,id:!0,markerWidth:!0,markerHeight:!0,viewBox:!0,markerUnits:!0,orient:!0,refX:!0,refY:!0});var l=I(e);a&&a.l(l),l.forEach(p),this.h()},h(){g(e,"class","svelte-flow__arrowhead"),g(e,"id",o[0]),g(e,"markerWidth",t=`${o[2]}`),g(e,"markerHeight",n=`${o[3]}`),g(e,"viewBox","-10 -10 20 20"),g(e,"markerUnits",o[4]),g(e,"orient",o[5]),g(e,"refX","0"),g(e,"refY","0")},m(s,l){U(s,e,l),a&&a.m(e,null)},p(s,[l]){i===(i=r(s))&&a?a.p(s,l):(a&&a.d(1),a=i&&i(s),a&&(a.c(),a.m(e,null))),l&1&&g(e,"id",s[0]),l&4&&t!==(t=`${s[2]}`)&&g(e,"markerWidth",t),l&8&&n!==(n=`${s[3]}`)&&g(e,"markerHeight",n),l&16&&g(e,"markerUnits",s[4]),l&32&&g(e,"orient",s[5])},i:Re,o:Re,d(s){s&&p(e),a&&a.d()}}}function dC(o,e,t){let{id:n}=e,{type:r}=e,{width:i=12.5}=e,{height:a=12.5}=e,{markerUnits:s="strokeWidth"}=e,{orient:l="auto-start-reverse"}=e,{color:c=void 0}=e,{strokeWidth:u=void 0}=e;return o.$$set=d=>{"id"in d&&t(0,n=d.id),"type"in d&&t(1,r=d.type),"width"in d&&t(2,i=d.width),"height"in d&&t(3,a=d.height),"markerUnits"in d&&t(4,s=d.markerUnits),"orient"in d&&t(5,l=d.orient),"color"in d&&t(6,c=d.color),"strokeWidth"in d&&t(7,u=d.strokeWidth)},[n,r,i,a,s,l,c,u]}class fC extends Ve{constructor(e){super(),Fe(this,e,dC,uC,Qe,{id:0,type:1,width:2,height:3,markerUnits:4,orient:5,color:6,strokeWidth:7})}}function sd(o,e,t){const n=o.slice();return n[14]=e[t],n}function ad(o,e){let t,n,r;return n=new nC({props:{id:e[14].id,source:e[14].source,target:e[14].target,data:e[14].data,style:e[14].style,animated:e[14].animated,selected:e[14].selected,selectable:e[14].selectable??e[1],deletable:e[14].deletable,hidden:e[14].hidden,label:e[14].label,labelStyle:e[14].labelStyle,markerStart:e[14].markerStart,markerEnd:e[14].markerEnd,sourceHandle:e[14].sourceHandle,targetHandle:e[14].targetHandle,sourceX:e[14].sourceX,sourceY:e[14].sourceY,targetX:e[14].targetX,targetY:e[14].targetY,sourcePosition:e[14].sourcePosition,targetPosition:e[14].targetPosition,ariaLabel:e[14].ariaLabel,interactionWidth:e[14].interactionWidth,class:e[14].class,type:e[14].type||"default",zIndex:e[14].zIndex}}),n.$on("edgeclick",e[7]),n.$on("edgecontextmenu",e[8]),n.$on("edgemouseenter",e[9]),n.$on("edgemouseleave",e[10]),{key:o,first:null,c(){t=je(),te(n.$$.fragment),this.h()},l(i){t=je(),re(n.$$.fragment,i),this.h()},h(){this.first=t},m(i,a){U(i,t,a),ne(n,i,a),r=!0},p(i,a){e=i;const s={};a&1&&(s.id=e[14].id),a&1&&(s.source=e[14].source),a&1&&(s.target=e[14].target),a&1&&(s.data=e[14].data),a&1&&(s.style=e[14].style),a&1&&(s.animated=e[14].animated),a&1&&(s.selected=e[14].selected),a&3&&(s.selectable=e[14].selectable??e[1]),a&1&&(s.deletable=e[14].deletable),a&1&&(s.hidden=e[14].hidden),a&1&&(s.label=e[14].label),a&1&&(s.labelStyle=e[14].labelStyle),a&1&&(s.markerStart=e[14].markerStart),a&1&&(s.markerEnd=e[14].markerEnd),a&1&&(s.sourceHandle=e[14].sourceHandle),a&1&&(s.targetHandle=e[14].targetHandle),a&1&&(s.sourceX=e[14].sourceX),a&1&&(s.sourceY=e[14].sourceY),a&1&&(s.targetX=e[14].targetX),a&1&&(s.targetY=e[14].targetY),a&1&&(s.sourcePosition=e[14].sourcePosition),a&1&&(s.targetPosition=e[14].targetPosition),a&1&&(s.ariaLabel=e[14].ariaLabel),a&1&&(s.interactionWidth=e[14].interactionWidth),a&1&&(s.class=e[14].class),a&1&&(s.type=e[14].type||"default"),a&1&&(s.zIndex=e[14].zIndex),n.$set(s)},i(i){r||(T(n.$$.fragment,i),r=!0)},o(i){D(n.$$.fragment,i),r=!1},d(i){i&&p(t),oe(n,i)}}}function ld(o){let e,t;return e=new rC({props:{onMount:o[11],onDestroy:o[12]}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&4&&(i.onMount=n[11]),r&4&&(i.onDestroy=n[12]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function hC(o){let e,t,n,r,i=[],a=new Map,s,l;n=new aC({});let c=Pt(o[0]);const u=f=>f[14].id;for(let f=0;f<c.length;f+=1){let h=sd(o,c,f),_=u(h);a.set(_,i[f]=ad(_,h))}let d=o[0].length>0&&ld(o);return{c(){e=M("div"),t=be("svg"),te(n.$$.fragment),r=$();for(let f=0;f<i.length;f+=1)i[f].c();s=$(),d&&d.c(),this.h()},l(f){e=P(f,"DIV",{class:!0});var h=I(e);t=ye(h,"svg",{class:!0});var _=I(t);re(n.$$.fragment,_),_.forEach(p),r=ee(h);for(let y=0;y<i.length;y+=1)i[y].l(h);s=ee(h),d&&d.l(h),h.forEach(p),this.h()},h(){g(t,"class","svelte-flow__marker"),g(e,"class","svelte-flow__edges")},m(f,h){U(f,e,h),k(e,t),ne(n,t,null),k(e,r);for(let _=0;_<i.length;_+=1)i[_]&&i[_].m(e,null);k(e,s),d&&d.m(e,null),l=!0},p(f,[h]){h&3&&(c=Pt(f[0]),Le(),i=Is(i,h,u,1,f,c,a,e,Ts,ad,s,sd),Ue()),f[0].length>0?d?(d.p(f,h),h&1&&T(d,1)):(d=ld(f),d.c(),T(d,1),d.m(e,null)):d&&(Le(),D(d,1,1,()=>{d=null}),Ue())},i(f){if(!l){T(n.$$.fragment,f);for(let h=0;h<c.length;h+=1)T(i[h]);T(d),l=!0}},o(f){D(n.$$.fragment,f);for(let h=0;h<i.length;h+=1)D(i[h]);D(d),l=!1},d(f){f&&p(e),oe(n);for(let h=0;h<i.length;h+=1)i[h].d();d&&d.d()}}}function gC(o,e,t){let n,r,i,{defaultEdgeOptions:a}=e;const{visibleEdges:s,edgesInitialized:l,edges:{setDefaultOptions:c},elementsSelectable:u}=ln();de(o,s,m=>t(0,n=m)),de(o,l,m=>t(2,i=m)),de(o,u,m=>t(1,r=m)),Jn(()=>{a&&c(a)});function d(m){St.call(this,o,m)}function f(m){St.call(this,o,m)}function h(m){St.call(this,o,m)}function _(m){St.call(this,o,m)}const y=()=>{ns(l,i=!0,i)},v=()=>{ns(l,i=!1,i)};return o.$$set=m=>{"defaultEdgeOptions"in m&&t(6,a=m.defaultEdgeOptions)},[n,r,i,s,l,u,a,d,f,h,_,y,v]}class mC extends Ve{constructor(e){super(),Fe(this,e,gC,hC,Qe,{defaultEdgeOptions:6})}}function cd(o){let e;return{c(){e=M("div"),this.h()},l(t){e=P(t,"DIV",{class:!0}),I(e).forEach(p),this.h()},h(){g(e,"class","svelte-flow__selection svelte-1iugwpu"),lt(e,"width",typeof o[2]=="string"?o[2]:`${o[2]}px`),lt(e,"height",typeof o[3]=="string"?o[3]:`${o[3]}px`),lt(e,"transform",`translate(${o[0]}px, ${o[1]}px)`)},m(t,n){U(t,e,n)},p(t,n){n&4&&lt(e,"width",typeof t[2]=="string"?t[2]:`${t[2]}px`),n&8&&lt(e,"height",typeof t[3]=="string"?t[3]:`${t[3]}px`),n&3&&lt(e,"transform",`translate(${t[0]}px, ${t[1]}px)`)},d(t){t&&p(e)}}}function pC(o){let e,t=o[4]&&cd(o);return{c(){t&&t.c(),e=je()},l(n){t&&t.l(n),e=je()},m(n,r){t&&t.m(n,r),U(n,e,r)},p(n,[r]){n[4]?t?t.p(n,r):(t=cd(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Re,o:Re,d(n){n&&p(e),t&&t.d(n)}}}function _C(o,e,t){let{x:n=0}=e,{y:r=0}=e,{width:i=0}=e,{height:a=0}=e,{isVisible:s=!0}=e;return o.$$set=l=>{"x"in l&&t(0,n=l.x),"y"in l&&t(1,r=l.y),"width"in l&&t(2,i=l.width),"height"in l&&t(3,a=l.height),"isVisible"in l&&t(4,s=l.isVisible)},[n,r,i,a,s]}class Og extends Ve{constructor(e){super(),Fe(this,e,_C,pC,Qe,{x:0,y:1,width:2,height:3,isVisible:4})}}function bC(o){var n,r,i,a;let e,t;return e=new Og({props:{isVisible:!!(o[0]&&o[1]==="user"),width:(n=o[0])==null?void 0:n.width,height:(r=o[0])==null?void 0:r.height,x:(i=o[0])==null?void 0:i.x,y:(a=o[0])==null?void 0:a.y}}),{c(){te(e.$$.fragment)},l(s){re(e.$$.fragment,s)},m(s,l){ne(e,s,l),t=!0},p(s,[l]){var u,d,f,h;const c={};l&3&&(c.isVisible=!!(s[0]&&s[1]==="user")),l&1&&(c.width=(u=s[0])==null?void 0:u.width),l&1&&(c.height=(d=s[0])==null?void 0:d.height),l&1&&(c.x=(f=s[0])==null?void 0:f.x),l&1&&(c.y=(h=s[0])==null?void 0:h.y),e.$set(c)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){oe(e,s)}}}function yC(o,e,t){let n,r;const{selectionRect:i,selectionRectMode:a}=ln();return de(o,i,s=>t(0,n=s)),de(o,a,s=>t(1,r=s)),[n,r,i,a]}class vC extends Ve{constructor(e){super(),Fe(this,e,yC,bC,Qe,{})}}function ud(o){let e,t,n,r,i;return t=new Og({props:{width:"100%",height:"100%",x:0,y:0}}),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(a){e=P(a,"DIV",{class:!0,style:!0,role:!0,tabindex:!0});var s=I(e);re(t.$$.fragment,s),s.forEach(p),this.h()},h(){g(e,"class","selection-wrapper nopan svelte-5pxri"),lt(e,"width",o[1].width+"px"),lt(e,"height",o[1].height+"px"),lt(e,"transform","translate("+o[1].x+"px, "+o[1].y+"px)"),g(e,"role","button"),g(e,"tabindex","-1")},m(a,s){U(a,e,s),ne(t,e,null),n=!0,r||(i=[Vn(Pg.call(null,e,{disabled:!1,store:o[2],onDrag:o[11],onDragStart:o[12],onDragStop:o[13]})),Ie(e,"contextmenu",o[7]),Ie(e,"click",o[8]),Ie(e,"keyup",kC)],r=!0)},p(a,s){(!n||s&2)&&lt(e,"width",a[1].width+"px"),(!n||s&2)&&lt(e,"height",a[1].height+"px"),(!n||s&2)&&lt(e,"transform","translate("+a[1].x+"px, "+a[1].y+"px)")},i(a){n||(T(t.$$.fragment,a),n=!0)},o(a){D(t.$$.fragment,a),n=!1},d(a){a&&p(e),oe(t),r=!1,kn(i)}}}function wC(o){let e=o[0]==="nodes"&&o[1]&&po(o[1].x)&&po(o[1].y),t,n,r=e&&ud(o);return{c(){r&&r.c(),t=je()},l(i){r&&r.l(i),t=je()},m(i,a){r&&r.m(i,a),U(i,t,a),n=!0},p(i,[a]){a&3&&(e=i[0]==="nodes"&&i[1]&&po(i[1].x)&&po(i[1].y)),e?r?(r.p(i,a),a&3&&T(r,1)):(r=ud(i),r.c(),T(r,1),r.m(t.parentNode,t)):r&&(Le(),D(r,1,1,()=>{r=null}),Ue())},i(i){n||(T(r),n=!0)},o(i){D(r),n=!1},d(i){i&&p(t),r&&r.d(i)}}}const kC=()=>{};function CC(o,e,t){let n,r,i;const a=ln(),{selectionRectMode:s,nodes:l,nodeLookup:c}=a;de(o,s,m=>t(0,i=m)),de(o,l,m=>t(9,n=m)),de(o,c,m=>t(10,r=m));const u=Pn();let d=null;function f(m){const b=n.filter(w=>w.selected);u("selectioncontextmenu",{nodes:b,event:m})}function h(m){const b=n.filter(w=>w.selected);u("selectionclick",{nodes:b,event:m})}const _=(m,b,w,C)=>{u("nodedrag",{event:m,targetNode:null,nodes:C})},y=(m,b,w,C)=>{u("nodedragstart",{event:m,targetNode:null,nodes:C})},v=(m,b,w,C)=>{u("nodedragstop",{event:m,targetNode:null,nodes:C})};return o.$$.update=()=>{o.$$.dirty&1537&&i==="nodes"&&t(1,d=js(r,{filter:m=>!!m.selected}))},[i,d,a,s,l,c,u,f,h,n,r,_,y,v]}class EC extends Ve{constructor(e){super(),Fe(this,e,CC,wC,Qe,{})}}function Io(o,e){let{enabled:t=!0,trigger:n,type:r="keydown"}=e;function i(a){const s=Array.isArray(n)?n:[n],l={alt:a.altKey,ctrl:a.ctrlKey,shift:a.shiftKey,meta:a.metaKey};for(const c of s){const u={modifier:[],preventDefault:!1,enabled:!0,...c},{modifier:d,key:f,callback:h,preventDefault:_,enabled:y}=u;if(y){if(d.length&&!(Array.isArray(d)?d:[d]).map(b=>typeof b=="string"?[b]:b).some(b=>b.every(w=>l[w])))continue;if(a.key===f){_&&a.preventDefault();const v={node:o,trigger:u,originalEvent:a};o.dispatchEvent(new CustomEvent("shortcut",{detail:v})),h==null||h(v)}}}}return t&&o.addEventListener(r,i),{update:a=>{const{enabled:s=!0,type:l="keydown"}=a;t&&(!s||r!==l)?o.removeEventListener(r,i):!t&&s&&o.addEventListener(l,i),t=s,r=l,n=a.trigger},destroy:()=>{o.removeEventListener(r,i)}}}function IC(o){let e,t,n,r,i,a,s,l,c,u,d,f;return{c:Re,l:Re,m(h,_){d||(f=[Vn(e=Io.call(null,window,{trigger:hn(o[0],o[11]),type:"keydown"})),Vn(t=Io.call(null,window,{trigger:hn(o[0],o[12]),type:"keyup"})),Vn(n=Io.call(null,window,{trigger:hn(o[1],o[13]),type:"keydown"})),Vn(r=Io.call(null,window,{trigger:hn(o[1],o[14]),type:"keyup"})),Vn(i=Io.call(null,window,{trigger:hn(o[2],o[15]),type:"keydown"})),Vn(a=Io.call(null,window,{trigger:hn(o[2],o[16]),type:"keyup"})),Vn(s=Io.call(null,window,{trigger:hn(o[3],o[17]),type:"keydown"})),Vn(l=Io.call(null,window,{trigger:hn(o[3],o[18]),type:"keyup"})),Vn(c=Io.call(null,window,{trigger:hn(o[4],o[19]),type:"keydown"})),Vn(u=Io.call(null,window,{trigger:hn(o[4],o[20]),type:"keyup"})),Ie(window,"blur",o[10]),Ie(window,"contextmenu",o[10])],d=!0)},p(h,[_]){e&&vn(e.update)&&_&1&&e.update.call(null,{trigger:hn(h[0],h[11]),type:"keydown"}),t&&vn(t.update)&&_&1&&t.update.call(null,{trigger:hn(h[0],h[12]),type:"keyup"}),n&&vn(n.update)&&_&2&&n.update.call(null,{trigger:hn(h[1],h[13]),type:"keydown"}),r&&vn(r.update)&&_&2&&r.update.call(null,{trigger:hn(h[1],h[14]),type:"keyup"}),i&&vn(i.update)&&_&4&&i.update.call(null,{trigger:hn(h[2],h[15]),type:"keydown"}),a&&vn(a.update)&&_&4&&a.update.call(null,{trigger:hn(h[2],h[16]),type:"keyup"}),s&&vn(s.update)&&_&8&&s.update.call(null,{trigger:hn(h[3],h[17]),type:"keydown"}),l&&vn(l.update)&&_&8&&l.update.call(null,{trigger:hn(h[3],h[18]),type:"keyup"}),c&&vn(c.update)&&_&16&&c.update.call(null,{trigger:hn(h[4],h[19]),type:"keydown"}),u&&vn(u.update)&&_&16&&u.update.call(null,{trigger:hn(h[4],h[20]),type:"keyup"})},i:Re,o:Re,d(h){d=!1,kn(f)}}}function Ng(o){return o!==null&&typeof o=="object"}function TC(o){return Ng(o)?o.modifier||[]:[]}function SC(o){return o==null?"":Ng(o)?o.key:o}function hn(o,e){return(Array.isArray(o)?o:[o]).map(n=>{const r=SC(n);return{key:r,modifier:TC(n),enabled:r!==null,callback:e}})}function AC(o,e,t){let{selectionKey:n="Shift"}=e,{multiSelectionKey:r=ks()?"Meta":"Control"}=e,{deleteKey:i="Backspace"}=e,{panActivationKey:a=" "}=e,{zoomActivationKey:s=ks()?"Meta":"Control"}=e;const{selectionKeyPressed:l,multiselectionKeyPressed:c,deleteKeyPressed:u,panActivationKeyPressed:d,zoomActivationKeyPressed:f,selectionRect:h}=ln();function _(){h.set(null),l.set(!1),c.set(!1),u.set(!1),d.set(!1),f.set(!1)}const y=()=>l.set(!0),v=()=>l.set(!1),m=()=>c.set(!0),b=()=>c.set(!1),w=R=>{!(R.originalEvent.ctrlKey||R.originalEvent.metaKey||R.originalEvent.shiftKey)&&!dw(R.originalEvent)&&u.set(!0)},C=()=>u.set(!1),O=()=>d.set(!0),S=()=>d.set(!1),E=()=>f.set(!0),H=()=>f.set(!1);return o.$$set=R=>{"selectionKey"in R&&t(0,n=R.selectionKey),"multiSelectionKey"in R&&t(1,r=R.multiSelectionKey),"deleteKey"in R&&t(2,i=R.deleteKey),"panActivationKey"in R&&t(3,a=R.panActivationKey),"zoomActivationKey"in R&&t(4,s=R.zoomActivationKey)},[n,r,i,a,s,l,c,u,d,f,_,y,v,m,b,w,C,O,S,E,H]}class RC extends Ve{constructor(e){super(),Fe(this,e,AC,IC,Qe,{selectionKey:0,multiSelectionKey:1,deleteKey:2,panActivationKey:3,zoomActivationKey:4})}}const MC=o=>({}),dd=o=>({});function fd(o){let e,t,n,r;const i=o[13].connectionLine,a=gn(i,o,o[12],dd);let s=!o[2]&&hd(o);return{c(){e=be("svg"),t=be("g"),a&&a.c(),s&&s.c(),this.h()},l(l){e=ye(l,"svg",{width:!0,height:!0,class:!0,style:!0});var c=I(e);t=ye(c,"g",{class:!0});var u=I(t);a&&a.l(u),s&&s.l(u),u.forEach(p),c.forEach(p),this.h()},h(){g(t,"class",n=Qt(["svelte-flow__connection",Lu(o[3].isValid)])),g(e,"width",o[5]),g(e,"height",o[6]),g(e,"class","svelte-flow__connectionline"),g(e,"style",o[0])},m(l,c){U(l,e,c),k(e,t),a&&a.m(t,null),s&&s.m(t,null),r=!0},p(l,c){a&&a.p&&(!r||c&4096)&&mn(a,i,l,l[12],r?_n(i,l[12],c,MC):pn(l[12]),dd),l[2]?s&&(s.d(1),s=null):s?s.p(l,c):(s=hd(l),s.c(),s.m(t,null)),(!r||c&8&&n!==(n=Qt(["svelte-flow__connection",Lu(l[3].isValid)])))&&g(t,"class",n),(!r||c&32)&&g(e,"width",l[5]),(!r||c&64)&&g(e,"height",l[6]),(!r||c&1)&&g(e,"style",l[0])},i(l){r||(T(a,l),r=!0)},o(l){D(a,l),r=!1},d(l){l&&p(e),a&&a.d(l),s&&s.d()}}}function hd(o){let e;return{c(){e=be("path"),this.h()},l(t){e=ye(t,"path",{d:!0,style:!0,fill:!0,class:!0}),I(e).forEach(p),this.h()},h(){g(e,"d",o[4]),g(e,"style",o[1]),g(e,"fill","none"),g(e,"class","svelte-flow__connection-path")},m(t,n){U(t,e,n)},p(t,n){n&16&&g(e,"d",t[4]),n&2&&g(e,"style",t[1])},d(t){t&&p(e)}}}function PC(o){let e,t,n=o[3].inProgress&&fd(o);return{c(){n&&n.c(),e=je()},l(r){n&&n.l(r),e=je()},m(r,i){n&&n.m(r,i),U(r,e,i),t=!0},p(r,[i]){r[3].inProgress?n?(n.p(r,i),i&8&&T(n,1)):(n=fd(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Le(),D(n,1,1,()=>{n=null}),Ue())},i(r){t||(T(n),t=!0)},o(r){D(n),t=!1},d(r){r&&p(e),n&&n.d(r)}}}function OC(o,e,t){let n,r,i,a,{$$slots:s={},$$scope:l}=e,{containerStyle:c=""}=e,{style:u=""}=e,{isCustomComponent:d=!1}=e;const{width:f,height:h,connection:_,connectionLineType:y}=ln();de(o,f,m=>t(5,i=m)),de(o,h,m=>t(6,a=m)),de(o,_,m=>t(3,r=m)),de(o,y,m=>t(11,n=m));let v=null;return o.$$set=m=>{"containerStyle"in m&&t(0,c=m.containerStyle),"style"in m&&t(1,u=m.style),"isCustomComponent"in m&&t(2,d=m.isCustomComponent),"$$scope"in m&&t(12,l=m.$$scope)},o.$$.update=()=>{if(o.$$.dirty&2060&&r.inProgress&&!d){const{from:m,to:b,fromPosition:w,toPosition:C}=r,O={sourceX:m.x,sourceY:m.y,sourcePosition:w,targetX:b.x,targetY:b.y,targetPosition:C};switch(n){case Fr.Bezier:t(4,[v]=cg(O),v);break;case Fr.Step:t(4,[v]=Cs({...O,borderRadius:0}),v);break;case Fr.SmoothStep:t(4,[v]=Cs(O),v);break;default:t(4,[v]=dg(O),v)}}},[c,u,d,r,v,i,a,f,h,_,y,n,l,s]}class NC extends Ve{constructor(e){super(),Fe(this,e,OC,PC,Qe,{containerStyle:0,style:1,isCustomComponent:2})}}function DC(o){let e,t,n;const r=o[8].default,i=gn(r,o,o[7],null);let a=[{class:t=Qt(["svelte-flow__panel",o[1],...o[2]])},{style:o[0]},o[5]],s={};for(let l=0;l<a.length;l+=1)s=Dt(s,a[l]);return{c(){e=M("div"),i&&i.c(),this.h()},l(l){e=P(l,"DIV",{class:!0,style:!0});var c=I(e);i&&i.l(c),c.forEach(p),this.h()},h(){Kr(e,s),lt(e,"pointer-events",o[3]?"none":"")},m(l,c){U(l,e,c),i&&i.m(e,null),n=!0},p(l,[c]){i&&i.p&&(!n||c&128)&&mn(i,r,l,l[7],n?_n(r,l[7],c,null):pn(l[7]),null),Kr(e,s=rr(a,[(!n||c&6&&t!==(t=Qt(["svelte-flow__panel",l[1],...l[2]])))&&{class:t},(!n||c&1)&&{style:l[0]},c&32&&l[5]])),lt(e,"pointer-events",l[3]?"none":"")},i(l){n||(T(i,l),n=!0)},o(l){D(i,l),n=!1},d(l){l&&p(e),i&&i.d(l)}}}function HC(o,e,t){let n;const r=["position","style","class"];let i=an(e,r),a,{$$slots:s={},$$scope:l}=e,{position:c="top-right"}=e,{style:u=void 0}=e,{class:d=void 0}=e;const{selectionRectMode:f}=ln();return de(o,f,h=>t(3,a=h)),o.$$set=h=>{e=Dt(Dt({},e),vo(h)),t(5,i=an(e,r)),"position"in h&&t(6,c=h.position),"style"in h&&t(0,u=h.style),"class"in h&&t(1,d=h.class),"$$scope"in h&&t(7,l=h.$$scope)},o.$$.update=()=>{o.$$.dirty&64&&t(2,n=`${c}`.split("-"))},[u,d,n,a,f,i,c,l,s]}class Dg extends Ve{constructor(e){super(),Fe(this,e,HC,DC,Qe,{position:6,style:0,class:1})}}function gd(o){let e,t;return e=new Dg({props:{position:o[1],class:"svelte-flow__attribution","data-message":"Feel free to remove the attribution or check out how you could support us: https://svelteflow.dev/support-us",$$slots:{default:[LC]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&2&&(i.position=n[1]),r&4&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function LC(o){let e,t="Svelte Flow";return{c(){e=M("a"),e.textContent=t,this.h()},l(n){e=P(n,"A",{href:!0,target:!0,rel:!0,"aria-label":!0,"data-svelte-h":!0}),wt(e)!=="svelte-2vm8e4"&&(e.textContent=t),this.h()},h(){g(e,"href","https://svelteflow.dev"),g(e,"target","_blank"),g(e,"rel","noopener noreferrer"),g(e,"aria-label","Svelte Flow attribution")},m(n,r){U(n,e,r)},p:Re,d(n){n&&p(e)}}}function UC(o){var r;let e,t,n=!((r=o[0])!=null&&r.hideAttribution)&&gd(o);return{c(){n&&n.c(),e=je()},l(i){n&&n.l(i),e=je()},m(i,a){n&&n.m(i,a),U(i,e,a),t=!0},p(i,[a]){var s;(s=i[0])!=null&&s.hideAttribution?n&&(Le(),D(n,1,1,()=>{n=null}),Ue()):n?(n.p(i,a),a&1&&T(n,1)):(n=gd(i),n.c(),T(n,1),n.m(e.parentNode,e))},i(i){t||(T(n),t=!0)},o(i){D(n),t=!1},d(i){i&&p(e),n&&n.d(i)}}}function BC(o,e,t){let{proOptions:n=void 0}=e,{position:r="bottom-right"}=e;return o.$$set=i=>{"proOptions"in i&&t(0,n=i.proOptions),"position"in i&&t(1,r=i.position)},[n,r]}class zC extends Ve{constructor(e){super(),Fe(this,e,BC,UC,Qe,{proOptions:0,position:1})}}function md(o,{nodeTypes:e,edgeTypes:t,minZoom:n,maxZoom:r,translateExtent:i,paneClickDistance:a}){e!==void 0&&o.setNodeTypes(e),t!==void 0&&o.setEdgeTypes(t),n!==void 0&&o.setMinZoom(n),r!==void 0&&o.setMaxZoom(r),i!==void 0&&o.setTranslateExtent(i),a!==void 0&&o.setPaneClickDistance(a)}const VC=o=>Object.keys(o);function FC(o,e){VC(e).forEach(t=>{const n=e[t];n!==void 0&&o[t].set(n)})}function KC(){return typeof window>"u"||!window.matchMedia?null:window.matchMedia("(prefers-color-scheme: dark)")}function GC(o="light"){return ho("light",t=>{if(o!=="system"){t(o);return}const n=KC(),r=()=>t(n!=null&&n.matches?"dark":"light");return t(n!=null&&n.matches?"dark":"light"),n==null||n.addEventListener("change",r),()=>{n==null||n.removeEventListener("change",r)}})}const WC=o=>({}),pd=o=>({slot:"connectionLine"});function YC(o){let e;const t=o[75].connectionLine,n=gn(t,o,o[99],pd);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i[3]&64)&&mn(n,t,r,r[99],e?_n(t,r[99],i,WC):pn(r[99]),pd)},i(r){e||(T(n,r),e=!0)},o(r){D(n,r),e=!1},d(r){n&&n.d(r)}}}function qC(o){let e,t,n,r,i,a,s,l,c,u,d,f;return e=new mC({props:{defaultEdgeOptions:o[21]}}),e.$on("edgeclick",o[78]),e.$on("edgecontextmenu",o[79]),e.$on("edgemouseenter",o[80]),e.$on("edgemouseleave",o[81]),n=new NC({props:{containerStyle:o[7],style:o[6],isCustomComponent:o[34].connectionLine,$$slots:{connectionLine:[YC]},$$scope:{ctx:o}}}),c=new $k({props:{nodeClickDistance:o[23]}}),c.$on("nodeclick",o[82]),c.$on("nodemouseenter",o[83]),c.$on("nodemousemove",o[84]),c.$on("nodemouseleave",o[85]),c.$on("nodedragstart",o[86]),c.$on("nodedrag",o[87]),c.$on("nodedragstop",o[88]),c.$on("nodecontextmenu",o[89]),d=new EC({}),d.$on("selectionclick",o[90]),d.$on("selectioncontextmenu",o[91]),d.$on("nodedragstart",o[92]),d.$on("nodedrag",o[93]),d.$on("nodedragstop",o[94]),{c(){te(e.$$.fragment),t=$(),te(n.$$.fragment),r=$(),i=M("div"),a=$(),s=M("div"),l=$(),te(c.$$.fragment),u=$(),te(d.$$.fragment),this.h()},l(h){re(e.$$.fragment,h),t=ee(h),re(n.$$.fragment,h),r=ee(h),i=P(h,"DIV",{class:!0}),I(i).forEach(p),a=ee(h),s=P(h,"DIV",{class:!0}),I(s).forEach(p),l=ee(h),re(c.$$.fragment,h),u=ee(h),re(d.$$.fragment,h),this.h()},h(){g(i,"class","svelte-flow__edgelabel-renderer"),g(s,"class","svelte-flow__viewport-portal")},m(h,_){ne(e,h,_),U(h,t,_),ne(n,h,_),U(h,r,_),U(h,i,_),U(h,a,_),U(h,s,_),U(h,l,_),ne(c,h,_),U(h,u,_),ne(d,h,_),f=!0},p(h,_){const y={};_[0]&2097152&&(y.defaultEdgeOptions=h[21]),e.$set(y);const v={};_[0]&128&&(v.containerStyle=h[7]),_[0]&64&&(v.style=h[6]),_[1]&8&&(v.isCustomComponent=h[34].connectionLine),_[3]&64&&(v.$$scope={dirty:_,ctx:h}),n.$set(v);const m={};_[0]&8388608&&(m.nodeClickDistance=h[23]),c.$set(m)},i(h){f||(T(e.$$.fragment,h),T(n.$$.fragment,h),T(c.$$.fragment,h),T(d.$$.fragment,h),f=!0)},o(h){D(e.$$.fragment,h),D(n.$$.fragment,h),D(c.$$.fragment,h),D(d.$$.fragment,h),f=!1},d(h){h&&(p(t),p(r),p(i),p(a),p(s),p(l),p(u)),oe(e,h),oe(n,h),oe(c,h),oe(d,h)}}}function jC(o){let e,t,n,r;return e=new Yk({props:{$$slots:{default:[qC]},$$scope:{ctx:o}}}),n=new vC({}),{c(){te(e.$$.fragment),t=$(),te(n.$$.fragment)},l(i){re(e.$$.fragment,i),t=ee(i),re(n.$$.fragment,i)},m(i,a){ne(e,i,a),U(i,t,a),ne(n,i,a),r=!0},p(i,a){const s={};a[0]&10485952|a[1]&8|a[3]&64&&(s.$$scope={dirty:a,ctx:i}),e.$set(s)},i(i){r||(T(e.$$.fragment,i),T(n.$$.fragment,i),r=!0)},o(i){D(e.$$.fragment,i),D(n.$$.fragment,i),r=!1},d(i){i&&p(t),oe(e,i),oe(n,i)}}}function QC(o){let e,t;return e=new Kk({props:{panOnDrag:o[17]===void 0?!0:o[17],selectionOnDrag:o[18],$$slots:{default:[jC]},$$scope:{ctx:o}}}),e.$on("paneclick",o[95]),e.$on("panecontextmenu",o[96]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&131072&&(i.panOnDrag=n[17]===void 0?!0:n[17]),r[0]&262144&&(i.selectionOnDrag=n[18]),r[0]&10485952|r[1]&8|r[3]&64&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function XC(o){let e,t,n,r,i,a,s,l,c,u,d,f;t=new RC({props:{selectionKey:o[1],deleteKey:o[5],panActivationKey:o[2],multiSelectionKey:o[3],zoomActivationKey:o[4]}}),r=new zk({props:{initialViewport:o[31],onMoveStart:o[8],onMove:o[9],onMoveEnd:o[10],panOnScrollMode:o[11]===void 0?Oo.Free:o[11],preventScrolling:o[12]===void 0?!0:o[12],zoomOnScroll:o[13]===void 0?!0:o[13],zoomOnDoubleClick:o[14]===void 0?!0:o[14],zoomOnPinch:o[15]===void 0?!0:o[15],panOnScroll:o[16]===void 0?!1:o[16],panOnDrag:o[17]===void 0?!0:o[17],paneClickDistance:o[22]===void 0?0:o[22],$$slots:{default:[QC]},$$scope:{ctx:o}}}),a=new zC({props:{proOptions:o[20],position:o[19]}});const h=o[75].default,_=gn(h,o,o[99],null);let y=[{style:o[24]},{class:l=Qt(["svelte-flow",o[25],o[30]])},{"data-testid":"svelte-flow__wrapper"},o[33],{role:"application"}],v={};for(let m=0;m<y.length;m+=1)v=Dt(v,y[m]);return{c(){e=M("div"),te(t.$$.fragment),n=$(),te(r.$$.fragment),i=$(),te(a.$$.fragment),s=$(),_&&_.c(),this.h()},l(m){e=P(m,"DIV",{style:!0,class:!0,"data-testid":!0,role:!0});var b=I(e);re(t.$$.fragment,b),n=ee(b),re(r.$$.fragment,b),i=ee(b),re(a.$$.fragment,b),s=ee(b),_&&_.l(b),b.forEach(p),this.h()},h(){Kr(e,v),pr(()=>o[98].call(e)),ft(e,"svelte-12wlba6",!0)},m(m,b){U(m,e,b),ne(t,e,null),k(e,n),ne(r,e,null),k(e,i),ne(a,e,null),k(e,s),_&&_.m(e,null),o[97](e),c=Kg(e,o[98].bind(e)),u=!0,d||(f=[Ie(e,"dragover",o[76]),Ie(e,"drop",o[77])],d=!0)},p(m,b){const w={};b[0]&2&&(w.selectionKey=m[1]),b[0]&32&&(w.deleteKey=m[5]),b[0]&4&&(w.panActivationKey=m[2]),b[0]&8&&(w.multiSelectionKey=m[3]),b[0]&16&&(w.zoomActivationKey=m[4]),t.$set(w);const C={};b[0]&256&&(C.onMoveStart=m[8]),b[0]&512&&(C.onMove=m[9]),b[0]&1024&&(C.onMoveEnd=m[10]),b[0]&2048&&(C.panOnScrollMode=m[11]===void 0?Oo.Free:m[11]),b[0]&4096&&(C.preventScrolling=m[12]===void 0?!0:m[12]),b[0]&8192&&(C.zoomOnScroll=m[13]===void 0?!0:m[13]),b[0]&16384&&(C.zoomOnDoubleClick=m[14]===void 0?!0:m[14]),b[0]&32768&&(C.zoomOnPinch=m[15]===void 0?!0:m[15]),b[0]&65536&&(C.panOnScroll=m[16]===void 0?!1:m[16]),b[0]&131072&&(C.panOnDrag=m[17]===void 0?!0:m[17]),b[0]&4194304&&(C.paneClickDistance=m[22]===void 0?0:m[22]),b[0]&10879168|b[1]&8|b[3]&64&&(C.$$scope={dirty:b,ctx:m}),r.$set(C);const O={};b[0]&1048576&&(O.proOptions=m[20]),b[0]&524288&&(O.position=m[19]),a.$set(O),_&&_.p&&(!u||b[3]&64)&&mn(_,h,m,m[99],u?_n(h,m[99],b,null):pn(m[99]),null),Kr(e,v=rr(y,[(!u||b[0]&16777216)&&{style:m[24]},(!u||b[0]&1107296256&&l!==(l=Qt(["svelte-flow",m[25],m[30]])))&&{class:l},{"data-testid":"svelte-flow__wrapper"},b[1]&4&&m[33],{role:"application"}])),ft(e,"svelte-12wlba6",!0)},i(m){u||(T(t.$$.fragment,m),T(r.$$.fragment,m),T(a.$$.fragment,m),T(_,m),u=!0)},o(m){D(t.$$.fragment,m),D(r.$$.fragment,m),D(a.$$.fragment,m),D(_,m),u=!1},d(m){m&&p(e),oe(t),oe(r),oe(a),_&&_.d(m),o[97](null),c(),d=!1,kn(f)}}}function JC(o,e,t){let n;const r=["id","nodes","edges","fitView","fitViewOptions","minZoom","maxZoom","initialViewport","viewport","nodeTypes","edgeTypes","selectionKey","selectionMode","panActivationKey","multiSelectionKey","zoomActivationKey","nodesDraggable","nodesConnectable","nodeDragThreshold","elementsSelectable","snapGrid","deleteKey","connectionRadius","connectionLineType","connectionMode","connectionLineStyle","connectionLineContainerStyle","onMoveStart","onMove","onMoveEnd","isValidConnection","translateExtent","nodeExtent","onlyRenderVisibleElements","panOnScrollMode","preventScrolling","zoomOnScroll","zoomOnDoubleClick","zoomOnPinch","panOnScroll","panOnDrag","selectionOnDrag","autoPanOnConnect","autoPanOnNodeDrag","onerror","ondelete","onedgecreate","attributionPosition","proOptions","defaultEdgeOptions","width","height","colorMode","onconnect","onconnectstart","onconnectend","onbeforedelete","oninit","nodeOrigin","paneClickDistance","nodeClickDistance","defaultMarkerColor","style","class"];let i=an(e,r),a,s,l=Re,c=()=>(l(),l=ql(H,Z=>t(100,s=Z)),H),u,d=Re,f=()=>(d(),d=ql(n,Z=>t(30,u=Z)),n);o.$$.on_destroy.push(()=>l()),o.$$.on_destroy.push(()=>d());let{$$slots:h={},$$scope:_}=e;const y=Gg(h);let{id:v="1"}=e,{nodes:m}=e,{edges:b}=e,{fitView:w=void 0}=e,{fitViewOptions:C=void 0}=e,{minZoom:O=void 0}=e,{maxZoom:S=void 0}=e,{initialViewport:E=void 0}=e,{viewport:H=void 0}=e;c();let{nodeTypes:R=void 0}=e,{edgeTypes:L=void 0}=e,{selectionKey:F=void 0}=e,{selectionMode:q=void 0}=e,{panActivationKey:W=void 0}=e,{multiSelectionKey:A=void 0}=e,{zoomActivationKey:V=void 0}=e,{nodesDraggable:N=void 0}=e,{nodesConnectable:G=void 0}=e,{nodeDragThreshold:X=void 0}=e,{elementsSelectable:Q=void 0}=e,{snapGrid:j=void 0}=e,{deleteKey:ue=void 0}=e,{connectionRadius:B=void 0}=e,{connectionLineType:x=void 0}=e,{connectionMode:J=Ir.Strict}=e,{connectionLineStyle:ce=""}=e,{connectionLineContainerStyle:me=""}=e,{onMoveStart:se=void 0}=e,{onMove:Be=void 0}=e,{onMoveEnd:He=void 0}=e,{isValidConnection:Y=void 0}=e,{translateExtent:Xe=void 0}=e,{nodeExtent:Ke=void 0}=e,{onlyRenderVisibleElements:mt=void 0}=e,{panOnScrollMode:fe=Oo.Free}=e,{preventScrolling:xe=!0}=e,{zoomOnScroll:gt=!0}=e,{zoomOnDoubleClick:Et=!0}=e,{zoomOnPinch:Bt=!0}=e,{panOnScroll:Xt=!1}=e,{panOnDrag:Ot=!0}=e,{selectionOnDrag:rn=void 0}=e,{autoPanOnConnect:Wt=!0}=e,{autoPanOnNodeDrag:Nt=!0}=e,{onerror:tn=void 0}=e,{ondelete:ie=void 0}=e,{onedgecreate:Ge=void 0}=e,{attributionPosition:nt=void 0}=e,{proOptions:vt=void 0}=e,{defaultEdgeOptions:Me=void 0}=e,{width:Yt=void 0}=e,{height:Tt=void 0}=e,{colorMode:he="light"}=e,{onconnect:qe=void 0}=e,{onconnectstart:Oe=void 0}=e,{onconnectend:$e=void 0}=e,{onbeforedelete:It=void 0}=e,{oninit:kt=void 0}=e,{nodeOrigin:Rt=void 0}=e,{paneClickDistance:pt=0}=e,{nodeClickDistance:dn=0}=e,{defaultMarkerColor:sn="#b1b1b7"}=e,{style:Jt=void 0}=e,{class:qt=void 0}=e,fn,bn,Cn;const xt=s||E,Ht=Wg(Zs)?ln():Hk({nodes:pe(m),edges:pe(b),width:Yt,height:Tt,fitView:w,nodeOrigin:Rt,nodeExtent:Ke});Jn(()=>(Ht.width.set(bn),Ht.height.set(Cn),Ht.domNode.set(fn),Ht.syncNodeStores(m),Ht.syncEdgeStores(b),Ht.syncViewport(H),w!==void 0&&Ht.fitViewOnInit.set(w),C&&Ht.fitViewOptions.set(C),md(Ht,{nodeTypes:R,edgeTypes:L,minZoom:O,maxZoom:S,translateExtent:Xe,paneClickDistance:pt}),()=>{Ht.reset()}));const{initialized:xn}=Ht;de(o,xn,Z=>t(74,a=Z));let Bn=!1;function Zn(Z){St.call(this,o,Z)}function ao(Z){St.call(this,o,Z)}function wo(Z){St.call(this,o,Z)}function Do(Z){St.call(this,o,Z)}function $n(Z){St.call(this,o,Z)}function eo(Z){St.call(this,o,Z)}function yn(Z){St.call(this,o,Z)}function K(Z){St.call(this,o,Z)}function Pe(Z){St.call(this,o,Z)}function Ze(Z){St.call(this,o,Z)}function ut(Z){St.call(this,o,Z)}function We(Z){St.call(this,o,Z)}function it(Z){St.call(this,o,Z)}function On(Z){St.call(this,o,Z)}function zn(Z){St.call(this,o,Z)}function Ct(Z){St.call(this,o,Z)}function cn(Z){St.call(this,o,Z)}function to(Z){St.call(this,o,Z)}function lo(Z){St.call(this,o,Z)}function ko(Z){St.call(this,o,Z)}function co(Z){St.call(this,o,Z)}function Sr(Z){Ye[Z?"unshift":"push"](()=>{fn=Z,t(28,fn)})}function ar(){bn=this.clientWidth,Cn=this.clientHeight,t(26,bn),t(27,Cn)}return o.$$set=Z=>{e=Dt(Dt({},e),vo(Z)),t(33,i=an(e,r)),"id"in Z&&t(35,v=Z.id),"nodes"in Z&&t(36,m=Z.nodes),"edges"in Z&&t(37,b=Z.edges),"fitView"in Z&&t(38,w=Z.fitView),"fitViewOptions"in Z&&t(39,C=Z.fitViewOptions),"minZoom"in Z&&t(40,O=Z.minZoom),"maxZoom"in Z&&t(41,S=Z.maxZoom),"initialViewport"in Z&&t(42,E=Z.initialViewport),"viewport"in Z&&c(t(0,H=Z.viewport)),"nodeTypes"in Z&&t(43,R=Z.nodeTypes),"edgeTypes"in Z&&t(44,L=Z.edgeTypes),"selectionKey"in Z&&t(1,F=Z.selectionKey),"selectionMode"in Z&&t(45,q=Z.selectionMode),"panActivationKey"in Z&&t(2,W=Z.panActivationKey),"multiSelectionKey"in Z&&t(3,A=Z.multiSelectionKey),"zoomActivationKey"in Z&&t(4,V=Z.zoomActivationKey),"nodesDraggable"in Z&&t(46,N=Z.nodesDraggable),"nodesConnectable"in Z&&t(47,G=Z.nodesConnectable),"nodeDragThreshold"in Z&&t(48,X=Z.nodeDragThreshold),"elementsSelectable"in Z&&t(49,Q=Z.elementsSelectable),"snapGrid"in Z&&t(50,j=Z.snapGrid),"deleteKey"in Z&&t(5,ue=Z.deleteKey),"connectionRadius"in Z&&t(51,B=Z.connectionRadius),"connectionLineType"in Z&&t(52,x=Z.connectionLineType),"connectionMode"in Z&&t(53,J=Z.connectionMode),"connectionLineStyle"in Z&&t(6,ce=Z.connectionLineStyle),"connectionLineContainerStyle"in Z&&t(7,me=Z.connectionLineContainerStyle),"onMoveStart"in Z&&t(8,se=Z.onMoveStart),"onMove"in Z&&t(9,Be=Z.onMove),"onMoveEnd"in Z&&t(10,He=Z.onMoveEnd),"isValidConnection"in Z&&t(54,Y=Z.isValidConnection),"translateExtent"in Z&&t(55,Xe=Z.translateExtent),"nodeExtent"in Z&&t(56,Ke=Z.nodeExtent),"onlyRenderVisibleElements"in Z&&t(57,mt=Z.onlyRenderVisibleElements),"panOnScrollMode"in Z&&t(11,fe=Z.panOnScrollMode),"preventScrolling"in Z&&t(12,xe=Z.preventScrolling),"zoomOnScroll"in Z&&t(13,gt=Z.zoomOnScroll),"zoomOnDoubleClick"in Z&&t(14,Et=Z.zoomOnDoubleClick),"zoomOnPinch"in Z&&t(15,Bt=Z.zoomOnPinch),"panOnScroll"in Z&&t(16,Xt=Z.panOnScroll),"panOnDrag"in Z&&t(17,Ot=Z.panOnDrag),"selectionOnDrag"in Z&&t(18,rn=Z.selectionOnDrag),"autoPanOnConnect"in Z&&t(58,Wt=Z.autoPanOnConnect),"autoPanOnNodeDrag"in Z&&t(59,Nt=Z.autoPanOnNodeDrag),"onerror"in Z&&t(60,tn=Z.onerror),"ondelete"in Z&&t(61,ie=Z.ondelete),"onedgecreate"in Z&&t(62,Ge=Z.onedgecreate),"attributionPosition"in Z&&t(19,nt=Z.attributionPosition),"proOptions"in Z&&t(20,vt=Z.proOptions),"defaultEdgeOptions"in Z&&t(21,Me=Z.defaultEdgeOptions),"width"in Z&&t(63,Yt=Z.width),"height"in Z&&t(64,Tt=Z.height),"colorMode"in Z&&t(65,he=Z.colorMode),"onconnect"in Z&&t(66,qe=Z.onconnect),"onconnectstart"in Z&&t(67,Oe=Z.onconnectstart),"onconnectend"in Z&&t(68,$e=Z.onconnectend),"onbeforedelete"in Z&&t(69,It=Z.onbeforedelete),"oninit"in Z&&t(70,kt=Z.oninit),"nodeOrigin"in Z&&t(71,Rt=Z.nodeOrigin),"paneClickDistance"in Z&&t(22,pt=Z.paneClickDistance),"nodeClickDistance"in Z&&t(23,dn=Z.nodeClickDistance),"defaultMarkerColor"in Z&&t(72,sn=Z.defaultMarkerColor),"style"in Z&&t(24,Jt=Z.style),"class"in Z&&t(25,qt=Z.class),"$$scope"in Z&&t(99,_=Z.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&201326592&&bn!==void 0&&Cn!==void 0&&(Ht.width.set(bn),Ht.height.set(Cn)),o.$$.dirty[2]&6400&&!Bn&&a&&(kt==null||kt(),t(73,Bn=!0)),o.$$.dirty[1]&2097135632|o.$$.dirty[2]&1777&&FC(Ht,{flowId:v,connectionLineType:x,connectionRadius:B,selectionMode:q,snapGrid:j,defaultMarkerColor:sn,nodesDraggable:N,nodesConnectable:G,elementsSelectable:Q,onlyRenderVisibleElements:mt,isValidConnection:Y,autoPanOnConnect:Wt,autoPanOnNodeDrag:Nt,onerror:tn,ondelete:ie,onedgecreate:Ge,connectionMode:J,nodeDragThreshold:X,onconnect:qe,onconnectstart:Oe,onconnectend:$e,onbeforedelete:It,nodeOrigin:Rt}),o.$$.dirty[0]&4194304|o.$$.dirty[1]&16791040&&md(Ht,{nodeTypes:R,edgeTypes:L,minZoom:O,maxZoom:S,translateExtent:Xe,paneClickDistance:pt}),o.$$.dirty[2]&8&&f(t(29,n=GC(he)))},[H,F,W,A,V,ue,ce,me,se,Be,He,fe,xe,gt,Et,Bt,Xt,Ot,rn,nt,vt,Me,pt,dn,Jt,qt,bn,Cn,fn,n,u,xt,xn,i,y,v,m,b,w,C,O,S,E,R,L,q,N,G,X,Q,j,B,x,J,Y,Xe,Ke,mt,Wt,Nt,tn,ie,Ge,Yt,Tt,he,qe,Oe,$e,It,kt,Rt,sn,Bn,a,h,Zn,ao,wo,Do,$n,eo,yn,K,Pe,Ze,ut,We,it,On,zn,Ct,cn,to,lo,ko,co,Sr,ar,_]}class xC extends Ve{constructor(e){super(),Fe(this,e,JC,XC,Qe,{id:35,nodes:36,edges:37,fitView:38,fitViewOptions:39,minZoom:40,maxZoom:41,initialViewport:42,viewport:0,nodeTypes:43,edgeTypes:44,selectionKey:1,selectionMode:45,panActivationKey:2,multiSelectionKey:3,zoomActivationKey:4,nodesDraggable:46,nodesConnectable:47,nodeDragThreshold:48,elementsSelectable:49,snapGrid:50,deleteKey:5,connectionRadius:51,connectionLineType:52,connectionMode:53,connectionLineStyle:6,connectionLineContainerStyle:7,onMoveStart:8,onMove:9,onMoveEnd:10,isValidConnection:54,translateExtent:55,nodeExtent:56,onlyRenderVisibleElements:57,panOnScrollMode:11,preventScrolling:12,zoomOnScroll:13,zoomOnDoubleClick:14,zoomOnPinch:15,panOnScroll:16,panOnDrag:17,selectionOnDrag:18,autoPanOnConnect:58,autoPanOnNodeDrag:59,onerror:60,ondelete:61,onedgecreate:62,attributionPosition:19,proOptions:20,defaultEdgeOptions:21,width:63,height:64,colorMode:65,onconnect:66,onconnectstart:67,onconnectend:68,onbeforedelete:69,oninit:70,nodeOrigin:71,paneClickDistance:22,nodeClickDistance:23,defaultMarkerColor:72,style:24,class:25},null,[-1,-1,-1,-1])}}function ZC(o){let e;const t=o[7].default,n=gn(t,o,o[6],null);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,[i]){n&&n.p&&(!e||i&64)&&mn(n,t,r,r[6],e?_n(t,r[6],i,null):pn(r[6]),null)},i(r){e||(T(n,r),e=!0)},o(r){D(n,r),e=!1},d(r){n&&n.d(r)}}}function $C(o,e,t){let{$$slots:n={},$$scope:r}=e,{initialNodes:i=void 0}=e,{initialEdges:a=void 0}=e,{initialWidth:s=void 0}=e,{initialHeight:l=void 0}=e,{fitView:c=void 0}=e,{nodeOrigin:u=void 0}=e;const d=Mg({nodes:i,edges:a,width:s,height:l,nodeOrigin:u,fitView:c});return fi(Zs,{getStore:()=>d}),Qo(()=>{d.reset()}),o.$$set=f=>{"initialNodes"in f&&t(0,i=f.initialNodes),"initialEdges"in f&&t(1,a=f.initialEdges),"initialWidth"in f&&t(2,s=f.initialWidth),"initialHeight"in f&&t(3,l=f.initialHeight),"fitView"in f&&t(4,c=f.fitView),"nodeOrigin"in f&&t(5,u=f.nodeOrigin),"$$scope"in f&&t(6,r=f.$$scope)},[i,a,s,l,c,u,r,n]}class eE extends Ve{constructor(e){super(),Fe(this,e,$C,ZC,Qe,{initialNodes:0,initialEdges:1,initialWidth:2,initialHeight:3,fitView:4,nodeOrigin:5})}}const tE=o=>({}),_d=o=>({class:"button-svg"});function nE(o){let e,t,n,r,i;const a=o[8].default,s=gn(a,o,o[7],_d);let l=[{type:"button"},{class:t=Qt(["svelte-flow__controls-button",o[0]])},o[6]],c={};for(let u=0;u<l.length;u+=1)c=Dt(c,l[u]);return{c(){e=M("button"),s&&s.c(),this.h()},l(u){e=P(u,"BUTTON",{type:!0,class:!0});var d=I(e);s&&s.l(d),d.forEach(p),this.h()},h(){Kr(e,c),lt(e,"--xy-controls-button-background-color-props",o[1]),lt(e,"--xy-controls-button-background-color-hover-props",o[2]),lt(e,"--xy-controls-button-color-props",o[3]),lt(e,"--xy-controls-button-color-hover-props",o[4]),lt(e,"--xy-controls-button-border-color-props",o[5])},m(u,d){U(u,e,d),s&&s.m(e,null),e.autofocus&&e.focus(),n=!0,r||(i=Ie(e,"click",o[9]),r=!0)},p(u,[d]){s&&s.p&&(!n||d&128)&&mn(s,a,u,u[7],n?_n(a,u[7],d,tE):pn(u[7]),_d),Kr(e,c=rr(l,[{type:"button"},(!n||d&1&&t!==(t=Qt(["svelte-flow__controls-button",u[0]])))&&{class:t},d&64&&u[6]])),lt(e,"--xy-controls-button-background-color-props",u[1]),lt(e,"--xy-controls-button-background-color-hover-props",u[2]),lt(e,"--xy-controls-button-color-props",u[3]),lt(e,"--xy-controls-button-color-hover-props",u[4]),lt(e,"--xy-controls-button-border-color-props",u[5])},i(u){n||(T(s,u),n=!0)},o(u){D(s,u),n=!1},d(u){u&&p(e),s&&s.d(u),r=!1,i()}}}function oE(o,e,t){const n=["class"];let r=an(e,n),{$$slots:i={},$$scope:a}=e,{class:s=void 0}=e,l,c,u,d,f;function h(_){St.call(this,o,_)}return o.$$set=_=>{e=Dt(Dt({},e),vo(_)),t(6,r=an(e,n)),"class"in _&&t(0,s=_.class),"$$scope"in _&&t(7,a=_.$$scope)},[s,l,c,u,d,f,r,a,i,h]}class Es extends Ve{constructor(e){super(),Fe(this,e,oE,nE,Qe,{class:0})}}function rE(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{xmlns:!0,viewBox:!0});var r=I(e);t=ye(r,"path",{d:!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"d","M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 32 32")},m(n,r){U(n,e,r),k(e,t)},p:Re,i:Re,o:Re,d(n){n&&p(e)}}}class iE extends Ve{constructor(e){super(),Fe(this,e,null,rE,Qe,{})}}function sE(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{xmlns:!0,viewBox:!0});var r=I(e);t=ye(r,"path",{d:!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"d","M0 0h32v4.2H0z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 32 5")},m(n,r){U(n,e,r),k(e,t)},p:Re,i:Re,o:Re,d(n){n&&p(e)}}}class aE extends Ve{constructor(e){super(),Fe(this,e,null,sE,Qe,{})}}function lE(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{xmlns:!0,viewBox:!0});var r=I(e);t=ye(r,"path",{d:!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"d","M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 32 30")},m(n,r){U(n,e,r),k(e,t)},p:Re,i:Re,o:Re,d(n){n&&p(e)}}}class cE extends Ve{constructor(e){super(),Fe(this,e,null,lE,Qe,{})}}function uE(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{xmlns:!0,viewBox:!0});var r=I(e);t=ye(r,"path",{d:!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"d","M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 25 32")},m(n,r){U(n,e,r),k(e,t)},p:Re,i:Re,o:Re,d(n){n&&p(e)}}}class dE extends Ve{constructor(e){super(),Fe(this,e,null,uE,Qe,{})}}function fE(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{xmlns:!0,viewBox:!0});var r=I(e);t=ye(r,"path",{d:!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"d","M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"viewBox","0 0 25 32")},m(n,r){U(n,e,r),k(e,t)},p:Re,i:Re,o:Re,d(n){n&&p(e)}}}class hE extends Ve{constructor(e){super(),Fe(this,e,null,fE,Qe,{})}}const gE=o=>({}),bd=o=>({}),mE=o=>({}),yd=o=>({});function vd(o){let e,t,n,r;const i=[{class:"svelte-flow__controls-zoomin"},{title:"zoom in"},{"aria-label":"zoom in"},{disabled:o[9]},o[17]];let a={$$slots:{default:[pE]},$$scope:{ctx:o}};for(let c=0;c<i.length;c+=1)a=Dt(a,i[c]);e=new Es({props:a}),e.$on("click",o[18]);const s=[{class:"svelte-flow__controls-zoomout"},{title:"zoom out"},{"aria-label":"zoom out"},{disabled:o[10]},o[17]];let l={$$slots:{default:[_E]},$$scope:{ctx:o}};for(let c=0;c<s.length;c+=1)l=Dt(l,s[c]);return n=new Es({props:l}),n.$on("click",o[19]),{c(){te(e.$$.fragment),t=$(),te(n.$$.fragment)},l(c){re(e.$$.fragment,c),t=ee(c),re(n.$$.fragment,c)},m(c,u){ne(e,c,u),U(c,t,u),ne(n,c,u),r=!0},p(c,u){const d=u[0]&131584?rr(i,[i[0],i[1],i[2],u[0]&512&&{disabled:c[9]},u[0]&131072&&gi(c[17])]):{};u[1]&32&&(d.$$scope={dirty:u,ctx:c}),e.$set(d);const f=u[0]&132096?rr(s,[s[0],s[1],s[2],u[0]&1024&&{disabled:c[10]},u[0]&131072&&gi(c[17])]):{};u[1]&32&&(f.$$scope={dirty:u,ctx:c}),n.$set(f)},i(c){r||(T(e.$$.fragment,c),T(n.$$.fragment,c),r=!0)},o(c){D(e.$$.fragment,c),D(n.$$.fragment,c),r=!1},d(c){c&&p(t),oe(e,c),oe(n,c)}}}function pE(o){let e,t;return e=new iE({}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function _E(o){let e,t;return e=new aE({}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function wd(o){let e,t;const n=[{class:"svelte-flow__controls-fitview"},{title:"fit view"},{"aria-label":"fit view"},o[17]];let r={$$slots:{default:[bE]},$$scope:{ctx:o}};for(let i=0;i<n.length;i+=1)r=Dt(r,n[i]);return e=new Es({props:r}),e.$on("click",o[20]),{c(){te(e.$$.fragment)},l(i){re(e.$$.fragment,i)},m(i,a){ne(e,i,a),t=!0},p(i,a){const s=a[0]&131072?rr(n,[n[0],n[1],n[2],gi(i[17])]):{};a[1]&32&&(s.$$scope={dirty:a,ctx:i}),e.$set(s)},i(i){t||(T(e.$$.fragment,i),t=!0)},o(i){D(e.$$.fragment,i),t=!1},d(i){oe(e,i)}}}function bE(o){let e,t;return e=new cE({}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function kd(o){let e,t;const n=[{class:"svelte-flow__controls-interactive"},{title:"toggle interactivity"},{"aria-label":"toggle interactivity"},o[17]];let r={$$slots:{default:[wE]},$$scope:{ctx:o}};for(let i=0;i<n.length;i+=1)r=Dt(r,n[i]);return e=new Es({props:r}),e.$on("click",o[21]),{c(){te(e.$$.fragment)},l(i){re(e.$$.fragment,i)},m(i,a){ne(e,i,a),t=!0},p(i,a){const s=a[0]&131072?rr(n,[n[0],n[1],n[2],gi(i[17])]):{};a[0]&256|a[1]&32&&(s.$$scope={dirty:a,ctx:i}),e.$set(s)},i(i){t||(T(e.$$.fragment,i),t=!0)},o(i){D(e.$$.fragment,i),t=!1},d(i){oe(e,i)}}}function yE(o){let e,t;return e=new dE({}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function vE(o){let e,t;return e=new hE({}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function wE(o){let e,t,n,r;const i=[vE,yE],a=[];function s(l,c){return l[8]?0:1}return e=s(o),t=a[e]=i[e](o),{c(){t.c(),n=je()},l(l){t.l(l),n=je()},m(l,c){a[e].m(l,c),U(l,n,c),r=!0},p(l,c){let u=e;e=s(l),e!==u&&(Le(),D(a[u],1,1,()=>{a[u]=null}),Ue(),t=a[e],t||(t=a[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){D(t),r=!1},d(l){l&&p(n),a[e].d(l)}}}function kE(o){let e,t,n,r,i,a;const s=o[35].before,l=gn(s,o,o[36],yd);let c=o[1]&&vd(o),u=o[2]&&wd(o),d=o[3]&&kd(o);const f=o[35].default,h=gn(f,o,o[36],null),_=o[35].after,y=gn(_,o,o[36],bd);return{c(){l&&l.c(),e=$(),c&&c.c(),t=$(),u&&u.c(),n=$(),d&&d.c(),r=$(),h&&h.c(),i=$(),y&&y.c()},l(v){l&&l.l(v),e=ee(v),c&&c.l(v),t=ee(v),u&&u.l(v),n=ee(v),d&&d.l(v),r=ee(v),h&&h.l(v),i=ee(v),y&&y.l(v)},m(v,m){l&&l.m(v,m),U(v,e,m),c&&c.m(v,m),U(v,t,m),u&&u.m(v,m),U(v,n,m),d&&d.m(v,m),U(v,r,m),h&&h.m(v,m),U(v,i,m),y&&y.m(v,m),a=!0},p(v,m){l&&l.p&&(!a||m[1]&32)&&mn(l,s,v,v[36],a?_n(s,v[36],m,mE):pn(v[36]),yd),v[1]?c?(c.p(v,m),m[0]&2&&T(c,1)):(c=vd(v),c.c(),T(c,1),c.m(t.parentNode,t)):c&&(Le(),D(c,1,1,()=>{c=null}),Ue()),v[2]?u?(u.p(v,m),m[0]&4&&T(u,1)):(u=wd(v),u.c(),T(u,1),u.m(n.parentNode,n)):u&&(Le(),D(u,1,1,()=>{u=null}),Ue()),v[3]?d?(d.p(v,m),m[0]&8&&T(d,1)):(d=kd(v),d.c(),T(d,1),d.m(r.parentNode,r)):d&&(Le(),D(d,1,1,()=>{d=null}),Ue()),h&&h.p&&(!a||m[1]&32)&&mn(h,f,v,v[36],a?_n(f,v[36],m,null):pn(v[36]),null),y&&y.p&&(!a||m[1]&32)&&mn(y,_,v,v[36],a?_n(_,v[36],m,gE):pn(v[36]),bd)},i(v){a||(T(l,v),T(c),T(u),T(d),T(h,v),T(y,v),a=!0)},o(v){D(l,v),D(c),D(u),D(d),D(h,v),D(y,v),a=!1},d(v){v&&(p(e),p(t),p(n),p(r),p(i)),l&&l.d(v),c&&c.d(v),u&&u.d(v),d&&d.d(v),h&&h.d(v),y&&y.d(v)}}}function CE(o){let e,t;return e=new Dg({props:{class:Qt(["svelte-flow__controls",o[7],o[6]]),position:o[0],"data-testid":"svelte-flow__controls","aria-label":o[4]??"Svelte Flow controls",style:o[5],$$slots:{default:[kE]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&192&&(i.class=Qt(["svelte-flow__controls",n[7],n[6]])),r[0]&1&&(i.position=n[0]),r[0]&16&&(i["aria-label"]=n[4]??"Svelte Flow controls"),r[0]&32&&(i.style=n[5]),r[0]&1806|r[1]&32&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function EE(o,e,t){let n,r,i,a,s,l,c,u,d,f,{$$slots:h={},$$scope:_}=e,{position:y="bottom-left"}=e,{showZoom:v=!0}=e,{showFitView:m=!0}=e,{showLock:b=!0}=e,{buttonBgColor:w=void 0}=e,{buttonBgColorHover:C=void 0}=e,{buttonColor:O=void 0}=e,{buttonColorHover:S=void 0}=e,{buttonBorderColor:E=void 0}=e,{ariaLabel:H=void 0}=e,{style:R=void 0}=e,{orientation:L="vertical"}=e,{fitViewOptions:F=void 0}=e,{class:q=""}=e;const{zoomIn:W,zoomOut:A,fitView:V,viewport:N,minZoom:G,maxZoom:X,nodesDraggable:Q,nodesConnectable:j,elementsSelectable:ue}=ln();de(o,N,se=>t(30,l=se)),de(o,G,se=>t(31,c=se)),de(o,X,se=>t(29,s=se)),de(o,Q,se=>t(34,f=se)),de(o,j,se=>t(33,d=se)),de(o,ue,se=>t(32,u=se));const B={bgColor:w,bgColorHover:C,color:O,colorHover:S,borderColor:E},x=()=>{W()},J=()=>{A()},ce=()=>{V(F)},me=()=>{t(8,n=!n),Q.set(n),j.set(n),ue.set(n)};return o.$$set=se=>{"position"in se&&t(0,y=se.position),"showZoom"in se&&t(1,v=se.showZoom),"showFitView"in se&&t(2,m=se.showFitView),"showLock"in se&&t(3,b=se.showLock),"buttonBgColor"in se&&t(22,w=se.buttonBgColor),"buttonBgColorHover"in se&&t(23,C=se.buttonBgColorHover),"buttonColor"in se&&t(24,O=se.buttonColor),"buttonColorHover"in se&&t(25,S=se.buttonColorHover),"buttonBorderColor"in se&&t(26,E=se.buttonBorderColor),"ariaLabel"in se&&t(4,H=se.ariaLabel),"style"in se&&t(5,R=se.style),"orientation"in se&&t(27,L=se.orientation),"fitViewOptions"in se&&t(28,F=se.fitViewOptions),"class"in se&&t(6,q=se.class),"$$scope"in se&&t(36,_=se.$$scope)},o.$$.update=()=>{o.$$.dirty[1]&14&&t(8,n=f||d||u),o.$$.dirty[0]&1073741824|o.$$.dirty[1]&1&&t(10,r=l.zoom<=c),o.$$.dirty[0]&1610612736&&t(9,i=l.zoom>=s),o.$$.dirty[0]&134217728&&t(7,a=L==="horizontal"?"horizontal":"vertical")},[y,v,m,b,H,R,q,a,n,i,r,N,G,X,Q,j,ue,B,x,J,ce,me,w,C,O,S,E,L,F,s,l,c,u,d,f,h,_]}let IE=class extends Ve{constructor(e){super(),Fe(this,e,EE,CE,Qe,{position:0,showZoom:1,showFitView:2,showLock:3,buttonBgColor:22,buttonBgColorHover:23,buttonColor:24,buttonColorHover:25,buttonBorderColor:26,ariaLabel:4,style:5,orientation:27,fitViewOptions:28,class:6},null,[-1,-1])}};var Yo;(function(o){o.Lines="lines",o.Dots="dots",o.Cross="cross"})(Yo||(Yo={}));function TE(o){let e,t;return{c(){e=be("circle"),this.h()},l(n){e=ye(n,"circle",{cx:!0,cy:!0,r:!0,class:!0}),I(e).forEach(p),this.h()},h(){g(e,"cx",o[0]),g(e,"cy",o[0]),g(e,"r",o[0]),g(e,"class",t=Qt(["svelte-flow__background-pattern","dots",o[1]]))},m(n,r){U(n,e,r)},p(n,[r]){r&1&&g(e,"cx",n[0]),r&1&&g(e,"cy",n[0]),r&1&&g(e,"r",n[0]),r&2&&t!==(t=Qt(["svelte-flow__background-pattern","dots",n[1]]))&&g(e,"class",t)},i:Re,o:Re,d(n){n&&p(e)}}}function SE(o,e,t){let{radius:n=5}=e,{class:r=""}=e;return o.$$set=i=>{"radius"in i&&t(0,n=i.radius),"class"in i&&t(1,r=i.class)},[n,r]}class AE extends Ve{constructor(e){super(),Fe(this,e,SE,TE,Qe,{radius:0,class:1})}}function RE(o){let e,t,n;return{c(){e=be("path"),this.h()},l(r){e=ye(r,"path",{"stroke-width":!0,d:!0,class:!0}),I(e).forEach(p),this.h()},h(){g(e,"stroke-width",o[0]),g(e,"d",t=`M${o[1][0]/2} 0 V${o[1][1]} M0 ${o[1][1]/2} H${o[1][0]}`),g(e,"class",n=Qt(["svelte-flow__background-pattern",o[2],o[3]]))},m(r,i){U(r,e,i)},p(r,[i]){i&1&&g(e,"stroke-width",r[0]),i&2&&t!==(t=`M${r[1][0]/2} 0 V${r[1][1]} M0 ${r[1][1]/2} H${r[1][0]}`)&&g(e,"d",t),i&12&&n!==(n=Qt(["svelte-flow__background-pattern",r[2],r[3]]))&&g(e,"class",n)},i:Re,o:Re,d(r){r&&p(e)}}}function ME(o,e,t){let{lineWidth:n=1}=e,{dimensions:r}=e,{variant:i=void 0}=e,{class:a=""}=e;return o.$$set=s=>{"lineWidth"in s&&t(0,n=s.lineWidth),"dimensions"in s&&t(1,r=s.dimensions),"variant"in s&&t(2,i=s.variant),"class"in s&&t(3,a=s.class)},[n,r,i,a]}class PE extends Ve{constructor(e){super(),Fe(this,e,ME,RE,Qe,{lineWidth:0,dimensions:1,variant:2,class:3})}}function OE(o){let e,t;return e=new PE({props:{dimensions:o[6],variant:o[0],lineWidth:o[1],class:o[4]}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&64&&(i.dimensions=n[6]),r&1&&(i.variant=n[0]),r&2&&(i.lineWidth=n[1]),r&16&&(i.class=n[4]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function NE(o){let e,t;return e=new AE({props:{radius:o[7]/2,class:o[4]}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&128&&(i.radius=n[7]/2),r&16&&(i.class=n[4]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function DE(o){let e,t,n,r,i,a,s,l,c,u,d,f,h;const _=[NE,OE],y=[];function v(m,b){return m[14]?0:1}return n=v(o),r=y[n]=_[n](o),{c(){e=be("svg"),t=be("pattern"),r.c(),u=be("rect"),this.h()},l(m){e=ye(m,"svg",{class:!0,"data-testid":!0});var b=I(e);t=ye(b,"pattern",{id:!0,x:!0,y:!0,width:!0,height:!0,patternUnits:!0,patternTransform:!0});var w=I(t);r.l(w),w.forEach(p),u=ye(b,"rect",{x:!0,y:!0,width:!0,height:!0,fill:!0}),I(u).forEach(p),b.forEach(p),this.h()},h(){g(t,"id",o[11]),g(t,"x",i=o[9].x%o[8][0]),g(t,"y",a=o[9].y%o[8][1]),g(t,"width",s=o[8][0]),g(t,"height",l=o[8][1]),g(t,"patternUnits","userSpaceOnUse"),g(t,"patternTransform",c=`translate(-${o[10][0]},-${o[10][1]})`),g(u,"x","0"),g(u,"y","0"),g(u,"width","100%"),g(u,"height","100%"),g(u,"fill",d=`url(#${o[11]})`),g(e,"class",f=jl(Qt(["svelte-flow__background",o[5]]))+" svelte-1r7pe8d"),g(e,"data-testid","svelte-flow__background"),lt(e,"--xy-background-color-props",o[2]),lt(e,"--xy-background-pattern-color-props",o[3])},m(m,b){U(m,e,b),k(e,t),y[n].m(t,null),k(e,u),h=!0},p(m,[b]){r.p(m,b),(!h||b&2048)&&g(t,"id",m[11]),(!h||b&768&&i!==(i=m[9].x%m[8][0]))&&g(t,"x",i),(!h||b&768&&a!==(a=m[9].y%m[8][1]))&&g(t,"y",a),(!h||b&256&&s!==(s=m[8][0]))&&g(t,"width",s),(!h||b&256&&l!==(l=m[8][1]))&&g(t,"height",l),(!h||b&1024&&c!==(c=`translate(-${m[10][0]},-${m[10][1]})`))&&g(t,"patternTransform",c),(!h||b&2048&&d!==(d=`url(#${m[11]})`))&&g(u,"fill",d),(!h||b&32&&f!==(f=jl(Qt(["svelte-flow__background",m[5]]))+" svelte-1r7pe8d"))&&g(e,"class",f),b&4&&lt(e,"--xy-background-color-props",m[2]),b&8&&lt(e,"--xy-background-pattern-color-props",m[3])},i(m){h||(T(r),h=!0)},o(m){D(r),h=!1},d(m){m&&p(e),y[n].d()}}}const HE={[Yo.Dots]:1,[Yo.Lines]:1,[Yo.Cross]:6};function LE(o,e,t){let n,r,i,a,s,l,c,{id:u=void 0}=e,{variant:d=Yo.Dots}=e,{gap:f=20}=e,{size:h=1}=e,{lineWidth:_=1}=e,{bgColor:y=void 0}=e,{patternColor:v=void 0}=e,{patternClass:m=void 0}=e,{class:b=""}=e;const{viewport:w,flowId:C}=ln();de(o,w,R=>t(9,l=R)),de(o,C,R=>t(18,c=R));const O=h||HE[d],S=d===Yo.Dots,E=d===Yo.Cross,H=Array.isArray(f)?f:[f,f];return o.$$set=R=>{"id"in R&&t(15,u=R.id),"variant"in R&&t(0,d=R.variant),"gap"in R&&t(16,f=R.gap),"size"in R&&t(17,h=R.size),"lineWidth"in R&&t(1,_=R.lineWidth),"bgColor"in R&&t(2,y=R.bgColor),"patternColor"in R&&t(3,v=R.patternColor),"patternClass"in R&&t(4,m=R.patternClass),"class"in R&&t(5,b=R.class)},o.$$.update=()=>{o.$$.dirty&294912&&t(11,n=`background-pattern-${c}-${u||""}`),o.$$.dirty&512&&t(8,r=[H[0]*l.zoom||1,H[1]*l.zoom||1]),o.$$.dirty&512&&t(7,i=O*l.zoom),o.$$.dirty&384&&t(6,a=E?[i,i]:r),o.$$.dirty&192&&t(10,s=S?[i/2,i/2]:[a[0]/2,a[1]/2])},[d,_,y,v,m,b,a,i,r,l,s,n,w,C,S,u,f,h,c]}class UE extends Ve{constructor(e){super(),Fe(this,e,LE,DE,Qe,{id:15,variant:0,gap:16,size:17,lineWidth:1,bgColor:2,patternColor:3,patternClass:4,class:5})}}const Cd=o=>ow(o);function BE(){const{zoomIn:o,zoomOut:e,fitView:t,onbeforedelete:n,snapGrid:r,viewport:i,width:a,height:s,minZoom:l,maxZoom:c,panZoom:u,nodes:d,edges:f,domNode:h,nodeLookup:_,nodeOrigin:y,edgeLookup:v,connectionLookup:m}=ln(),b=O=>{var L,F;const S=pe(_),E=Cd(O)?O:S.get(O.id),H=E.parentId?lw(E.position,E.measured,E.parentId,S,pe(y)):E.position,R={id:E.id,position:H,width:((L=E.measured)==null?void 0:L.width)??E.width,height:((F=E.measured)==null?void 0:F.height)??E.height,data:E.data};return Qr(R)},w=(O,S,E={replace:!1})=>{var L;const H=(L=pe(_).get(O))==null?void 0:L.internals.userNode;if(!H)return;const R=typeof S=="function"?S(H):S;E.replace?d.update(F=>F.map(q=>q.id===O?Cd(R)?R:{...q,...R}:q)):(Object.assign(H,R),d.update(F=>F))},C=O=>pe(_).get(O);return{zoomIn:o,zoomOut:e,getInternalNode:C,getNode:O=>{var S;return(S=C(O))==null?void 0:S.internals.userNode},getNodes:O=>O===void 0?pe(d):Ed(pe(_),O),getEdge:O=>pe(v).get(O),getEdges:O=>O===void 0?pe(f):Ed(pe(v),O),setZoom:(O,S)=>{const E=pe(u);return E?E.scaleTo(O,{duration:S==null?void 0:S.duration}):Promise.resolve(!1)},getZoom:()=>pe(i).zoom,setViewport:async(O,S)=>{const E=pe(i),H=pe(u);return H?(await H.setViewport({x:O.x??E.x,y:O.y??E.y,zoom:O.zoom??E.zoom},{duration:S==null?void 0:S.duration}),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>pe(i),setCenter:async(O,S,E)=>{const H=typeof(E==null?void 0:E.zoom)<"u"?E.zoom:pe(c),R=pe(u);return R?(await R.setViewport({x:pe(a)/2-O*H,y:pe(s)/2-S*H,zoom:H},{duration:E==null?void 0:E.duration}),Promise.resolve(!0)):Promise.resolve(!1)},fitView:t,fitBounds:async(O,S)=>{const E=pe(u);if(!E)return Promise.resolve(!1);const H=Vl(O,pe(a),pe(s),pe(l),pe(c),(S==null?void 0:S.padding)??.1);return await E.setViewport(H,{duration:S==null?void 0:S.duration}),Promise.resolve(!0)},getIntersectingNodes:(O,S=!0,E)=>{const H=Vu(O),R=H?O:b(O);return R?(E||pe(d)).filter(L=>{const F=pe(_).get(L.id);if(!F||!H&&L.id===O.id)return!1;const q=Qr(F),W=vi(q,R);return S&&W>0||W>=R.width*R.height}):[]},isNodeIntersecting:(O,S,E=!0)=>{const R=Vu(O)?O:b(O);if(!R)return!1;const L=vi(R,S);return E&&L>0||L>=R.width*R.height},deleteElements:async({nodes:O=[],edges:S=[]})=>{const{nodes:E,edges:H}=await og({nodesToRemove:O,edgesToRemove:S,nodes:pe(d),edges:pe(f),onBeforeDelete:pe(n)});return E&&d.update(R=>R.filter(L=>!E.some(({id:F})=>F===L.id))),H&&f.update(R=>R.filter(L=>!H.some(({id:F})=>F===L.id))),{deletedNodes:E,deletedEdges:H}},screenToFlowPosition:(O,S={snapToGrid:!0})=>{const E=pe(h);if(!E)return O;const H=S.snapToGrid?pe(r):!1,{x:R,y:L,zoom:F}=pe(i),{x:q,y:W}=E.getBoundingClientRect(),A={x:O.x-q,y:O.y-W};return Mi(A,[R,L,F],H!==null,H||[1,1])},flowToScreenPosition:O=>{const S=pe(h);if(!S)return O;const{x:E,y:H,zoom:R}=pe(i),{x:L,y:F}=S.getBoundingClientRect(),q=sg(O,[E,H,R]);return{x:q.x+L,y:q.y+F}},toObject:()=>({nodes:pe(d).map(O=>({...O,position:{...O.position},data:{...O.data}})),edges:pe(f).map(O=>({...O})),viewport:{...pe(i)}}),updateNode:w,updateNodeData:(O,S,E)=>{var L;const H=(L=pe(_).get(O))==null?void 0:L.internals.userNode;if(!H)return;const R=typeof S=="function"?S(H):S;H.data=E!=null&&E.replace?R:{...H.data,...R},d.update(F=>F)},getNodesBounds:O=>{const S=pe(_),E=pe(y);return rw(O,{nodeLookup:S,nodeOrigin:E})},getHandleConnections:({type:O,id:S,nodeId:E})=>{var H;return Array.from(((H=pe(m).get(`${E}-${O}-${S??null}`))==null?void 0:H.values())??[])},viewport:i}}function Ed(o,e){var n;const t=[];for(const r of e){const i=o.get(r);if(i){const a="internals"in i?(n=i.internals)==null?void 0:n.userNode:i;t.push(a)}}return t}function zE(){const{nodesInitialized:o}=ln();return{subscribe:o.subscribe}}function Id(o,e,t){const n=o.slice();return n[25]=e[t],n[27]=t,n}function Td(o,e,t){const n=o.slice();return n[22]=e[t],n[24]=t,n}function VE(o){let e,t;return e=new Ps({props:{className:"size-4"}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p:Re,i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function FE(o){let e,t,n,r,i,a,s,l=o[8].t("Tools")+"",c,u,d=o[8].t("Functions")+"",f,h,_,y,v,m,b,w;function C(H,R){if(H[1]==="tools")return GE;if(H[1]==="functions")return KE}let O=C(o),S=O&&O(o),E=o[2]&&Rd(o);return{c(){e=M("form"),t=M("div"),n=M("div"),r=M("div"),i=M("div"),a=M("select"),s=M("option"),c=Se(l),u=M("option"),f=Se(d),h=$(),_=M("div"),y=M("select"),S&&S.c(),v=$(),E&&E.c(),this.h()},l(H){e=P(H,"FORM",{class:!0});var R=I(e);t=P(R,"DIV",{class:!0});var L=I(t);n=P(L,"DIV",{class:!0});var F=I(n);r=P(F,"DIV",{class:!0});var q=I(r);i=P(q,"DIV",{class:!0});var W=I(i);a=P(W,"SELECT",{class:!0,placeholder:!0});var A=I(a);s=P(A,"OPTION",{class:!0});var V=I(s);c=Ae(V,l),V.forEach(p),u=P(A,"OPTION",{class:!0});var N=I(u);f=Ae(N,d),N.forEach(p),A.forEach(p),W.forEach(p),h=ee(q),_=P(q,"DIV",{class:!0});var G=I(_);y=P(G,"SELECT",{class:!0});var X=I(y);S&&S.l(X),X.forEach(p),G.forEach(p),q.forEach(p),F.forEach(p),v=ee(L),E&&E.l(L),L.forEach(p),R.forEach(p),this.h()},h(){s.__value="tools",io(s,s.__value),g(s,"class","bg-gray-100 dark:bg-gray-800"),u.__value="functions",io(u,u.__value),g(u,"class","bg-gray-100 dark:bg-gray-800"),g(a,"class","w-full rounded-sm text-xs py-2 px-1 bg-transparent outline-hidden"),g(a,"placeholder","Select"),o[1]===void 0&&pr(()=>o[13].call(a)),g(i,"class","flex-1"),g(y,"class","w-full rounded-sm py-2 px-1 text-xs bg-transparent outline-hidden"),o[2]===void 0&&pr(()=>o[14].call(y)),g(_,"class","flex-1"),g(r,"class","flex gap-2"),g(n,"class","space-y-1"),g(t,"class","flex flex-col"),g(e,"class","flex flex-col h-full justify-between space-y-3 text-sm")},m(H,R){U(H,e,R),k(e,t),k(t,n),k(n,r),k(r,i),k(i,a),k(a,s),k(s,c),k(a,u),k(u,f),Li(a,o[1],!0),k(r,h),k(r,_),k(_,y),S&&S.m(y,null),Li(y,o[2],!0),k(t,v),E&&E.m(t,null),m=!0,b||(w=[Ie(a,"change",o[13]),Ie(y,"change",o[14]),Ie(y,"change",o[15]),Ie(e,"submit",Jr(o[18]))],b=!0)},p(H,R){(!m||R&256)&&l!==(l=H[8].t("Tools")+"")&&Ne(c,l),(!m||R&256)&&d!==(d=H[8].t("Functions")+"")&&Ne(f,d),R&2&&Li(a,H[1]),O===(O=C(H))&&S?S.p(H,R):(S&&S.d(1),S=O&&O(H),S&&(S.c(),S.m(y,null))),R&196&&Li(y,H[2]),H[2]?E?(E.p(H,R),R&4&&T(E,1)):(E=Rd(H),E.c(),T(E,1),E.m(t,null)):E&&(Le(),D(E,1,1,()=>{E=null}),Ue())},i(H){m||(T(E),m=!0)},o(H){D(E),m=!1},d(H){H&&p(e),S&&S.d(),E&&E.d(),b=!1,kn(w)}}}function KE(o){let e,t=o[8].t("Select a function")+"",n,r,i=Pt(o[7]),a=[];for(let s=0;s<i.length;s+=1)a[s]=Sd(Id(o,i,s));return{c(){e=M("option"),n=Se(t);for(let s=0;s<a.length;s+=1)a[s].c();r=je(),this.h()},l(s){e=P(s,"OPTION",{class:!0});var l=I(e);n=Ae(l,t),l.forEach(p);for(let c=0;c<a.length;c+=1)a[c].l(s);r=je(),this.h()},h(){e.__value="",io(e,e.__value),e.selected=!0,e.disabled=!0,g(e,"class","bg-gray-100 dark:bg-gray-800")},m(s,l){U(s,e,l),k(e,n);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(s,l);U(s,r,l)},p(s,l){if(l&256&&t!==(t=s[8].t("Select a function")+"")&&Ne(n,t),l&128){i=Pt(s[7]);let c;for(c=0;c<i.length;c+=1){const u=Id(s,i,c);a[c]?a[c].p(u,l):(a[c]=Sd(u),a[c].c(),a[c].m(r.parentNode,r))}for(;c<a.length;c+=1)a[c].d(1);a.length=i.length}},d(s){s&&(p(e),p(r)),so(a,s)}}}function GE(o){let e,t=o[8].t("Select a tool")+"",n,r,i=Pt(o[6]),a=[];for(let s=0;s<i.length;s+=1)a[s]=Ad(Td(o,i,s));return{c(){e=M("option"),n=Se(t);for(let s=0;s<a.length;s+=1)a[s].c();r=je(),this.h()},l(s){e=P(s,"OPTION",{class:!0});var l=I(e);n=Ae(l,t),l.forEach(p);for(let c=0;c<a.length;c+=1)a[c].l(s);r=je(),this.h()},h(){e.__value="",io(e,e.__value),e.selected=!0,e.disabled=!0,g(e,"class","bg-gray-100 dark:bg-gray-800")},m(s,l){U(s,e,l),k(e,n);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(s,l);U(s,r,l)},p(s,l){if(l&256&&t!==(t=s[8].t("Select a tool")+"")&&Ne(n,t),l&64){i=Pt(s[6]);let c;for(c=0;c<i.length;c+=1){const u=Td(s,i,c);a[c]?a[c].p(u,l):(a[c]=Ad(u),a[c].c(),a[c].m(r.parentNode,r))}for(;c<a.length;c+=1)a[c].d(1);a.length=i.length}},d(s){s&&(p(e),p(r)),so(a,s)}}}function Sd(o){let e,t=o[25].name+"",n,r;return{c(){e=M("option"),n=Se(t),this.h()},l(i){e=P(i,"OPTION",{class:!0});var a=I(e);n=Ae(a,t),a.forEach(p),this.h()},h(){e.__value=r=o[25].id,io(e,e.__value),g(e,"class","bg-gray-100 dark:bg-gray-800")},m(i,a){U(i,e,a),k(e,n)},p(i,a){a&128&&t!==(t=i[25].name+"")&&Ne(n,t),a&128&&r!==(r=i[25].id)&&(e.__value=r,io(e,e.__value))},d(i){i&&p(e)}}}function Ad(o){let e,t=o[22].name+"",n,r;return{c(){e=M("option"),n=Se(t),this.h()},l(i){e=P(i,"OPTION",{class:!0});var a=I(e);n=Ae(a,t),a.forEach(p),this.h()},h(){e.__value=r=o[22].id,io(e,e.__value),g(e,"class","bg-gray-100 dark:bg-gray-800")},m(i,a){U(i,e,a),k(e,n)},p(i,a){a&64&&t!==(t=i[22].name+"")&&Ne(n,t),a&64&&r!==(r=i[22].id)&&(e.__value=r,io(e,e.__value))},d(i){i&&p(e)}}}function Rd(o){let e,t,n,r,i,a;const s=[YE,WE],l=[];function c(u,d){return u[3]?1:0}return r=c(o),i=l[r]=s[r](o),{c(){e=M("hr"),t=$(),n=M("div"),i.c(),this.h()},l(u){e=P(u,"HR",{class:!0}),t=ee(u),n=P(u,"DIV",{class:!0});var d=I(n);i.l(d),d.forEach(p),this.h()},h(){g(e,"class","dark:border-gray-800 my-1 w-full"),g(n,"class","my-2 text-xs")},m(u,d){U(u,e,d),U(u,t,d),U(u,n,d),l[r].m(n,null),a=!0},p(u,d){let f=r;r=c(u),r===f?l[r].p(u,d):(Le(),D(l[f],1,1,()=>{l[f]=null}),Ue(),i=l[r],i?i.p(u,d):(i=l[r]=s[r](u),i.c()),T(i,1),i.m(n,null))},i(u){a||(T(i),a=!0)},o(u){D(i),a=!1},d(u){u&&(p(e),p(t),p(n)),l[r].d()}}}function WE(o){let e,t;return e=new Ps({props:{className:"size-5"}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p:Re,i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function YE(o){let e,t,n;function r(a){o[16](a)}let i={valvesSpec:o[4]};return o[5]!==void 0&&(i.valves=o[5]),e=new _p({props:i}),Ye.push(()=>tt(e,"valves",r)),e.$on("change",o[17]),{c(){te(e.$$.fragment)},l(a){re(e.$$.fragment,a)},m(a,s){ne(e,a,s),n=!0},p(a,s){const l={};s&16&&(l.valvesSpec=a[4]),!t&&s&32&&(t=!0,l.valves=a[5],et(()=>t=!1)),e.$set(l)},i(a){n||(T(e.$$.fragment,a),n=!0)},o(a){D(e.$$.fragment,a),n=!1},d(a){oe(e,a)}}}function qE(o){let e,t,n,r;const i=[FE,VE],a=[];function s(l,c){return l[0]&&!l[3]?0:1}return e=s(o),t=a[e]=i[e](o),{c(){t.c(),n=je()},l(l){t.l(l),n=je()},m(l,c){a[e].m(l,c),U(l,n,c),r=!0},p(l,[c]){let u=e;e=s(l),e===u?a[e].p(l,c):(Le(),D(a[u],1,1,()=>{a[u]=null}),Ue(),t=a[e],t?t.p(l,c):(t=a[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){D(t),r=!1},d(l){l&&p(n),a[e].d(l)}}}function jE(o,e,t){let n,r,i;de(o,yr,R=>t(6,n=R)),de(o,Jl,R=>t(7,r=R));const a=Pn(),s=on("i18n");de(o,s,R=>t(8,i=R));let{show:l=!1}=e,c="tools",u="",d=!1,f=null,h={},_;const y=async()=>{_&&clearTimeout(_),_=setTimeout(()=>{m()},500)},v=async()=>{var R;if(t(3,d=!0),c==="tools"?(t(5,h=await Um(localStorage.token,u)),t(4,f=await Bm(localStorage.token,u))):c==="functions"&&(t(5,h=await gp(localStorage.token,u)),t(4,f=await mp(localStorage.token,u))),f)for(const L in f.properties)((R=f.properties[L])==null?void 0:R.type)==="array"&&t(5,h[L]=(h[L]??[]).join(","),h);t(3,d=!1)},m=async()=>{var R;if(f){for(const L in f.properties)((R=f.properties[L])==null?void 0:R.type)==="array"&&t(5,h[L]=(h[L]??"").split(",").map(F=>F.trim()),h);if(c==="tools"){const L=await zm(localStorage.token,u,h).catch(F=>(at.error(`${F}`),null));L&&(at.success(i.t("Valves updated")),t(5,h=L))}else if(c==="functions"){const L=await pp(localStorage.token,u,h).catch(F=>(at.error(`${F}`),null));L&&(at.success(i.t("Valves updated")),t(5,h=L))}}},b=async()=>{t(3,d=!0),r===null&&Jl.set(await hp(localStorage.token)),n===null&&yr.set(await qa(localStorage.token)),t(3,d=!1)};function w(){c=Ql(this),t(1,c)}function C(){u=Ql(this),t(2,u),t(1,c)}const O=async()=>{await rt()};function S(R){h=R,t(5,h)}const E=()=>{y()},H=()=>{m(),a("save")};return o.$$set=R=>{"show"in R&&t(0,l=R.show)},o.$$.update=()=>{o.$$.dirty&2&&c&&t(2,u=""),o.$$.dirty&4&&u&&v(),o.$$.dirty&1&&l&&b()},[l,c,u,d,f,h,n,r,i,a,s,y,m,w,C,O,S,E,H]}class QE extends Ve{constructor(e){super(),Fe(this,e,jE,qE,Qe,{show:0})}}function Md(o,e,t){const n=o.slice();return n[14]=e[t],n[16]=t,n}function XE(o){let e,t=o[3].t("You do not have permission to access this feature.")+"",n;return{c(){e=M("div"),n=Se(t),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);n=Ae(i,t),i.forEach(p),this.h()},h(){g(e,"class","text-sm dark:text-gray-300 text-center py-2 px-10")},m(r,i){U(r,e,i),k(e,n)},p(r,i){i&8&&t!==(t=r[3].t("You do not have permission to access this feature.")+"")&&Ne(n,t)},i:Re,o:Re,d(r){r&&p(e)}}}function JE(o){let e,t,n,r,i,a,s,l,c,u,d,f,h,_=o[0].length>0&&Pd(o);function y(m){o[11](m)}let v={title:o[3].t("Valves"),buttonClassName:"w-full",$$slots:{content:[ZE]},$$scope:{ctx:o}};return o[2]!==void 0&&(v.open=o[2]),n=new es({props:v}),Ye.push(()=>tt(n,"open",y)),l=new es({props:{title:o[3].t("System Prompt"),open:!0,buttonClassName:"w-full",$$slots:{content:[$E]},$$scope:{ctx:o}}}),f=new es({props:{title:o[3].t("Advanced Params"),open:!0,buttonClassName:"w-full",$$slots:{content:[e2]},$$scope:{ctx:o}}}),{c(){e=M("div"),_&&_.c(),t=$(),te(n.$$.fragment),i=$(),a=M("hr"),s=$(),te(l.$$.fragment),c=$(),u=M("hr"),d=$(),te(f.$$.fragment),this.h()},l(m){e=P(m,"DIV",{class:!0});var b=I(e);_&&_.l(b),t=ee(b),re(n.$$.fragment,b),i=ee(b),a=P(b,"HR",{class:!0}),s=ee(b),re(l.$$.fragment,b),c=ee(b),u=P(b,"HR",{class:!0}),d=ee(b),re(f.$$.fragment,b),b.forEach(p),this.h()},h(){g(a,"class","my-2 border-gray-50 dark:border-gray-700/10"),g(u,"class","my-2 border-gray-50 dark:border-gray-700/10"),g(e,"class","dark:text-gray-200 text-sm font-primary py-0.5 px-0.5")},m(m,b){U(m,e,b),_&&_.m(e,null),k(e,t),ne(n,e,null),k(e,i),k(e,a),k(e,s),ne(l,e,null),k(e,c),k(e,u),k(e,d),ne(f,e,null),h=!0},p(m,b){m[0].length>0?_?(_.p(m,b),b&1&&T(_,1)):(_=Pd(m),_.c(),T(_,1),_.m(e,t)):_&&(Le(),D(_,1,1,()=>{_=null}),Ue());const w={};b&8&&(w.title=m[3].t("Valves")),b&131076&&(w.$$scope={dirty:b,ctx:m}),!r&&b&4&&(r=!0,w.open=m[2],et(()=>r=!1)),n.$set(w);const C={};b&8&&(C.title=m[3].t("System Prompt")),b&131082&&(C.$$scope={dirty:b,ctx:m}),l.$set(C);const O={};b&8&&(O.title=m[3].t("Advanced Params")),b&131090&&(O.$$scope={dirty:b,ctx:m}),f.$set(O)},i(m){h||(T(_),T(n.$$.fragment,m),T(l.$$.fragment,m),T(f.$$.fragment,m),h=!0)},o(m){D(_),D(n.$$.fragment,m),D(l.$$.fragment,m),D(f.$$.fragment,m),h=!1},d(m){m&&p(e),_&&_.d(),oe(n),oe(l),oe(f)}}}function Pd(o){let e,t,n,r;return e=new es({props:{title:o[3].t("Files"),open:!0,buttonClassName:"w-full",$$slots:{content:[xE]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment),t=$(),n=M("hr"),this.h()},l(i){re(e.$$.fragment,i),t=ee(i),n=P(i,"HR",{class:!0}),this.h()},h(){g(n,"class","my-2 border-gray-50 dark:border-gray-700/10")},m(i,a){ne(e,i,a),U(i,t,a),U(i,n,a),r=!0},p(i,a){const s={};a&8&&(s.title=i[3].t("Files")),a&131073&&(s.$$scope={dirty:a,ctx:i}),e.$set(s)},i(i){r||(T(e.$$.fragment,i),r=!0)},o(i){D(e.$$.fragment,i),r=!1},d(i){i&&(p(t),p(n)),oe(e,i)}}}function Od(o){var i,a;let e,t;function n(){return o[9](o[16])}function r(){return o[10](o[14])}return e=new of({props:{className:"w-full",item:o[14],edit:!0,url:(i=o[14])!=null&&i.url?o[14].url:null,name:o[14].name,type:o[14].type,size:(a=o[14])==null?void 0:a.size,dismissible:!0}}),e.$on("dismiss",n),e.$on("click",r),{c(){te(e.$$.fragment)},l(s){re(e.$$.fragment,s)},m(s,l){ne(e,s,l),t=!0},p(s,l){var u,d;o=s;const c={};l&1&&(c.item=o[14]),l&1&&(c.url=(u=o[14])!=null&&u.url?o[14].url:null),l&1&&(c.name=o[14].name),l&1&&(c.type=o[14].type),l&1&&(c.size=(d=o[14])==null?void 0:d.size),e.$set(c)},i(s){t||(T(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){oe(e,s)}}}function xE(o){let e,t,n=Pt(o[0]),r=[];for(let a=0;a<n.length;a+=1)r[a]=Od(Md(o,n,a));const i=a=>D(r[a],1,1,()=>{r[a]=null});return{c(){e=M("div");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){e=P(a,"DIV",{class:!0,slot:!0});var s=I(e);for(let l=0;l<r.length;l+=1)r[l].l(s);s.forEach(p),this.h()},h(){g(e,"class","flex flex-col gap-1 mt-1.5"),g(e,"slot","content")},m(a,s){U(a,e,s);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(e,null);t=!0},p(a,s){if(s&1){n=Pt(a[0]);let l;for(l=0;l<n.length;l+=1){const c=Md(a,n,l);r[l]?(r[l].p(c,s),T(r[l],1)):(r[l]=Od(c),r[l].c(),T(r[l],1),r[l].m(e,null))}for(Le(),l=n.length;l<r.length;l+=1)i(l);Ue()}},i(a){if(!t){for(let s=0;s<n.length;s+=1)T(r[s]);t=!0}},o(a){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)D(r[s]);t=!1},d(a){a&&p(e),so(r,a)}}}function ZE(o){let e,t,n;return t=new QE({props:{show:o[2]}}),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(r){e=P(r,"DIV",{class:!0,slot:!0});var i=I(e);re(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"class","text-sm"),g(e,"slot","content")},m(r,i){U(r,e,i),ne(t,e,null),n=!0},p(r,i){const a={};i&4&&(a.show=r[2]),t.$set(a)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){D(t.$$.fragment,r),n=!1},d(r){r&&p(e),oe(t)}}}function $E(o){let e,t,n,r,i;return{c(){e=M("div"),t=M("textarea"),this.h()},l(a){e=P(a,"DIV",{class:!0,slot:!0});var s=I(e);t=P(s,"TEXTAREA",{class:!0,rows:!0,placeholder:!0}),I(t).forEach(p),s.forEach(p),this.h()},h(){g(t,"class","w-full text-xs py-1.5 bg-transparent outline-hidden resize-none"),g(t,"rows","4"),g(t,"placeholder",n=o[3].t("Enter system prompt")),g(e,"class",""),g(e,"slot","content")},m(a,s){U(a,e,s),k(e,t),io(t,o[1].system),r||(i=Ie(t,"input",o[12]),r=!0)},p(a,s){s&8&&n!==(n=a[3].t("Enter system prompt"))&&g(t,"placeholder",n),s&2&&io(t,a[1].system)},d(a){a&&p(e),r=!1,i()}}}function e2(o){var l;let e,t,n,r,i;function a(c){o[13](c)}let s={admin:((l=o[4])==null?void 0:l.role)==="admin"};return o[1]!==void 0&&(s.params=o[1]),n=new fp({props:s}),Ye.push(()=>tt(n,"params",a)),{c(){e=M("div"),t=M("div"),te(n.$$.fragment),this.h()},l(c){e=P(c,"DIV",{class:!0,slot:!0});var u=I(e);t=P(u,"DIV",{});var d=I(t);re(n.$$.fragment,d),d.forEach(p),u.forEach(p),this.h()},h(){g(e,"class","text-sm mt-1.5"),g(e,"slot","content")},m(c,u){U(c,e,u),k(e,t),ne(n,t,null),i=!0},p(c,u){var f;const d={};u&16&&(d.admin=((f=c[4])==null?void 0:f.role)==="admin"),!r&&u&2&&(r=!0,d.params=c[1],et(()=>r=!1)),n.$set(d)},i(c){i||(T(n.$$.fragment,c),i=!0)},o(c){D(n.$$.fragment,c),i=!1},d(c){c&&p(e),oe(n)}}}function t2(o){let e,t,n,r=o[3].t("Chat Controls")+"",i,a,s,l,c,u,d,f,h,_;l=new Os({props:{className:"size-3.5"}});const y=[JE,XE],v=[];function m(b,w){var C,O;return b[4].role==="admin"||(O=(C=b[4])==null?void 0:C.permissions.chat)!=null&&O.controls?0:1}return u=m(o),d=v[u]=y[u](o),{c(){e=M("div"),t=M("div"),n=M("div"),i=Se(r),a=$(),s=M("button"),te(l.$$.fragment),c=$(),d.c(),this.h()},l(b){e=P(b,"DIV",{class:!0});var w=I(e);t=P(w,"DIV",{class:!0});var C=I(t);n=P(C,"DIV",{class:!0});var O=I(n);i=Ae(O,r),O.forEach(p),a=ee(C),s=P(C,"BUTTON",{class:!0});var S=I(s);re(l.$$.fragment,S),S.forEach(p),C.forEach(p),c=ee(w),d.l(w),w.forEach(p),this.h()},h(){g(n,"class","text-lg font-medium self-center font-primary"),g(s,"class","self-center"),g(t,"class","flex items-center justify-between dark:text-gray-100 mb-2"),g(e,"class","dark:text-white")},m(b,w){U(b,e,w),k(e,t),k(t,n),k(n,i),k(t,a),k(t,s),ne(l,s,null),k(e,c),v[u].m(e,null),f=!0,h||(_=Ie(s,"click",o[8]),h=!0)},p(b,[w]){(!f||w&8)&&r!==(r=b[3].t("Chat Controls")+"")&&Ne(i,r);let C=u;u=m(b),u===C?v[u].p(b,w):(Le(),D(v[C],1,1,()=>{v[C]=null}),Ue(),d=v[u],d?d.p(b,w):(d=v[u]=y[u](b),d.c()),T(d,1),d.m(e,null))},i(b){f||(T(l.$$.fragment,b),T(d),f=!0)},o(b){D(l.$$.fragment,b),D(d),f=!1},d(b){b&&p(e),oe(l),v[u].d(),h=!1,_()}}}function n2(o,e,t){let n,r;de(o,Xo,m=>t(4,r=m));const i=Pn(),a=on("i18n");de(o,a,m=>t(3,n=m));let{models:s=[]}=e,{chatFiles:l=[]}=e,{params:c={}}=e,u=!1;const d=()=>{i("close")},f=m=>{l.splice(m,1),t(0,l)},h=m=>{console.log(m)};function _(m){u=m,t(2,u)}function y(){c.system=this.value,t(1,c)}function v(m){c=m,t(1,c)}return o.$$set=m=>{"models"in m&&t(7,s=m.models),"chatFiles"in m&&t(0,l=m.chatFiles),"params"in m&&t(1,c=m.params)},[l,c,u,n,r,i,a,s,d,f,h,_,y,v]}class Hg extends Ve{constructor(e){super(),Fe(this,e,n2,t2,Qe,{models:7,chatFiles:0,params:1})}}function Nd(o,e,t){const n=o.slice();return n[10]=e[t],n}function o2(o){let e;const t=o[4].default,n=gn(t,o,o[8],null);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i&256)&&mn(n,t,r,r[8],e?_n(t,r[8],i,null):pn(r[8]),null)},i(r){e||(T(n,r),e=!0)},o(r){D(n,r),e=!1},d(r){n&&n.d(r)}}}function r2(o){var a;let e,t,n=(((a=o[10])==null?void 0:a.label)??"Camera")+"",r,i;return{c(){e=M("div"),t=M("div"),r=Se(n),i=$(),this.h()},l(s){e=P(s,"DIV",{class:!0});var l=I(e);t=P(l,"DIV",{class:!0});var c=I(t);r=Ae(c,n),c.forEach(p),l.forEach(p),i=ee(s),this.h()},h(){g(t,"class","line-clamp-1"),g(e,"class","flex items-center")},m(s,l){U(s,e,l),k(e,t),k(t,r),U(s,i,l)},p(s,l){var c;l&2&&n!==(n=(((c=s[10])==null?void 0:c.label)??"Camera")+"")&&Ne(r,n)},d(s){s&&(p(e),p(i))}}}function Dd(o){let e,t;function n(){return o[5](o[10])}return e=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[r2]},$$scope:{ctx:o}}}),e.$on("click",n),{c(){te(e.$$.fragment)},l(r){re(e.$$.fragment,r)},m(r,i){ne(e,r,i),t=!0},p(r,i){o=r;const a={};i&258&&(a.$$scope={dirty:i,ctx:o}),e.$set(a)},i(r){t||(T(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){oe(e,r)}}}function i2(o){let e,t,n=Pt(o[1]),r=[];for(let a=0;a<n.length;a+=1)r[a]=Dd(Nd(o,n,a));const i=a=>D(r[a],1,1,()=>{r[a]=null});return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=je()},l(a){for(let s=0;s<r.length;s+=1)r[s].l(a);e=je()},m(a,s){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(a,s);U(a,e,s),t=!0},p(a,s){if(s&10){n=Pt(a[1]);let l;for(l=0;l<n.length;l+=1){const c=Nd(a,n,l);r[l]?(r[l].p(c,s),T(r[l],1)):(r[l]=Dd(c),r[l].c(),T(r[l],1),r[l].m(e.parentNode,e))}for(Le(),l=n.length;l<r.length;l+=1)i(l);Ue()}},i(a){if(!t){for(let s=0;s<n.length;s+=1)T(r[s]);t=!0}},o(a){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)D(r[s]);t=!1},d(a){a&&p(e),so(r,a)}}}function s2(o){let e,t,n;return t=new Ms({props:{class:"w-full max-w-[180px] rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-9999 bg-white dark:bg-gray-900 dark:text-white shadow-xs",sideOffset:6,side:"top",align:"start",transition:Ei,$$slots:{default:[i2]},$$scope:{ctx:o}}}),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(r){e=P(r,"DIV",{slot:!0});var i=I(e);re(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"slot","content")},m(r,i){U(r,e,i),ne(t,e,null),n=!0},p(r,i){const a={};i&258&&(a.$$scope={dirty:i,ctx:r}),t.$set(a)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){D(t.$$.fragment,r),n=!1},d(r){r&&p(e),oe(t)}}}function a2(o){let e,t,n;function r(a){o[6](a)}let i={$$slots:{content:[s2],default:[o2]},$$scope:{ctx:o}};return o[2]!==void 0&&(i.show=o[2]),e=new Rs({props:i}),Ye.push(()=>tt(e,"show",r)),e.$on("change",o[7]),{c(){te(e.$$.fragment)},l(a){re(e.$$.fragment,a)},m(a,s){ne(e,a,s),n=!0},p(a,[s]){const l={};s&258&&(l.$$scope={dirty:s,ctx:a}),!t&&s&4&&(t=!0,l.show=a[2],et(()=>t=!1)),e.$set(l)},i(a){n||(T(e.$$.fragment,a),n=!0)},o(a){D(e.$$.fragment,a),n=!1},d(a){oe(e,a)}}}function l2(o,e,t){let{$$slots:n={},$$scope:r}=e;on("i18n");const i=Pn();let{onClose:a=()=>{}}=e,{devices:s}=e,l=!1;const c=f=>{i("change",f.deviceId)};function u(f){l=f,t(2,l)}const d=f=>{f.detail===!1&&a()};return o.$$set=f=>{"onClose"in f&&t(0,a=f.onClose),"devices"in f&&t(1,s=f.devices),"$$scope"in f&&t(8,r=f.$$scope)},[a,s,l,i,n,c,u,d,r]}class c2 extends Ve{constructor(e){super(),Fe(this,e,l2,a2,Qe,{onClose:0,devices:1})}}function Hd(o){let e,t,n,r,i,a,s,l,c,u,d,f,h,_,y,v='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"></path></svg>',m,b,w,C=o[4]&&Ld(o);function O(A,V){return A[4]?h2:g2}let S=O(o),E=S(o);const H=[y2,b2],R=[];function L(A,V){return A[4]?0:1}s=L(o),l=R[s]=H[s](o);function F(A,V){return A[1]?E2:A[2]?C2:k2}let q=F(o),W=q(o);return{c(){e=M("div"),C&&C.c(),t=$(),n=M("div"),E.c(),r=$(),i=M("div"),a=M("div"),l.c(),c=$(),u=M("div"),d=M("button"),f=M("div"),W.c(),h=$(),_=M("div"),y=M("button"),y.innerHTML=v,this.h()},l(A){e=P(A,"DIV",{class:!0});var V=I(e);C&&C.l(V),t=ee(V),n=P(V,"DIV",{class:!0});var N=I(n);E.l(N),N.forEach(p),r=ee(V),i=P(V,"DIV",{class:!0});var G=I(i);a=P(G,"DIV",{});var X=I(a);l.l(X),X.forEach(p),c=ee(G),u=P(G,"DIV",{});var Q=I(u);d=P(Q,"BUTTON",{type:!0});var j=I(d);f=P(j,"DIV",{class:!0});var ue=I(f);W.l(ue),ue.forEach(p),j.forEach(p),Q.forEach(p),h=ee(G),_=P(G,"DIV",{});var B=I(_);y=P(B,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),wt(y)!=="svelte-1k5eavb"&&(y.innerHTML=v),B.forEach(p),G.forEach(p),V.forEach(p),this.h()},h(){g(n,"class","flex justify-center items-center flex-1 h-full w-full max-h-full"),g(f,"class","line-clamp-1 text-sm font-medium"),g(d,"type","button"),g(y,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),g(y,"type","button"),g(i,"class","flex justify-between items-center pb-2 w-full"),g(e,"class","max-w-lg w-full h-full max-h-[100dvh] flex flex-col justify-between p-3 md:p-6")},m(A,V){U(A,e,V),C&&C.m(e,null),k(e,t),k(e,n),E.m(n,null),k(e,r),k(e,i),k(i,a),R[s].m(a,null),k(i,c),k(i,u),k(u,d),k(d,f),W.m(f,null),k(i,h),k(i,_),k(_,y),m=!0,b||(w=[Ie(d,"click",o[31]),Ie(y,"click",o[32])],b=!0)},p(A,V){A[4]?C?C.p(A,V):(C=Ld(A),C.c(),C.m(e,t)):C&&(C.d(1),C=null),S===(S=O(A))&&E?E.p(A,V):(E.d(1),E=S(A),E&&(E.c(),E.m(n,null)));let N=s;s=L(A),s===N?R[s].p(A,V):(Le(),D(R[N],1,1,()=>{R[N]=null}),Ue(),l=R[s],l?l.p(A,V):(l=R[s]=H[s](A),l.c()),T(l,1),l.m(a,null)),q===(q=F(A))&&W?W.p(A,V):(W.d(1),W=q(A),W&&(W.c(),W.m(f,null)))},i(A){m||(T(l),m=!0)},o(A){D(l),m=!1},d(A){A&&p(e),C&&C.d(),E.d(),R[s].d(),W.d(),b=!1,kn(w)}}}function Ld(o){let e,t,n;function r(s,l){return s[3]?f2:s[1]||s[2]?d2:u2}let i=r(o),a=i(o);return{c(){e=M("button"),a.c(),this.h()},l(s){e=P(s,"BUTTON",{type:!0,class:!0});var l=I(e);a.l(l),l.forEach(p),this.h()},h(){g(e,"type","button"),g(e,"class","flex justify-center items-center w-full h-20 min-h-20")},m(s,l){U(s,e,l),a.m(e,null),t||(n=Ie(e,"click",o[26]),t=!0)},p(s,l){i===(i=r(s))&&a?a.p(s,l):(a.d(1),a=i(s),a&&(a.c(),a.m(e,null)))},d(s){s&&p(e),a.d(),t=!1,n()}}}function u2(o){let e,t,n;return{c(){e=M("div"),this.h()},l(r){e=P(r,"DIV",{class:!0,style:!0}),I(e).forEach(p),this.h()},h(){var r,i,a,s,l,c,u,d,f;g(e,"class",t=(o[6]*100>4?" size-[4.5rem]":o[6]*100>2?" size-16":o[6]*100>1?"size-14":"size-12")+" transition-all rounded-full "+((((a=(i=(r=o[0])==null?void 0:r.info)==null?void 0:i.meta)==null?void 0:a.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?" bg-cover bg-center bg-no-repeat":"bg-black dark:bg-white")+" bg-black dark:bg-white"),g(e,"style",n=(((c=(l=(s=o[0])==null?void 0:s.info)==null?void 0:l.meta)==null?void 0:c.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?`background-image: url('${(f=(d=(u=o[0])==null?void 0:u.info)==null?void 0:d.meta)==null?void 0:f.profile_image_url}');`:"")},m(r,i){U(r,e,i)},p(r,i){var a,s,l,c,u,d,f,h,_;i[0]&65&&t!==(t=(r[6]*100>4?" size-[4.5rem]":r[6]*100>2?" size-16":r[6]*100>1?"size-14":"size-12")+" transition-all rounded-full "+((((l=(s=(a=r[0])==null?void 0:a.info)==null?void 0:s.meta)==null?void 0:l.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?" bg-cover bg-center bg-no-repeat":"bg-black dark:bg-white")+" bg-black dark:bg-white")&&g(e,"class",t),i[0]&1&&n!==(n=(((d=(u=(c=r[0])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?`background-image: url('${(_=(h=(f=r[0])==null?void 0:f.info)==null?void 0:h.meta)==null?void 0:_.profile_image_url}');`:"")&&g(e,"style",n)},d(r){r&&p(e)}}}function d2(o){let e,t,n,r,i,a;return{c(){e=be("svg"),t=be("style"),n=Se(`.spinner_qM83 {\r
								animation: spinner_8HQG 1.05s infinite;\r
							}\r
							.spinner_oXPr {\r
								animation-delay: 0.1s;\r
							}\r
							.spinner_ZTLf {\r
								animation-delay: 0.2s;\r
							}\r
							@keyframes spinner_8HQG {\r
								0%,\r
								57.14% {\r
									animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\r
									transform: translate(0);\r
								}\r
								28.57% {\r
									animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\r
									transform: translateY(-6px);\r
								}\r
								100% {\r
									transform: translate(0);\r
								}\r
							}\r
						`),r=be("circle"),i=be("circle"),a=be("circle"),this.h()},l(s){e=ye(s,"svg",{class:!0,viewBox:!0,fill:!0,xmlns:!0});var l=I(e);t=ye(l,"style",{});var c=I(t);n=Ae(c,`.spinner_qM83 {\r
								animation: spinner_8HQG 1.05s infinite;\r
							}\r
							.spinner_oXPr {\r
								animation-delay: 0.1s;\r
							}\r
							.spinner_ZTLf {\r
								animation-delay: 0.2s;\r
							}\r
							@keyframes spinner_8HQG {\r
								0%,\r
								57.14% {\r
									animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\r
									transform: translate(0);\r
								}\r
								28.57% {\r
									animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\r
									transform: translateY(-6px);\r
								}\r
								100% {\r
									transform: translate(0);\r
								}\r
							}\r
						`),c.forEach(p),r=ye(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),I(r).forEach(p),i=ye(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),I(i).forEach(p),a=ye(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),I(a).forEach(p),l.forEach(p),this.h()},h(){g(r,"class","spinner_qM83"),g(r,"cx","4"),g(r,"cy","12"),g(r,"r","3"),g(i,"class","spinner_qM83 spinner_oXPr"),g(i,"cx","12"),g(i,"cy","12"),g(i,"r","3"),g(a,"class","spinner_qM83 spinner_ZTLf"),g(a,"cx","20"),g(a,"cy","12"),g(a,"r","3"),g(e,"class","size-12 text-gray-900 dark:text-gray-400"),g(e,"viewBox","0 0 24 24"),g(e,"fill","currentColor"),g(e,"xmlns","http://www.w3.org/2000/svg")},m(s,l){U(s,e,l),k(e,t),k(t,n),k(e,r),k(e,i),k(e,a)},p:Re,d(s){s&&p(e)}}}function f2(o){let e,t;return{c(){e=M("div"),t=Se(o[3]),this.h()},l(n){e=P(n,"DIV",{class:!0,style:!0});var r=I(e);t=Ae(r,o[3]),r.forEach(p),this.h()},h(){g(e,"class","transition-all rounded-full"),lt(e,"font-size",(o[6]*100>4?"4.5":o[6]*100>2?"4.25":o[6]*100>1?"3.75":"3.5")+"rem"),lt(e,"width","100%"),lt(e,"text-align","center")},m(n,r){U(n,e,r),k(e,t)},p(n,r){r[0]&8&&Ne(t,n[3]),r[0]&64&&lt(e,"font-size",(n[6]*100>4?"4.5":n[6]*100>2?"4.25":n[6]*100>1?"3.75":"3.5")+"rem")},d(n){n&&p(e)}}}function h2(o){let e,t,n,r,i,a,s,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-6"><path d="M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"></path></svg>',c,u;return{c(){e=M("div"),t=M("video"),n=$(),r=M("canvas"),i=$(),a=M("div"),s=M("button"),s.innerHTML=l,this.h()},l(d){e=P(d,"DIV",{class:!0});var f=I(e);t=P(f,"VIDEO",{id:!0,class:!0}),I(t).forEach(p),n=ee(f),r=P(f,"CANVAS",{id:!0,style:!0}),I(r).forEach(p),i=ee(f),a=P(f,"DIV",{class:!0});var h=I(a);s=P(h,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),wt(s)!=="svelte-16ul42n"&&(s.innerHTML=l),h.forEach(p),f.forEach(p),this.h()},h(){g(t,"id","camera-feed"),t.autoplay=!0,g(t,"class","rounded-2xl h-full min-w-full object-cover object-center"),t.playsInline=!0,g(r,"id","camera-canvas"),lt(r,"display","none"),g(s,"type","button"),g(s,"class","p-1.5 text-white cursor-pointer backdrop-blur-xl bg-black/10 rounded-full"),g(a,"class","absolute top-4 md:top-8 left-4"),g(e,"class","relative flex video-container w-full max-h-full pt-2 pb-4 md:py-6 px-2 h-full")},m(d,f){U(d,e,f),k(e,t),k(e,n),k(e,r),k(e,i),k(e,a),k(a,s),c||(u=Ie(s,"click",o[28]),c=!0)},p:Re,d(d){d&&p(e),c=!1,u()}}}function g2(o){let e,t,n;function r(s,l){return s[3]?_2:s[1]||s[2]?p2:m2}let i=r(o),a=i(o);return{c(){e=M("button"),a.c(),this.h()},l(s){e=P(s,"BUTTON",{type:!0});var l=I(e);a.l(l),l.forEach(p),this.h()},h(){g(e,"type","button")},m(s,l){U(s,e,l),a.m(e,null),t||(n=Ie(e,"click",o[27]),t=!0)},p(s,l){i===(i=r(s))&&a?a.p(s,l):(a.d(1),a=i(s),a&&(a.c(),a.m(e,null)))},d(s){s&&p(e),a.d(),t=!1,n()}}}function m2(o){let e,t,n;return{c(){e=M("div"),this.h()},l(r){e=P(r,"DIV",{class:!0,style:!0}),I(e).forEach(p),this.h()},h(){var r,i,a,s,l,c,u,d,f;g(e,"class",t=(o[6]*100>4?" size-52":o[6]*100>2?"size-48":o[6]*100>1?"size-44":"size-40")+" transition-all rounded-full "+((((a=(i=(r=o[0])==null?void 0:r.info)==null?void 0:i.meta)==null?void 0:a.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?" bg-cover bg-center bg-no-repeat":"bg-black dark:bg-white")),g(e,"style",n=(((c=(l=(s=o[0])==null?void 0:s.info)==null?void 0:l.meta)==null?void 0:c.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?`background-image: url('${(f=(d=(u=o[0])==null?void 0:u.info)==null?void 0:d.meta)==null?void 0:f.profile_image_url}');`:"")},m(r,i){U(r,e,i)},p(r,i){var a,s,l,c,u,d,f,h,_;i[0]&65&&t!==(t=(r[6]*100>4?" size-52":r[6]*100>2?"size-48":r[6]*100>1?"size-44":"size-40")+" transition-all rounded-full "+((((l=(s=(a=r[0])==null?void 0:a.info)==null?void 0:s.meta)==null?void 0:l.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?" bg-cover bg-center bg-no-repeat":"bg-black dark:bg-white"))&&g(e,"class",t),i[0]&1&&n!==(n=(((d=(u=(c=r[0])==null?void 0:c.info)==null?void 0:u.meta)==null?void 0:d.profile_image_url)??"/static/favicon.png")!=="/static/favicon.png"?`background-image: url('${(_=(h=(f=r[0])==null?void 0:f.info)==null?void 0:h.meta)==null?void 0:_.profile_image_url}');`:"")&&g(e,"style",n)},d(r){r&&p(e)}}}function p2(o){let e,t,n,r,i,a;return{c(){e=be("svg"),t=be("style"),n=Se(`.spinner_qM83 {\r
									animation: spinner_8HQG 1.05s infinite;\r
								}\r
								.spinner_oXPr {\r
									animation-delay: 0.1s;\r
								}\r
								.spinner_ZTLf {\r
									animation-delay: 0.2s;\r
								}\r
								@keyframes spinner_8HQG {\r
									0%,\r
									57.14% {\r
										animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\r
										transform: translate(0);\r
									}\r
									28.57% {\r
										animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\r
										transform: translateY(-6px);\r
									}\r
									100% {\r
										transform: translate(0);\r
									}\r
								}\r
							`),r=be("circle"),i=be("circle"),a=be("circle"),this.h()},l(s){e=ye(s,"svg",{class:!0,viewBox:!0,fill:!0,xmlns:!0});var l=I(e);t=ye(l,"style",{});var c=I(t);n=Ae(c,`.spinner_qM83 {\r
									animation: spinner_8HQG 1.05s infinite;\r
								}\r
								.spinner_oXPr {\r
									animation-delay: 0.1s;\r
								}\r
								.spinner_ZTLf {\r
									animation-delay: 0.2s;\r
								}\r
								@keyframes spinner_8HQG {\r
									0%,\r
									57.14% {\r
										animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\r
										transform: translate(0);\r
									}\r
									28.57% {\r
										animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\r
										transform: translateY(-6px);\r
									}\r
									100% {\r
										transform: translate(0);\r
									}\r
								}\r
							`),c.forEach(p),r=ye(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),I(r).forEach(p),i=ye(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),I(i).forEach(p),a=ye(l,"circle",{class:!0,cx:!0,cy:!0,r:!0}),I(a).forEach(p),l.forEach(p),this.h()},h(){g(r,"class","spinner_qM83"),g(r,"cx","4"),g(r,"cy","12"),g(r,"r","3"),g(i,"class","spinner_qM83 spinner_oXPr"),g(i,"cx","12"),g(i,"cy","12"),g(i,"r","3"),g(a,"class","spinner_qM83 spinner_ZTLf"),g(a,"cx","20"),g(a,"cy","12"),g(a,"r","3"),g(e,"class","size-44 text-gray-900 dark:text-gray-400"),g(e,"viewBox","0 0 24 24"),g(e,"fill","currentColor"),g(e,"xmlns","http://www.w3.org/2000/svg")},m(s,l){U(s,e,l),k(e,t),k(t,n),k(e,r),k(e,i),k(e,a)},p:Re,d(s){s&&p(e)}}}function _2(o){let e,t;return{c(){e=M("div"),t=Se(o[3]),this.h()},l(n){e=P(n,"DIV",{class:!0,style:!0});var r=I(e);t=Ae(r,o[3]),r.forEach(p),this.h()},h(){g(e,"class","transition-all rounded-full"),lt(e,"font-size",(o[6]*100>4?"13":o[6]*100>2?"12":o[6]*100>1?"11.5":"11")+"rem"),lt(e,"width","100%"),lt(e,"text-align","center")},m(n,r){U(n,e,r),k(e,t)},p(n,r){r[0]&8&&Ne(t,n[3]),r[0]&64&&lt(e,"font-size",(n[6]*100>4?"13":n[6]*100>2?"12":n[6]*100>1?"11.5":"11")+"rem")},d(n){n&&p(e)}}}function b2(o){let e,t;return e=new Gt({props:{content:o[11].t("Camera"),$$slots:{default:[v2]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&2048&&(i.content=n[11].t("Camera")),r[2]&16&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function y2(o){let e,t;return e=new c2({props:{devices:o[8],$$slots:{default:[w2]},$$scope:{ctx:o}}}),e.$on("change",o[29]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&256&&(i.devices=n[8]),r[2]&16&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function v2(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"></path></svg>',n,r;return{c(){e=M("button"),e.innerHTML=t,this.h()},l(i){e=P(i,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),wt(e)!=="svelte-1n1gs9g"&&(e.innerHTML=t),this.h()},h(){g(e,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),g(e,"type","button")},m(i,a){U(i,e,a),n||(r=Ie(e,"click",o[30]),n=!0)},p:Re,d(i){i&&p(e),n=!1,r()}}}function w2(o){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z" clip-rule="evenodd"></path></svg>';return{c(){e=M("button"),e.innerHTML=t,this.h()},l(n){e=P(n,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),wt(e)!=="svelte-5e0pue"&&(e.innerHTML=t),this.h()},h(){g(e,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),g(e,"type","button")},m(n,r){U(n,e,r)},p:Re,d(n){n&&p(e)}}}function k2(o){let e=o[11].t("Listening...")+"",t;return{c(){t=Se(e)},l(n){t=Ae(n,e)},m(n,r){U(n,t,r)},p(n,r){r[0]&2048&&e!==(e=n[11].t("Listening...")+"")&&Ne(t,e)},d(n){n&&p(t)}}}function C2(o){let e=o[11].t("Tap to interrupt")+"",t;return{c(){t=Se(e)},l(n){t=Ae(n,e)},m(n,r){U(n,t,r)},p(n,r){r[0]&2048&&e!==(e=n[11].t("Tap to interrupt")+"")&&Ne(t,e)},d(n){n&&p(t)}}}function E2(o){let e=o[11].t("Thinking...")+"",t;return{c(){t=Se(e)},l(n){t=Ae(n,e)},m(n,r){U(n,t,r)},p(n,r){r[0]&2048&&e!==(e=n[11].t("Thinking...")+"")&&Ne(t,e)},d(n){n&&p(t)}}}function I2(o){let e,t,n=o[10]&&Hd(o);return{c(){n&&n.c(),e=je()},l(r){n&&n.l(r),e=je()},m(r,i){n&&n.m(r,i),U(r,e,i),t=!0},p(r,i){r[10]?n?(n.p(r,i),i[0]&1024&&T(n,1)):(n=Hd(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Le(),D(n,1,1,()=>{n=null}),Ue())},i(r){t||(T(n),t=!0)},o(r){D(n),t=!1},d(r){r&&p(e),n&&n.d(r)}}}function T2(o,e,t){let n,r,i,a,s,l;de(o,Tr,he=>t(45,n=he)),de(o,Ci,he=>t(46,r=he)),de(o,zo,he=>t(47,i=he)),de(o,pa,he=>t(48,a=he)),de(o,jn,he=>t(10,s=he));const c=Pn(),u=on("i18n");de(o,u,he=>t(11,l=he));let{eventTarget:d}=e,{submitPrompt:f}=e,{stopResponse:h}=e,{files:_}=e,{chatId:y}=e,{modelId:v}=e,m=null,b=null,w=!1,C=!1,O=!1,S=null,E=!1,H=null,R=!1,L=0,F=!1,q,W=null,A=[],V=[],N=null;const G=async()=>{const he=await navigator.mediaDevices.enumerateDevices();t(8,V=he.filter(qe=>qe.kind==="videoinput")),navigator.mediaDevices.getDisplayMedia&&t(8,V=[...V,{deviceId:"screen",label:"Screen Share"}]),console.log(V),N===null&&V.length>0&&t(9,N=V[0].deviceId)},X=async()=>{if(await G(),H===null){t(4,E=!0),await rt();try{await Q()}catch(he){console.error("Error accessing webcam: ",he)}}},Q=async()=>{const he=document.getElementById("camera-feed");he&&(N==="screen"?t(5,H=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1})):t(5,H=await navigator.mediaDevices.getUserMedia({video:{deviceId:N?{exact:N}:void 0}})),H&&(await G(),he.srcObject=H,await he.play()))},j=async()=>{H&&H.getTracks().forEach(qe=>qe.stop()),t(5,H=null)},ue=()=>{const he=document.getElementById("camera-feed"),qe=document.getElementById("camera-canvas");if(!qe)return;const Oe=qe.getContext("2d");qe.width=he.videoWidth,qe.height=he.videoHeight,Oe.drawImage(he,0,0,he.videoWidth,he.videoHeight);const $e=qe.toDataURL("image/png");return console.log($e),$e},B=async()=>{await j(),t(4,E=!1)},x=-55,J=async he=>{await rt();const qe=fm(he,"recording.wav"),Oe=await vp(localStorage.token,qe).catch($e=>(at.error(`${$e}`),null));if(Oe&&(console.log(Oe.text),Oe.text!=="")){const $e=await f(Oe.text,{_raw:!0});console.log($e)}},ce=async(he=!0)=>{if(s){console.log("%c%s","color: red; font-size: 20px;","🚨 stopRecordingCallback 🚨");const qe=A.slice(0);if(A=[],q=!1,he&&me(),C){if(t(1,w=!0),t(3,S=null),H){const $e=ue();t(20,_=[{type:"image",url:$e}])}const Oe=new Blob(qe,{type:"audio/wav"});await J(Oe),C=!1,t(1,w=!1)}}else A=[],q=!1,W&&W.getTracks().forEach(Oe=>Oe.stop()),t(7,W=null)},me=async()=>{s&&(W||t(7,W=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})),q=new MediaRecorder(W),q.onstart=()=>{console.log("Recording started"),A=[]},q.ondataavailable=he=>{F&&A.push(he.data)},q.onstop=he=>{console.log("Recording stopped",W,he),ce()},He(W))},se=async()=>{try{q&&q.stop()}catch(he){console.log("Error stopping audio stream:",he)}W&&(W.getAudioTracks().forEach(function(he){he.stop()}),t(7,W=null))},Be=he=>{let qe=0;for(let Oe=0;Oe<he.length;Oe++){const $e=(he[Oe]-128)/128;qe+=$e*$e}return Math.sqrt(qe/he.length)},He=he=>{const qe=new AudioContext,Oe=qe.createMediaStreamSource(he),$e=qe.createAnalyser();$e.minDecibels=x,Oe.connect($e);const It=$e.frequencyBinCount,kt=new Uint8Array(It),Rt=new Uint8Array($e.fftSize);let pt=Date.now();F=!1,console.log("🔊 Sound detection started",pt,F),(()=>{const sn=()=>{if(!q||!s)return;if(O&&!((i==null?void 0:i.voiceInterruption)??!1)?($e.maxDecibels=0,$e.minDecibels=-1):($e.minDecibels=x,$e.maxDecibels=-30),$e.getByteTimeDomainData(Rt),$e.getByteFrequencyData(kt),t(6,L=Be(Rt)),kt.some(qt=>qt>0)&&(console.log("%c%s","color: red; font-size: 20px;","🔊 Sound detected"),q&&q.state!=="recording"&&q.start(),F||(F=!0,xe()),pt=Date.now()),F&&Date.now()-pt>2e3&&(C=!0,q)){console.log("%c%s","color: red; font-size: 20px;","🔇 Silence detected"),q.stop();return}window.requestAnimationFrame(sn)};window.requestAnimationFrame(sn)})()};let Y={},Xe=null,Ke=null;const mt=he=>s?new Promise(qe=>{let Oe=[];const $e=setInterval(async()=>{var It,kt,Rt;if(Oe=await speechSynthesis.getVoices(),Oe.length>0){clearInterval($e);const pt=((It=Oe==null?void 0:Oe.filter(dn=>{var sn,Jt,qt,fn;return dn.voiceURI===(((Jt=(sn=i==null?void 0:i.audio)==null?void 0:sn.tts)==null?void 0:Jt.voice)??((fn=(qt=r==null?void 0:r.audio)==null?void 0:qt.tts)==null?void 0:fn.voice))}))==null?void 0:It.at(0))??void 0;Ke=new SpeechSynthesisUtterance(he),Ke.rate=((Rt=(kt=i.audio)==null?void 0:kt.tts)==null?void 0:Rt.playbackRate)??1,pt&&(Ke.voice=pt),speechSynthesis.speak(Ke),Ke.onend=async dn=>{await new Promise(sn=>setTimeout(sn,200)),qe(dn)}}},100)}):Promise.resolve(),fe=he=>s?new Promise(qe=>{var $e,It;const Oe=document.getElementById("audioElement");Oe&&(Oe.src=he.src,Oe.muted=!0,Oe.playbackRate=((It=($e=i.audio)==null?void 0:$e.tts)==null?void 0:It.playbackRate)??1,Oe.play().then(()=>{Oe.muted=!1}).catch(kt=>{console.error(kt)}),Oe.onended=async kt=>{await new Promise(Rt=>setTimeout(Rt,100)),qe(kt)})}):Promise.resolve(),xe=async()=>{t(2,O=!1),R&&h(),Ke&&(speechSynthesis.cancel(),Ke=null);const he=document.getElementById("audioElement");he&&(he.muted=!0,he.pause(),he.currentTime=0)};let gt=new AbortController;const Et=new Map,Bt=new Map,Xt=async he=>{var qe,Oe,$e,It,kt,Rt,pt,dn,sn,Jt,qt,fn,bn,Cn;if(!Et.has(he))try{if((i==null?void 0:i.showEmojiInCall)??!1){const xt=await Om(localStorage.token,v,he,y);xt&&Bt.set(he,xt)}if(((Oe=(qe=i.audio)==null?void 0:qe.tts)==null?void 0:Oe.engine)==="browser-kokoro"){const xt=await a.generate({text:he,voice:((It=($e=i==null?void 0:i.audio)==null?void 0:$e.tts)==null?void 0:It.voice)??((Rt=(kt=r==null?void 0:r.audio)==null?void 0:kt.tts)==null?void 0:Rt.voice)}).catch(Ht=>{console.error(Ht),at.error(`${Ht}`)});xt&&Et.set(he,new Audio(xt))}else if(r.audio.tts.engine!==""){const xt=await yp(localStorage.token,((dn=(pt=i==null?void 0:i.audio)==null?void 0:pt.tts)==null?void 0:dn.defaultVoice)===r.audio.tts.voice?((Jt=(sn=i==null?void 0:i.audio)==null?void 0:sn.tts)==null?void 0:Jt.voice)??((fn=(qt=r==null?void 0:r.audio)==null?void 0:qt.tts)==null?void 0:fn.voice):(Cn=(bn=r==null?void 0:r.audio)==null?void 0:bn.tts)==null?void 0:Cn.voice,he).catch(Ht=>(console.error(Ht),null));if(xt){const Ht=await xt.blob(),xn=URL.createObjectURL(Ht);Et.set(he,new Audio(xn))}}else Et.set(he,!0)}catch(xt){console.error("Error synthesizing speech:",xt)}return Et.get(he)};let Ot={};const rn=async(he,qe)=>{for(;!qe.aborted;)if(Ot[he]&&Ot[he].length>0){const Oe=Ot[he].shift();if(Et.has(Oe))if(((i==null?void 0:i.showEmojiInCall)??!1)&&Bt.has(Oe)?t(3,S=Bt.get(Oe)):t(3,S=null),r.audio.tts.engine!=="")try{console.log("%c%s","color: red; font-size: 20px;",`Playing audio for content: ${Oe}`);const $e=Et.get(Oe);await fe($e),console.log(`Played audio for content: ${Oe}`),await new Promise(It=>setTimeout(It,200))}catch($e){console.error("Error playing audio:",$e)}else await mt(Oe);else Ot[he].unshift(Oe),console.log(`Audio for "${Oe}" not yet available in the cache, re-queued...`),await new Promise($e=>setTimeout($e,200))}else if(Y[he]&&Ot[he]&&Ot[he].length===0){t(2,O=!1);break}else await new Promise(Oe=>setTimeout(Oe,200));console.log(`Audio monitoring and playing stopped for message ID ${he}`)},Wt=async he=>{const{id:qe}=he.detail;R=!0,Xe!==qe&&(console.log(`Received chat start event for message ID ${qe}`),Xe=qe,gt&&gt.abort(),gt=new AbortController,t(2,O=!0),rn(qe,gt.signal))},Nt=async he=>{const{id:qe,content:Oe}=he.detail;if(Xe===qe){console.log(`Received chat event for message ID ${qe}: ${Oe}`);try{Ot[qe]===void 0?Ot[qe]=[Oe]:Ot[qe].push(Oe),console.log(Oe),Xt(Oe)}catch($e){console.error("Failed to fetch or play audio:",$e)}}},tn=async he=>{const{id:qe,content:Oe}=he.detail;Y[qe]=!0,R=!1};Jn(async()=>{const he=async()=>{try{m=await navigator.wakeLock.request("screen")}catch(qe){console.log(qe)}m&&m.addEventListener("release",()=>{console.log("Wake Lock released")})};return"wakeLock"in navigator&&(await he(),document.addEventListener("visibilitychange",async()=>{m!==null&&document.visibilityState==="visible"&&await he()})),t(0,b=n.find(qe=>qe.id===v)),me(),d.addEventListener("chat:start",Wt),d.addEventListener("chat",Nt),d.addEventListener("chat:finish",tn),async()=>{await xe(),se(),d.removeEventListener("chat:start",Wt),d.removeEventListener("chat",Nt),d.removeEventListener("chat:finish",tn),gt.abort(),await rt(),await xe(),await ce(!1),await B()}}),Qo(async()=>{await xe(),await ce(!1),await B(),await se(),d.removeEventListener("chat:start",Wt),d.removeEventListener("chat",Nt),d.removeEventListener("chat:finish",tn),gt.abort(),await rt(),await xe()});const ie=()=>{O&&xe()},Ge=()=>{O&&xe()},nt=()=>{B()},vt=async he=>{console.log(he.detail),t(9,N=he.detail),await j(),await Q()},Me=async()=>{await navigator.mediaDevices.getUserMedia({video:!0}),X()},Yt=()=>{O&&xe()},Tt=async()=>{await se(),await j(),console.log(W),console.log(H),jn.set(!1),c("close")};return o.$$set=he=>{"eventTarget"in he&&t(21,d=he.eventTarget),"submitPrompt"in he&&t(22,f=he.submitPrompt),"stopResponse"in he&&t(23,h=he.stopResponse),"files"in he&&t(20,_=he.files),"chatId"in he&&t(24,y=he.chatId),"modelId"in he&&t(25,v=he.modelId)},[b,w,O,S,E,H,L,W,V,N,s,l,c,u,X,Q,j,B,se,xe,_,d,f,h,y,v,ie,Ge,nt,vt,Me,Yt,Tt]}class Lg extends Ve{constructor(e){super(),Fe(this,e,T2,I2,Qe,{eventTarget:21,submitPrompt:22,stopResponse:23,files:20,chatId:24,modelId:25},null,[-1,-1,-1])}}function S2(o){var C,O,S,E,H,R,L,F,q,W;let e,t,n,r,i,a,s=(((O=(C=o[0])==null?void 0:C.model)==null?void 0:O.name)??((E=(S=o[0])==null?void 0:S.message)==null?void 0:E.model)??"Assistant")+"",l,c,u,d,f,h,_,y,v;t=new sf({props:{src:((F=(L=(R=(H=o[0])==null?void 0:H.model)==null?void 0:R.info)==null?void 0:L.meta)==null?void 0:F.profile_image_url)??"",className:"size-5 -translate-y-[1px]"}}),d=new bp({props:{className:"size-3 "+((W=(q=o[0])==null?void 0:q.message)!=null&&W.favorite?"fill-red-500 stroke-red-500":"hover:fill-red-500 hover:stroke-red-500")+" ",strokeWidth:"2.5"}});function m(A,V){var N,G;return(G=(N=A[0])==null?void 0:N.message)!=null&&G.error?M2:R2}let b=m(o),w=b(o);return{c(){e=M("div"),te(t.$$.fragment),n=$(),r=M("div"),i=M("div"),a=M("div"),l=Se(s),c=$(),u=M("button"),te(d.$$.fragment),h=$(),w.c(),this.h()},l(A){e=P(A,"DIV",{class:!0});var V=I(e);re(t.$$.fragment,V),n=ee(V),r=P(V,"DIV",{class:!0});var N=I(r);i=P(N,"DIV",{class:!0});var G=I(i);a=P(G,"DIV",{class:!0});var X=I(a);l=Ae(X,s),X.forEach(p),c=ee(G),u=P(G,"BUTTON",{class:!0});var Q=I(u);re(d.$$.fragment,Q),Q.forEach(p),G.forEach(p),h=ee(N),w.l(N),N.forEach(p),V.forEach(p),this.h()},h(){var A,V;g(a,"class","text-xs text-black dark:text-white font-medium line-clamp-1"),g(u,"class",f=(V=(A=o[0])==null?void 0:A.message)!=null&&V.favorite?"":"invisible group-hover:visible"),g(i,"class","flex justify-between items-center"),g(r,"class","ml-2"),g(e,"class","flex w-full")},m(A,V){U(A,e,V),ne(t,e,null),k(e,n),k(e,r),k(r,i),k(i,a),k(a,l),k(i,c),k(i,u),ne(d,u,null),k(r,h),w.m(r,null),_=!0,y||(v=Ie(u,"click",o[1]),y=!0)},p(A,V){var X,Q,j,ue,B,x,J,ce,me,se,Be,He;const N={};V&1&&(N.src=((ue=(j=(Q=(X=A[0])==null?void 0:X.model)==null?void 0:Q.info)==null?void 0:j.meta)==null?void 0:ue.profile_image_url)??""),t.$set(N),(!_||V&1)&&s!==(s=(((x=(B=A[0])==null?void 0:B.model)==null?void 0:x.name)??((ce=(J=A[0])==null?void 0:J.message)==null?void 0:ce.model)??"Assistant")+"")&&Ne(l,s);const G={};V&1&&(G.className="size-3 "+((se=(me=A[0])==null?void 0:me.message)!=null&&se.favorite?"fill-red-500 stroke-red-500":"hover:fill-red-500 hover:stroke-red-500")+" "),d.$set(G),(!_||V&1&&f!==(f=(He=(Be=A[0])==null?void 0:Be.message)!=null&&He.favorite?"":"invisible group-hover:visible"))&&g(u,"class",f),b===(b=m(A))&&w?w.p(A,V):(w.d(1),w=b(A),w&&(w.c(),w.m(r,null)))},i(A){_||(T(t.$$.fragment,A),T(d.$$.fragment,A),_=!0)},o(A){D(t.$$.fragment,A),D(d.$$.fragment,A),_=!1},d(A){A&&p(e),oe(t),oe(d),w.d(),y=!1,v()}}}function A2(o){var _,y,v;let e,t,n,r,i,a,s=(((y=(_=o[0])==null?void 0:_.user)==null?void 0:y.name)??"User")+"",l,c,u;t=new sf({props:{src:((v=o[0].user)==null?void 0:v.profile_image_url)??"/user.png",className:"size-5 -translate-y-[1px]"}});function d(m,b){var w,C;return(C=(w=m[0])==null?void 0:w.message)!=null&&C.error?O2:P2}let f=d(o),h=f(o);return{c(){e=M("div"),te(t.$$.fragment),n=$(),r=M("div"),i=M("div"),a=M("div"),l=Se(s),c=$(),h.c(),this.h()},l(m){e=P(m,"DIV",{class:!0});var b=I(e);re(t.$$.fragment,b),n=ee(b),r=P(b,"DIV",{class:!0});var w=I(r);i=P(w,"DIV",{class:!0});var C=I(i);a=P(C,"DIV",{class:!0});var O=I(a);l=Ae(O,s),O.forEach(p),C.forEach(p),c=ee(w),h.l(w),w.forEach(p),b.forEach(p),this.h()},h(){g(a,"class","text-xs text-black dark:text-white font-medium line-clamp-1"),g(i,"class","flex justify-between items-center"),g(r,"class","ml-2"),g(e,"class","flex w-full")},m(m,b){U(m,e,b),ne(t,e,null),k(e,n),k(e,r),k(r,i),k(i,a),k(a,l),k(r,c),h.m(r,null),u=!0},p(m,b){var C,O,S;const w={};b&1&&(w.src=((C=m[0].user)==null?void 0:C.profile_image_url)??"/user.png"),t.$set(w),(!u||b&1)&&s!==(s=(((S=(O=m[0])==null?void 0:O.user)==null?void 0:S.name)??"User")+"")&&Ne(l,s),f===(f=d(m))&&h?h.p(m,b):(h.d(1),h=f(m),h&&(h.c(),h.m(r,null)))},i(m){u||(T(t.$$.fragment,m),u=!0)},o(m){D(t.$$.fragment,m),u=!1},d(m){m&&p(e),oe(t),h.d()}}}function R2(o){let e,t=o[0].message.content+"",n;return{c(){e=M("div"),n=Se(t),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);n=Ae(i,t),i.forEach(p),this.h()},h(){g(e,"class","text-gray-500 line-clamp-2 text-xs mt-0.5")},m(r,i){U(r,e,i),k(e,n)},p(r,i){i&1&&t!==(t=r[0].message.content+"")&&Ne(n,t)},d(r){r&&p(e)}}}function M2(o){let e,t=o[0].message.error.content+"",n;return{c(){e=M("div"),n=Se(t),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);n=Ae(i,t),i.forEach(p),this.h()},h(){g(e,"class","text-red-500 line-clamp-2 text-xs mt-0.5")},m(r,i){U(r,e,i),k(e,n)},p(r,i){i&1&&t!==(t=r[0].message.error.content+"")&&Ne(n,t)},d(r){r&&p(e)}}}function P2(o){let e,t=o[0].message.content+"",n;return{c(){e=M("div"),n=Se(t),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);n=Ae(i,t),i.forEach(p),this.h()},h(){g(e,"class","text-gray-500 line-clamp-2 text-xs mt-0.5")},m(r,i){U(r,e,i),k(e,n)},p(r,i){i&1&&t!==(t=r[0].message.content+"")&&Ne(n,t)},d(r){r&&p(e)}}}function O2(o){let e,t=o[0].message.error.content+"",n;return{c(){e=M("div"),n=Se(t),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);n=Ae(i,t),i.forEach(p),this.h()},h(){g(e,"class","text-red-500 line-clamp-2 text-xs mt-0.5")},m(r,i){U(r,e,i),k(e,n)},p(r,i){i&1&&t!==(t=r[0].message.error.content+"")&&Ne(n,t)},d(r){r&&p(e)}}}function N2(o){let e,t,n,r;const i=[A2,S2],a=[];function s(l,c){return l[0].message.role==="user"?0:1}return e=s(o),t=a[e]=i[e](o),{c(){t.c(),n=je()},l(l){t.l(l),n=je()},m(l,c){a[e].m(l,c),U(l,n,c),r=!0},p(l,c){let u=e;e=s(l),e===u?a[e].p(l,c):(Le(),D(a[u],1,1,()=>{a[u]=null}),Ue(),t=a[e],t?t.p(l,c):(t=a[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){D(t),r=!1},d(l){l&&p(n),a[e].d(l)}}}function D2(o){var l,c;let e,t,n,r,i,a,s;return t=new Gt({props:{content:(c=(l=o[0])==null?void 0:l.message)!=null&&c.error?o[0].message.error.content:o[0].message.content,class:"w-full",allowHTML:!1,$$slots:{default:[N2]},$$scope:{ctx:o}}}),r=new Xr({props:{type:"target",position:ht.Top,class:"w-2 rounded-full dark:bg-gray-900"}}),a=new Xr({props:{type:"source",position:ht.Bottom,class:"w-2 rounded-full dark:bg-gray-900"}}),{c(){e=M("div"),te(t.$$.fragment),n=$(),te(r.$$.fragment),i=$(),te(a.$$.fragment),this.h()},l(u){e=P(u,"DIV",{class:!0});var d=I(e);re(t.$$.fragment,d),n=ee(d),re(r.$$.fragment,d),i=ee(d),re(a.$$.fragment,d),d.forEach(p),this.h()},h(){g(e,"class","px-4 py-3 shadow-md rounded-xl dark:bg-black bg-white border dark:border-gray-900 w-60 h-20 group")},m(u,d){U(u,e,d),ne(t,e,null),k(e,n),ne(r,e,null),k(e,i),ne(a,e,null),s=!0},p(u,[d]){var h,_;const f={};d&1&&(f.content=(_=(h=u[0])==null?void 0:h.message)!=null&&_.error?u[0].message.error.content:u[0].message.content),d&5&&(f.$$scope={dirty:d,ctx:u}),t.$set(f)},i(u){s||(T(t.$$.fragment,u),T(r.$$.fragment,u),T(a.$$.fragment,u),s=!0)},o(u){D(t.$$.fragment,u),D(r.$$.fragment,u),D(a.$$.fragment,u),s=!1},d(u){u&&p(e),oe(t),oe(r),oe(a)}}}function H2(o,e,t){let{data:n}=e;const r=()=>{var i;t(0,n.message.favorite=!(((i=n==null?void 0:n.message)==null?void 0:i.favorite)??!1),n)};return o.$$set=i=>{"data"in i&&t(0,n=i.data)},[n,r]}class L2 extends Ve{constructor(e){super(),Fe(this,e,H2,D2,Qe,{data:0})}}function U2(o){let e,t,n,r;return e=new IE({props:{showLock:!1}}),n=new UE({props:{variant:Yo.Dots}}),{c(){te(e.$$.fragment),t=$(),te(n.$$.fragment)},l(i){re(e.$$.fragment,i),t=ee(i),re(n.$$.fragment,i)},m(i,a){ne(e,i,a),U(i,t,a),ne(n,i,a),r=!0},p:Re,i(i){r||(T(e.$$.fragment,i),T(n.$$.fragment,i),r=!0)},o(i){D(e.$$.fragment,i),D(n.$$.fragment,i),r=!1},d(i){i&&p(t),oe(e,i),oe(n,i)}}}function B2(o){let e,t;return e=new xC({props:{nodes:o[0],nodeTypes:o[1],edges:o[2],fitView:!0,minZoom:.001,colorMode:o[3].includes("dark")||o[3]==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",nodesConnectable:!1,nodesDraggable:!1,oninit:o[5],$$slots:{default:[U2]},$$scope:{ctx:o}}}),e.$on("nodeclick",o[6]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,[r]){const i={};r&1&&(i.nodes=n[0]),r&2&&(i.nodeTypes=n[1]),r&4&&(i.edges=n[2]),r&8&&(i.colorMode=n[3].includes("dark")||n[3]==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),r&128&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function z2(o,e,t){let n;de(o,em,u=>t(3,n=u));const r=Pn();let{nodes:i}=e,{nodeTypes:a}=e,{edges:s}=e;const l=()=>{console.log("Flow initialized")},c=u=>r("nodeclick",u.detail);return o.$$set=u=>{"nodes"in u&&t(0,i=u.nodes),"nodeTypes"in u&&t(1,a=u.nodeTypes),"edges"in u&&t(2,s=u.edges)},[i,a,s,n,r,l,c]}class V2 extends Ve{constructor(e){super(),Fe(this,e,z2,B2,Qe,{nodes:0,nodeTypes:1,edges:2})}}function F2(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var r=I(e);t=ye(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(n,r){U(n,e,r),k(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Re,o:Re,d(n){n&&p(e)}}}function K2(o,e,t){let{className:n="size-4"}=e,{strokeWidth:r="1.5"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class Ug extends Ve{constructor(e){super(),Fe(this,e,K2,F2,Qe,{className:0,strokeWidth:1})}}function Ud(o){let e,t;return e=new V2({props:{nodes:o[6],nodeTypes:o[8],edges:o[7]}}),e.$on("nodeclick",o[12]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p:Re,i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function G2(o){let e,t,n,r,i,a,s,l=o[1].t("Chat Overview")+"",c,u,d,f,h,_,y,v;i=new Ug({props:{className:"size-3.5"}}),f=new Os({props:{className:"size-3.5"}});let m=o[2].length>0&&Ud(o);return{c(){e=M("div"),t=M("div"),n=M("div"),r=M("button"),te(i.$$.fragment),a=$(),s=M("div"),c=Se(l),u=$(),d=M("button"),te(f.$$.fragment),h=$(),m&&m.c(),this.h()},l(b){e=P(b,"DIV",{class:!0});var w=I(e);t=P(w,"DIV",{class:!0});var C=I(t);n=P(C,"DIV",{class:!0});var O=I(n);r=P(O,"BUTTON",{class:!0});var S=I(r);re(i.$$.fragment,S),S.forEach(p),a=ee(O),s=P(O,"DIV",{class:!0});var E=I(s);c=Ae(E,l),E.forEach(p),O.forEach(p),u=ee(C),d=P(C,"BUTTON",{class:!0});var H=I(d);re(f.$$.fragment,H),H.forEach(p),C.forEach(p),h=ee(w),m&&m.l(w),w.forEach(p),this.h()},h(){g(r,"class","self-center p-0.5"),g(s,"class","text-lg font-medium self-center font-primary"),g(n,"class","flex items-center gap-2.5"),g(d,"class","self-center p-0.5"),g(t,"class","absolute z-50 w-full flex justify-between dark:text-gray-100 px-4 py-3.5"),g(e,"class","w-full h-full relative")},m(b,w){U(b,e,w),k(e,t),k(t,n),k(n,r),ne(i,r,null),k(n,a),k(n,s),k(s,c),k(t,u),k(t,d),ne(f,d,null),k(e,h),m&&m.m(e,null),_=!0,y||(v=[Ie(r,"click",o[10]),Ie(d,"click",o[11])],y=!0)},p(b,[w]){(!_||w&2)&&l!==(l=b[1].t("Chat Overview")+"")&&Ne(c,l),b[2].length>0?m?(m.p(b,w),w&4&&T(m,1)):(m=Ud(b),m.c(),T(m,1),m.m(e,null)):m&&(Le(),D(m,1,1,()=>{m=null}),Ue())},i(b){_||(T(i.$$.fragment,b),T(f.$$.fragment,b),T(m),_=!0)},o(b){D(i.$$.fragment,b),D(f.$$.fragment,b),D(m),_=!1},d(b){b&&p(e),oe(i),oe(f),m&&m.d(),y=!1,kn(v)}}}function W2(o,e,t){let n,r,i,a;de(o,Tr,R=>t(13,n=R)),de(o,Xo,R=>t(14,r=R));const s=Pn(),l=on("i18n");de(o,l,R=>t(1,i=R));const{width:c,height:u}=ln(),{fitView:d,getViewport:f}=BE(),h=zE();let{history:_}=e,y=null;const v=ot([]);de(o,v,R=>t(2,a=R));const m=ot([]),b={custom:L2},w=async()=>{y===null?await d({nodes:[{id:_.currentId}]}):await d({nodes:[{id:y}]}),t(0,y=null)},C=async()=>{const R=[],L=[];let W=new Map,A={};Object.keys(_.messages).forEach(V=>{var X;const N=_.messages[V],G=N.parentId?(((X=W.get(N.parentId))==null?void 0:X.level)??-1)+1:0;A[G]||(A[G]=0),W.set(V,{id:N.id,level:G,position:A[G]++})}),Object.keys(_.messages).forEach(V=>{const N=W.get(V),G=N.position*250,X=N.level*150,Q=G;R.push({id:N.id,type:"custom",data:{user:r,message:_.messages[V],model:n.find(ue=>ue.id===_.messages[V].model)},position:{x:Q,y:X}});const j=_.messages[V].parentId;j&&L.push({id:j+"-"+N.id,source:j,target:N.id,selectable:!1,class:" dark:fill-gray-300 fill-gray-300",type:"smoothstep",animated:_.currentId===V||O(V,_.currentId)})}),await m.set([...L]),await v.set([...R])},O=(R,L)=>{const F=_.messages[R];return F.childrenIds&&F.childrenIds.some(q=>q===L||O(q,L))};Jn(()=>{C(),h.subscribe(async R=>{R&&(await rt(),await d({nodes:[{id:_.currentId}]}))}),c.subscribe(R=>{R&&d({nodes:[{id:_.currentId}]})}),u.subscribe(R=>{R&&d({nodes:[{id:_.currentId}]})})}),Qo(()=>{console.log("Overview destroyed"),v.set([]),m.set([])});const S=()=>{Fo.set(!1)},E=()=>{s("close"),Fo.set(!1)},H=R=>{console.log(R.detail.node.data),s("nodeclick",R.detail),t(0,y=R.detail.node.data.message.id),d({nodes:[{id:y}]})};return o.$$set=R=>{"history"in R&&t(9,_=R.history)},o.$$.update=()=>{o.$$.dirty&512&&_&&C(),o.$$.dirty&512&&_&&_.currentId&&w()},[y,i,a,s,l,d,v,m,b,_,S,E,H]}class Bg extends Ve{constructor(e){super(),Fe(this,e,W2,G2,Qe,{history:9})}}function Y2(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var r=I(e);t=ye(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(n,r){U(n,e,r),k(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Re,o:Re,d(n){n&&p(e)}}}function q2(o,e,t){let{className:n="size-4"}=e,{strokeWidth:r="1.5"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class j2 extends Ve{constructor(e){super(),Fe(this,e,q2,Y2,Qe,{className:0,strokeWidth:1})}}function Bd(o){let e;return{c(){e=M("div"),this.h()},l(t){e=P(t,"DIV",{class:!0}),I(e).forEach(p),this.h()},h(){g(e,"class","absolute top-0 left-0 right-0 bottom-0 z-10")},m(t,n){U(t,e,n)},d(t){t&&p(e)}}}function Q2(o){let e,t=o[5].t("No HTML, CSS, or JavaScript content found.")+"",n;return{c(){e=M("div"),n=Se(t),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);n=Ae(i,t),i.forEach(p),this.h()},h(){g(e,"class","m-auto font-medium text-xs text-gray-900 dark:text-white")},m(r,i){U(r,e,i),k(e,n)},p(r,i){i&32&&t!==(t=r[5].t("No HTML, CSS, or JavaScript content found.")+"")&&Ne(n,t)},i:Re,o:Re,d(r){r&&p(e)}}}function X2(o){let e,t,n,r;const i=[x2,J2],a=[];function s(l,c){return l[1][l[2]].type==="iframe"?0:l[1][l[2]].type==="svg"?1:-1}return~(t=s(o))&&(n=a[t]=i[t](o)),{c(){e=M("div"),n&&n.c(),this.h()},l(l){e=P(l,"DIV",{class:!0});var c=I(e);n&&n.l(c),c.forEach(p),this.h()},h(){g(e,"class","max-w-full w-full h-full")},m(l,c){U(l,e,c),~t&&a[t].m(e,null),r=!0},p(l,c){let u=t;t=s(l),t===u?~t&&a[t].p(l,c):(n&&(Le(),D(a[u],1,1,()=>{a[u]=null}),Ue()),~t?(n=a[t],n?n.p(l,c):(n=a[t]=i[t](l),n.c()),T(n,1),n.m(e,null)):n=null)},i(l){r||(T(n),r=!0)},o(l){D(n),r=!1},d(l){l&&p(e),~t&&a[t].d()}}}function J2(o){let e,t;return e=new ep({props:{className:" w-full h-full max-h-full overflow-hidden",svg:o[1][o[2]].content}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&6&&(i.svg=n[1][n[2]].content),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function x2(o){let e,t,n,r;return{c(){e=M("iframe"),this.h()},l(i){e=P(i,"IFRAME",{title:!0,srcdoc:!0,class:!0,sandbox:!0}),I(e).forEach(p),this.h()},h(){g(e,"title","Content"),g(e,"srcdoc",t=o[1][o[2]].content),g(e,"class","w-full border-0 h-full rounded-none"),g(e,"sandbox","allow-scripts allow-forms allow-same-origin")},m(i,a){U(i,e,a),o[14](e),n||(r=Ie(e,"load",o[9]),n=!0)},p(i,a){a&6&&t!==(t=i[1][i[2]].content)&&g(e,"srcdoc",t)},i:Re,o:Re,d(i){i&&p(e),o[14](null),n=!1,r()}}}function zd(o){let e,t,n,r,i,a,s,l,c,u=o[5].t("Version {{selectedVersion}} of {{totalVersions}}",{selectedVersion:o[2]+1,totalVersions:o[1].length})+"",d,f,h,_,y,v,m,b,w,C=(o[3]?o[5].t("Copied"):o[5].t("Copy"))+"",O,S,E,H,R,L=o[1][o[2]].type==="iframe"&&Vd(o);return{c(){e=M("div"),t=M("div"),n=M("div"),r=M("button"),i=be("svg"),a=be("path"),l=$(),c=M("div"),d=Se(u),f=$(),h=M("button"),_=be("svg"),y=be("path"),m=$(),b=M("div"),w=M("button"),O=Se(C),S=$(),L&&L.c(),this.h()},l(F){e=P(F,"DIV",{class:!0});var q=I(e);t=P(q,"DIV",{class:!0});var W=I(t);n=P(W,"DIV",{class:!0,dir:!0});var A=I(n);r=P(A,"BUTTON",{class:!0});var V=I(r);i=ye(V,"svg",{xmlns:!0,fill:!0,viewBox:!0,stroke:!0,"stroke-width":!0,class:!0});var N=I(i);a=ye(N,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),I(a).forEach(p),N.forEach(p),V.forEach(p),l=ee(A),c=P(A,"DIV",{class:!0});var G=I(c);d=Ae(G,u),G.forEach(p),f=ee(A),h=P(A,"BUTTON",{class:!0});var X=I(h);_=ye(X,"svg",{xmlns:!0,fill:!0,viewBox:!0,stroke:!0,"stroke-width":!0,class:!0});var Q=I(_);y=ye(Q,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),I(y).forEach(p),Q.forEach(p),X.forEach(p),A.forEach(p),W.forEach(p),m=ee(q),b=P(q,"DIV",{class:!0});var j=I(b);w=P(j,"BUTTON",{class:!0});var ue=I(w);O=Ae(ue,C),ue.forEach(p),S=ee(j),L&&L.l(j),j.forEach(p),q.forEach(p),this.h()},h(){g(a,"stroke-linecap","round"),g(a,"stroke-linejoin","round"),g(a,"d","M15.75 19.5 8.25 12l7.5-7.5"),g(i,"xmlns","http://www.w3.org/2000/svg"),g(i,"fill","none"),g(i,"viewBox","0 0 24 24"),g(i,"stroke","currentColor"),g(i,"stroke-width","2.5"),g(i,"class","size-3.5"),g(r,"class","self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition disabled:cursor-not-allowed"),r.disabled=s=o[1].length<=1,g(c,"class","text-xs self-center dark:text-gray-100 min-w-fit"),g(y,"stroke-linecap","round"),g(y,"stroke-linejoin","round"),g(y,"d","m8.25 4.5 7.5 7.5-7.5 7.5"),g(_,"xmlns","http://www.w3.org/2000/svg"),g(_,"fill","none"),g(_,"viewBox","0 0 24 24"),g(_,"stroke","currentColor"),g(_,"stroke-width","2.5"),g(_,"class","size-3.5"),g(h,"class","self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition disabled:cursor-not-allowed"),h.disabled=v=o[1].length<=1,g(n,"class","flex items-center gap-0.5 self-center min-w-fit"),g(n,"dir","ltr"),g(t,"class","flex items-center space-x-2"),g(w,"class","copy-code-button bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md px-1.5 py-0.5"),g(b,"class","flex items-center gap-1"),g(e,"class","flex justify-between items-center p-2.5 font-primar text-gray-900 dark:text-white")},m(F,q){U(F,e,q),k(e,t),k(t,n),k(n,r),k(r,i),k(i,a),k(n,l),k(n,c),k(c,d),k(n,f),k(n,h),k(h,_),k(_,y),k(e,m),k(e,b),k(b,w),k(w,O),k(b,S),L&&L.m(b,null),E=!0,H||(R=[Ie(r,"click",o[15]),Ie(h,"click",o[16]),Ie(w,"click",o[17])],H=!0)},p(F,q){(!E||q&2&&s!==(s=F[1].length<=1))&&(r.disabled=s),(!E||q&38)&&u!==(u=F[5].t("Version {{selectedVersion}} of {{totalVersions}}",{selectedVersion:F[2]+1,totalVersions:F[1].length})+"")&&Ne(d,u),(!E||q&2&&v!==(v=F[1].length<=1))&&(h.disabled=v),(!E||q&40)&&C!==(C=(F[3]?F[5].t("Copied"):F[5].t("Copy"))+"")&&Ne(O,C),F[1][F[2]].type==="iframe"?L?(L.p(F,q),q&6&&T(L,1)):(L=Vd(F),L.c(),T(L,1),L.m(b,null)):L&&(Le(),D(L,1,1,()=>{L=null}),Ue())},i(F){E||(T(L),E=!0)},o(F){D(L),E=!1},d(F){F&&p(e),L&&L.d(),H=!1,kn(R)}}}function Vd(o){let e,t;return e=new Gt({props:{content:o[5].t("Open in full screen"),$$slots:{default:[Z2]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&32&&(i.content=n[5].t("Open in full screen")),r&1048576&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function Z2(o){let e,t,n,r,i;return t=new j2({props:{className:"size-3.5"}}),{c(){e=M("button"),te(t.$$.fragment),this.h()},l(a){e=P(a,"BUTTON",{class:!0});var s=I(e);re(t.$$.fragment,s),s.forEach(p),this.h()},h(){g(e,"class","bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md p-0.5")},m(a,s){U(a,e,s),ne(t,e,null),n=!0,r||(i=Ie(e,"click",o[10]),r=!0)},p:Re,i(a){n||(T(t.$$.fragment,a),n=!0)},o(a){D(t.$$.fragment,a),n=!1},d(a){a&&p(e),oe(t),r=!1,i()}}}function $2(o){let e,t,n,r,i,a,s,l,c,u,d,f,h,_,y,v,m,b,w,C=o[0]&&Bd();a=new Ug({props:{className:"size-3.5  text-gray-900 dark:text-white"}}),u=new Os({props:{className:"size-3.5 text-gray-900 dark:text-white"}});const O=[X2,Q2],S=[];function E(R,L){return R[1].length>0?0:1}_=E(o),y=S[_]=O[_](o);let H=o[1].length>0&&zd(o);return{c(){e=M("div"),t=M("div"),C&&C.c(),n=$(),r=M("div"),i=M("button"),te(a.$$.fragment),s=$(),l=M("div"),c=M("button"),te(u.$$.fragment),d=$(),f=M("div"),h=M("div"),y.c(),v=$(),H&&H.c(),this.h()},l(R){e=P(R,"DIV",{class:!0});var L=I(e);t=P(L,"DIV",{class:!0});var F=I(t);C&&C.l(F),n=ee(F),r=P(F,"DIV",{class:!0});var q=I(r);i=P(q,"BUTTON",{class:!0});var W=I(i);re(a.$$.fragment,W),W.forEach(p),q.forEach(p),s=ee(F),l=P(F,"DIV",{class:!0});var A=I(l);c=P(A,"BUTTON",{class:!0});var V=I(c);re(u.$$.fragment,V),V.forEach(p),A.forEach(p),d=ee(F),f=P(F,"DIV",{class:!0});var N=I(f);h=P(N,"DIV",{class:!0});var G=I(h);y.l(G),G.forEach(p),N.forEach(p),F.forEach(p),v=ee(L),H&&H.l(L),L.forEach(p),this.h()},h(){g(i,"class","self-center pointer-events-auto p-1 rounded-full bg-white dark:bg-gray-850"),g(r,"class","absolute pointer-events-none z-50 w-full flex items-center justify-start p-4"),g(c,"class","self-center pointer-events-auto p-1 rounded-full bg-white dark:bg-gray-850"),g(l,"class","absolute pointer-events-none z-50 w-full flex items-center justify-end p-4"),g(h,"class","h-full flex flex-col"),g(f,"class","flex-1 w-full h-full"),g(t,"class","w-full h-full flex-1 relative"),g(e,"class","w-full h-full relative flex flex-col bg-gray-50 dark:bg-gray-850")},m(R,L){U(R,e,L),k(e,t),C&&C.m(t,null),k(t,n),k(t,r),k(r,i),ne(a,i,null),k(t,s),k(t,l),k(l,c),ne(u,c,null),k(t,d),k(t,f),k(f,h),S[_].m(h,null),k(e,v),H&&H.m(e,null),m=!0,b||(w=[Ie(i,"click",o[12]),Ie(c,"click",o[13])],b=!0)},p(R,[L]){R[0]?C||(C=Bd(),C.c(),C.m(t,n)):C&&(C.d(1),C=null);let F=_;_=E(R),_===F?S[_].p(R,L):(Le(),D(S[F],1,1,()=>{S[F]=null}),Ue(),y=S[_],y?y.p(R,L):(y=S[_]=O[_](R),y.c()),T(y,1),y.m(h,null)),R[1].length>0?H?(H.p(R,L),L&2&&T(H,1)):(H=zd(R),H.c(),T(H,1),H.m(e,null)):H&&(Le(),D(H,1,1,()=>{H=null}),Ue())},i(R){m||(T(a.$$.fragment,R),T(u.$$.fragment,R),T(y),T(H),m=!0)},o(R){D(a.$$.fragment,R),D(u.$$.fragment,R),D(y),D(H),m=!1},d(R){R&&p(e),C&&C.d(),oe(a),oe(u),S[_].d(),H&&H.d(),b=!1,kn(w)}}}function eI(o,e,t){let n;const r=on("i18n");de(o,r,E=>t(5,n=E));const i=Pn();let{overlay:a=!1}=e,{history:s}=e,l=[],c=[],u=0,d=!1,f;const h=()=>{t(1,c=[]),l.forEach(E=>{if((E==null?void 0:E.role)!=="user"&&(E!=null&&E.content)){const H=E.content.match(/```[\s\S]*?```/g);let R=[];H&&H.forEach(N=>{const G=N.split(`
`)[0].replace("```","").trim().toLowerCase(),X=N.replace(/```[\s\S]*?\n/,"").replace(/```$/,"");R.push({lang:G,code:X})});let L="",F="",q="";R.forEach(N=>{const{lang:G,code:X}=N;G==="html"?L+=X+`
`:G==="css"?F+=X+`
`:(G==="javascript"||G==="js")&&(q+=X+`
`)});const W=E.content.match(/<html>[\s\S]*?<\/html>/gi),A=E.content.match(/<style>[\s\S]*?<\/style>/gi),V=E.content.match(/<script>[\s\S]*?<\/script>/gi);if(W&&W.forEach(N=>{const G=N.replace(/<\/?html>/gi,"");L+=G+`
`}),A&&A.forEach(N=>{const G=N.replace(/<\/?style>/gi,"");F+=G+`
`}),V&&V.forEach(N=>{const G=N.replace(/<\/?script>/gi,"");q+=G+`
`}),L||F||q){const N=`
                        <!DOCTYPE html>
                        <html lang="en">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
							<style>
								body {
									background-color: white; /* Ensure the iframe has a white background */
								}

								${F}
							</style>
                        </head>
                        <body>
                            ${L}

							<script>
                            	${q}
							<\/script>
                        </body>
                        </html>
                    `;t(1,c=[...c,{type:"iframe",content:N}])}else for(const N of R)(N.lang==="svg"||N.lang==="xml"&&N.code.includes("<svg"))&&t(1,c=[...c,{type:"svg",content:N.code}])}}),c.length===0&&(nn.set(!1),Mo.set(!1)),t(2,u=c?c.length-1:0)};function _(E){console.log(u),t(2,u=E==="prev"?Math.max(u-1,0):Math.min(u+1,c.length-1)),console.log(u)}const y=()=>{f.contentWindow.addEventListener("click",function(E){const H=E.target.closest("a");if(H&&H.href){E.preventDefault();const R=new URL(H.href,f.baseURI);R.origin===window.location.origin?f.contentWindow.history.pushState(null,"",R.pathname+R.search+R.hash):console.log("External navigation blocked:",R.href)}},!0),f.contentWindow.addEventListener("mouseenter",function(E){E.preventDefault(),f.contentWindow.addEventListener("dragstart",H=>{H.preventDefault()})})},v=()=>{f.requestFullscreen?f.requestFullscreen():f.webkitRequestFullscreen?f.webkitRequestFullscreen():f.msRequestFullscreen&&f.msRequestFullscreen()};Jn(()=>{});const m=()=>{Mo.set(!1)},b=()=>{i("close"),nn.set(!1),Mo.set(!1)};function w(E){Ye[E?"unshift":"push"](()=>{f=E,t(4,f)})}const C=()=>_("prev"),O=()=>_("next"),S=()=>{Ya(c[u].content),t(3,d=!0),setTimeout(()=>{t(3,d=!1)},2e3)};return o.$$set=E=>{"overlay"in E&&t(0,a=E.overlay),"history"in E&&t(11,s=E.history)},o.$$.update=()=>{o.$$.dirty&2048&&(s?(l=qn(s,s.currentId),h()):(l=[],h()))},[a,c,u,d,f,n,r,i,_,y,v,s,m,b,w,C,O,S]}class zg extends Ve{constructor(e){super(),Fe(this,e,eI,$2,Qe,{overlay:0,history:11})}}function tI(o){let e,t,n,r,i=o[16]&&Fd(o);function a(l){o[37](l)}let s={defaultSize:0,onResize:o[35],onCollapse:o[36],collapsible:!0,class:"pt-8",$$slots:{default:[lI]},$$scope:{ctx:o}};return o[4]!==void 0&&(s.pane=o[4]),t=new Zd({props:s}),Ye.push(()=>tt(t,"pane",a)),{c(){i&&i.c(),e=$(),te(t.$$.fragment)},l(l){i&&i.l(l),e=ee(l),re(t.$$.fragment,l)},m(l,c){i&&i.m(l,c),U(l,e,c),ne(t,l,c),r=!0},p(l,c){l[16]?i?c[0]&65536&&T(i,1):(i=Fd(l),i.c(),T(i,1),i.m(e.parentNode,e)):i&&(Le(),D(i,1,1,()=>{i=null}),Ue());const u={};c[0]&81936&&(u.onResize=l[35]),c[0]&503791|c[1]&4096&&(u.$$scope={dirty:c,ctx:l}),!n&&c[0]&16&&(n=!0,u.pane=l[4],et(()=>n=!1)),t.$set(u)},i(l){r||(T(i),T(t.$$.fragment,l),r=!0)},o(l){D(i),D(t.$$.fragment,l),r=!1},d(l){l&&p(e),i&&i.d(l),oe(t,l)}}}function nI(o){let e,t,n=o[16]&&Gd(o);return{c(){n&&n.c(),e=je()},l(r){n&&n.l(r),e=je()},m(r,i){n&&n.m(r,i),U(r,e,i),t=!0},p(r,i){r[16]?n?(n.p(r,i),i[0]&65536&&T(n,1)):(n=Gd(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Le(),D(n,1,1,()=>{n=null}),Ue())},i(r){t||(T(n),t=!0)},o(r){D(n),t=!1},d(r){r&&p(e),n&&n.d(r)}}}function Fd(o){let e,t;return e=new Xg({props:{class:"relative flex w-2 items-center justify-center bg-background group",$$slots:{default:[oI]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function oI(o){let e,t,n;return t=new kp({props:{className:"size-4 invisible group-hover:visible"}}),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(r){e=P(r,"DIV",{class:!0});var i=I(e);re(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"class","z-10 flex h-7 w-5 items-center justify-center rounded-xs")},m(r,i){U(r,e,i),ne(t,e,null),n=!0},p:Re,i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){D(t.$$.fragment,r),n=!1},d(r){r&&p(e),oe(t)}}}function Kd(o){let e,t,n,r,i,a;const s=[aI,sI,iI,rI],l=[];function c(u,d){return u[15]?0:u[18]?1:u[17]?2:3}return n=c(o),r=l[n]=s[n](o),{c(){e=M("div"),t=M("div"),r.c(),this.h()},l(u){e=P(u,"DIV",{class:!0});var d=I(e);t=P(d,"DIV",{class:!0});var f=I(t);r.l(f),f.forEach(p),d.forEach(p),this.h()},h(){g(t,"class",i="w-full "+((o[17]||o[18])&&!o[15]?" ":"px-4 py-4 bg-white dark:shadow-lg dark:bg-gray-850  border border-gray-100 dark:border-gray-850")+" rounded-xl z-40 pointer-events-auto overflow-y-auto scrollbar-hidden"),g(e,"class","pr-4 pb-8 flex max-h-full min-h-full")},m(u,d){U(u,e,d),k(e,t),l[n].m(t,null),a=!0},p(u,d){let f=n;n=c(u),n===f?l[n].p(u,d):(Le(),D(l[f],1,1,()=>{l[f]=null}),Ue(),r=l[n],r?r.p(u,d):(r=l[n]=s[n](u),r.c()),T(r,1),r.m(t,null)),(!a||d[0]&425984&&i!==(i="w-full "+((u[17]||u[18])&&!u[15]?" ":"px-4 py-4 bg-white dark:shadow-lg dark:bg-gray-850  border border-gray-100 dark:border-gray-850")+" rounded-xl z-40 pointer-events-auto overflow-y-auto scrollbar-hidden"))&&g(t,"class",i)},i(u){a||(T(r),a=!0)},o(u){D(r),a=!1},d(u){u&&p(e),l[n].d()}}}function rI(o){let e,t,n,r;function i(l){o[32](l)}function a(l){o[33](l)}let s={models:o[5]};return o[1]!==void 0&&(s.chatFiles=o[1]),o[2]!==void 0&&(s.params=o[2]),e=new Hg({props:s}),Ye.push(()=>tt(e,"chatFiles",i)),Ye.push(()=>tt(e,"params",a)),e.$on("close",o[34]),{c(){te(e.$$.fragment)},l(l){re(e.$$.fragment,l)},m(l,c){ne(e,l,c),r=!0},p(l,c){const u={};c[0]&32&&(u.models=l[5]),!t&&c[0]&2&&(t=!0,u.chatFiles=l[1],et(()=>t=!1)),!n&&c[0]&4&&(n=!0,u.params=l[2],et(()=>n=!1)),e.$set(u)},i(l){r||(T(e.$$.fragment,l),r=!0)},o(l){D(e.$$.fragment,l),r=!1},d(l){oe(e,l)}}}function iI(o){let e,t;return e=new Bg({props:{history:o[0]}}),e.$on("nodeclick",o[30]),e.$on("close",o[31]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&1&&(i.history=n[0]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function sI(o){let e,t;return e=new zg({props:{history:o[0],overlay:o[13]}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&1&&(i.history=n[0]),r[0]&8192&&(i.overlay=n[13]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function aI(o){let e,t,n,r;function i(s){o[28](s)}let a={submitPrompt:o[8],stopResponse:o[9],modelId:o[11],chatId:o[6],eventTarget:o[7]};return o[3]!==void 0&&(a.files=o[3]),t=new Lg({props:a}),Ye.push(()=>tt(t,"files",i)),t.$on("close",o[29]),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(s){e=P(s,"DIV",{class:!0});var l=I(e);re(t.$$.fragment,l),l.forEach(p),this.h()},h(){g(e,"class","w-full h-full flex justify-center")},m(s,l){U(s,e,l),ne(t,e,null),r=!0},p(s,l){const c={};l[0]&256&&(c.submitPrompt=s[8]),l[0]&512&&(c.stopResponse=s[9]),l[0]&2048&&(c.modelId=s[11]),l[0]&64&&(c.chatId=s[6]),l[0]&128&&(c.eventTarget=s[7]),!n&&l[0]&8&&(n=!0,c.files=s[3],et(()=>n=!1)),t.$set(c)},i(s){r||(T(t.$$.fragment,s),r=!0)},o(s){D(t.$$.fragment,s),r=!1},d(s){s&&p(e),oe(t)}}}function lI(o){let e,t,n=o[16]&&Kd(o);return{c(){n&&n.c(),e=je()},l(r){n&&n.l(r),e=je()},m(r,i){n&&n.m(r,i),U(r,e,i),t=!0},p(r,i){r[16]?n?(n.p(r,i),i[0]&65536&&T(n,1)):(n=Kd(r),n.c(),T(n,1),n.m(e.parentNode,e)):n&&(Le(),D(n,1,1,()=>{n=null}),Ue())},i(r){t||(T(n),t=!0)},o(r){D(n),t=!1},d(r){r&&p(e),n&&n.d(r)}}}function Gd(o){let e,t;return e=new wp({props:{show:o[16],$$slots:{default:[hI]},$$scope:{ctx:o}}}),e.$on("close",o[27]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&65536&&(i.show=n[16]),r[0]&430063|r[1]&4096&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function cI(o){let e,t,n,r;function i(l){o[24](l)}function a(l){o[25](l)}let s={models:o[5]};return o[1]!==void 0&&(s.chatFiles=o[1]),o[2]!==void 0&&(s.params=o[2]),e=new Hg({props:s}),Ye.push(()=>tt(e,"chatFiles",i)),Ye.push(()=>tt(e,"params",a)),e.$on("close",o[26]),{c(){te(e.$$.fragment)},l(l){re(e.$$.fragment,l)},m(l,c){ne(e,l,c),r=!0},p(l,c){const u={};c[0]&32&&(u.models=l[5]),!t&&c[0]&2&&(t=!0,u.chatFiles=l[1],et(()=>t=!1)),!n&&c[0]&4&&(n=!0,u.params=l[2],et(()=>n=!1)),e.$set(u)},i(l){r||(T(e.$$.fragment,l),r=!0)},o(l){D(e.$$.fragment,l),r=!1},d(l){oe(e,l)}}}function uI(o){let e,t;return e=new Bg({props:{history:o[0]}}),e.$on("nodeclick",o[22]),e.$on("close",o[23]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&1&&(i.history=n[0]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function dI(o){let e,t;return e=new zg({props:{history:o[0]}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&1&&(i.history=n[0]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function fI(o){let e,t,n,r;function i(s){o[20](s)}let a={submitPrompt:o[8],stopResponse:o[9],modelId:o[11],chatId:o[6],eventTarget:o[7]};return o[3]!==void 0&&(a.files=o[3]),t=new Lg({props:a}),Ye.push(()=>tt(t,"files",i)),t.$on("close",o[21]),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(s){e=P(s,"DIV",{class:!0});var l=I(e);re(t.$$.fragment,l),l.forEach(p),this.h()},h(){g(e,"class","h-full max-h-[100dvh] bg-white text-gray-700 dark:bg-black dark:text-gray-300 flex justify-center")},m(s,l){U(s,e,l),ne(t,e,null),r=!0},p(s,l){const c={};l[0]&256&&(c.submitPrompt=s[8]),l[0]&512&&(c.stopResponse=s[9]),l[0]&2048&&(c.modelId=s[11]),l[0]&64&&(c.chatId=s[6]),l[0]&128&&(c.eventTarget=s[7]),!n&&l[0]&8&&(n=!0,c.files=s[3],et(()=>n=!1)),t.$set(c)},i(s){r||(T(t.$$.fragment,s),r=!0)},o(s){D(t.$$.fragment,s),r=!1},d(s){s&&p(e),oe(t)}}}function hI(o){let e,t,n,r,i;const a=[fI,dI,uI,cI],s=[];function l(c,u){return c[15]?0:c[18]?1:c[17]?2:3}return t=l(o),n=s[t]=a[t](o),{c(){e=M("div"),n.c(),this.h()},l(c){e=P(c,"DIV",{class:!0});var u=I(e);n.l(u),u.forEach(p),this.h()},h(){g(e,"class",r=(o[15]||o[17]||o[18]?" h-screen  w-full":"px-6 py-4")+" h-full")},m(c,u){U(c,e,u),s[t].m(e,null),i=!0},p(c,u){let d=t;t=l(c),t===d?s[t].p(c,u):(Le(),D(s[d],1,1,()=>{s[d]=null}),Ue(),n=s[t],n?n.p(c,u):(n=s[t]=a[t](c),n.c()),T(n,1),n.m(e,null)),(!i||u[0]&425984&&r!==(r=(c[15]||c[17]||c[18]?" h-screen  w-full":"px-6 py-4")+" h-full"))&&g(e,"class",r)},i(c){i||(T(n),i=!0)},o(c){D(n),i=!1},d(c){c&&p(e),s[t].d()}}}function gI(o){let e,t,n,r;const i=[nI,tI],a=[];function s(l,c){return l[12]?1:0}return e=s(o),t=a[e]=i[e](o),{c(){t.c(),n=je()},l(l){t.l(l),n=je()},m(l,c){a[e].m(l,c),U(l,n,c),r=!0},p(l,c){let u=e;e=s(l),e===u?a[e].p(l,c):(Le(),D(a[u],1,1,()=>{a[u]=null}),Ue(),t=a[e],t?t.p(l,c):(t=a[e]=i[e](l),t.c()),T(t,1),t.m(n.parentNode,n))},i(l){r||(T(t),r=!0)},o(l){D(t),r=!1},d(l){l&&p(n),a[e].d(l)}}}function mI(o){let e,t;return e=new eE({props:{$$slots:{default:[gI]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&524287|r[1]&4096&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function pI(o,e,t){let n,r,i,a;de(o,jn,Y=>t(15,n=Y)),de(o,nn,Y=>t(16,r=Y)),de(o,Fo,Y=>t(17,i=Y)),de(o,Mo,Y=>t(18,a=Y));let{history:s}=e,{models:l=[]}=e,{chatId:c=null}=e,{chatFiles:u=[]}=e,{params:d={}}=e,{eventTarget:f}=e,{submitPrompt:h}=e,{stopResponse:_}=e,{showMessage:y}=e,{files:v}=e,{modelId:m}=e,{pane:b}=e,w,C=!1,O=!1,S=0;const E=()=>{parseInt(localStorage==null?void 0:localStorage.chatControlsSize)?b.resize(parseInt(localStorage==null?void 0:localStorage.chatControlsSize)):b.resize(S)},H=async Y=>{Y.matches?(t(12,C=!0),n&&(jn.set(!1),await rt(),jn.set(!0))):(t(12,C=!1),n&&(jn.set(!1),await rt(),jn.set(!0)),t(4,b=null))},R=Y=>{t(13,O=!0)},L=Y=>{t(13,O=!1)};Jn(()=>{w=window.matchMedia("(min-width: 1024px)"),w.addEventListener("change",H),H(w);const Y=document.getElementById("chat-container");t(14,S=Math.floor(350/Y.clientWidth*100)),new ResizeObserver(Ke=>{for(let mt of Ke){const xe=350/mt.contentRect.width*100;t(14,S=Math.floor(xe)),r&&b&&b.isExpanded()&&b.getSize()<S&&b.resize(S)}}).observe(Y),document.addEventListener("mousedown",R),document.addEventListener("mouseup",L)}),Qo(()=>{nn.set(!1),w.removeEventListener("change",H),document.removeEventListener("mousedown",R),document.removeEventListener("mouseup",L)});const F=()=>{nn.set(!1),Fo.set(!1),Mo.set(!1),n&&jn.set(!1)};function q(Y){v=Y,t(3,v)}const W=()=>{nn.set(!1)},A=Y=>{y(Y.detail.node.data.message)},V=()=>{nn.set(!1)};function N(Y){u=Y,t(1,u)}function G(Y){d=Y,t(2,d)}const X=()=>{nn.set(!1)},Q=()=>{nn.set(!1)};function j(Y){v=Y,t(3,v)}const ue=()=>{nn.set(!1)},B=Y=>{Y.detail.node.data.message.favorite?t(0,s.messages[Y.detail.node.data.message.id].favorite=!0,s):t(0,s.messages[Y.detail.node.data.message.id].favorite=null,s),y(Y.detail.node.data.message)},x=()=>{nn.set(!1)};function J(Y){u=Y,t(1,u)}function ce(Y){d=Y,t(2,d)}const me=()=>{nn.set(!1)},se=Y=>{console.log("size",Y,S),r&&b.isExpanded()&&(Y<S&&b.resize(S),Y<S?localStorage.chatControlsSize=0:localStorage.chatControlsSize=Y)},Be=()=>{nn.set(!1)};function He(Y){b=Y,t(4,b)}return o.$$set=Y=>{"history"in Y&&t(0,s=Y.history),"models"in Y&&t(5,l=Y.models),"chatId"in Y&&t(6,c=Y.chatId),"chatFiles"in Y&&t(1,u=Y.chatFiles),"params"in Y&&t(2,d=Y.params),"eventTarget"in Y&&t(7,f=Y.eventTarget),"submitPrompt"in Y&&t(8,h=Y.submitPrompt),"stopResponse"in Y&&t(9,_=Y.stopResponse),"showMessage"in Y&&t(10,y=Y.showMessage),"files"in Y&&t(3,v=Y.files),"modelId"in Y&&t(11,m=Y.modelId),"pane"in Y&&t(4,b=Y.pane)},o.$$.update=()=>{o.$$.dirty[0]&64&&(c||F())},[s,u,d,v,b,l,c,f,h,_,y,m,C,O,S,n,r,i,a,E,q,W,A,V,N,G,X,Q,j,ue,B,x,J,ce,me,se,Be,He]}class _I extends Ve{constructor(e){super(),Fe(this,e,pI,mI,Qe,{history:0,models:5,chatId:6,chatFiles:1,params:2,eventTarget:7,submitPrompt:8,stopResponse:9,showMessage:10,files:3,modelId:11,pane:4,openPane:19},null,[-1,-1])}get openPane(){return this.$$.ctx[19]}}const{document:ma}=Wa;function Wd(o,e,t){const n=o.slice();return n[118]=e[t],n}function bI(o){let e,t,n,r;return n=new Ps({}),{c(){e=M("div"),t=M("div"),te(n.$$.fragment),this.h()},l(i){e=P(i,"DIV",{class:!0});var a=I(e);t=P(a,"DIV",{class:!0});var s=I(t);re(n.$$.fragment,s),s.forEach(p),a.forEach(p),this.h()},h(){g(t,"class","m-auto"),g(e,"class","flex items-center justify-center h-full w-full")},m(i,a){U(i,e,a),k(e,t),ne(n,t,null),r=!0},p:Re,i(i){r||(T(n.$$.fragment,i),r=!0)},o(i){D(n.$$.fragment,i),r=!1},d(i){i&&p(e),oe(n)}}}function yI(o){var u;let e,t,n,r,i,a,s=(((u=o[27])==null?void 0:u.backgroundImageUrl)??null)&&Yd(o);function l(d){o[56](d)}let c={chat:{id:o[26],chat:{title:o[31],models:o[1],system:o[27].system??void 0,params:o[25],history:o[21],timestamp:Date.now()}},title:o[31],shareEnabled:!!o[21].currentId,initNewChat:o[41]};return o[1]!==void 0&&(c.selectedModels=o[1]),t=new ew({props:c}),o[55](t),Ye.push(()=>tt(t,"selectedModels",l)),i=new Jg({props:{direction:"horizontal",class:"w-full h-full",$$slots:{default:[CI]},$$scope:{ctx:o}}}),{c(){s&&s.c(),e=$(),te(t.$$.fragment),r=$(),te(i.$$.fragment)},l(d){s&&s.l(d),e=ee(d),re(t.$$.fragment,d),r=ee(d),re(i.$$.fragment,d)},m(d,f){s&&s.m(d,f),U(d,e,f),ne(t,d,f),U(d,r,f),ne(i,d,f),a=!0},p(d,f){var y;((y=d[27])==null?void 0:y.backgroundImageUrl)??null?s?s.p(d,f):(s=Yd(d),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null);const h={};f[0]&236978178|f[1]&1&&(h.chat={id:d[26],chat:{title:d[31],models:d[1],system:d[27].system??void 0,params:d[25],history:d[21],timestamp:Date.now()}}),f[1]&1&&(h.title=d[31]),f[0]&2097152&&(h.shareEnabled=!!d[21].currentId),!n&&f[0]&2&&(n=!0,h.selectedModels=d[1],et(()=>n=!1)),t.$set(h);const _={};f[0]&2147418358|f[1]&8|f[3]&268435456&&(_.$$scope={dirty:f,ctx:d}),i.$set(_)},i(d){a||(T(t.$$.fragment,d),T(i.$$.fragment,d),a=!0)},o(d){D(t.$$.fragment,d),D(i.$$.fragment,d),a=!1},d(d){d&&(p(e),p(r)),s&&s.d(d),o[55](null),oe(t,d),oe(i,d)}}}function Yd(o){let e,t,n,r;return{c(){e=M("div"),n=$(),r=M("div"),this.h()},l(i){e=P(i,"DIV",{class:!0,style:!0}),I(e).forEach(p),n=ee(i),r=P(i,"DIV",{class:!0}),I(r).forEach(p),this.h()},h(){g(e,"class",t="absolute "+(o[33]?"md:max-w-[calc(100%-260px)] md:translate-x-[260px]":"")+" top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat"),lt(e,"background-image","url("+o[27].backgroundImageUrl+")"),g(r,"class","absolute top-0 left-0 w-full h-full bg-linear-to-t from-white to-white/85 dark:from-gray-900 dark:to-gray-900/90 z-0")},m(i,a){U(i,e,a),U(i,n,a),U(i,r,a)},p(i,a){a[1]&4&&t!==(t="absolute "+(i[33]?"md:max-w-[calc(100%-260px)] md:translate-x-[260px]":"")+" top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat")&&g(e,"class",t),a[0]&134217728&&lt(e,"background-image","url("+i[27].backgroundImageUrl+")")},d(i){i&&(p(e),p(n),p(r))}}}function qd(o){var d,f,h,_,y,v,m;let e,t,n,r,i,a=(((f=(d=o[30])==null?void 0:d.license_metadata)==null?void 0:f.type)??null)==="trial"&&jd(o),s=(((_=(h=o[30])==null?void 0:h.license_metadata)==null?void 0:_.seats)??null)!==null&&((y=o[30])==null?void 0:y.user_count)>((m=(v=o[30])==null?void 0:v.license_metadata)==null?void 0:m.seats)&&Qd(o),l=Pt(o[34].filter(o[57])),c=[];for(let b=0;b<l.length;b+=1)c[b]=Xd(Wd(o,l,b));const u=b=>D(c[b],1,1,()=>{c[b]=null});return{c(){e=M("div"),t=M("div"),a&&a.c(),n=$(),s&&s.c(),r=$();for(let b=0;b<c.length;b+=1)c[b].c();this.h()},l(b){e=P(b,"DIV",{class:!0});var w=I(e);t=P(w,"DIV",{class:!0});var C=I(t);a&&a.l(C),n=ee(C),s&&s.l(C),r=ee(C);for(let O=0;O<c.length;O+=1)c[O].l(C);C.forEach(p),w.forEach(p),this.h()},h(){g(t,"class","flex flex-col gap-1 w-full"),g(e,"class","absolute top-12 left-0 right-0 w-full z-30")},m(b,w){U(b,e,w),k(e,t),a&&a.m(t,null),k(t,n),s&&s.m(t,null),k(t,r);for(let C=0;C<c.length;C+=1)c[C]&&c[C].m(t,null);i=!0},p(b,w){var C,O,S,E,H,R,L;if((((O=(C=b[30])==null?void 0:C.license_metadata)==null?void 0:O.type)??null)==="trial"?a?(a.p(b,w),w[0]&1073741824&&T(a,1)):(a=jd(b),a.c(),T(a,1),a.m(t,n)):a&&(Le(),D(a,1,1,()=>{a=null}),Ue()),(((E=(S=b[30])==null?void 0:S.license_metadata)==null?void 0:E.seats)??null)!==null&&((H=b[30])==null?void 0:H.user_count)>((L=(R=b[30])==null?void 0:R.license_metadata)==null?void 0:L.seats)?s?(s.p(b,w),w[0]&1073741824&&T(s,1)):(s=Qd(b),s.c(),T(s,1),s.m(t,r)):s&&(Le(),D(s,1,1,()=>{s=null}),Ue()),w[1]&8){l=Pt(b[34].filter(b[57]));let F;for(F=0;F<l.length;F+=1){const q=Wd(b,l,F);c[F]?(c[F].p(q,w),T(c[F],1)):(c[F]=Xd(q),c[F].c(),T(c[F],1),c[F].m(t,null))}for(Le(),F=l.length;F<c.length;F+=1)u(F);Ue()}},i(b){if(!i){T(a),T(s);for(let w=0;w<l.length;w+=1)T(c[w]);i=!0}},o(b){D(a),D(s),c=c.filter(Boolean);for(let w=0;w<c.length;w+=1)D(c[w]);i=!1},d(b){b&&p(e),a&&a.d(),s&&s.d(),so(c,b)}}}function jd(o){let e,t;return e=new ja({props:{banner:{type:"info",title:"Trial License",content:o[28].t("You are currently using a trial license. Please contact support to upgrade your license.")}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&268435456&&(i.banner={type:"info",title:"Trial License",content:n[28].t("You are currently using a trial license. Please contact support to upgrade your license.")}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function Qd(o){let e,t;return e=new ja({props:{banner:{type:"error",title:"License Error",content:o[28].t("Exceeded the number of seats in your license. Please contact support to increase the number of seats.")}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[0]&268435456&&(i.banner={type:"error",title:"License Error",content:n[28].t("Exceeded the number of seats in your license. Please contact support to increase the number of seats.")}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function Xd(o){let e,t;return e=new ja({props:{banner:o[118]}}),e.$on("dismiss",o[58]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r[1]&8&&(i.banner=n[118]),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function vI(o){var O;let e,t,n,r,i,a,s,l,c,u,d;function f(S){o[75](S)}function h(S){o[76](S)}function _(S){o[77](S)}function y(S){o[78](S)}function v(S){o[79](S)}function m(S){o[80](S)}function b(S){o[81](S)}function w(S){o[82](S)}let C={history:o[21],selectedModels:o[1],transparentBackground:((O=o[27])==null?void 0:O.backgroundImageUrl)??!1,stopResponse:o[47],createMessagePair:o[43]};return o[24]!==void 0&&(C.files=o[24]),o[22]!==void 0&&(C.prompt=o[22]),o[6]!==void 0&&(C.autoScroll=o[6]),o[17]!==void 0&&(C.selectedToolIds=o[17]),o[18]!==void 0&&(C.imageGenerationEnabled=o[18]),o[20]!==void 0&&(C.codeInterpreterEnabled=o[20]),o[19]!==void 0&&(C.webSearchEnabled=o[19]),o[2]!==void 0&&(C.atSelectedModel=o[2]),t=new Ky({props:C}),Ye.push(()=>tt(t,"files",f)),Ye.push(()=>tt(t,"prompt",h)),Ye.push(()=>tt(t,"autoScroll",_)),Ye.push(()=>tt(t,"selectedToolIds",y)),Ye.push(()=>tt(t,"imageGenerationEnabled",v)),Ye.push(()=>tt(t,"codeInterpreterEnabled",m)),Ye.push(()=>tt(t,"webSearchEnabled",b)),Ye.push(()=>tt(t,"atSelectedModel",w)),t.$on("upload",o[83]),t.$on("submit",o[84]),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(S){e=P(S,"DIV",{class:!0});var E=I(e);re(t.$$.fragment,E),E.forEach(p),this.h()},h(){g(e,"class","overflow-auto w-full h-full flex items-center")},m(S,E){U(S,e,E),ne(t,e,null),d=!0},p(S,E){var R;const H={};E[0]&2097152&&(H.history=S[21]),E[0]&2&&(H.selectedModels=S[1]),E[0]&134217728&&(H.transparentBackground=((R=S[27])==null?void 0:R.backgroundImageUrl)??!1),!n&&E[0]&16777216&&(n=!0,H.files=S[24],et(()=>n=!1)),!r&&E[0]&4194304&&(r=!0,H.prompt=S[22],et(()=>r=!1)),!i&&E[0]&64&&(i=!0,H.autoScroll=S[6],et(()=>i=!1)),!a&&E[0]&131072&&(a=!0,H.selectedToolIds=S[17],et(()=>a=!1)),!s&&E[0]&262144&&(s=!0,H.imageGenerationEnabled=S[18],et(()=>s=!1)),!l&&E[0]&1048576&&(l=!0,H.codeInterpreterEnabled=S[20],et(()=>l=!1)),!c&&E[0]&524288&&(c=!0,H.webSearchEnabled=S[19],et(()=>c=!1)),!u&&E[0]&4&&(u=!0,H.atSelectedModel=S[2],et(()=>u=!1)),t.$set(H)},i(S){d||(T(t.$$.fragment,S),d=!0)},o(S){D(t.$$.fragment,S),d=!1},d(S){S&&p(e),oe(t)}}}function wI(o){var ue;let e,t,n,r,i,a,s,l,c,u,d,f,h,_,y,v,m,b,w,C="",O,S,E;function H(B){o[59](B)}function R(B){o[60](B)}function L(B){o[61](B)}let F={chatId:o[26],selectedModels:o[1],atSelectedModel:o[2],sendPrompt:o[46],showMessage:o[37],submitMessage:o[48],continueResponse:o[50],regenerateResponse:o[49],mergeResponses:o[51],chatActionHandler:o[42],addMessages:o[44],bottomPadding:o[24].length>0};o[21]!==void 0&&(F.history=o[21]),o[6]!==void 0&&(F.autoScroll=o[6]),o[22]!==void 0&&(F.prompt=o[22]),n=new ip({props:F}),Ye.push(()=>tt(n,"history",H)),Ye.push(()=>tt(n,"autoScroll",R)),Ye.push(()=>tt(n,"prompt",L));function q(B){o[65](B)}function W(B){o[66](B)}function A(B){o[67](B)}function V(B){o[68](B)}function N(B){o[69](B)}function G(B){o[70](B)}function X(B){o[71](B)}function Q(B){o[72](B)}let j={history:o[21],selectedModels:o[1],transparentBackground:((ue=o[27])==null?void 0:ue.backgroundImageUrl)??!1,stopResponse:o[47],createMessagePair:o[43],onChange:o[64]};return o[24]!==void 0&&(j.files=o[24]),o[22]!==void 0&&(j.prompt=o[22]),o[6]!==void 0&&(j.autoScroll=o[6]),o[17]!==void 0&&(j.selectedToolIds=o[17]),o[18]!==void 0&&(j.imageGenerationEnabled=o[18]),o[20]!==void 0&&(j.codeInterpreterEnabled=o[20]),o[19]!==void 0&&(j.webSearchEnabled=o[19]),o[2]!==void 0&&(j.atSelectedModel=o[2]),c=new tg({props:j}),Ye.push(()=>tt(c,"files",q)),Ye.push(()=>tt(c,"prompt",W)),Ye.push(()=>tt(c,"autoScroll",A)),Ye.push(()=>tt(c,"selectedToolIds",V)),Ye.push(()=>tt(c,"imageGenerationEnabled",N)),Ye.push(()=>tt(c,"codeInterpreterEnabled",G)),Ye.push(()=>tt(c,"webSearchEnabled",X)),Ye.push(()=>tt(c,"atSelectedModel",Q)),c.$on("upload",o[73]),c.$on("submit",o[74]),{c(){e=M("div"),t=M("div"),te(n.$$.fragment),s=$(),l=M("div"),te(c.$$.fragment),b=$(),w=M("div"),w.innerHTML=C,this.h()},l(B){e=P(B,"DIV",{class:!0,id:!0});var x=I(e);t=P(x,"DIV",{class:!0});var J=I(t);re(n.$$.fragment,J),J.forEach(p),x.forEach(p),s=ee(B),l=P(B,"DIV",{class:!0});var ce=I(l);re(c.$$.fragment,ce),b=ee(ce),w=P(ce,"DIV",{class:!0,"data-svelte-h":!0}),wt(w)!=="svelte-1t2gtm5"&&(w.innerHTML=C),ce.forEach(p),this.h()},h(){g(t,"class","h-full w-full flex flex-col"),g(e,"class","pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full z-10 scrollbar-hidden"),g(e,"id","messages-container"),g(w,"class","absolute bottom-1 text-xs text-gray-500 text-center line-clamp-1 right-0 left-0"),g(l,"class","pb-[1rem]")},m(B,x){U(B,e,x),k(e,t),ne(n,t,null),o[62](e),U(B,s,x),U(B,l,x),ne(c,l,null),k(l,b),k(l,w),O=!0,S||(E=Ie(e,"scroll",o[63]),S=!0)},p(B,x){var me;const J={};x[0]&67108864&&(J.chatId=B[26]),x[0]&2&&(J.selectedModels=B[1]),x[0]&4&&(J.atSelectedModel=B[2]),x[0]&16777216&&(J.bottomPadding=B[24].length>0),!r&&x[0]&2097152&&(r=!0,J.history=B[21],et(()=>r=!1)),!i&&x[0]&64&&(i=!0,J.autoScroll=B[6],et(()=>i=!1)),!a&&x[0]&4194304&&(a=!0,J.prompt=B[22],et(()=>a=!1)),n.$set(J);const ce={};x[0]&2097152&&(ce.history=B[21]),x[0]&2&&(ce.selectedModels=B[1]),x[0]&134217728&&(ce.transparentBackground=((me=B[27])==null?void 0:me.backgroundImageUrl)??!1),x[0]&67108864&&(ce.onChange=B[64]),!u&&x[0]&16777216&&(u=!0,ce.files=B[24],et(()=>u=!1)),!d&&x[0]&4194304&&(d=!0,ce.prompt=B[22],et(()=>d=!1)),!f&&x[0]&64&&(f=!0,ce.autoScroll=B[6],et(()=>f=!1)),!h&&x[0]&131072&&(h=!0,ce.selectedToolIds=B[17],et(()=>h=!1)),!_&&x[0]&262144&&(_=!0,ce.imageGenerationEnabled=B[18],et(()=>_=!1)),!y&&x[0]&1048576&&(y=!0,ce.codeInterpreterEnabled=B[20],et(()=>y=!1)),!v&&x[0]&524288&&(v=!0,ce.webSearchEnabled=B[19],et(()=>v=!1)),!m&&x[0]&4&&(m=!0,ce.atSelectedModel=B[2],et(()=>m=!1)),c.$set(ce)},i(B){O||(T(n.$$.fragment,B),T(c.$$.fragment,B),O=!0)},o(B){D(n.$$.fragment,B),D(c.$$.fragment,B),O=!1},d(B){B&&(p(e),p(s),p(l)),oe(n),o[62](null),oe(c),S=!1,E()}}}function kI(o){var d,f,h,_,y,v,m;let e,t,n,r,i,a,s=!o[21].currentId&&!o[26]&&o[1].length<=1&&(o[34].length>0||(((f=(d=o[30])==null?void 0:d.license_metadata)==null?void 0:f.type)??null)==="trial"||(((_=(h=o[30])==null?void 0:h.license_metadata)==null?void 0:_.seats)??null)!==null&&((y=o[30])==null?void 0:y.user_count)>((m=(v=o[30])==null?void 0:v.license_metadata)==null?void 0:m.seats))&&qd(o);const l=[wI,vI],c=[];function u(b,w){var C;return w[0]&136314880&&(n=null),n==null&&(n=((C=b[27])==null?void 0:C.landingPageMode)==="chat"||qn(b[21],b[21].currentId).length>0),n?0:1}return r=u(o,[-1,-1,-1,-1]),i=c[r]=l[r](o),{c(){s&&s.c(),e=$(),t=M("div"),i.c(),this.h()},l(b){s&&s.l(b),e=ee(b),t=P(b,"DIV",{class:!0});var w=I(t);i.l(w),w.forEach(p),this.h()},h(){g(t,"class","flex flex-col flex-auto z-10 w-full @container")},m(b,w){s&&s.m(b,w),U(b,e,w),U(b,t,w),c[r].m(t,null),a=!0},p(b,w){var O,S,E,H,R,L,F;!b[21].currentId&&!b[26]&&b[1].length<=1&&(b[34].length>0||(((S=(O=b[30])==null?void 0:O.license_metadata)==null?void 0:S.type)??null)==="trial"||(((H=(E=b[30])==null?void 0:E.license_metadata)==null?void 0:H.seats)??null)!==null&&((R=b[30])==null?void 0:R.user_count)>((F=(L=b[30])==null?void 0:L.license_metadata)==null?void 0:F.seats))?s?(s.p(b,w),w[0]&1142947842|w[1]&8&&T(s,1)):(s=qd(b),s.c(),T(s,1),s.m(e.parentNode,e)):s&&(Le(),D(s,1,1,()=>{s=null}),Ue());let C=r;r=u(b,w),r===C?c[r].p(b,w):(Le(),D(c[C],1,1,()=>{c[C]=null}),Ue(),i=c[r],i?i.p(b,w):(i=c[r]=l[r](b),i.c()),T(i,1),i.m(t,null))},i(b){a||(T(s),T(i),a=!0)},o(b){D(s),D(i),a=!1},d(b){b&&(p(e),p(t)),s&&s.d(b),c[r].d()}}}function CI(o){var v;let e,t,n,r,i,a,s,l,c;e=new Zd({props:{defaultSize:50,class:"h-full flex w-full relative",$$slots:{default:[kI]},$$scope:{ctx:o}}});function u(m){o[87](m)}function d(m){o[88](m)}function f(m){o[89](m)}function h(m){o[90](m)}function _(m){o[91](m)}let y={chatId:o[26],modelId:((v=o[16])==null?void 0:v.at(0))??null,models:o[16].reduce(o[85],[]),submitPrompt:o[45],stopResponse:o[47],showMessage:o[37],eventTarget:o[36]};return o[21]!==void 0&&(y.history=o[21]),o[23]!==void 0&&(y.chatFiles=o[23]),o[25]!==void 0&&(y.params=o[25]),o[24]!==void 0&&(y.files=o[24]),o[4]!==void 0&&(y.pane=o[4]),n=new _I({props:y}),o[86](n),Ye.push(()=>tt(n,"history",u)),Ye.push(()=>tt(n,"chatFiles",d)),Ye.push(()=>tt(n,"params",f)),Ye.push(()=>tt(n,"files",h)),Ye.push(()=>tt(n,"pane",_)),{c(){te(e.$$.fragment),t=$(),te(n.$$.fragment)},l(m){re(e.$$.fragment,m),t=ee(m),re(n.$$.fragment,m)},m(m,b){ne(e,m,b),U(m,t,b),ne(n,m,b),c=!0},p(m,b){var O;const w={};b[0]&1568538822|b[1]&8|b[3]&268435456&&(w.$$scope={dirty:b,ctx:m}),e.$set(w);const C={};b[0]&67108864&&(C.chatId=m[26]),b[0]&65536&&(C.modelId=((O=m[16])==null?void 0:O.at(0))??null),b[0]&536936448&&(C.models=m[16].reduce(m[85],[])),!r&&b[0]&2097152&&(r=!0,C.history=m[21],et(()=>r=!1)),!i&&b[0]&8388608&&(i=!0,C.chatFiles=m[23],et(()=>i=!1)),!a&&b[0]&33554432&&(a=!0,C.params=m[25],et(()=>a=!1)),!s&&b[0]&16777216&&(s=!0,C.files=m[24],et(()=>s=!1)),!l&&b[0]&16&&(l=!0,C.pane=m[4],et(()=>l=!1)),n.$set(C)},i(m){c||(T(e.$$.fragment,m),T(n.$$.fragment,m),c=!0)},o(m){D(e.$$.fragment,m),D(n.$$.fragment,m),c=!1},d(m){m&&p(t),oe(e,m),o[86](null),oe(n,m)}}}function EI(o){let e,t,n,r,i,a,s,l,c,u,d,f,h;ma.title=e=`\r
		`+(o[31]?`${o[31].length>30?`${o[31].slice(0,30)}...`:o[31]} | ${o[32]}`:`${o[32]}`)+`\r
	`;function _(w){o[52](w)}let y={title:o[10],message:o[11],input:o[12],inputPlaceholder:o[13],inputValue:o[14]};o[9]!==void 0&&(y.show=o[9]),a=new Cp({props:y}),Ye.push(()=>tt(a,"show",_)),a.$on("confirm",o[53]),a.$on("cancel",o[54]);const v=[yI,bI],m=[];function b(w,C){return w[0]===""||!w[3]&&w[0]?0:w[3]?1:-1}return~(u=b(o))&&(d=m[u]=v[u](o)),{c(){t=$(),n=M("audio"),i=$(),te(a.$$.fragment),l=$(),c=M("div"),d&&d.c(),this.h()},l(w){Yg("svelte-8uu834",ma.head).forEach(p),t=ee(w),n=P(w,"AUDIO",{id:!0,src:!0,style:!0}),I(n).forEach(p),i=ee(w),re(a.$$.fragment,w),l=ee(w),c=P(w,"DIV",{class:!0,id:!0});var O=I(c);d&&d.l(O),O.forEach(p),this.h()},h(){g(n,"id","audioElement"),qo(n.src,r="")||g(n,"src",r),lt(n,"display","none"),g(c,"class",f="h-screen max-h-[100dvh] transition-width duration-200 ease-in-out "+(o[33]?"  md:max-w-[calc(100%-260px)]":" ")+" w-full max-w-full flex flex-col"),g(c,"id","chat-container")},m(w,C){U(w,t,C),U(w,n,C),U(w,i,C),ne(a,w,C),U(w,l,C),U(w,c,C),~u&&m[u].m(c,null),h=!0},p(w,C){(!h||C[1]&3)&&e!==(e=`\r
		`+(w[31]?`${w[31].length>30?`${w[31].slice(0,30)}...`:w[31]} | ${w[32]}`:`${w[32]}`)+`\r
	`)&&(ma.title=e);const O={};C[0]&1024&&(O.title=w[10]),C[0]&2048&&(O.message=w[11]),C[0]&4096&&(O.input=w[12]),C[0]&8192&&(O.inputPlaceholder=w[13]),C[0]&16384&&(O.inputValue=w[14]),!s&&C[0]&512&&(s=!0,O.show=w[9],et(()=>s=!1)),a.$set(O);let S=u;u=b(w),u===S?~u&&m[u].p(w,C):(d&&(Le(),D(m[S],1,1,()=>{m[S]=null}),Ue()),~u?(d=m[u],d?d.p(w,C):(d=m[u]=v[u](w),d.c()),T(d,1),d.m(c,null)):d=null),(!h||C[1]&4&&f!==(f="h-screen max-h-[100dvh] transition-width duration-200 ease-in-out "+(w[33]?"  md:max-w-[calc(100%-260px)]":" ")+" w-full max-w-full flex flex-col"))&&g(c,"class",f)},i(w){h||(T(a.$$.fragment,w),T(d),h=!0)},o(w){D(a.$$.fragment,w),D(d),h=!1},d(w){w&&(p(t),p(n),p(i),p(l),p(c)),oe(a,w),~u&&m[u].d()}}}function II(o,e,t){let n,r,i,a,s,l,c,u,d,f,h,_,y,v,m,b,w,C;de(o,fr,z=>t(96,n=z)),de(o,_r,z=>t(97,r=z)),de(o,Ss,z=>t(98,i=z)),de(o,gr,z=>t(26,a=z)),de(o,zo,z=>t(27,s=z)),de(o,Tr,z=>t(29,c=z)),de(o,tm,z=>t(99,u=z)),de(o,Xo,z=>t(100,d=z)),de(o,Ci,z=>t(30,f=z)),de(o,jn,z=>t(101,h=z)),de(o,xg,z=>t(102,_=z)),de(o,As,z=>t(103,y=z)),de(o,yr,z=>t(104,v=z)),de(o,Bi,z=>t(31,m=z)),de(o,tf,z=>t(32,b=z)),de(o,_a,z=>t(33,w=z)),de(o,nm,z=>t(34,C=z));const O=on("i18n");de(o,O,z=>t(28,l=z));let{chatIdProp:S=""}=e,E=!1;const H=new EventTarget;let R,L,F=!0,q,W,A=!1,V="",N="",G=!1,X="",Q="",j=null,ue,B=[""],x,J=[],ce=[],me=!1,se=!1,Be=!1,He=null,Y={messages:{},currentId:null,is_confidential:!1},Xe=null,Ke="",mt=[],fe=[],xe={};const gt=()=>{B.length===0||B.length===1&&B[0]===""||(sessionStorage.selectedModels=JSON.stringify(B),console.log("saveSessionSelectedModels",B,sessionStorage.selectedModels))},Et=async()=>{var le,ve;if(v||yr.set(await qa(localStorage.token)),B.length!==1&&!x)return;const z=x??c.find(De=>De.id===B[0]);z&&t(17,ce=(((ve=(le=z==null?void 0:z.info)==null?void 0:le.meta)==null?void 0:ve.toolIds)??[]).filter(De=>v.find(_e=>_e.id===De)))},Bt=async z=>{const le=JSON.parse(JSON.stringify(a));let ve=JSON.parse(JSON.stringify(z.id)),De=Y.messages[ve].childrenIds;for(;De.length!==0;)ve=De.at(-1),De=Y.messages[ve].childrenIds;t(21,Y.currentId=ve,Y),await rt(),await rt(),await rt();const _e=document.getElementById(`message-${z.id}`);_e&&_e.scrollIntoView({behavior:"smooth"}),await rt(),qt(le,Y)},Xt=async(z,le)=>{var ve,De;if(console.log(z),z.chat_id===a){await rt();let _e=Y.messages[z.message_id];if(_e){const Ee=((ve=z==null?void 0:z.data)==null?void 0:ve.type)??null,we=((De=z==null?void 0:z.data)==null?void 0:De.data)??null;if(Ee==="status")_e!=null&&_e.statusHistory?_e.statusHistory.push(we):_e.statusHistory=[we];else if(Ee==="source"||Ee==="citation")if((we==null?void 0:we.type)==="code_execution"){_e!=null&&_e.code_executions||(_e.code_executions=[]);const Te=_e.code_executions.findIndex(ze=>ze.id===we.id);Te!==-1?_e.code_executions[Te]=we:_e.code_executions.push(we),_e.code_executions=_e.code_executions}else _e!=null&&_e.sources?_e.sources.push(we):_e.sources=[we];else if(Ee==="chat:completion")he(we,_e,z.chat_id);else if(Ee==="chat:title")Bi.set(we),fr.set(1),await hr.set(await Rr(localStorage.token,n));else if(Ee==="chat:tags")He=await ba(localStorage.token,a),om.set(await bm(localStorage.token));else if(Ee==="message")_e.content+=we.content;else if(Ee==="replace")_e.content=we.content;else if(Ee==="action"){if(we.action==="continue"){const Te=document.getElementById("continue-response-button");Te&&Te.click()}}else if(Ee==="confirmation")t(15,j=le),t(12,G=!1),t(9,A=!0),t(10,V=we.title),t(11,N=we.message);else if(Ee==="execute"){t(15,j=le);try{const ze=await new Function(`return (async () => { ${we.code} })()`)();le&&le(ze)}catch(Te){console.error("Error executing code:",Te)}}else if(Ee==="input")t(15,j=le),t(12,G=!0),t(9,A=!0),t(10,V=we.title),t(11,N=we.message),t(13,X=we.placeholder),t(14,Q=(we==null?void 0:we.value)??"");else if(Ee==="notification"){const Te=(we==null?void 0:we.type)??"info",ze=(we==null?void 0:we.content)??"";Te==="success"?at.success(ze):Te==="error"?at.error(ze):Te==="warning"?at.warning(ze):at.info(ze)}else console.log("Unknown message type",we);t(21,Y.messages[z.message_id]=_e,Y)}}},Ot=async z=>{if(z.origin===window.origin){if(z.data.type==="input:prompt"){console.debug(z.data.text);const le=document.getElementById("chat-input");le&&(t(22,Ke=z.data.text),le.focus())}z.data.type==="action:submit"&&(console.debug(z.data.text),Ke!==""&&(await rt(),qe(Ke))),z.data.type==="input:prompt:submit"&&(console.debug(z.data.text),Ke!==""&&(await rt(),qe(z.data.text)))}};Jn(async()=>{if(console.log("mounted"),window.addEventListener("message",Ot),u==null||u.on("chat-events",Xt),a?i&&await $s("/"):ue=gr.subscribe(async le=>{le||await tn()}),localStorage.getItem(`chat-input-${S}`))try{const le=JSON.parse(localStorage.getItem(`chat-input-${S}`));t(22,Ke=le.prompt),t(24,fe=le.files),t(17,ce=le.selectedToolIds),t(19,se=le.webSearchEnabled),t(18,me=le.imageGenerationEnabled)}catch{t(22,Ke=""),t(24,fe=[]),t(17,ce=[]),t(19,se=!1),t(18,me=!1)}nn.subscribe(async le=>{if(R&&!y)try{le?L.openPane():R.collapse()}catch{}le||(jn.set(!1),Fo.set(!1),Mo.set(!1))});const z=document.getElementById("chat-input");z==null||z.focus(),hr.subscribe(()=>{})}),Qo(()=>{console.log("Destroy"),ue==null||ue(),window.removeEventListener("message",Ot),u==null||u.off("chat-events",Xt)});const rn=async z=>{var De,_e;if(console.log("Starting uploadGoogleDriveFile with:",{id:z.id,name:z.name,url:z.url,headers:{Authorization:`Bearer ${token}`}}),!(z!=null&&z.id)||!(z!=null&&z.name)||!(z!=null&&z.url)||!((De=z==null?void 0:z.headers)!=null&&De.Authorization))throw new Error("Invalid file data provided");const le=Uo(),ve={type:"file",file:"",id:null,url:z.url,name:z.name,collection_name:"",status:"uploading",error:"",itemId:le,size:0};try{t(24,fe=[...fe,ve]),console.log("Processing web file with URL:",z.url);const Ee={headers:{Authorization:z.headers.Authorization,Accept:"*/*"},method:"GET"};console.log("Fetching file content from Google Drive...");const we=await fetch(z.url,Ee);if(!we.ok){const Ft=await we.text();throw new Error(`Failed to fetch file (${we.status}): ${Ft}`)}const Te=we.headers.get("content-type")||"application/octet-stream";console.log("Response received with content-type:",Te),console.log("Converting response to blob...");const ze=await we.blob();if(ze.size===0)throw new Error("Retrieved file is empty");console.log("Blob created:",{size:ze.size,type:ze.type||Te});const bt=new File([ze],z.name,{type:ze.type||Te});if(console.log("File object created:",{name:bt.name,size:bt.size,type:bt.type}),bt.size===0)throw new Error("Created file is empty");console.log("Uploading file to server...");const zt=await uploadFile(localStorage.token,bt);if(!zt)throw new Error("Server returned null response for file upload");console.log("File uploaded successfully:",zt),ve.status="uploaded",ve.file=zt,ve.id=zt.id,ve.size=bt.size,ve.collection_name=(_e=zt==null?void 0:zt.meta)==null?void 0:_e.collection_name,ve.url=`${WEBUI_API_BASE_URL}/files/${zt.id}`,t(24,fe),t(0,S),at.success(l.t("File uploaded successfully"))}catch(Ee){console.error("Error uploading file:",Ee),t(24,fe=fe.filter(we=>we.itemId!==le)),at.error(l.t("Error uploading file: {{error}}",{error:Ee.message||"Unknown error"}))}},Wt=async z=>{console.log(z);const le={type:"doc",name:z,collection_name:"",status:"uploading",url:z,error:""};try{t(24,fe=[...fe,le]);const ve=await wm(localStorage.token,"",z);ve&&(le.status="uploaded",le.collection_name=ve.collection_name,le.file={...ve.file,...le.file},t(24,fe),t(0,S))}catch(ve){t(24,fe=fe.filter(De=>De.name!==z)),at.error(JSON.stringify(ve))}},Nt=async z=>{console.log(z);const le={type:"doc",name:z,collection_name:"",status:"uploading",context:"full",url:z,error:""};try{t(24,fe=[...fe,le]);const ve=await km(localStorage.token,z);ve&&(le.status="uploaded",le.collection_name=ve.collection_name,le.file={...ve.file,...le.file},t(24,fe),t(0,S))}catch(ve){t(24,fe=fe.filter(De=>De.name!==z)),at.error(`${ve}`)}},tn=async()=>{var ve,De,_e,Ee;if(_.url.searchParams.get("models"))t(1,B=(ve=_.url.searchParams.get("models"))==null?void 0:ve.split(","));else if(_.url.searchParams.get("model")){const we=(De=_.url.searchParams.get("model"))==null?void 0:De.split(",");if(we.length===1)if(c.find(ze=>ze.id===we[0]))t(1,B=we);else{const ze=document.getElementById("model-selector-0-button");if(ze){ze.click(),await rt();const bt=document.getElementById("model-search-input");bt&&(bt.focus(),bt.value=we[0],bt.dispatchEvent(new Event("input")))}}else t(1,B=we)}else sessionStorage.selectedModels?(t(1,B=JSON.parse(sessionStorage.selectedModels)),sessionStorage.removeItem("selectedModels")):s!=null&&s.models?t(1,B=s==null?void 0:s.models):f!=null&&f.default_models&&(console.log((f==null?void 0:f.default_models.split(","))??""),t(1,B=f==null?void 0:f.default_models.split(",")));t(1,B=B.filter(we=>c.map(Te=>Te.id).includes(we))),(B.length===0||B.length===1&&B[0]==="")&&(c.length>0?t(1,B=[c[0].id]):t(1,B=[""])),await nn.set(!1),await jn.set(!1),await Fo.set(!1),await Mo.set(!1),_.url.pathname.includes("/c/")&&window.history.replaceState(Y.state,"","/"),t(6,F=!0),await gr.set(""),await Bi.set(""),t(21,Y={messages:{},currentId:null}),t(23,mt=[]),t(25,xe={}),_.url.searchParams.get("youtube")&&Nt(`https://www.youtube.com/watch?v=${_.url.searchParams.get("youtube")}`),_.url.searchParams.get("web-search")==="true"&&t(19,se=!0),_.url.searchParams.get("image-generation")==="true"&&t(18,me=!0),_.url.searchParams.get("tools")?t(17,ce=(_e=_.url.searchParams.get("tools"))==null?void 0:_e.split(",").map(we=>we.trim()).filter(we=>we)):_.url.searchParams.get("tool-ids")&&t(17,ce=(Ee=_.url.searchParams.get("tool-ids"))==null?void 0:Ee.split(",").map(we=>we.trim()).filter(we=>we)),_.url.searchParams.get("call")==="true"&&(jn.set(!0),nn.set(!0)),_.url.searchParams.get("q")&&(t(22,Ke=_.url.searchParams.get("q")??""),Ke&&(await rt(),qe(Ke))),t(1,B=B.map(we=>c.map(Te=>Te.id).includes(we)?we:""));const z=await Zl(localStorage.token);z?zo.set(z.ui):zo.set(JSON.parse(localStorage.getItem("settings")??"{}"));const le=document.getElementById("chat-input");setTimeout(()=>le==null?void 0:le.focus(),0)},ie=async()=>{if(gr.set(S),He=await ba(localStorage.token,a).catch(async z=>(await $s("/"),null)),He){await ym(localStorage.token,a).catch(async le=>[]);const z=He.chat;if(z){console.log(z),t(1,B=((z==null?void 0:z.models)??void 0)!==void 0?z.models:[z.models??""]),t(21,Y=((z==null?void 0:z.history)??void 0)!==void 0?z.history:pm(z.messages)),Bi.set(z.title);const le=await Zl(localStorage.token);return le?await zo.set(le.ui):await zo.set(JSON.parse(localStorage.getItem("settings")??"{}")),t(25,xe=(z==null?void 0:z.params)??{}),t(23,mt=(z==null?void 0:z.files)??[]),t(6,F=!0),await rt(),Y.currentId&&t(21,Y.messages[Y.currentId].done=!0,Y),await rt(),!0}else return null}},Ge=async()=>{await rt(),q&&t(7,q.scrollTop=q.scrollHeight,q)},nt=async(z,le,ve,De)=>{const _e=await Lm(localStorage.token,{model:le,messages:De.map(Ee=>({id:Ee.id,role:Ee.role,content:Ee.content,info:Ee.info?Ee.info:void 0,timestamp:Ee.timestamp,...Ee.usage?{usage:Ee.usage}:{},...Ee.sources?{sources:Ee.sources}:{}})),model_item:c.find(Ee=>Ee.id===le),chat_id:z,session_id:u==null?void 0:u.id,id:ve}).catch(Ee=>(at.error(`${Ee}`),De.at(-1).error={content:Ee},null));if(_e!==null&&_e.messages)for(const Ee of _e.messages)Ee!=null&&Ee.id&&t(21,Y.messages[Ee.id]={...Y.messages[Ee.id],...Y.messages[Ee.id].content!==Ee.content?{originalContent:Y.messages[Ee.id].content}:{},...Ee},Y);await rt(),a==z&&(i||(t(21,Y.is_confidential=r,Y),He=await ta(localStorage.token,z,{models:B,messages:De,history:Y,params:xe,files:mt}),fr.set(1),await hr.set(await Rr(localStorage.token,n))))},vt=async(z,le,ve,De,_e=null)=>{const Ee=qn(Y,De),we=await Nm(localStorage.token,le,{model:ve,messages:Ee.map(Te=>({id:Te.id,role:Te.role,content:Te.content,info:Te.info?Te.info:void 0,timestamp:Te.timestamp,...Te.sources?{sources:Te.sources}:{}})),..._e?{event:_e}:{},model_item:c.find(Te=>Te.id===ve),chat_id:z,session_id:u==null?void 0:u.id,id:De}).catch(Te=>(at.error(`${Te}`),Ee.at(-1).error={content:Te},null));if(we!==null&&we.messages)for(const Te of we.messages)t(21,Y.messages[Te.id]={...Y.messages[Te.id],...Y.messages[Te.id].content!==Te.content?{originalContent:Y.messages[Te.id].content}:{},...Te},Y);a==z&&(i||(t(21,Y.is_confidential=r,Y),He=await ta(localStorage.token,z,{models:B,messages:Ee,history:Y,params:xe,files:mt}),fr.set(1),await hr.set(await Rr(localStorage.token,n))))},Me=async(z,le="")=>setInterval(()=>{u==null||u.emit("usage",{action:"chat",model:z,chat_id:le})},1e3),Yt=async z=>{if(t(22,Ke=""),B.length===0)at.error(l.t("Model not selected"));else{const le=B[0],ve=c.filter(bt=>bt.id===le).at(0),De=qn(Y,Y.currentId),_e=De.length!==0?De.at(-1):null,Ee=Uo(),we=Uo(),Te={id:Ee,parentId:_e?_e.id:null,childrenIds:[we],role:"user",content:z||`[PROMPT] ${Ee}`,timestamp:Math.floor(Date.now()/1e3)},ze={id:we,parentId:Ee,childrenIds:[],role:"assistant",content:`[RESPONSE] ${we}`,done:!0,model:le,modelName:ve.name??ve.id,modelIdx:0,timestamp:Math.floor(Date.now()/1e3)};_e&&(_e.childrenIds.push(Ee),t(21,Y.messages[_e.id]=_e,Y)),t(21,Y.messages[Ee]=Te,Y),t(21,Y.messages[we]=ze,Y),t(21,Y.currentId=we,Y),await rt(),F&&Ge(),De.length===0?await Jt(Y):await qt(a,Y)}},Tt=async({modelId:z,parentId:le,messages:ve})=>{const De=c.filter(we=>we.id===z).at(0);let _e=Y.messages[le],Ee=_e?_e.id:null;for(const we of ve){let Te=Uo();if(we.role==="user"){const ze={id:Te,parentId:Ee,childrenIds:[],timestamp:Math.floor(Date.now()/1e3),...we};_e&&(_e.childrenIds.push(Te),t(21,Y.messages[_e.id]=_e,Y)),t(21,Y.messages[Te]=ze,Y),_e=ze,Ee=Te}else{const ze={id:Te,parentId:Ee,childrenIds:[],done:!0,model:De.id,modelName:De.name??De.id,modelIdx:0,timestamp:Math.floor(Date.now()/1e3),...we};_e&&(_e.childrenIds.push(Te),t(21,Y.messages[_e.id]=_e,Y)),t(21,Y.messages[Te]=ze,Y),_e=ze,Ee=Te}}t(21,Y.currentId=Ee,Y),await rt(),F&&Ge(),ve.length===0?await Jt(Y):await qt(a,Y)},he=async(z,le,ve)=>{var Ft,Mt,Kt,Nn,Fn,uo,fo,no,Kn,Gn,Dn,En,oo,In;const{id:De,done:_e,choices:Ee,content:we,sources:Te,selected_model_id:ze,error:bt,usage:zt}=z;if(bt&&await It(bt,le),Te&&(le.sources=Te),Ee)if((Mt=(Ft=Ee[0])==null?void 0:Ft.message)!=null&&Mt.content)le.content+=(Nn=(Kt=Ee[0])==null?void 0:Kt.message)==null?void 0:Nn.content;else{let Zt=((uo=(Fn=Ee[0])==null?void 0:Fn.delta)==null?void 0:uo.content)??"";if(le.content==""&&Zt==`
`)console.log("Empty response");else{le.content+=Zt,navigator.vibrate&&((s==null?void 0:s.hapticFeedback)??!1)&&navigator.vibrate(5);const An=ea(le.content,((no=(fo=f==null?void 0:f.audio)==null?void 0:fo.tts)==null?void 0:no.split_on)??"punctuation");An.pop(),An.length>0&&An[An.length-1]!==le.lastSentence&&(le.lastSentence=An[An.length-1],H.dispatchEvent(new CustomEvent("chat",{detail:{id:le.id,content:An[An.length-1]}})))}}if(we){le.content=we,navigator.vibrate&&((s==null?void 0:s.hapticFeedback)??!1)&&navigator.vibrate(5);const Zt=ea(le.content,((Gn=(Kn=f==null?void 0:f.audio)==null?void 0:Kn.tts)==null?void 0:Gn.split_on)??"punctuation");Zt.pop(),Zt.length>0&&Zt[Zt.length-1]!==le.lastSentence&&(le.lastSentence=Zt[Zt.length-1],H.dispatchEvent(new CustomEvent("chat",{detail:{id:le.id,content:Zt[Zt.length-1]}})))}if(ze&&(le.selectedModelId=ze,le.arena=!0),zt&&(le.usage=zt),t(21,Y.messages[le.id]=le,Y),_e){le.done=!0,s.responseAutoCopy&&Ya(le.content),s.responseAutoPlayback&&!h&&(await rt(),(Dn=document.getElementById(`speak-button-${le.id}`))==null||Dn.click());let Zt=((In=ea(le.content,((oo=(En=f==null?void 0:f.audio)==null?void 0:En.tts)==null?void 0:oo.split_on)??"punctuation"))==null?void 0:In.at(-1))??"";Zt&&H.dispatchEvent(new CustomEvent("chat",{detail:{id:le.id,content:Zt}})),H.dispatchEvent(new CustomEvent("chat:finish",{detail:{id:le.id,content:le.content}})),t(21,Y.messages[le.id]=le,Y),await nt(ve,le.model,le.id,qn(Y,le.id))}console.log(z),F&&Ge()},qe=async(z,{_raw:le=!1}={})=>{var bt,zt,Ft;console.log("submitPrompt",z,a);const ve=qn(Y,Y.currentId),De=B.map(Mt=>c.map(Kt=>Kt.id).includes(Mt)?Mt:"");if(JSON.stringify(B)!==JSON.stringify(De)&&t(1,B=De),z===""&&fe.length===0){at.error(l.t("Please enter a prompt"));return}if(B.includes("")){at.error(l.t("Model not selected"));return}if(ve.length!=0&&ve.at(-1).done!=!0)return;if(ve.length!=0&&ve.at(-1).error&&!ve.at(-1).content){at.error(l.t("Oops! There was an error in the previous response."));return}if(fe.length>0&&fe.filter(Mt=>Mt.type!=="image"&&Mt.status==="uploading").length>0){at.error(l.t("Oops! There are files still uploading. Please wait for the upload to complete."));return}if((((bt=f==null?void 0:f.file)==null?void 0:bt.max_count)??null)!==null&&fe.length+mt.length>((zt=f==null?void 0:f.file)==null?void 0:zt.max_count)){at.error(l.t("You can only chat with a maximum of {{maxCount}} file(s) at a time.",{maxCount:(Ft=f==null?void 0:f.file)==null?void 0:Ft.max_count}));return}t(22,Ke="");const _e=document.getElementById("chat-input");_e&&(await rt(),_e.style.height="",_e.style.height=Math.min(_e.scrollHeight,320)+"px");const Ee=JSON.parse(JSON.stringify(fe));mt.push(...Ee.filter(Mt=>["doc","file","collection"].includes(Mt.type))),t(23,mt=mt.filter((Mt,Kt,Nn)=>Nn.findIndex(Fn=>JSON.stringify(Fn)===JSON.stringify(Mt))===Kt)),t(24,fe=[]),t(22,Ke="");let we=Uo(),Te={id:we,parentId:ve.length!==0?ve.at(-1).id:null,childrenIds:[],role:"user",content:z,files:Ee.length>0?Ee:void 0,timestamp:Math.floor(Date.now()/1e3),models:B};t(21,Y.messages[we]=Te,Y),t(21,Y.currentId=we,Y),ve.length!==0&&Y.messages[ve.at(-1).id].childrenIds.push(we);const ze=document.getElementById("chat-input");ze==null||ze.focus(),gt(),await Oe(Y,z,we,{newChat:!0})},Oe=async(z,le,ve,{modelId:De=null,modelIdx:_e=null,newChat:Ee=!1}={})=>{let we=JSON.parse(JSON.stringify(a));z=JSON.parse(JSON.stringify(z));const Te={};let ze=De?[De]:x!==void 0?[x.id]:B;for(const[bt,zt]of ze.entries()){const Ft=c.filter(Mt=>Mt.id===zt).at(0);if(Ft){let Mt=Uo(),Kt={parentId:ve,id:Mt,childrenIds:[],role:"assistant",content:"",model:Ft.id,modelName:Ft.name??Ft.id,modelIdx:_e||bt,userContext:null,timestamp:Math.floor(Date.now()/1e3)};t(21,Y.messages[Mt]=Kt,Y),t(21,Y.currentId=Mt,Y),ve!==null&&Y.messages[ve]&&t(21,Y.messages[ve].childrenIds=[...Y.messages[ve].childrenIds,Mt],Y),Te[`${zt}-${_e||bt}`]=Mt}}t(21,Y),Ee&&z.messages[z.currentId].parentId===null&&(we=await Jt(z)),await rt(),z=JSON.parse(JSON.stringify(Y)),await qt(we,z),await Promise.all(ze.map(async(bt,zt)=>{var Mt,Kt,Nn;console.log("modelId",bt);const Ft=c.filter(Fn=>Fn.id===bt).at(0);if(Ft){qn(z,ve).some(Dn=>{var En;return(En=Dn.files)==null?void 0:En.some(oo=>oo.type==="image")})&&!(((Nn=(Kt=(Mt=Ft.info)==null?void 0:Mt.meta)==null?void 0:Kt.capabilities)==null?void 0:Nn.vision)??!0)&&at.error(l.t("Model {{modelName}} is not vision capable",{modelName:Ft.name??Ft.id}));let fo=Te[`${bt}-${_e||zt}`],no=z.messages[fo],Kn=null;if(((s==null?void 0:s.memory)??!1)&&Kn===null){const Dn=await Rm(localStorage.token,le).catch(En=>(at.error(`${En}`),null));Dn&&(Dn.documents[0].length>0&&(Kn=Dn.documents[0].reduce((En,oo,In)=>{const Zt=Dn.metadatas[0][In].created_at,An=new Date(Zt*1e3).toISOString().split("T")[0];return`${En}${In+1}. [${An}]. ${oo}
`},"")),console.log(Kn))}no.userContext=Kn;const Gn=await Me(Ft.id,we);Ge(),await $e(z,Ft,fo),Gn&&clearInterval(Gn)}else at.error(l.t("Model {{modelId}} not found",{modelId:bt}))})),fr.set(1),hr.set(await Rr(localStorage.token,n)),console.log("sendPrompt: ",z)},$e=async(z,le,ve,De)=>{var zt,Ft,Mt,Kt,Nn,Fn,uo,fo,no,Kn,Gn,Dn,En,oo,In,Zt,An,cr,ni;const _e=z.messages[ve],Ee=z.messages[_e.parentId];let we=JSON.parse(JSON.stringify(mt));we.push(...((Ee==null?void 0:Ee.files)??[]).filter(dt=>["doc","file","collection"].includes(dt.type)),...((_e==null?void 0:_e.files)??[]).filter(dt=>["web_search_results"].includes(dt.type))),we=we.filter((dt,Zo,ur)=>ur.findIndex(dr=>JSON.stringify(dr)===JSON.stringify(dt))===Zo),Ge(),H.dispatchEvent(new CustomEvent("chat:start",{detail:{id:ve}})),await rt();const Te=((Ft=(zt=le==null?void 0:le.info)==null?void 0:zt.params)==null?void 0:Ft.stream_response)??((Mt=s==null?void 0:s.params)==null?void 0:Mt.stream_response)??(xe==null?void 0:xe.stream_response)??!0;let ze=[xe!=null&&xe.system||s.system||((_e==null?void 0:_e.userContext)??null)?{role:"system",content:`${hm((xe==null?void 0:xe.system)??(s==null?void 0:s.system)??"",d.name,s!=null&&s.userLocation?await $l(localStorage.token).catch(dt=>{console.error(dt)}):void 0)}${(_e==null?void 0:_e.userContext)??null?`

User Context:
${(_e==null?void 0:_e.userContext)??""}`:""}`}:void 0,...qn(z,ve).map(dt=>({...dt,content:gm(dt.content,["reasoning","code_interpreter"])}))].filter(dt=>dt);ze=ze.map((dt,Zo,ur)=>{var dr,oi,ri;return{role:dt.role,...((dr=dt.files)==null?void 0:dr.filter($o=>$o.type==="image").length)>0&&dt.role==="user"?{content:[{type:"text",text:((oi=dt==null?void 0:dt.merged)==null?void 0:oi.content)??dt.content},...dt.files.filter($o=>$o.type==="image").map($o=>({type:"image_url",image_url:{url:$o.url}}))]}:{content:((ri=dt==null?void 0:dt.merged)==null?void 0:ri.content)??dt.content}}}).filter(dt=>{var Zo;return(dt==null?void 0:dt.role)==="user"||((Zo=dt==null?void 0:dt.content)==null?void 0:Zo.trim())});const bt=await vm(localStorage.token,{stream:Te,model:le.id,messages:ze,params:{...s==null?void 0:s.params,...xe,format:s.requestFormat??void 0,keep_alive:s.keepAlive??void 0,stop:(xe==null?void 0:xe.stop)??((Kt=s==null?void 0:s.params)==null?void 0:Kt.stop)??void 0?((xe==null?void 0:xe.stop.split(",").map(dt=>dt.trim()))??s.params.stop).map(dt=>decodeURIComponent(JSON.parse('"'+dt.replace(/\"/g,'\\"')+'"'))):void 0},files:((we==null?void 0:we.length)??0)>0?we:void 0,tool_ids:ce.length>0?ce:void 0,features:{image_generation:(Nn=f==null?void 0:f.features)!=null&&Nn.enable_image_generation&&(d.role==="admin"||(uo=(Fn=d==null?void 0:d.permissions)==null?void 0:Fn.features)!=null&&uo.image_generation)?me:!1,code_interpreter:(fo=f==null?void 0:f.features)!=null&&fo.enable_code_interpreter&&(d.role==="admin"||(Kn=(no=d==null?void 0:d.permissions)==null?void 0:no.features)!=null&&Kn.code_interpreter)?Be:!1,web_search:(Gn=f==null?void 0:f.features)!=null&&Gn.enable_web_search&&(d.role==="admin"||(En=(Dn=d==null?void 0:d.permissions)==null?void 0:Dn.features)!=null&&En.web_search)?se||((s==null?void 0:s.webSearch)??!1)==="always":!1},variables:{...mm(d.name,s!=null&&s.userLocation?await $l(localStorage.token).catch(dt=>{console.error(dt)}):void 0)},model_item:c.find(dt=>dt.id===le.id),session_id:u==null?void 0:u.id,chat_id:a,id:ve,...!i&&(ze.length==1||ze.length==2&&((oo=ze.at(0))==null?void 0:oo.role)==="system"&&((In=ze.at(1))==null?void 0:In.role)==="user")&&(B[0]===le.id||x!==void 0)?{background_tasks:{title_generation:((Zt=s==null?void 0:s.title)==null?void 0:Zt.auto)??!0,tags_generation:(s==null?void 0:s.autoTags)??!0}}:{},...Te&&(((ni=(cr=(An=le.info)==null?void 0:An.meta)==null?void 0:cr.capabilities)==null?void 0:ni.usage)??!1)?{stream_options:{include_usage:!0}}:{}},`${hi}/api`).catch(dt=>(at.error(`${dt}`),_e.error={content:dt},_e.done=!0,t(21,Y.messages[ve]=_e,Y),t(21,Y.currentId=ve,Y),null));console.log(bt),bt&&(Xe=bt.task_id),await rt(),Ge()},It=async(z,le)=>{let ve="",De;z&&(De=z),console.error(De),"detail"in De?(at.error(De.detail),ve=De.detail):"error"in De?"message"in De.error?(at.error(De.error.message),ve=De.error.message):(at.error(De.error),ve=De.error):"message"in De&&(at.error(De.message),ve=De.message),le.error={content:l.t("Uh-oh! There was an issue with the response.")+`
`+ve},le.done=!0,le.statusHistory&&(le.statusHistory=le.statusHistory.filter(_e=>_e.action!=="knowledge_search")),t(21,Y.messages[le.id]=le,Y)},kt=()=>{if(Xe&&Dm(localStorage.token,Xe).catch(le=>null)){Xe=null;const le=Y.messages[Y.currentId];le.done=!0,t(21,Y.messages[Y.currentId]=le,Y),F&&Ge()}},Rt=async(z,le)=>{let ve=le,De=Uo(),_e={id:De,parentId:z,childrenIds:[],role:"user",content:ve,models:B};z!==null&&t(21,Y.messages[z].childrenIds=[...Y.messages[z].childrenIds,De],Y),t(21,Y.messages[De]=_e,Y),t(21,Y.currentId=De,Y),await rt(),await Oe(Y,ve,De)},pt=async z=>{if(console.log("regenerateResponse"),Y.currentId){let le=Y.messages[z.parentId],ve=le.content;((le==null?void 0:le.models)??[...B]).length==1?await Oe(Y,ve,le.id):await Oe(Y,ve,le.id,{modelId:z.model,modelIdx:z.modelIdx})}},dn=async()=>{if(console.log("continueResponse"),JSON.parse(JSON.stringify(a)),Y.currentId&&Y.messages[Y.currentId].done==!0){const z=Y.messages[Y.currentId];z.done=!1,await rt();const le=c.filter(ve=>ve.id===((z==null?void 0:z.selectedModelId)??z.model)).at(0);le&&await $e(Y,le,z.id)}},sn=async(z,le,ve)=>{console.log("mergeResponses",z,le);const De=Y.messages[z],_e={status:!0,content:""};De.merged=_e,t(21,Y.messages[z]=De,Y);try{const[Ee,we]=await Hm(localStorage.token,De.model,Y.messages[De.parentId].content,le);if(Ee&&Ee.ok&&Ee.body){const Te=await Yp(Ee.body,s.splitLargeChunks);for await(const ze of Te){const{value:bt,done:zt,sources:Ft,error:Mt,usage:Kt}=ze;if(Mt||zt)break;_e.content==""&&bt==`
`||(_e.content+=bt,t(21,Y.messages[z]=De,Y),F&&Ge())}await qt(ve,Y)}else console.error(Ee)}catch(Ee){console.error(Ee)}},Jt=async z=>{let le=a;return i?(le="local",await gr.set("local")):(z.is_confidential=r,He=await _m(localStorage.token,{id:le,title:l.t("New Chat"),models:B,system:s.system??void 0,params:xe,history:z,messages:qn(z,z.currentId),tags:[],timestamp:Date.now()}),le=He.id,await gr.set(le),await hr.set(await Rr(localStorage.token,n)),fr.set(1),window.history.replaceState(z.state,"",`/c/${le}`)),await rt(),le},qt=async(z,le)=>{a==z&&(i||(le.is_confidential=r,He=await ta(localStorage.token,z,{models:B,history:le,messages:qn(le,le.currentId),params:xe,files:mt}),fr.set(1),await hr.set(await Rr(localStorage.token,n))))};function fn(z){A=z,t(9,A)}const bn=z=>{z.detail?j(z.detail):j(!0)},Cn=()=>{j(!1)};function xt(z){Ye[z?"unshift":"push"](()=>{W=z,t(8,W)})}function Ht(z){B=z,t(1,B)}const xn=z=>z.dismissible?!JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]").includes(z.id):!0,Bn=z=>{const le=z.detail;localStorage.setItem("dismissedBannerIds",JSON.stringify([le,...JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]")].filter(ve=>C.find(De=>De.id===ve))))};function Zn(z){Y=z,t(21,Y)}function ao(z){F=z,t(6,F)}function wo(z){Ke=z,t(22,Ke),t(0,S)}function Do(z){Ye[z?"unshift":"push"](()=>{q=z,t(7,q)})}const $n=z=>{t(6,F=q.scrollHeight-q.scrollTop<=q.clientHeight+5)},eo=z=>{z.prompt?localStorage.setItem(`chat-input-${a}`,JSON.stringify(z)):localStorage.removeItem(`chat-input-${a}`)};function yn(z){fe=z,t(24,fe),t(0,S)}function K(z){Ke=z,t(22,Ke),t(0,S)}function Pe(z){F=z,t(6,F)}function Ze(z){ce=z,t(17,ce),t(0,S)}function ut(z){me=z,t(18,me),t(0,S)}function We(z){Be=z,t(20,Be)}function it(z){se=z,t(19,se),t(0,S)}function On(z){x=z,t(2,x)}const zn=async z=>{const{type:le,data:ve}=z.detail;le==="web"?await Wt(ve):le==="youtube"?await Nt(ve):le==="google-drive"&&await rn(ve)},Ct=async z=>{(z.detail||fe.length>0)&&(await rt(),qe((s==null?void 0:s.richTextInput)??!0?z.detail.replaceAll(`

`,`
`):z.detail))};function cn(z){fe=z,t(24,fe),t(0,S)}function to(z){Ke=z,t(22,Ke),t(0,S)}function lo(z){F=z,t(6,F)}function ko(z){ce=z,t(17,ce),t(0,S)}function co(z){me=z,t(18,me),t(0,S)}function Sr(z){Be=z,t(20,Be)}function ar(z){se=z,t(19,se),t(0,S)}function Z(z){x=z,t(2,x)}const Jo=async z=>{const{type:le,data:ve}=z.detail;le==="web"?await Wt(ve):le==="youtube"&&await Nt(ve)},lr=async z=>{(z.detail||fe.length>0)&&(await rt(),qe((s==null?void 0:s.richTextInput)??!0?z.detail.replaceAll(`

`,`
`):z.detail))},Ar=(z,le,ve,De)=>{const _e=c.find(Ee=>Ee.id===le);return _e?[...z,_e]:z};function ei(z){Ye[z?"unshift":"push"](()=>{L=z,t(5,L)})}function Ho(z){Y=z,t(21,Y)}function Pi(z){mt=z,t(23,mt)}function ti(z){xe=z,t(25,xe)}function Co(z){fe=z,t(24,fe),t(0,S)}function xo(z){R=z,t(4,R)}return o.$$set=z=>{"chatIdProp"in z&&t(0,S=z.chatIdProp)},o.$$.update=()=>{o.$$.dirty[0]&6&&t(16,J=x!==void 0?[x.id]:B),o.$$.dirty[0]&1&&S&&(async()=>{if(t(3,E=!0),console.log(S),t(22,Ke=""),t(24,fe=[]),t(17,ce=[]),t(19,se=!1),t(18,me=!1),S&&await ie()){if(await rt(),t(3,E=!1),localStorage.getItem(`chat-input-${S}`))try{const le=JSON.parse(localStorage.getItem(`chat-input-${S}`));t(22,Ke=le.prompt),t(24,fe=le.files),t(17,ce=le.selectedToolIds),t(19,se=le.webSearchEnabled),t(18,me=le.imageGenerationEnabled)}catch{}window.setTimeout(()=>Ge(),0);const z=document.getElementById("chat-input");z==null||z.focus()}else await $s("/")})(),o.$$.dirty[0]&3&&B&&S!==""&&gt(),o.$$.dirty[0]&2&&B&&Et(),o.$$.dirty[0]&6&&(x||B)&&Et()},[S,B,x,E,R,L,F,q,W,A,V,N,G,X,Q,j,J,ce,me,se,Be,Y,Ke,mt,fe,xe,a,s,l,c,f,m,b,w,C,O,H,Bt,rn,Wt,Nt,tn,vt,Yt,Tt,qe,Oe,kt,Rt,pt,dn,sn,fn,bn,Cn,xt,Ht,xn,Bn,Zn,ao,wo,Do,$n,eo,yn,K,Pe,Ze,ut,We,it,On,zn,Ct,cn,to,lo,ko,co,Sr,ar,Z,Jo,lr,Ar,ei,Ho,Pi,ti,Co,xo]}class JT extends Ve{constructor(e){super(),Fe(this,e,II,EI,Qe,{chatIdProp:0},null,[-1,-1,-1,-1])}}function TI(o){let e,t,n,r=o[1].t("Keyboard shortcuts")+"",i,a,s,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg>',c,u,d,f,h,_,y=o[1].t("Open new chat")+"",v,m,b,w='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/⌘</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Shift</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">O</div>',C,O,S,E=o[1].t("Focus chat input")+"",H,R,L,F='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Shift</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Esc</div>',q,W,A,V=o[1].t("Copy last code block")+"",N,G,X,Q='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/⌘</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Shift</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">;</div>',j,ue,B,x=o[1].t("Copy last response")+"",J,ce,me,se='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/⌘</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Shift</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">C</div>',Be,He,Y,Xe=o[1].t("Generate prompt pair")+"",Ke,mt,fe,xe='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/⌘</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Shift</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Enter</div>',gt,Et,Bt,Xt,Ot=o[1].t("Toggle settings")+"",rn,Wt,Nt,tn='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/⌘</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">.</div>',ie,Ge,nt,vt=o[1].t("Toggle sidebar")+"",Me,Yt,Tt,he='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/⌘</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Shift</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">S</div>',qe,Oe,$e,It=o[1].t("Delete chat")+"",kt,Rt,pt,dn='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/⌘</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Shift</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">⌫/Delete</div>',sn,Jt,qt,fn=o[1].t("Show shortcuts")+"",bn,Cn,xt,Ht='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">Ctrl/⌘</div> <div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">/</div>',xn,Bn,Zn,ao=o[1].t("Input commands")+"",wo,Do,$n,eo,yn,K,Pe,Ze=o[1].t("Attach file from knowledge")+"",ut,We,it,On='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">#</div>',zn,Ct,cn,to=o[1].t("Add custom prompt")+"",lo,ko,co,Sr='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">/</div>',ar,Z,Jo,lr=o[1].t("Talk to model")+"",Ar,ei,Ho,Pi='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">@</div>',ti,Co,xo,z=o[1].t("Accept autocomplete generation / Jump to prompt variable")+"",le,ve,De,_e='<div class="h-fit py-1 px-2 flex items-center justify-center rounded-sm border border-black/10 capitalize text-gray-600 dark:border-white/10 dark:text-gray-300">TAB</div>',Ee,we;return{c(){e=M("div"),t=M("div"),n=M("div"),i=Se(r),a=$(),s=M("button"),s.innerHTML=l,c=$(),u=M("div"),d=M("div"),f=M("div"),h=M("div"),_=M("div"),v=Se(y),m=$(),b=M("div"),b.innerHTML=w,C=$(),O=M("div"),S=M("div"),H=Se(E),R=$(),L=M("div"),L.innerHTML=F,q=$(),W=M("div"),A=M("div"),N=Se(V),G=$(),X=M("div"),X.innerHTML=Q,j=$(),ue=M("div"),B=M("div"),J=Se(x),ce=$(),me=M("div"),me.innerHTML=se,Be=$(),He=M("div"),Y=M("div"),Ke=Se(Xe),mt=$(),fe=M("div"),fe.innerHTML=xe,gt=$(),Et=M("div"),Bt=M("div"),Xt=M("div"),rn=Se(Ot),Wt=$(),Nt=M("div"),Nt.innerHTML=tn,ie=$(),Ge=M("div"),nt=M("div"),Me=Se(vt),Yt=$(),Tt=M("div"),Tt.innerHTML=he,qe=$(),Oe=M("div"),$e=M("div"),kt=Se(It),Rt=$(),pt=M("div"),pt.innerHTML=dn,sn=$(),Jt=M("div"),qt=M("div"),bn=Se(fn),Cn=$(),xt=M("div"),xt.innerHTML=Ht,xn=$(),Bn=M("div"),Zn=M("div"),wo=Se(ao),Do=$(),$n=M("div"),eo=M("div"),yn=M("div"),K=M("div"),Pe=M("div"),ut=Se(Ze),We=$(),it=M("div"),it.innerHTML=On,zn=$(),Ct=M("div"),cn=M("div"),lo=Se(to),ko=$(),co=M("div"),co.innerHTML=Sr,ar=$(),Z=M("div"),Jo=M("div"),Ar=Se(lr),ei=$(),Ho=M("div"),Ho.innerHTML=Pi,ti=$(),Co=M("div"),xo=M("div"),le=Se(z),ve=$(),De=M("div"),De.innerHTML=_e,this.h()},l(Te){e=P(Te,"DIV",{class:!0});var ze=I(e);t=P(ze,"DIV",{class:!0});var bt=I(t);n=P(bt,"DIV",{class:!0});var zt=I(n);i=Ae(zt,r),zt.forEach(p),a=ee(bt),s=P(bt,"BUTTON",{class:!0,"data-svelte-h":!0}),wt(s)!=="svelte-745w2y"&&(s.innerHTML=l),bt.forEach(p),c=ee(ze),u=P(ze,"DIV",{class:!0});var Ft=I(u);d=P(Ft,"DIV",{class:!0});var Mt=I(d);f=P(Mt,"DIV",{class:!0});var Kt=I(f);h=P(Kt,"DIV",{class:!0});var Nn=I(h);_=P(Nn,"DIV",{class:!0});var Fn=I(_);v=Ae(Fn,y),Fn.forEach(p),m=ee(Nn),b=P(Nn,"DIV",{class:!0,"data-svelte-h":!0}),wt(b)!=="svelte-1ykt4pq"&&(b.innerHTML=w),Nn.forEach(p),C=ee(Kt),O=P(Kt,"DIV",{class:!0});var uo=I(O);S=P(uo,"DIV",{class:!0});var fo=I(S);H=Ae(fo,E),fo.forEach(p),R=ee(uo),L=P(uo,"DIV",{class:!0,"data-svelte-h":!0}),wt(L)!=="svelte-9s7il5"&&(L.innerHTML=F),uo.forEach(p),q=ee(Kt),W=P(Kt,"DIV",{class:!0});var no=I(W);A=P(no,"DIV",{class:!0});var Kn=I(A);N=Ae(Kn,V),Kn.forEach(p),G=ee(no),X=P(no,"DIV",{class:!0,"data-svelte-h":!0}),wt(X)!=="svelte-1rhjj6y"&&(X.innerHTML=Q),no.forEach(p),j=ee(Kt),ue=P(Kt,"DIV",{class:!0});var Gn=I(ue);B=P(Gn,"DIV",{class:!0});var Dn=I(B);J=Ae(Dn,x),Dn.forEach(p),ce=ee(Gn),me=P(Gn,"DIV",{class:!0,"data-svelte-h":!0}),wt(me)!=="svelte-88t2mq"&&(me.innerHTML=se),Gn.forEach(p),Be=ee(Kt),He=P(Kt,"DIV",{class:!0});var En=I(He);Y=P(En,"DIV",{class:!0});var oo=I(Y);Ke=Ae(oo,Xe),oo.forEach(p),mt=ee(En),fe=P(En,"DIV",{class:!0,"data-svelte-h":!0}),wt(fe)!=="svelte-71xcgz"&&(fe.innerHTML=xe),En.forEach(p),Kt.forEach(p),gt=ee(Mt),Et=P(Mt,"DIV",{class:!0});var In=I(Et);Bt=P(In,"DIV",{class:!0});var Zt=I(Bt);Xt=P(Zt,"DIV",{class:!0});var An=I(Xt);rn=Ae(An,Ot),An.forEach(p),Wt=ee(Zt),Nt=P(Zt,"DIV",{class:!0,"data-svelte-h":!0}),wt(Nt)!=="svelte-sstb0e"&&(Nt.innerHTML=tn),Zt.forEach(p),ie=ee(In),Ge=P(In,"DIV",{class:!0});var cr=I(Ge);nt=P(cr,"DIV",{class:!0});var ni=I(nt);Me=Ae(ni,vt),ni.forEach(p),Yt=ee(cr),Tt=P(cr,"DIV",{class:!0,"data-svelte-h":!0}),wt(Tt)!=="svelte-shqiv6"&&(Tt.innerHTML=he),cr.forEach(p),qe=ee(In),Oe=P(In,"DIV",{class:!0});var dt=I(Oe);$e=P(dt,"DIV",{class:!0});var Zo=I($e);kt=Ae(Zo,It),Zo.forEach(p),Rt=ee(dt),pt=P(dt,"DIV",{class:!0,"data-svelte-h":!0}),wt(pt)!=="svelte-1czc2xm"&&(pt.innerHTML=dn),dt.forEach(p),sn=ee(In),Jt=P(In,"DIV",{class:!0});var ur=I(Jt);qt=P(ur,"DIV",{class:!0});var dr=I(qt);bn=Ae(dr,fn),dr.forEach(p),Cn=ee(ur),xt=P(ur,"DIV",{class:!0,"data-svelte-h":!0}),wt(xt)!=="svelte-10s6aob"&&(xt.innerHTML=Ht),ur.forEach(p),In.forEach(p),Mt.forEach(p),Ft.forEach(p),xn=ee(ze),Bn=P(ze,"DIV",{class:!0});var oi=I(Bn);Zn=P(oi,"DIV",{class:!0});var ri=I(Zn);wo=Ae(ri,ao),ri.forEach(p),oi.forEach(p),Do=ee(ze),$n=P(ze,"DIV",{class:!0});var $o=I($n);eo=P($o,"DIV",{class:!0});var Fl=I(eo);yn=P(Fl,"DIV",{class:!0});var er=I(yn);K=P(er,"DIV",{class:!0});var Oi=I(K);Pe=P(Oi,"DIV",{class:!0});var Kl=I(Pe);ut=Ae(Kl,Ze),Kl.forEach(p),We=ee(Oi),it=P(Oi,"DIV",{class:!0,"data-svelte-h":!0}),wt(it)!=="svelte-npid8c"&&(it.innerHTML=On),Oi.forEach(p),zn=ee(er),Ct=P(er,"DIV",{class:!0});var Ni=I(Ct);cn=P(Ni,"DIV",{class:!0});var Gl=I(cn);lo=Ae(Gl,to),Gl.forEach(p),ko=ee(Ni),co=P(Ni,"DIV",{class:!0,"data-svelte-h":!0}),wt(co)!=="svelte-1x4z9aw"&&(co.innerHTML=Sr),Ni.forEach(p),ar=ee(er),Z=P(er,"DIV",{class:!0});var Di=I(Z);Jo=P(Di,"DIV",{class:!0});var Wl=I(Jo);Ar=Ae(Wl,lr),Wl.forEach(p),ei=ee(Di),Ho=P(Di,"DIV",{class:!0,"data-svelte-h":!0}),wt(Ho)!=="svelte-1ia95ih"&&(Ho.innerHTML=Pi),Di.forEach(p),ti=ee(er),Co=P(er,"DIV",{class:!0});var Hi=I(Co);xo=P(Hi,"DIV",{class:!0});var Yl=I(xo);le=Ae(Yl,z),Yl.forEach(p),ve=ee(Hi),De=P(Hi,"DIV",{class:!0,"data-svelte-h":!0}),wt(De)!=="svelte-1hbxzzi"&&(De.innerHTML=_e),Hi.forEach(p),er.forEach(p),Fl.forEach(p),$o.forEach(p),ze.forEach(p),this.h()},h(){g(n,"class","text-lg font-medium self-center"),g(s,"class","self-center"),g(t,"class","flex justify-between dark:text-gray-300 px-5 pt-4"),g(_,"class","text-sm"),g(b,"class","flex space-x-1 text-xs"),g(h,"class","w-full flex justify-between items-center"),g(S,"class","text-sm"),g(L,"class","flex space-x-1 text-xs"),g(O,"class","w-full flex justify-between items-center"),g(A,"class","text-sm"),g(X,"class","flex space-x-1 text-xs"),g(W,"class","w-full flex justify-between items-center"),g(B,"class","text-sm"),g(me,"class","flex space-x-1 text-xs"),g(ue,"class","w-full flex justify-between items-center"),g(Y,"class","text-sm"),g(fe,"class","flex space-x-1 text-xs"),g(He,"class","w-full flex justify-between items-center"),g(f,"class","flex flex-col space-y-3 w-full self-start"),g(Xt,"class","text-sm"),g(Nt,"class","flex space-x-1 text-xs"),g(Bt,"class","w-full flex justify-between items-center"),g(nt,"class","text-sm"),g(Tt,"class","flex space-x-1 text-xs"),g(Ge,"class","w-full flex justify-between items-center"),g($e,"class","text-sm"),g(pt,"class","flex space-x-1 text-xs"),g(Oe,"class","w-full flex justify-between items-center"),g(qt,"class","text-sm"),g(xt,"class","flex space-x-1 text-xs"),g(Jt,"class","w-full flex justify-between items-center"),g(Et,"class","flex flex-col space-y-3 w-full self-start"),g(d,"class","flex flex-col w-full sm:flex-row sm:justify-center sm:space-x-6"),g(u,"class","flex flex-col md:flex-row w-full p-5 md:space-x-4 dark:text-gray-200"),g(Zn,"class","text-lg font-medium self-center"),g(Bn,"class","flex justify-between dark:text-gray-300 px-5"),g(Pe,"class","text-sm"),g(it,"class","flex space-x-1 text-xs"),g(K,"class","w-full flex justify-between items-center"),g(cn,"class","text-sm"),g(co,"class","flex space-x-1 text-xs"),g(Ct,"class","w-full flex justify-between items-center"),g(Jo,"class","text-sm"),g(Ho,"class","flex space-x-1 text-xs"),g(Z,"class","w-full flex justify-between items-center"),g(xo,"class","text-sm"),g(De,"class","flex space-x-1 text-xs"),g(Co,"class","w-full flex justify-between items-center"),g(yn,"class","flex flex-col space-y-3 w-full self-start"),g(eo,"class","flex flex-col w-full sm:flex-row sm:justify-center sm:space-x-6"),g($n,"class","flex flex-col md:flex-row w-full p-5 md:space-x-4 dark:text-gray-200"),g(e,"class","text-gray-700 dark:text-gray-100")},m(Te,ze){U(Te,e,ze),k(e,t),k(t,n),k(n,i),k(t,a),k(t,s),k(e,c),k(e,u),k(u,d),k(d,f),k(f,h),k(h,_),k(_,v),k(h,m),k(h,b),k(f,C),k(f,O),k(O,S),k(S,H),k(O,R),k(O,L),k(f,q),k(f,W),k(W,A),k(A,N),k(W,G),k(W,X),k(f,j),k(f,ue),k(ue,B),k(B,J),k(ue,ce),k(ue,me),k(f,Be),k(f,He),k(He,Y),k(Y,Ke),k(He,mt),k(He,fe),k(d,gt),k(d,Et),k(Et,Bt),k(Bt,Xt),k(Xt,rn),k(Bt,Wt),k(Bt,Nt),k(Et,ie),k(Et,Ge),k(Ge,nt),k(nt,Me),k(Ge,Yt),k(Ge,Tt),k(Et,qe),k(Et,Oe),k(Oe,$e),k($e,kt),k(Oe,Rt),k(Oe,pt),k(Et,sn),k(Et,Jt),k(Jt,qt),k(qt,bn),k(Jt,Cn),k(Jt,xt),k(e,xn),k(e,Bn),k(Bn,Zn),k(Zn,wo),k(e,Do),k(e,$n),k($n,eo),k(eo,yn),k(yn,K),k(K,Pe),k(Pe,ut),k(K,We),k(K,it),k(yn,zn),k(yn,Ct),k(Ct,cn),k(cn,lo),k(Ct,ko),k(Ct,co),k(yn,ar),k(yn,Z),k(Z,Jo),k(Jo,Ar),k(Z,ei),k(Z,Ho),k(yn,ti),k(yn,Co),k(Co,xo),k(xo,le),k(Co,ve),k(Co,De),Ee||(we=Ie(s,"click",o[3]),Ee=!0)},p(Te,ze){ze&2&&r!==(r=Te[1].t("Keyboard shortcuts")+"")&&Ne(i,r),ze&2&&y!==(y=Te[1].t("Open new chat")+"")&&Ne(v,y),ze&2&&E!==(E=Te[1].t("Focus chat input")+"")&&Ne(H,E),ze&2&&V!==(V=Te[1].t("Copy last code block")+"")&&Ne(N,V),ze&2&&x!==(x=Te[1].t("Copy last response")+"")&&Ne(J,x),ze&2&&Xe!==(Xe=Te[1].t("Generate prompt pair")+"")&&Ne(Ke,Xe),ze&2&&Ot!==(Ot=Te[1].t("Toggle settings")+"")&&Ne(rn,Ot),ze&2&&vt!==(vt=Te[1].t("Toggle sidebar")+"")&&Ne(Me,vt),ze&2&&It!==(It=Te[1].t("Delete chat")+"")&&Ne(kt,It),ze&2&&fn!==(fn=Te[1].t("Show shortcuts")+"")&&Ne(bn,fn),ze&2&&ao!==(ao=Te[1].t("Input commands")+"")&&Ne(wo,ao),ze&2&&Ze!==(Ze=Te[1].t("Attach file from knowledge")+"")&&Ne(ut,Ze),ze&2&&to!==(to=Te[1].t("Add custom prompt")+"")&&Ne(lo,to),ze&2&&lr!==(lr=Te[1].t("Talk to model")+"")&&Ne(Ar,lr),ze&2&&z!==(z=Te[1].t("Accept autocomplete generation / Jump to prompt variable")+"")&&Ne(le,z)},d(Te){Te&&p(e),Ee=!1,we()}}}function SI(o){let e,t,n;function r(a){o[4](a)}let i={$$slots:{default:[TI]},$$scope:{ctx:o}};return o[0]!==void 0&&(i.show=o[0]),e=new dp({props:i}),Ye.push(()=>tt(e,"show",r)),{c(){te(e.$$.fragment)},l(a){re(e.$$.fragment,a)},m(a,s){ne(e,a,s),n=!0},p(a,[s]){const l={};s&35&&(l.$$scope={dirty:s,ctx:a}),!t&&s&1&&(t=!0,l.show=a[0],et(()=>t=!1)),e.$set(l)},i(a){n||(T(e.$$.fragment,a),n=!0)},o(a){D(e.$$.fragment,a),n=!1},d(a){oe(e,a)}}}function AI(o,e,t){let n;const r=on("i18n");de(o,r,l=>t(1,n=l));let{show:i=!1}=e;const a=()=>{t(0,i=!1)};function s(l){i=l,t(0,i)}return o.$$set=l=>{"show"in l&&t(0,i=l.show)},[i,n,r,a,s]}class RI extends Ve{constructor(e){super(),Fe(this,e,AI,SI,Qe,{show:0})}}function MI(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var r=I(e);t=ye(r,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"stroke-linecap","round"),g(t,"stroke-linejoin","round"),g(t,"d","M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","none"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"stroke","currentColor"),g(e,"class",o[0])},m(n,r){U(n,e,r),k(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Re,o:Re,d(n){n&&p(e)}}}function PI(o,e,t){let{className:n="w-4 h-4"}=e,{strokeWidth:r="2"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class OI extends Ve{constructor(e){super(),Fe(this,e,PI,MI,Qe,{className:0,strokeWidth:1})}}function NI(o){let e,t;return{c(){e=be("svg"),t=be("path"),this.h()},l(n){e=ye(n,"svg",{"aria-hidden":!0,xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,class:!0});var r=I(e);t=ye(r,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),I(t).forEach(p),r.forEach(p),this.h()},h(){g(t,"fill-rule","evenodd"),g(t,"d","M2 7a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V7Zm5.01 1H5v2.01h2.01V8Zm3 0H8v2.01h2.01V8Zm3 0H11v2.01h2.01V8Zm3 0H14v2.01h2.01V8Zm3 0H17v2.01h2.01V8Zm-12 3H5v2.01h2.01V11Zm3 0H8v2.01h2.01V11Zm3 0H11v2.01h2.01V11Zm3 0H14v2.01h2.01V11Zm3 0H17v2.01h2.01V11Zm-12 3H5v2.01h2.01V14ZM8 14l-.001 2 8.011.01V14H8Zm11.01 0H17v2.01h2.01V14Z"),g(t,"clip-rule","evenodd"),g(e,"aria-hidden","true"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"fill","currentColor"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width",o[1]),g(e,"class",o[0])},m(n,r){U(n,e,r),k(e,t)},p(n,[r]){r&2&&g(e,"stroke-width",n[1]),r&1&&g(e,"class",n[0])},i:Re,o:Re,d(n){n&&p(e)}}}function DI(o,e,t){let{className:n="size-4"}=e,{strokeWidth:r="2"}=e;return o.$$set=i=>{"className"in i&&t(0,n=i.className),"strokeWidth"in i&&t(1,r=i.strokeWidth)},[n,r]}class HI extends Ve{constructor(e){super(),Fe(this,e,DI,NI,Qe,{className:0,strokeWidth:1})}}function LI(o){let e;const t=o[5].default,n=gn(t,o,o[9],null);return{c(){n&&n.c()},l(r){n&&n.l(r)},m(r,i){n&&n.m(r,i),e=!0},p(r,i){n&&n.p&&(!e||i&512)&&mn(n,t,r,r[9],e?_n(t,r[9],i,null):pn(r[9]),null)},i(r){e||(T(n,r),e=!0)},o(r){D(n,r),e=!1},d(r){n&&n.d(r)}}}function UI(o){let e,t,n,r=o[2].t("Documentation")+"",i,a;return e=new OI({props:{className:"size-5"}}),{c(){te(e.$$.fragment),t=$(),n=M("div"),i=Se(r),this.h()},l(s){re(e.$$.fragment,s),t=ee(s),n=P(s,"DIV",{class:!0});var l=I(n);i=Ae(l,r),l.forEach(p),this.h()},h(){g(n,"class","flex items-center")},m(s,l){ne(e,s,l),U(s,t,l),U(s,n,l),k(n,i),a=!0},p(s,l){(!a||l&4)&&r!==(r=s[2].t("Documentation")+"")&&Ne(i,r)},i(s){a||(T(e.$$.fragment,s),a=!0)},o(s){D(e.$$.fragment,s),a=!1},d(s){s&&(p(t),p(n)),oe(e,s)}}}function BI(o){let e,t,n,r=o[2].t("Keyboard shortcuts")+"",i,a;return e=new HI({props:{className:"size-5"}}),{c(){te(e.$$.fragment),t=$(),n=M("div"),i=Se(r),this.h()},l(s){re(e.$$.fragment,s),t=ee(s),n=P(s,"DIV",{class:!0});var l=I(n);i=Ae(l,r),l.forEach(p),this.h()},h(){g(n,"class","flex items-center")},m(s,l){ne(e,s,l),U(s,t,l),U(s,n,l),k(n,i),a=!0},p(s,l){(!a||l&4)&&r!==(r=s[2].t("Keyboard shortcuts")+"")&&Ne(i,r)},i(s){a||(T(e.$$.fragment,s),a=!0)},o(s){D(e.$$.fragment,s),a=!1},d(s){s&&(p(t),p(n)),oe(e,s)}}}function zI(o){let e,t,n,r;return e=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-share-button",$$slots:{default:[UI]},$$scope:{ctx:o}}}),e.$on("click",o[6]),n=new Ln({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-share-button",$$slots:{default:[BI]},$$scope:{ctx:o}}}),n.$on("click",o[7]),{c(){te(e.$$.fragment),t=$(),te(n.$$.fragment)},l(i){re(e.$$.fragment,i),t=ee(i),re(n.$$.fragment,i)},m(i,a){ne(e,i,a),U(i,t,a),ne(n,i,a),r=!0},p(i,a){const s={};a&516&&(s.$$scope={dirty:a,ctx:i}),e.$set(s);const l={};a&516&&(l.$$scope={dirty:a,ctx:i}),n.$set(l)},i(i){r||(T(e.$$.fragment,i),T(n.$$.fragment,i),r=!0)},o(i){D(e.$$.fragment,i),D(n.$$.fragment,i),r=!1},d(i){i&&p(t),oe(e,i),oe(n,i)}}}function VI(o){let e,t,n;return t=new Ms({props:{class:"w-full max-w-[200px] rounded-xl px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",sideOffset:4,side:"top",align:"end",transition:Ei,$$slots:{default:[zI]},$$scope:{ctx:o}}}),{c(){e=M("div"),te(t.$$.fragment),this.h()},l(r){e=P(r,"DIV",{slot:!0});var i=I(e);re(t.$$.fragment,i),i.forEach(p),this.h()},h(){g(e,"slot","content")},m(r,i){U(r,e,i),ne(t,e,null),n=!0},p(r,i){const a={};i&517&&(a.$$scope={dirty:i,ctx:r}),t.$set(a)},i(r){n||(T(t.$$.fragment,r),n=!0)},o(r){D(t.$$.fragment,r),n=!1},d(r){r&&p(e),oe(t)}}}function FI(o){let e,t;return e=new Rs({props:{$$slots:{content:[VI],default:[LI]},$$scope:{ctx:o}}}),e.$on("change",o[8]),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,[r]){const i={};r&517&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function KI(o,e,t){let n,{$$slots:r={},$$scope:i}=e;const a=on("i18n");de(o,a,h=>t(2,n=h));let{showDocsHandler:s}=e,{showShortcutsHandler:l}=e,{onClose:c=()=>{}}=e;const u=()=>{window.open("https://docs.openwebui.com","_blank")},d=()=>{l()},f=h=>{h.detail===!1&&c()};return o.$$set=h=>{"showDocsHandler"in h&&t(4,s=h.showDocsHandler),"showShortcutsHandler"in h&&t(0,l=h.showShortcutsHandler),"onClose"in h&&t(1,c=h.onClose),"$$scope"in h&&t(9,i=h.$$scope)},[l,c,n,a,s,r,u,d,f,i]}class GI extends Ve{constructor(e){super(),Fe(this,e,KI,FI,Qe,{showDocsHandler:4,showShortcutsHandler:0,onClose:1})}}function WI(o){let e,t="?";return{c(){e=M("button"),e.textContent=t,this.h()},l(n){e=P(n,"BUTTON",{class:!0,"data-svelte-h":!0}),wt(e)!=="svelte-141cz2e"&&(e.textContent=t),this.h()},h(){g(e,"class","text-gray-600 dark:text-gray-300 bg-gray-300/20 size-4 flex items-center justify-center text-[0.7rem] rounded-full")},m(n,r){U(n,e,r)},p:Re,d(n){n&&p(e)}}}function YI(o){let e,t;return e=new Gt({props:{content:o[1].t("Help"),placement:"left",$$slots:{default:[WI]},$$scope:{ctx:o}}}),{c(){te(e.$$.fragment)},l(n){re(e.$$.fragment,n)},m(n,r){ne(e,n,r),t=!0},p(n,r){const i={};r&2&&(i.content=n[1].t("Help")),r&128&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(n){t||(T(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){oe(e,n)}}}function qI(o){let e,t,n,r,i,a,s,l,c,u;r=new GI({props:{showDocsHandler:o[4],showShortcutsHandler:o[5],$$slots:{default:[YI]},$$scope:{ctx:o}}});function d(h){o[6](h)}let f={};return o[0]!==void 0&&(f.show=o[0]),a=new RI({props:f}),Ye.push(()=>tt(a,"show",d)),{c(){e=M("div"),t=M("button"),n=$(),te(r.$$.fragment),i=$(),te(a.$$.fragment),this.h()},l(h){e=P(h,"DIV",{class:!0});var _=I(e);t=P(_,"BUTTON",{id:!0,class:!0}),I(t).forEach(p),n=ee(_),re(r.$$.fragment,_),_.forEach(p),i=ee(h),re(a.$$.fragment,h),this.h()},h(){g(t,"id","show-shortcuts-button"),g(t,"class","hidden"),g(e,"class","hidden lg:flex fixed bottom-0 right-0 px-1 py-1 z-20")},m(h,_){U(h,e,_),k(e,t),k(e,n),ne(r,e,null),U(h,i,_),ne(a,h,_),l=!0,c||(u=Ie(t,"click",o[3]),c=!0)},p(h,[_]){const y={};_&1&&(y.showDocsHandler=h[4]),_&1&&(y.showShortcutsHandler=h[5]),_&130&&(y.$$scope={dirty:_,ctx:h}),r.$set(y);const v={};!s&&_&1&&(s=!0,v.show=h[0],et(()=>s=!1)),a.$set(v)},i(h){l||(T(r.$$.fragment,h),T(a.$$.fragment,h),l=!0)},o(h){D(r.$$.fragment,h),D(a.$$.fragment,h),l=!1},d(h){h&&(p(e),p(i)),oe(r),oe(a,h),c=!1,u()}}}function jI(o,e,t){let n;const r=on("i18n");de(o,r,u=>t(1,n=u));let i=!1;const a=()=>{t(0,i=!i)},s=()=>{t(0,i=!i)},l=()=>{t(0,i=!i)};function c(u){i=u,t(0,i)}return[i,n,r,a,s,l,c]}class xT extends Ve{constructor(e){super(),Fe(this,e,jI,qI,Qe,{})}}export{JT as C,xT as H};
//# sourceMappingURL=Help.BuXpGRU6.js.map
